{
  "files": [
    {
      "name": "provider.tf",
      "content": "terraform {\n  required_version = \">= 1.3.0\"\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \">= 4.0\"\n    }\n  }\n}\n\nprovider \"aws\" {\n  region = var.aws_region\n}\n"
    },
    {
      "name": "variables.tf",
      "content": "variable \"aws_region\" {\n  description = \"AWS region to deploy resources in.\"\n  type        = string\n  default     = \"us-east-1\"\n}\n\nvariable \"project_name\" {\n  description = \"Project name prefix for resources.\"\n  type        = string\n  default     = \"ai-codegen\"\n}\n\nvariable \"lambda_runtime\" {\n  description = \"Lambda runtime environment.\"\n  type        = string\n  default     = \"python3.11\"\n}\n\nvariable \"lambda_handler\" {\n  description = \"Lambda handler function.\"\n  type        = string\n  default     = \"lambda.lambda_handler\"\n}\n\nvariable \"lambda_memory_size\" {\n  description = \"Lambda memory size in MB.\"\n  type        = number\n  default     = 256\n}\n\nvariable \"lambda_timeout\" {\n  description = \"Lambda timeout in seconds.\"\n  type        = number\n  default     = 30\n}\n\nvariable \"dynamodb_table_name\" {\n  description = \"DynamoDB table name.\"\n  type        = string\n  default     = \"ai_codegen_table\"\n}\n\nvariable \"dynamodb_hash_key\" {\n  description = \"DynamoDB table hash key.\"\n  type        = string\n  default     = \"id\"\n}\n\nvariable \"frontend_bucket_name\" {\n  description = \"S3 bucket name for static frontend.\"\n  type        = string\n  default     = \"ai-codegen-frontend\"\n}\n"
    },
    {
      "name": "s3_frontend.tf",
      "content": "resource \"aws_s3_bucket\" \"frontend\" {\n  bucket = var.frontend_bucket_name\n  force_destroy = true\n\n  tags = {\n    Name = \"${var.project_name}-frontend\"\n  }\n}\n\nresource \"aws_s3_bucket_public_access_block\" \"frontend\" {\n  bucket = aws_s3_bucket.frontend.id\n\n  block_public_acls   = true\n  block_public_policy = true\n  ignore_public_acls  = true\n  restrict_public_buckets = true\n}\n\nresource \"aws_cloudfront_origin_access_identity\" \"frontend_oai\" {\n  comment = \"OAI for frontend S3 bucket\"\n}\n\nresource \"aws_s3_bucket_policy\" \"frontend\" {\n  bucket = aws_s3_bucket.frontend.id\n  policy = data.aws_iam_policy_document.frontend_s3_policy.json\n}\n\ndata \"aws_iam_policy_document\" \"frontend_s3_policy\" {\n  statement {\n    actions = [\"s3:GetObject\"]\n    resources = [\"${aws_s3_bucket.frontend.arn}/*\"]\n    principals {\n      type        = \"AWS\"\n      identifiers = [aws_cloudfront_origin_access_identity.frontend_oai.iam_arn]\n    }\n  }\n}\n"
    },
    {
      "name": "cloudfront.tf",
      "content": "resource \"aws_cloudfront_distribution\" \"frontend\" {\n  origin {\n    domain_name = aws_s3_bucket.frontend.bucket_regional_domain_name\n    origin_id   = \"s3-frontend\"\n    s3_origin_config {\n      origin_access_identity = aws_cloudfront_origin_access_identity.frontend_oai.cloudfront_access_identity_path\n    }\n  }\n\n  enabled             = true\n  is_ipv6_enabled     = true\n  default_root_object = \"index.html\"\n\n  default_cache_behavior {\n    allowed_methods  = [\"GET\", \"HEAD\", \"OPTIONS\"]\n    cached_methods   = [\"GET\", \"HEAD\"]\n    target_origin_id = \"s3-frontend\"\n\n    forwarded_values {\n      query_string = false\n      cookies {\n        forward = \"none\"\n      }\n    }\n    viewer_protocol_policy = \"redirect-to-https\"\n  }\n\n  price_class = \"PriceClass_100\"\n\n  restrictions {\n    geo_restriction {\n      restriction_type = \"none\"\n    }\n  }\n\n  viewer_certificate {\n    cloudfront_default_certificate = true\n  }\n\n  tags = {\n    Name = \"${var.project_name}-frontend-cdn\"\n  }\n}\n"
    },
    {
      "name": "dynamodb.tf",
      "content": "resource \"aws_dynamodb_table\" \"main\" {\n  name         = var.dynamodb_table_name\n  billing_mode = \"PAY_PER_REQUEST\"\n  hash_key     = var.dynamodb_hash_key\n\n  attribute {\n    name = var.dynamodb_hash_key\n    type = \"S\"\n  }\n\n  tags = {\n    Name = \"${var.project_name}-dynamodb\"\n  }\n}\n"
    },
    {
      "name": "lambda.tf",
      "content": "resource \"aws_iam_role\" \"lambda_exec\" {\n  name = \"${var.project_name}-lambda-exec\"\n  assume_role_policy = data.aws_iam_policy_document.lambda_assume_role.json\n}\n\ndata \"aws_iam_policy_document\" \"lambda_assume_role\" {\n  statement {\n    actions = [\"sts:AssumeRole\"]\n    principals {\n      type        = \"Service\"\n      identifiers = [\"lambda.amazonaws.com\"]\n    }\n  }\n}\n\nresource \"aws_iam_role_policy\" \"lambda_policy\" {\n  name = \"${var.project_name}-lambda-policy\"\n  role = aws_iam_role.lambda_exec.id\n  policy = data.aws_iam_policy_document.lambda_policy.json\n}\n\ndata \"aws_iam_policy_document\" \"lambda_policy\" {\n  statement {\n    actions = [\n      \"dynamodb:GetItem\",\n      \"dynamodb:PutItem\",\n      \"dynamodb:UpdateItem\",\n      \"dynamodb:DeleteItem\",\n      \"dynamodb:Scan\",\n      \"dynamodb:Query\"\n    ]\n    resources = [aws_dynamodb_table.main.arn, \"${aws_dynamodb_table.main.arn}/*\"]\n  }\n  statement {\n    actions = [\n      \"logs:CreateLogGroup\",\n      \"logs:CreateLogStream\",\n      \"logs:PutLogEvents\"\n    ]\n    resources = [\"arn:aws:logs:*:*:*\"]\n  }\n}\n\nresource \"aws_lambda_function\" \"main\" {\n  function_name = \"${var.project_name}-lambda\"\n  role          = aws_iam_role.lambda_exec.arn\n  handler       = var.lambda_handler\n  runtime       = var.lambda_runtime\n  memory_size   = var.lambda_memory_size\n  timeout       = var.lambda_timeout\n\n  filename         = \"lambda.zip\"\n  source_code_hash = filebase64sha256(\"lambda.zip\")\n\n  environment {\n    variables = {\n      TABLE_NAME = aws_dynamodb_table.main.name\n    }\n  }\n\n  tags = {\n    Name = \"${var.project_name}-lambda\"\n  }\n}\n"
    },
    {
      "name": "api_gateway.tf",
      "content": "resource \"aws_api_gateway_rest_api\" \"main\" {\n  name        = \"${var.project_name}-api\"\n  description = \"API Gateway for Lambda backend\"\n}\n\nresource \"aws_api_gateway_resource\" \"proxy\" {\n  rest_api_id = aws_api_gateway_rest_api.main.id\n  parent_id   = aws_api_gateway_rest_api.main.root_resource_id\n  path_part   = \"{proxy+}\"\n}\n\nresource \"aws_api_gateway_method\" \"proxy\" {\n  rest_api_id   = aws_api_gateway_rest_api.main.id\n  resource_id   = aws_api_gateway_resource.proxy.id\n  http_method   = \"ANY\"\n  authorization = \"NONE\"\n  request_parameters = {\n    \"method.request.path.proxy\" = true\n  }\n}\n\nresource \"aws_api_gateway_integration\" \"lambda\" {\n  rest_api_id = aws_api_gateway_rest_api.main.id\n  resource_id = aws_api_gateway_resource.proxy.id\n  http_method = aws_api_gateway_method.proxy.http_method\n  integration_http_method = \"POST\"\n  type                    = \"AWS_PROXY\"\n  uri                     = aws_lambda_function.main.invoke_arn\n}\n\nresource \"aws_api_gateway_deployment\" \"main\" {\n  depends_on = [aws_api_gateway_integration.lambda]\n  rest_api_id = aws_api_gateway_rest_api.main.id\n  stage_name  = \"prod\"\n}\n\nresource \"aws_lambda_permission\" \"apigw\" {\n  statement_id  = \"AllowAPIGatewayInvoke\"\n  action        = \"lambda:InvokeFunction\"\n  function_name = aws_lambda_function.main.function_name\n  principal     = \"apigateway.amazonaws.com\"\n  source_arn    = \"${aws_api_gateway_rest_api.main.execution_arn}/*/*\"\n}\n"
    },
    {
      "name": "outputs.tf",
      "content": "output \"cloudfront_domain_name\" {\n  description = \"CloudFront distribution domain name for the frontend.\"\n  value       = aws_cloudfront_distribution.frontend.domain_name\n}\n\noutput \"api_gateway_invoke_url\" {\n  description = \"Invoke URL for the API Gateway.\"\n  value       = \"https://${aws_api_gateway_rest_api.main.id}.execute-api.${var.aws_region}.amazonaws.com/prod/\"\n}\n\noutput \"dynamodb_table_name\" {\n  description = \"DynamoDB table name.\"\n  value       = aws_dynamodb_table.main.name\n}\n"
    },
    {
      "name": "README.md",
      "content": "# AI Code Generation from Code to IaC - Terraform Infrastructure\n\nThis directory contains the Terraform configuration for deploying the serverless web application on AWS.\n\n## Architecture\n- **Frontend**: Static web assets hosted on S3, served via CloudFront.\n- **Backend**: Python AWS Lambda function, exposed via API Gateway.\n- **Database**: DynamoDB table for persistent storage.\n\n## How to Use\n1. Place your Lambda deployment package as `lambda.zip` in this directory.\n2. Run `terraform init` to initialize the configuration.\n3. Run `terraform apply` to deploy the infrastructure.\n\n## Outputs\n- CloudFront domain for the frontend\n- API Gateway invoke URL\n- DynamoDB table name\n"
    }
  ]
}