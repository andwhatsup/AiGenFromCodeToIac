{
  "files": [
    {
      "name": "provider.tf",
      "content": "terraform {\n  required_version = \">= 1.3.0\"\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \">= 4.0\"\n    }\n  }\n}\n\nprovider \"aws\" {\n  region = var.aws_region\n}\n"
    },
    {
      "name": "variables.tf",
      "content": "variable \"aws_region\" {\n  description = \"AWS region to deploy resources in.\"\n  type        = string\n  default     = \"us-east-1\"\n}\n\nvariable \"lambda_function_name\" {\n  description = \"Name for the Lambda function.\"\n  type        = string\n  default     = \"ai-codegen-lambda\"\n}\n\nvariable \"s3_bucket_name\" {\n  description = \"Name for the S3 bucket.\"\n  type        = string\n}\n\nvariable \"lambda_image_uri\" {\n  description = \"ECR image URI for the Lambda function.\"\n  type        = string\n}\n\nvariable \"vpc_id\" {\n  description = \"VPC ID for Lambda network isolation.\"\n  type        = string\n}\n\nvariable \"private_subnet_ids\" {\n  description = \"List of private subnet IDs for Lambda.\"\n  type        = list(string)\n}\n"
    },
    {
      "name": "main.tf",
      "content": "resource \"aws_s3_bucket\" \"lambda_data\" {\n  bucket = var.s3_bucket_name\n  force_destroy = true\n\n  tags = {\n    Name = \"ai-codegen-lambda-data\"\n  }\n}\n\nresource \"aws_iam_role\" \"lambda_exec\" {\n  name = \"${var.lambda_function_name}-exec-role\"\n  assume_role_policy = data.aws_iam_policy_document.lambda_assume_role.json\n}\n\ndata \"aws_iam_policy_document\" \"lambda_assume_role\" {\n  statement {\n    actions = [\"sts:AssumeRole\"]\n    principals {\n      type        = \"Service\"\n      identifiers = [\"lambda.amazonaws.com\"]\n    }\n  }\n}\n\nresource \"aws_iam_role_policy\" \"lambda_policy\" {\n  name = \"${var.lambda_function_name}-policy\"\n  role = aws_iam_role.lambda_exec.id\n  policy = data.aws_iam_policy_document.lambda_policy.json\n}\n\ndata \"aws_iam_policy_document\" \"lambda_policy\" {\n  statement {\n    actions = [\n      \"logs:CreateLogGroup\",\n      \"logs:CreateLogStream\",\n      \"logs:PutLogEvents\"\n    ]\n    resources = [\"arn:aws:logs:*:*:*\"]\n  }\n  statement {\n    actions = [\n      \"s3:GetObject\",\n      \"s3:PutObject\",\n      \"s3:ListBucket\"\n    ]\n    resources = [\n      aws_s3_bucket.lambda_data.arn,\n      \"${aws_s3_bucket.lambda_data.arn}/*\"\n    ]\n  }\n}\n\nresource \"aws_cloudwatch_log_group\" \"lambda\" {\n  name              = \"/aws/lambda/${var.lambda_function_name}\"\n  retention_in_days = 14\n}\n\nresource \"aws_security_group\" \"lambda\" {\n  name        = \"${var.lambda_function_name}-sg\"\n  description = \"Security group for Lambda function\"\n  vpc_id      = var.vpc_id\n\n  egress {\n    from_port   = 0\n    to_port     = 0\n    protocol    = \"-1\"\n    cidr_blocks = [\"0.0.0.0/0\"]\n  }\n}\n\nresource \"aws_lambda_function\" \"main\" {\n  function_name = var.lambda_function_name\n  role          = aws_iam_role.lambda_exec.arn\n  package_type  = \"Image\"\n  image_uri     = var.lambda_image_uri\n  timeout       = 60\n  memory_size   = 512\n  vpc_config {\n    subnet_ids         = var.private_subnet_ids\n    security_group_ids = [aws_security_group.lambda.id]\n  }\n  environment {\n    variables = {\n      S3_BUCKET = aws_s3_bucket.lambda_data.bucket\n    }\n  }\n  depends_on = [aws_cloudwatch_log_group.lambda]\n}\n"
    },
    {
      "name": "outputs.tf",
      "content": "output \"lambda_function_name\" {\n  description = \"Name of the Lambda function.\"\n  value       = aws_lambda_function.main.function_name\n}\n\noutput \"lambda_function_arn\" {\n  description = \"ARN of the Lambda function.\"\n  value       = aws_lambda_function.main.arn\n}\n\noutput \"s3_bucket_name\" {\n  description = \"Name of the S3 bucket.\"\n  value       = aws_s3_bucket.lambda_data.bucket\n}\n"
    },
    {
      "name": "README.md",
      "content": "# AI Code Generation Lambda Terraform\n\nThis Terraform configuration provisions a secure, serverless AWS Lambda function (Python, Docker image) with S3 storage, IAM roles, VPC network isolation, and CloudWatch logging.\n\n## Resources\n- AWS Lambda (Docker image)\n- S3 Bucket\n- IAM Role & Policy (least privilege)\n- CloudWatch Log Group\n- Security Group (for Lambda)\n\n## Required Variables\n- `aws_region`: AWS region\n- `lambda_function_name`: Name for the Lambda function\n- `s3_bucket_name`: Name for the S3 bucket\n- `lambda_image_uri`: ECR image URI for Lambda\n- `vpc_id`: VPC ID for Lambda\n- `private_subnet_ids`: List of private subnet IDs for Lambda\n\n## Usage\n1. Build and push your Lambda Docker image to ECR.\n2. Set the required variables (see `variables.tf`).\n3. Run `terraform init`, `terraform plan`, and `terraform apply`.\n\n## Security\n- Lambda runs in a VPC for network isolation.\n- IAM policy grants only S3 and CloudWatch access.\n- Security group allows all egress (modify as needed).\n"
    }
  ]
}