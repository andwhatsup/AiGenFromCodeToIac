{
  "files": [
    {
      "name": "provider.tf",
      "content": "terraform {\n  required_version = \">= 1.3.0\"\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \">= 4.0\"\n    }\n  }\n}\n\nprovider \"aws\" {\n  region = var.aws_region\n}\n"
    },
    {
      "name": "variables.tf",
      "content": "variable \"aws_region\" {\n  description = \"AWS region to deploy resources in.\"\n  type        = string\n  default     = \"us-east-1\"\n}\n\nvariable \"lambda_function_name\" {\n  description = \"Name for the Lambda function.\"\n  type        = string\n  default     = \"go-serverless-lambda\"\n}\n\nvariable \"s3_bucket_name\" {\n  description = \"Name for the S3 bucket.\"\n  type        = string\n  default     = \"go-serverless-bucket\"\n}\n\nvariable \"sqs_queue_name\" {\n  description = \"Name for the SQS queue.\"\n  type        = string\n  default     = \"go-serverless-queue\"\n}\n"
    },
    {
      "name": "main.tf",
      "content": "resource \"aws_s3_bucket\" \"lambda_bucket\" {\n  bucket = var.s3_bucket_name\n  force_destroy = true\n}\n\nresource \"aws_sqs_queue\" \"lambda_queue\" {\n  name = var.sqs_queue_name\n}\n\nresource \"aws_iam_role\" \"lambda_exec\" {\n  name = \"lambda_exec_role\"\n  assume_role_policy = data.aws_iam_policy_document.lambda_assume_role_policy.json\n}\n\ndata \"aws_iam_policy_document\" \"lambda_assume_role_policy\" {\n  statement {\n    actions = [\"sts:AssumeRole\"]\n    principals {\n      type        = \"Service\"\n      identifiers = [\"lambda.amazonaws.com\"]\n    }\n  }\n}\n\nresource \"aws_iam_role_policy\" \"lambda_policy\" {\n  name = \"lambda_policy\"\n  role = aws_iam_role.lambda_exec.id\n  policy = data.aws_iam_policy_document.lambda_policy.json\n}\n\ndata \"aws_iam_policy_document\" \"lambda_policy\" {\n  statement {\n    actions = [\n      \"s3:GetObject\",\n      \"s3:PutObject\",\n      \"s3:ListBucket\"\n    ]\n    resources = [\n      aws_s3_bucket.lambda_bucket.arn,\n      \"${aws_s3_bucket.lambda_bucket.arn}/*\"\n    ]\n  }\n  statement {\n    actions = [\n      \"sqs:SendMessage\",\n      \"sqs:ReceiveMessage\",\n      \"sqs:DeleteMessage\",\n      \"sqs:GetQueueAttributes\"\n    ]\n    resources = [aws_sqs_queue.lambda_queue.arn]\n  }\n  statement {\n    actions = [\n      \"logs:CreateLogGroup\",\n      \"logs:CreateLogStream\",\n      \"logs:PutLogEvents\"\n    ]\n    resources = [\"arn:aws:logs:*:*:*\"]\n  }\n}\n\nresource \"aws_lambda_function\" \"go_lambda\" {\n  function_name = var.lambda_function_name\n  role          = aws_iam_role.lambda_exec.arn\n  handler       = \"bootstrap\"\n  runtime       = \"go1.x\"\n  filename      = \"lambda/build/handler.zip\"\n  source_code_hash = filebase64sha256(\"lambda/build/handler.zip\")\n  environment {\n    variables = {\n      S3_BUCKET = aws_s3_bucket.lambda_bucket.bucket\n      SQS_QUEUE = aws_sqs_queue.lambda_queue.name\n    }\n  }\n  depends_on = [aws_iam_role_policy.lambda_policy]\n}\n\nresource \"aws_cloudwatch_log_group\" \"lambda_log_group\" {\n  name              = \"/aws/lambda/${aws_lambda_function.go_lambda.function_name}\"\n  retention_in_days = 14\n}\n"
    },
    {
      "name": "outputs.tf",
      "content": "output \"lambda_function_name\" {\n  description = \"The name of the Lambda function.\"\n  value       = aws_lambda_function.go_lambda.function_name\n}\n\noutput \"s3_bucket_name\" {\n  description = \"The name of the S3 bucket.\"\n  value       = aws_s3_bucket.lambda_bucket.bucket\n}\n\noutput \"sqs_queue_url\" {\n  description = \"The URL of the SQS queue.\"\n  value       = aws_sqs_queue.lambda_queue.url\n}\n\noutput \"lambda_iam_role_arn\" {\n  description = \"The ARN of the Lambda execution role.\"\n  value       = aws_iam_role.lambda_exec.arn\n}\n"
    }
  ]
}