{
  "files": [
    {
      "name": "provider.tf",
      "content": "terraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \">= 4.0\"\n    }\n  }\n  required_version = \">= 1.3.0\"\n}\n\nprovider \"aws\" {\n  region = var.aws_region\n}\n"
    },
    {
      "name": "variables.tf",
      "content": "variable \"aws_region\" {\n  description = \"AWS region to deploy resources in.\"\n  type        = string\n  default     = \"us-east-1\"\n}\n\nvariable \"lambda_function_name\" {\n  description = \"Name for the Lambda function.\"\n  type        = string\n  default     = \"telegram-bot-java-lambda\"\n}\n\nvariable \"lambda_handler\" {\n  description = \"Handler for the Lambda function.\"\n  type        = string\n  default     = \"com.example.Handler::handleRequest\"\n}\n\nvariable \"lambda_runtime\" {\n  description = \"Runtime for the Lambda function.\"\n  type        = string\n  default     = \"java17\"\n}\n\nvariable \"lambda_memory_size\" {\n  description = \"Memory size for the Lambda function (MB).\"\n  type        = number\n  default     = 512\n}\n\nvariable \"lambda_timeout\" {\n  description = \"Timeout for the Lambda function (seconds).\"\n  type        = number\n  default     = 30\n}\n\nvariable \"bot_token\" {\n  description = \"Telegram bot token (should be stored securely).\"\n  type        = string\n  sensitive   = true\n}\n\nvariable \"chat_id\" {\n  description = \"Telegram chat ID.\"\n  type        = string\n}\n\nvariable \"half_month_message\" {\n  description = \"Message to send at half month.\"\n  type        = string\n}\n\nvariable \"end_month_message\" {\n  description = \"Message to send at end of month.\"\n  type        = string\n}\n\nvariable \"lambda_s3_bucket\" {\n  description = \"S3 bucket where the Lambda deployment package is stored.\"\n  type        = string\n}\n\nvariable \"lambda_s3_key\" {\n  description = \"S3 key for the Lambda deployment package.\"\n  type        = string\n}\n"
    },
    {
      "name": "iam.tf",
      "content": "resource \"aws_iam_role\" \"lambda_exec\" {\n  name = \"${var.lambda_function_name}-exec-role\"\n\n  assume_role_policy = jsonencode({\n    Version = \"2012-10-17\"\n    Statement = [{\n      Action = \"sts:AssumeRole\"\n      Effect = \"Allow\"\n      Principal = {\n        Service = \"lambda.amazonaws.com\"\n      }\n    }]\n  })\n}\n\nresource \"aws_iam_role_policy\" \"lambda_exec_policy\" {\n  name = \"${var.lambda_function_name}-exec-policy\"\n  role = aws_iam_role.lambda_exec.id\n\n  policy = jsonencode({\n    Version = \"2012-10-17\"\n    Statement = [\n      {\n        Effect = \"Allow\"\n        Action = [\n          \"logs:CreateLogGroup\",\n          \"logs:CreateLogStream\",\n          \"logs:PutLogEvents\"\n        ]\n        Resource = \"arn:aws:logs:*:*:*\"\n      }\n    ]\n  })\n}\n"
    },
    {
      "name": "lambda.tf",
      "content": "resource \"aws_lambda_function\" \"telegram_bot\" {\n  function_name = var.lambda_function_name\n  handler       = var.lambda_handler\n  runtime       = var.lambda_runtime\n  role          = aws_iam_role.lambda_exec.arn\n  memory_size   = var.lambda_memory_size\n  timeout       = var.lambda_timeout\n\n  s3_bucket     = var.lambda_s3_bucket\n  s3_key        = var.lambda_s3_key\n\n  environment {\n    variables = {\n      bot_token           = var.bot_token\n      chat_id             = var.chat_id\n      half_month_message  = var.half_month_message\n      end_month_message   = var.end_month_message\n    }\n  }\n\n  depends_on = [aws_iam_role_policy.lambda_exec_policy]\n}\n\nresource \"aws_cloudwatch_log_group\" \"lambda_log_group\" {\n  name              = \"/aws/lambda/${aws_lambda_function.telegram_bot.function_name}\"\n  retention_in_days = 14\n}\n"
    },
    {
      "name": "outputs.tf",
      "content": "output \"lambda_function_name\" {\n  description = \"Name of the Lambda function.\"\n  value       = aws_lambda_function.telegram_bot.function_name\n}\n\noutput \"lambda_function_arn\" {\n  description = \"ARN of the Lambda function.\"\n  value       = aws_lambda_function.telegram_bot.arn\n}\n\noutput \"lambda_log_group_name\" {\n  description = \"CloudWatch Log Group name for the Lambda function.\"\n  value       = aws_cloudwatch_log_group.lambda_log_group.name\n}\n"
    }
  ]
}