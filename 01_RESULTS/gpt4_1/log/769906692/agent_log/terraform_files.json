{
  "files": [
    {
      "name": "provider.tf",
      "content": "terraform {\n  required_version = \">= 1.3.0\"\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \">= 5.0\"\n    }\n    kubernetes = {\n      source  = \"hashicorp/kubernetes\"\n      version = \">= 2.0\"\n    }\n    helm = {\n      source  = \"hashicorp/helm\"\n      version = \">= 2.0\"\n    }\n  }\n}\n\nprovider \"aws\" {\n  region = var.aws_region\n}\n\nprovider \"kubernetes\" {\n  host                   = module.eks.cluster_endpoint\n  cluster_ca_certificate = base64decode(module.eks.cluster_certificate_authority_data)\n  token                  = data.aws_eks_cluster_auth.cluster.token\n}\n\nprovider \"helm\" {\n  kubernetes {\n    host                   = module.eks.cluster_endpoint\n    cluster_ca_certificate = base64decode(module.eks.cluster_certificate_authority_data)\n    token                  = data.aws_eks_cluster_auth.cluster.token\n  }\n}\n"
    },
    {
      "name": "variables.tf",
      "content": "variable \"aws_region\" {\n  description = \"AWS region to deploy resources in\"\n  type        = string\n  default     = \"us-east-1\"\n}\n\nvariable \"vpc_cidr\" {\n  description = \"CIDR block for the VPC\"\n  type        = string\n  default     = \"10.0.0.0/16\"\n}\n\nvariable \"azs\" {\n  description = \"List of availability zones\"\n  type        = list(string)\n  default     = [\"us-east-1a\", \"us-east-1b\", \"us-east-1c\"]\n}\n\nvariable \"private_subnets\" {\n  description = \"List of private subnet CIDRs\"\n  type        = list(string)\n  default     = [\"10.0.1.0/24\", \"10.0.2.0/24\", \"10.0.3.0/24\"]\n}\n\nvariable \"public_subnets\" {\n  description = \"List of public subnet CIDRs\"\n  type        = list(string)\n  default     = [\"10.0.101.0/24\", \"10.0.102.0/24\", \"10.0.103.0/24\"]\n}\n\nvariable \"cluster_name\" {\n  description = \"EKS Cluster name\"\n  type        = string\n  default     = \"nodejs-eks-cluster\"\n}\n"
    },
    {
      "name": "main.tf",
      "content": "module \"vpc\" {\n  source  = \"terraform-aws-modules/vpc/aws\"\n  version = \"6.5.1\"\n\n  name = var.cluster_name\n  cidr = var.vpc_cidr\n\n  azs             = var.azs\n  private_subnets = var.private_subnets\n  public_subnets  = var.public_subnets\n\n  enable_nat_gateway = true\n  single_nat_gateway = true\n\n  tags = {\n    Terraform   = \"true\"\n    Environment = \"dev\"\n  }\n}\n\nmodule \"eks\" {\n  source  = \"terraform-aws-modules/eks/aws\"\n  version = \"21.10.1\"\n\n  cluster_name    = var.cluster_name\n  cluster_version = \"1.29\"\n  vpc_id          = module.vpc.vpc_id\n  subnet_ids      = module.vpc.private_subnets\n  control_plane_subnet_ids = module.vpc.private_subnets\n\n  enable_irsa = true\n  enable_cluster_creator_admin_permissions = true\n\n  eks_managed_node_groups = {\n    node_group = {\n      desired_size = 3\n      max_size     = 4\n      min_size     = 1\n      instance_types = [\"t3.medium\"]\n      capacity_type  = \"ON_DEMAND\"\n    }\n  }\n\n  tags = {\n    Terraform   = \"true\"\n    Environment = \"dev\"\n  }\n}\n\ndata \"aws_eks_cluster\" \"cluster\" {\n  name = module.eks.cluster_name\n}\n\ndata \"aws_eks_cluster_auth\" \"cluster\" {\n  name = module.eks.cluster_name\n}\n"
    },
    {
      "name": "outputs.tf",
      "content": "output \"vpc_id\" {\n  description = \"The ID of the VPC\"\n  value       = module.vpc.vpc_id\n}\n\noutput \"private_subnets\" {\n  description = \"List of private subnet IDs\"\n  value       = module.vpc.private_subnets\n}\n\noutput \"public_subnets\" {\n  description = \"List of public subnet IDs\"\n  value       = module.vpc.public_subnets\n}\n\noutput \"eks_cluster_name\" {\n  description = \"EKS cluster name\"\n  value       = module.eks.cluster_name\n}\n\noutput \"eks_cluster_endpoint\" {\n  description = \"EKS cluster endpoint\"\n  value       = module.eks.cluster_endpoint\n}\n\noutput \"eks_cluster_security_group_id\" {\n  description = \"EKS cluster security group ID\"\n  value       = module.eks.cluster_security_group_id\n}\n\noutput \"eks_managed_node_group_arn\" {\n  description = \"EKS managed node group ARN\"\n  value       = module.eks.eks_managed_node_groups[\"node_group\"].arn\n}\n"
    }
  ]
}