{
  "version": 4,
  "terraform_version": "1.13.5",
  "serial": 7,
  "lineage": "44af2910-2b63-5691-1961-5fca9239e223",
  "outputs": {
    "rekognition_state_machine_arn": {
      "value": "arn:aws:states:us-east-1:000000000000:stateMachine:rekognition-app-state-machine",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "managed",
      "type": "aws_iam_policy",
      "name": "rekognition_policy",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::000000000000:policy/rekognition-app-rekognition-policy",
            "attachment_count": 0,
            "delay_after_policy_creation_in_ms": null,
            "description": "Allow Step Functions to call Rekognition APIs",
            "id": "arn:aws:iam::000000000000:policy/rekognition-app-rekognition-policy",
            "name": "rekognition-app-rekognition-policy",
            "name_prefix": "",
            "path": "/",
            "policy": "{\"Statement\":[{\"Action\":[\"rekognition:DetectFaces\",\"rekognition:DetectLabels\",\"rekognition:DetectModerationLabels\",\"rekognition:DetectProtectiveEquipment\",\"rekognition:DetectText\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"}",
            "policy_id": "A6LD8COET43UNUX7O5HI2",
            "tags": null,
            "tags_all": {}
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "arn": "arn:aws:iam::000000000000:policy/rekognition-app-rekognition-policy"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "step_function_role",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::000000000000:role/rekognition-app-step-function-role",
            "assume_role_policy": "{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"states.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}",
            "create_date": "2026-01-23T19:55:12Z",
            "description": "",
            "force_detach_policies": false,
            "id": "rekognition-app-step-function-role",
            "inline_policy": [],
            "managed_policy_arns": [],
            "max_session_duration": 3600,
            "name": "rekognition-app-step-function-role",
            "name_prefix": "",
            "path": "/",
            "permissions_boundary": "",
            "tags": null,
            "tags_all": {},
            "unique_id": "AROAQAAAAAAAHP4JDDXW4"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "000000000000",
            "name": "rekognition-app-step-function-role"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy_attachment",
      "name": "step_function_attach",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "rekognition-app-step-function-role/arn:aws:iam::000000000000:policy/rekognition-app-rekognition-policy",
            "policy_arn": "arn:aws:iam::000000000000:policy/rekognition-app-rekognition-policy",
            "role": "rekognition-app-step-function-role"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "account_id": "000000000000",
            "policy_arn": "arn:aws:iam::000000000000:policy/rekognition-app-rekognition-policy",
            "role": "rekognition-app-step-function-role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_policy.rekognition_policy",
            "aws_iam_role.step_function_role"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_sfn_state_machine",
      "name": "rekognition_state_machine",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:states:us-east-1:000000000000:stateMachine:rekognition-app-state-machine",
            "creation_date": "2026-01-23T19:55:12Z",
            "definition": "{\n    \"StartAt\": \"Map\",\n    \"States\": {\n        \"Map\": {\n            \"Type\": \"Map\",\n            \"ItemProcessor\": {\n                \"ProcessorConfig\": {\n                    \"Mode\": \"INLINE\"\n                },\n                \"StartAt\": \"CheckEventSource\",\n                \"States\": {\n                    \"CheckEventSource\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"And\": [\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"IsPresent\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"IsString\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"StringEquals\": \"aws:sqs\"\n                                    }\n                                ],\n                                \"Next\": \"CheckBody\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckEventSource\"\n                    },\n                    \"CheckBody\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"And\": [\n                                    {\n                                        \"Variable\": \"$.body\",\n                                        \"IsPresent\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.body\",\n                                        \"IsString\": true\n                                    }\n                                ],\n                                \"Next\": \"PassBody\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckBody\"\n                    },\n                    \"PassBody\": {\n                        \"Type\": \"Pass\",\n                        \"Parameters\": {\n                            \"body.$\": \"States.StringToJson($.body)\"\n                        },\n                        \"Next\": \"CheckBodyRecords\"\n                    },\n                    \"CheckBodyRecords\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"Variable\": \"$.Records\",\n                                \"IsPresent\": true,\n                                \"Next\": \"MapBodyRecords\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckBodyRecords\",\n                        \"InputPath\": \"$.body\"\n                    },\n                    \"MapBodyRecords\": {\n                        \"Type\": \"Map\",\n                        \"ItemProcessor\": {\n                            \"ProcessorConfig\": {\n                                \"Mode\": \"INLINE\"\n                            },\n                            \"StartAt\": \"CheckBodyRecordEventSource\",\n                            \"States\": {\n                                \"CheckBodyRecordEventSource\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"And\": [\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"IsPresent\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"IsString\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"StringEquals\": \"aws:s3\"\n                                                }\n                                            ],\n                                            \"Next\": \"CheckBodyRecordEventName\"\n                                        }\n                                    ],\n                                    \"Default\": \"SuccessCheckBodyRecordEventSource\"\n                                },\n                                \"CheckBodyRecordEventName\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"And\": [\n                                                {\n                                                    \"Variable\": \"$.eventName\",\n                                                    \"IsPresent\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventName\",\n                                                    \"IsString\": true\n                                                },\n                                                {\n                                                    \"Or\": [\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:CompleteMultipartUpload\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Copy\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Post\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Put\"\n                                                        }\n                                                    ]\n                                                }\n                                            ],\n                                            \"Next\": \"CheckBodyRecordS3\"\n                                        }\n                                    ],\n                                    \"Default\": \"SuccessCheckBodyRecordEventName\"\n                                },\n                                \"CheckBodyRecordS3\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"Variable\": \"$.s3\",\n                                            \"IsPresent\": true,\n                                            \"Next\": \"PassBodyRecordS3\"\n                                        }\n                                    ],\n                                    \"Default\": \"Success\"\n                                },\n                                \"PassBodyRecordS3\": {\n                                    \"Type\": \"Pass\",\n                                    \"InputPath\": \"$.s3\",\n                                    \"Next\": \"ParallelRekognitionStateMachines\"\n                                },\n                                \"ParallelRekognitionStateMachines\": {\n                                    \"Type\": \"Parallel\",\n                                    \"End\": true,\n                                    \"Branches\": [\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectFaces\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectFaces\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_faces}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectFaces\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectFaces\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_faces}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectLabels\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_labels}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectLabels\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_labels}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectModerationLabels\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectModerationLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_moderation_labels}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectDetectModerationLabels\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectDetectModerationLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_moderation_labels}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectProtectiveEquipment\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectProtectiveEquipment\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_protective_equipment}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectProtectiveEquipment\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectProtectiveEquipment\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_protective_equipment}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectText\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectText\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_text}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectText\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectText\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_text}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        }\n                                    ],\n                                    \"Parameters\": {\n                                        \"S3\": {\n                                            \"Bucket\": {\n                                                \"Name.$\": \"$.bucket.name\"\n                                            },\n                                            \"Object\": {\n                                                \"Key.$\": \"$.object.key\"\n                                            }\n                                        }\n                                    }\n                                },\n                                \"Success\": {\n                                    \"Type\": \"Succeed\"\n                                },\n                                \"SuccessCheckBodyRecordEventName\": {\n                                    \"Type\": \"Succeed\"\n                                },\n                                \"SuccessCheckBodyRecordEventSource\": {\n                                    \"Type\": \"Succeed\"\n                                }\n                            }\n                        },\n                        \"End\": true,\n                        \"ItemsPath\": \"$.Records\"\n                    },\n                    \"SuccessCheckBodyRecords\": {\n                        \"Type\": \"Succeed\"\n                    },\n                    \"SuccessCheckBody\": {\n                        \"Type\": \"Succeed\"\n                    },\n                    \"SuccessCheckEventSource\": {\n                        \"Type\": \"Succeed\"\n                    }\n                }\n            },\n            \"End\": true,\n            \"ItemsPath\": \"$\"\n        }\n    }\n}\n",
            "description": "",
            "encryption_configuration": [],
            "id": "arn:aws:states:us-east-1:000000000000:stateMachine:rekognition-app-state-machine",
            "logging_configuration": [
              {
                "include_execution_data": false,
                "level": "OFF",
                "log_destination": ""
              }
            ],
            "name": "rekognition-app-state-machine",
            "name_prefix": "",
            "publish": false,
            "region": "us-east-1",
            "revision_id": "",
            "role_arn": "arn:aws:iam::000000000000:role/rekognition-app-step-function-role",
            "state_machine_version_arn": "",
            "status": "ACTIVE",
            "tags": null,
            "tags_all": {},
            "timeouts": null,
            "tracing_configuration": [],
            "type": "STANDARD",
            "version_description": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "identity": {
            "arn": "arn:aws:states:us-east-1:000000000000:stateMachine:rekognition-app-state-machine"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjYwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "aws_iam_role.step_function_role"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "random_id",
      "name": "suffix",
      "provider": "provider[\"registry.terraform.io/hashicorp/random\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "b64_std": "1vmyFw==",
            "b64_url": "1vmyFw",
            "byte_length": 4,
            "dec": "3606688279",
            "hex": "d6f9b217",
            "id": "1vmyFw",
            "keepers": null,
            "prefix": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    }
  ],
  "check_results": null
}
