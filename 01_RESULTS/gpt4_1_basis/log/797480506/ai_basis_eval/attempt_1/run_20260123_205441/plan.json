{"format_version":"1.2","terraform_version":"1.13.5","variables":{"app_name":{"value":"rekognition-app"},"aws_region":{"value":"us-east-1"}},"planned_values":{"outputs":{"artifact_bucket_name":{"sensitive":false},"rekognition_state_machine_arn":{"sensitive":false}},"root_module":{"resources":[{"address":"aws_iam_policy.rekognition_policy","mode":"managed","type":"aws_iam_policy","name":"rekognition_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"delay_after_policy_creation_in_ms":null,"description":"Allow Step Functions to call Rekognition APIs","name":"rekognition-app-rekognition-policy","path":"/","policy":"{\"Statement\":[{\"Action\":[\"rekognition:DetectFaces\",\"rekognition:DetectLabels\",\"rekognition:DetectModerationLabels\",\"rekognition:DetectProtectiveEquipment\",\"rekognition:DetectText\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"}","tags":null},"sensitive_values":{"tags_all":{}},"identity_schema_version":0,"identity":{"arn":null}},{"address":"aws_iam_role.step_function_role","mode":"managed","type":"aws_iam_role","name":"step_function_role","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"states.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"rekognition-app-step-function-role","path":"/","permissions_boundary":null,"tags":null},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}},"identity_schema_version":0,"identity":{"account_id":null,"name":null}},{"address":"aws_iam_role_policy_attachment.step_function_attach","mode":"managed","type":"aws_iam_role_policy_attachment","name":"step_function_attach","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"role":"rekognition-app-step-function-role"},"sensitive_values":{},"identity_schema_version":0,"identity":{"account_id":null,"policy_arn":null,"role":null}},{"address":"aws_s3_bucket.artifact_bucket","mode":"managed","type":"aws_s3_bucket","name":"artifact_bucket","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"force_destroy":true,"region":"us-east-1","tags":{"Name":"rekognition-app-artifacts"},"tags_all":{"Name":"rekognition-app-artifacts"},"timeouts":null},"sensitive_values":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags":{},"tags_all":{},"versioning":[],"website":[]},"identity_schema_version":0,"identity":{"account_id":null,"bucket":null,"region":null}},{"address":"aws_sfn_state_machine.rekognition_state_machine","mode":"managed","type":"aws_sfn_state_machine","name":"rekognition_state_machine","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"definition":"{\n    \"StartAt\": \"Map\",\n    \"States\": {\n        \"Map\": {\n            \"Type\": \"Map\",\n            \"ItemProcessor\": {\n                \"ProcessorConfig\": {\n                    \"Mode\": \"INLINE\"\n                },\n                \"StartAt\": \"CheckEventSource\",\n                \"States\": {\n                    \"CheckEventSource\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"And\": [\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"IsPresent\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"IsString\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"StringEquals\": \"aws:sqs\"\n                                    }\n                                ],\n                                \"Next\": \"CheckBody\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckEventSource\"\n                    },\n                    \"CheckBody\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"And\": [\n                                    {\n                                        \"Variable\": \"$.body\",\n                                        \"IsPresent\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.body\",\n                                        \"IsString\": true\n                                    }\n                                ],\n                                \"Next\": \"PassBody\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckBody\"\n                    },\n                    \"PassBody\": {\n                        \"Type\": \"Pass\",\n                        \"Parameters\": {\n                            \"body.$\": \"States.StringToJson($.body)\"\n                        },\n                        \"Next\": \"CheckBodyRecords\"\n                    },\n                    \"CheckBodyRecords\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"Variable\": \"$.Records\",\n                                \"IsPresent\": true,\n                                \"Next\": \"MapBodyRecords\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckBodyRecords\",\n                        \"InputPath\": \"$.body\"\n                    },\n                    \"MapBodyRecords\": {\n                        \"Type\": \"Map\",\n                        \"ItemProcessor\": {\n                            \"ProcessorConfig\": {\n                                \"Mode\": \"INLINE\"\n                            },\n                            \"StartAt\": \"CheckBodyRecordEventSource\",\n                            \"States\": {\n                                \"CheckBodyRecordEventSource\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"And\": [\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"IsPresent\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"IsString\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"StringEquals\": \"aws:s3\"\n                                                }\n                                            ],\n                                            \"Next\": \"CheckBodyRecordEventName\"\n                                        }\n                                    ],\n                                    \"Default\": \"SuccessCheckBodyRecordEventSource\"\n                                },\n                                \"CheckBodyRecordEventName\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"And\": [\n                                                {\n                                                    \"Variable\": \"$.eventName\",\n                                                    \"IsPresent\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventName\",\n                                                    \"IsString\": true\n                                                },\n                                                {\n                                                    \"Or\": [\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:CompleteMultipartUpload\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Copy\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Post\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Put\"\n                                                        }\n                                                    ]\n                                                }\n                                            ],\n                                            \"Next\": \"CheckBodyRecordS3\"\n                                        }\n                                    ],\n                                    \"Default\": \"SuccessCheckBodyRecordEventName\"\n                                },\n                                \"CheckBodyRecordS3\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"Variable\": \"$.s3\",\n                                            \"IsPresent\": true,\n                                            \"Next\": \"PassBodyRecordS3\"\n                                        }\n                                    ],\n                                    \"Default\": \"Success\"\n                                },\n                                \"PassBodyRecordS3\": {\n                                    \"Type\": \"Pass\",\n                                    \"InputPath\": \"$.s3\",\n                                    \"Next\": \"ParallelRekognitionStateMachines\"\n                                },\n                                \"ParallelRekognitionStateMachines\": {\n                                    \"Type\": \"Parallel\",\n                                    \"End\": true,\n                                    \"Branches\": [\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectFaces\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectFaces\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_faces}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectFaces\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectFaces\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_faces}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectLabels\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_labels}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectLabels\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_labels}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectModerationLabels\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectModerationLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_moderation_labels}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectDetectModerationLabels\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectDetectModerationLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_moderation_labels}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectProtectiveEquipment\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectProtectiveEquipment\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_protective_equipment}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectProtectiveEquipment\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectProtectiveEquipment\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_protective_equipment}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectText\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectText\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_text}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectText\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectText\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_text}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        }\n                                    ],\n                                    \"Parameters\": {\n                                        \"S3\": {\n                                            \"Bucket\": {\n                                                \"Name.$\": \"$.bucket.name\"\n                                            },\n                                            \"Object\": {\n                                                \"Key.$\": \"$.object.key\"\n                                            }\n                                        }\n                                    }\n                                },\n                                \"Success\": {\n                                    \"Type\": \"Succeed\"\n                                },\n                                \"SuccessCheckBodyRecordEventName\": {\n                                    \"Type\": \"Succeed\"\n                                },\n                                \"SuccessCheckBodyRecordEventSource\": {\n                                    \"Type\": \"Succeed\"\n                                }\n                            }\n                        },\n                        \"End\": true,\n                        \"ItemsPath\": \"$.Records\"\n                    },\n                    \"SuccessCheckBodyRecords\": {\n                        \"Type\": \"Succeed\"\n                    },\n                    \"SuccessCheckBody\": {\n                        \"Type\": \"Succeed\"\n                    },\n                    \"SuccessCheckEventSource\": {\n                        \"Type\": \"Succeed\"\n                    }\n                }\n            },\n            \"End\": true,\n            \"ItemsPath\": \"$\"\n        }\n    }\n}\n","name":"rekognition-app-state-machine","publish":false,"region":"us-east-1","tags":null,"timeouts":null,"type":"STANDARD"},"sensitive_values":{"encryption_configuration":[],"logging_configuration":[],"tags_all":{},"tracing_configuration":[]},"identity_schema_version":0,"identity":{"arn":null}},{"address":"random_id.suffix","mode":"managed","type":"random_id","name":"suffix","provider_name":"registry.terraform.io/hashicorp/random","schema_version":0,"values":{"byte_length":4,"keepers":null,"prefix":null},"sensitive_values":{}}]}},"resource_changes":[{"address":"aws_iam_policy.rekognition_policy","mode":"managed","type":"aws_iam_policy","name":"rekognition_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"delay_after_policy_creation_in_ms":null,"description":"Allow Step Functions to call Rekognition APIs","name":"rekognition-app-rekognition-policy","path":"/","policy":"{\"Statement\":[{\"Action\":[\"rekognition:DetectFaces\",\"rekognition:DetectLabels\",\"rekognition:DetectModerationLabels\",\"rekognition:DetectProtectiveEquipment\",\"rekognition:DetectText\"],\"Effect\":\"Allow\",\"Resource\":\"*\"}],\"Version\":\"2012-10-17\"}","tags":null},"after_unknown":{"arn":true,"attachment_count":true,"id":true,"name_prefix":true,"policy_id":true,"tags_all":true},"before_sensitive":false,"after_sensitive":{"tags_all":{}},"after_identity":{"arn":null}}},{"address":"aws_iam_role.step_function_role","mode":"managed","type":"aws_iam_role","name":"step_function_role","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"states.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name":"rekognition-app-step-function-role","path":"/","permissions_boundary":null,"tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name_prefix":true,"tags_all":true,"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}},"after_identity":{"account_id":null,"name":null}}},{"address":"aws_iam_role_policy_attachment.step_function_attach","mode":"managed","type":"aws_iam_role_policy_attachment","name":"step_function_attach","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"role":"rekognition-app-step-function-role"},"after_unknown":{"id":true,"policy_arn":true},"before_sensitive":false,"after_sensitive":{},"after_identity":{"account_id":null,"policy_arn":null,"role":null}}},{"address":"aws_s3_bucket.artifact_bucket","mode":"managed","type":"aws_s3_bucket","name":"artifact_bucket","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"force_destroy":true,"region":"us-east-1","tags":{"Name":"rekognition-app-artifacts"},"tags_all":{"Name":"rekognition-app-artifacts"},"timeouts":null},"after_unknown":{"acceleration_status":true,"acl":true,"arn":true,"bucket":true,"bucket_domain_name":true,"bucket_prefix":true,"bucket_region":true,"bucket_regional_domain_name":true,"cors_rule":true,"grant":true,"hosted_zone_id":true,"id":true,"lifecycle_rule":true,"logging":true,"object_lock_configuration":true,"object_lock_enabled":true,"policy":true,"replication_configuration":true,"request_payer":true,"server_side_encryption_configuration":true,"tags":{},"tags_all":{},"versioning":true,"website":true,"website_domain":true,"website_endpoint":true},"before_sensitive":false,"after_sensitive":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags":{},"tags_all":{},"versioning":[],"website":[]},"after_identity":{"account_id":null,"bucket":null,"region":null}}},{"address":"aws_sfn_state_machine.rekognition_state_machine","mode":"managed","type":"aws_sfn_state_machine","name":"rekognition_state_machine","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"definition":"{\n    \"StartAt\": \"Map\",\n    \"States\": {\n        \"Map\": {\n            \"Type\": \"Map\",\n            \"ItemProcessor\": {\n                \"ProcessorConfig\": {\n                    \"Mode\": \"INLINE\"\n                },\n                \"StartAt\": \"CheckEventSource\",\n                \"States\": {\n                    \"CheckEventSource\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"And\": [\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"IsPresent\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"IsString\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"StringEquals\": \"aws:sqs\"\n                                    }\n                                ],\n                                \"Next\": \"CheckBody\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckEventSource\"\n                    },\n                    \"CheckBody\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"And\": [\n                                    {\n                                        \"Variable\": \"$.body\",\n                                        \"IsPresent\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.body\",\n                                        \"IsString\": true\n                                    }\n                                ],\n                                \"Next\": \"PassBody\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckBody\"\n                    },\n                    \"PassBody\": {\n                        \"Type\": \"Pass\",\n                        \"Parameters\": {\n                            \"body.$\": \"States.StringToJson($.body)\"\n                        },\n                        \"Next\": \"CheckBodyRecords\"\n                    },\n                    \"CheckBodyRecords\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"Variable\": \"$.Records\",\n                                \"IsPresent\": true,\n                                \"Next\": \"MapBodyRecords\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckBodyRecords\",\n                        \"InputPath\": \"$.body\"\n                    },\n                    \"MapBodyRecords\": {\n                        \"Type\": \"Map\",\n                        \"ItemProcessor\": {\n                            \"ProcessorConfig\": {\n                                \"Mode\": \"INLINE\"\n                            },\n                            \"StartAt\": \"CheckBodyRecordEventSource\",\n                            \"States\": {\n                                \"CheckBodyRecordEventSource\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"And\": [\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"IsPresent\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"IsString\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"StringEquals\": \"aws:s3\"\n                                                }\n                                            ],\n                                            \"Next\": \"CheckBodyRecordEventName\"\n                                        }\n                                    ],\n                                    \"Default\": \"SuccessCheckBodyRecordEventSource\"\n                                },\n                                \"CheckBodyRecordEventName\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"And\": [\n                                                {\n                                                    \"Variable\": \"$.eventName\",\n                                                    \"IsPresent\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventName\",\n                                                    \"IsString\": true\n                                                },\n                                                {\n                                                    \"Or\": [\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:CompleteMultipartUpload\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Copy\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Post\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Put\"\n                                                        }\n                                                    ]\n                                                }\n                                            ],\n                                            \"Next\": \"CheckBodyRecordS3\"\n                                        }\n                                    ],\n                                    \"Default\": \"SuccessCheckBodyRecordEventName\"\n                                },\n                                \"CheckBodyRecordS3\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"Variable\": \"$.s3\",\n                                            \"IsPresent\": true,\n                                            \"Next\": \"PassBodyRecordS3\"\n                                        }\n                                    ],\n                                    \"Default\": \"Success\"\n                                },\n                                \"PassBodyRecordS3\": {\n                                    \"Type\": \"Pass\",\n                                    \"InputPath\": \"$.s3\",\n                                    \"Next\": \"ParallelRekognitionStateMachines\"\n                                },\n                                \"ParallelRekognitionStateMachines\": {\n                                    \"Type\": \"Parallel\",\n                                    \"End\": true,\n                                    \"Branches\": [\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectFaces\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectFaces\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_faces}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectFaces\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectFaces\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_faces}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectLabels\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_labels}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectLabels\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_labels}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectModerationLabels\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectModerationLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_moderation_labels}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectDetectModerationLabels\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectDetectModerationLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_moderation_labels}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectProtectiveEquipment\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectProtectiveEquipment\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_protective_equipment}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectProtectiveEquipment\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectProtectiveEquipment\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_protective_equipment}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectText\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectText\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_text}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectText\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectText\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_text}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        }\n                                    ],\n                                    \"Parameters\": {\n                                        \"S3\": {\n                                            \"Bucket\": {\n                                                \"Name.$\": \"$.bucket.name\"\n                                            },\n                                            \"Object\": {\n                                                \"Key.$\": \"$.object.key\"\n                                            }\n                                        }\n                                    }\n                                },\n                                \"Success\": {\n                                    \"Type\": \"Succeed\"\n                                },\n                                \"SuccessCheckBodyRecordEventName\": {\n                                    \"Type\": \"Succeed\"\n                                },\n                                \"SuccessCheckBodyRecordEventSource\": {\n                                    \"Type\": \"Succeed\"\n                                }\n                            }\n                        },\n                        \"End\": true,\n                        \"ItemsPath\": \"$.Records\"\n                    },\n                    \"SuccessCheckBodyRecords\": {\n                        \"Type\": \"Succeed\"\n                    },\n                    \"SuccessCheckBody\": {\n                        \"Type\": \"Succeed\"\n                    },\n                    \"SuccessCheckEventSource\": {\n                        \"Type\": \"Succeed\"\n                    }\n                }\n            },\n            \"End\": true,\n            \"ItemsPath\": \"$\"\n        }\n    }\n}\n","name":"rekognition-app-state-machine","publish":false,"region":"us-east-1","tags":null,"timeouts":null,"type":"STANDARD"},"after_unknown":{"arn":true,"creation_date":true,"description":true,"encryption_configuration":true,"id":true,"logging_configuration":true,"name_prefix":true,"revision_id":true,"role_arn":true,"state_machine_version_arn":true,"status":true,"tags_all":true,"tracing_configuration":true,"version_description":true},"before_sensitive":false,"after_sensitive":{"encryption_configuration":[],"logging_configuration":[],"tags_all":{},"tracing_configuration":[]},"after_identity":{"arn":null}}},{"address":"random_id.suffix","mode":"managed","type":"random_id","name":"suffix","provider_name":"registry.terraform.io/hashicorp/random","change":{"actions":["create"],"before":null,"after":{"byte_length":4,"keepers":null,"prefix":null},"after_unknown":{"b64_std":true,"b64_url":true,"dec":true,"hex":true,"id":true},"before_sensitive":false,"after_sensitive":{}}}],"output_changes":{"artifact_bucket_name":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"rekognition_state_machine_arn":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false}},"configuration":{"provider_config":{"aws":{"name":"aws","full_name":"registry.terraform.io/hashicorp/aws","version_constraint":"\u003e= 4.0.0","expressions":{"region":{"references":["var.aws_region"]}}},"random":{"name":"random","full_name":"registry.terraform.io/hashicorp/random"}},"root_module":{"outputs":{"artifact_bucket_name":{"expression":{"references":["aws_s3_bucket.artifact_bucket.bucket","aws_s3_bucket.artifact_bucket"]}},"rekognition_state_machine_arn":{"expression":{"references":["aws_sfn_state_machine.rekognition_state_machine.arn","aws_sfn_state_machine.rekognition_state_machine"]}}},"resources":[{"address":"aws_iam_policy.rekognition_policy","mode":"managed","type":"aws_iam_policy","name":"rekognition_policy","provider_config_key":"aws","expressions":{"description":{"constant_value":"Allow Step Functions to call Rekognition APIs"},"name":{"references":["var.app_name"]},"policy":{}},"schema_version":0},{"address":"aws_iam_role.step_function_role","mode":"managed","type":"aws_iam_role","name":"step_function_role","provider_config_key":"aws","expressions":{"assume_role_policy":{},"name":{"references":["var.app_name"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.step_function_attach","mode":"managed","type":"aws_iam_role_policy_attachment","name":"step_function_attach","provider_config_key":"aws","expressions":{"policy_arn":{"references":["aws_iam_policy.rekognition_policy.arn","aws_iam_policy.rekognition_policy"]},"role":{"references":["aws_iam_role.step_function_role.name","aws_iam_role.step_function_role"]}},"schema_version":0},{"address":"aws_s3_bucket.artifact_bucket","mode":"managed","type":"aws_s3_bucket","name":"artifact_bucket","provider_config_key":"aws","expressions":{"bucket":{"references":["var.app_name","random_id.suffix.hex","random_id.suffix"]},"force_destroy":{"constant_value":true},"tags":{"references":["var.app_name"]}},"schema_version":0},{"address":"aws_sfn_state_machine.rekognition_state_machine","mode":"managed","type":"aws_sfn_state_machine","name":"rekognition_state_machine","provider_config_key":"aws","expressions":{"definition":{"references":["path.module"]},"name":{"references":["var.app_name"]},"role_arn":{"references":["aws_iam_role.step_function_role.arn","aws_iam_role.step_function_role"]}},"schema_version":0},{"address":"random_id.suffix","mode":"managed","type":"random_id","name":"suffix","provider_config_key":"random","expressions":{"byte_length":{"constant_value":4}},"schema_version":0}],"variables":{"app_name":{"default":"rekognition-app","description":"Name of the application"},"aws_region":{"default":"us-east-1","description":"AWS region to deploy resources"}}}},"relevant_attributes":[{"resource":"aws_iam_policy.rekognition_policy","attribute":["arn"]},{"resource":"aws_iam_role.step_function_role","attribute":["name"]},{"resource":"aws_iam_role.step_function_role","attribute":["arn"]},{"resource":"random_id.suffix","attribute":["hex"]},{"resource":"aws_s3_bucket.artifact_bucket","attribute":["bucket"]},{"resource":"aws_sfn_state_machine.rekognition_state_machine","attribute":["arn"]}],"timestamp":"2026-01-23T19:55:08Z","applyable":true,"complete":true,"errored":false}
