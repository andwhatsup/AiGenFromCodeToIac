{"format_version":"1.2","terraform_version":"1.13.5","variables":{"access_key":{"value":"terraform.txt"},"aws_account":{"value":"terraform"},"azs":{"value":[]},"bucket":{"value":"terraform-bucket"},"ec2_keypair":{"value":"infra-key"},"image_id":{"value":"terraform"},"instance_type":{"value":"t3.micro"},"name":{"value":"terraform"},"region":{"value":"us-east-1"},"secret_key":{"value":"terraform.txt"},"volume_size":{"value":"terraform"},"vpc_cidr_block":{"value":"10.154.0.0/24"},"vpc_id":{"value":"vpc-00000000"}},"planned_values":{"root_module":{"resources":[{"address":"aws_iam_instance_profile.url-shortener-profile","mode":"managed","type":"aws_iam_instance_profile","name":"url-shortener-profile","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"name":"terraform","path":"/","role":"terraform","tags":null},"sensitive_values":{"tags_all":{}}},{"address":"aws_iam_policy.url-shortener-bucket-readonly","mode":"managed","type":"aws_iam_policy","name":"url-shortener-bucket-readonly","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":null,"name":"terraform-url-shortener-bucket-readonly","path":"/","policy":"{\"Statement\":[{\"Action\":[\"s3:List*\",\"s3:Get*\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:s3:::terraform-bucket\",\"arn:aws:s3:::terraform-bucket/*\"],\"Sid\":\"Stmt1425916919000\"}],\"Version\":\"2012-10-17\"}","tags":null},"sensitive_values":{"tags_all":{}},"identity_schema_version":0,"identity":{"arn":null}},{"address":"aws_iam_role.url-shortener","mode":"managed","type":"aws_iam_role","name":"url-shortener","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"},\"Sid\":\"\"}],\"Version\":\"2012-10-17\"}","description":"terraform instance role","force_detach_policies":false,"max_session_duration":3600,"name":"terraform","path":"/","permissions_boundary":null,"tags":null},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}},"identity_schema_version":0,"identity":{"account_id":null,"name":null}},{"address":"aws_iam_role_policy_attachment.url-shortener-bucket-readonly","mode":"managed","type":"aws_iam_role_policy_attachment","name":"url-shortener-bucket-readonly","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"role":"terraform"},"sensitive_values":{},"identity_schema_version":0,"identity":{"account_id":null,"policy_arn":null,"role":null}},{"address":"aws_instance.flask-web","mode":"managed","type":"aws_instance","name":"flask-web","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":2,"values":{"ami":"terraform","credit_specification":[],"force_destroy":false,"get_password_data":false,"hibernation":null,"iam_instance_profile":"terraform","instance_type":"t3.micro","key_name":"infra-key","launch_template":[],"region":"us-east-1","root_block_device":[{"delete_on_termination":true,"tags":null,"volume_size":16,"volume_type":"gp3"}],"security_groups":["terraform-sg"],"source_dest_check":true,"tags":{"Name":"terraform"},"tags_all":{"Name":"terraform"},"timeouts":null,"user_data":"#!/usr/bin/env bash\nexport EC2_HOME=/opt/aws/apitools/ec2\nexport PATH=$PATH:$EC2_HOME/bin\necho \"export FLASK_APP=routes\" \u003e\u003e /etc/bashrc\necho \"export FLASK_ENVIRONMENT=production\" \u003e\u003e /etc/bashrc\nyum update -y\nyum -y install jq pip3\nec2_reg=$(curl -s http://169.254.169.254/latest/dynamic/instance-identity/document | jq -c -r .region)\nmkdir -p /opt/url-shortener/app\naws --region $ec2_reg s3 cp s3://terraform-bucket/main.py /opt/url-shortener/\naws --region $ec2_reg s3 cp s3://terraform-bucket/app/ /opt/url-shortener/app/ --recursive\naws --region $ec2_reg s3 cp s3://terraform-bucket/app/templates/ /opt/url-shortener/app/templates/ --recursive\naws --region $ec2_reg s3 cp s3://terraform-bucket/flask.service /usr/lib/systemd/system/\npip3 install flask click Flask-Migrate Flask-SQLAlchemy hashids config\nsource /etc/bashrc\ncd /opt/url-shortener/app\nchmod 755 *.py *.sh\nflask db init\nflask db migrate\nflask db upgrade\nln -s /usr/lib/systemd/system/flask.service /etc/systemd/system/multi-user.target.wants/\nsystemctl daemon-reload\nsystemctl enable flask.service\nsystemctl start flask\n","user_data_replace_on_change":false,"volume_tags":null},"sensitive_values":{"capacity_reservation_specification":[],"cpu_options":[],"credit_specification":[],"ebs_block_device":[],"enclave_options":[],"ephemeral_block_device":[],"instance_market_options":[],"ipv6_addresses":[],"launch_template":[],"maintenance_options":[],"metadata_options":[],"network_interface":[],"primary_network_interface":[],"private_dns_name_options":[],"root_block_device":[{"tags_all":{}}],"secondary_private_ips":[],"security_groups":[false],"tags":{},"tags_all":{},"vpc_security_group_ids":[]},"identity_schema_version":0,"identity":{"account_id":null,"id":null,"region":null}},{"address":"aws_security_group.default","mode":"managed","type":"aws_security_group","name":"default","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"description":"Allow http traffic","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":["73.235.100.197/32"],"description":"","from_port":-1,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"icmp","security_groups":[],"self":false,"to_port":-1},{"cidr_blocks":["73.235.100.197/32"],"description":"","from_port":22,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":22},{"cidr_blocks":["73.235.100.197/32"],"description":"","from_port":5000,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":5000},{"cidr_blocks":["73.235.100.197/32"],"description":"","from_port":80,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":80}],"name":"terraform-sg","region":"us-east-1","revoke_rules_on_delete":false,"tags":{"Name":"terraform-sg"},"tags_all":{"Name":"terraform-sg"},"timeouts":null,"vpc_id":"vpc-00000000"},"sensitive_values":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}},"identity_schema_version":0,"identity":{"account_id":null,"id":null,"region":null}}]}},"resource_changes":[{"address":"aws_iam_instance_profile.url-shortener-profile","mode":"managed","type":"aws_iam_instance_profile","name":"url-shortener-profile","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"name":"terraform","path":"/","role":"terraform","tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"name_prefix":true,"tags_all":true,"unique_id":true},"before_sensitive":false,"after_sensitive":{"tags_all":{}}}},{"address":"aws_iam_policy.url-shortener-bucket-readonly","mode":"managed","type":"aws_iam_policy","name":"url-shortener-bucket-readonly","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":null,"name":"terraform-url-shortener-bucket-readonly","path":"/","policy":"{\"Statement\":[{\"Action\":[\"s3:List*\",\"s3:Get*\"],\"Effect\":\"Allow\",\"Resource\":[\"arn:aws:s3:::terraform-bucket\",\"arn:aws:s3:::terraform-bucket/*\"],\"Sid\":\"Stmt1425916919000\"}],\"Version\":\"2012-10-17\"}","tags":null},"after_unknown":{"arn":true,"attachment_count":true,"id":true,"name_prefix":true,"policy_id":true,"tags_all":true},"before_sensitive":false,"after_sensitive":{"tags_all":{}},"after_identity":{"arn":null}}},{"address":"aws_iam_role.url-shortener","mode":"managed","type":"aws_iam_role","name":"url-shortener","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"ec2.amazonaws.com\"},\"Sid\":\"\"}],\"Version\":\"2012-10-17\"}","description":"terraform instance role","force_detach_policies":false,"max_session_duration":3600,"name":"terraform","path":"/","permissions_boundary":null,"tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name_prefix":true,"tags_all":true,"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}},"after_identity":{"account_id":null,"name":null}}},{"address":"aws_iam_role_policy_attachment.url-shortener-bucket-readonly","mode":"managed","type":"aws_iam_role_policy_attachment","name":"url-shortener-bucket-readonly","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"role":"terraform"},"after_unknown":{"id":true,"policy_arn":true},"before_sensitive":false,"after_sensitive":{},"after_identity":{"account_id":null,"policy_arn":null,"role":null}}},{"address":"aws_instance.flask-web","mode":"managed","type":"aws_instance","name":"flask-web","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"ami":"terraform","credit_specification":[],"force_destroy":false,"get_password_data":false,"hibernation":null,"iam_instance_profile":"terraform","instance_type":"t3.micro","key_name":"infra-key","launch_template":[],"region":"us-east-1","root_block_device":[{"delete_on_termination":true,"tags":null,"volume_size":16,"volume_type":"gp3"}],"security_groups":["terraform-sg"],"source_dest_check":true,"tags":{"Name":"terraform"},"tags_all":{"Name":"terraform"},"timeouts":null,"user_data":"#!/usr/bin/env bash\nexport EC2_HOME=/opt/aws/apitools/ec2\nexport PATH=$PATH:$EC2_HOME/bin\necho \"export FLASK_APP=routes\" \u003e\u003e /etc/bashrc\necho \"export FLASK_ENVIRONMENT=production\" \u003e\u003e /etc/bashrc\nyum update -y\nyum -y install jq pip3\nec2_reg=$(curl -s http://169.254.169.254/latest/dynamic/instance-identity/document | jq -c -r .region)\nmkdir -p /opt/url-shortener/app\naws --region $ec2_reg s3 cp s3://terraform-bucket/main.py /opt/url-shortener/\naws --region $ec2_reg s3 cp s3://terraform-bucket/app/ /opt/url-shortener/app/ --recursive\naws --region $ec2_reg s3 cp s3://terraform-bucket/app/templates/ /opt/url-shortener/app/templates/ --recursive\naws --region $ec2_reg s3 cp s3://terraform-bucket/flask.service /usr/lib/systemd/system/\npip3 install flask click Flask-Migrate Flask-SQLAlchemy hashids config\nsource /etc/bashrc\ncd /opt/url-shortener/app\nchmod 755 *.py *.sh\nflask db init\nflask db migrate\nflask db upgrade\nln -s /usr/lib/systemd/system/flask.service /etc/systemd/system/multi-user.target.wants/\nsystemctl daemon-reload\nsystemctl enable flask.service\nsystemctl start flask\n","user_data_replace_on_change":false,"volume_tags":null},"after_unknown":{"arn":true,"associate_public_ip_address":true,"availability_zone":true,"capacity_reservation_specification":true,"cpu_options":true,"credit_specification":[],"disable_api_stop":true,"disable_api_termination":true,"ebs_block_device":true,"ebs_optimized":true,"enable_primary_ipv6":true,"enclave_options":true,"ephemeral_block_device":true,"host_id":true,"host_resource_group_arn":true,"id":true,"instance_initiated_shutdown_behavior":true,"instance_lifecycle":true,"instance_market_options":true,"instance_state":true,"ipv6_address_count":true,"ipv6_addresses":true,"launch_template":[],"maintenance_options":true,"metadata_options":true,"monitoring":true,"network_interface":true,"outpost_arn":true,"password_data":true,"placement_group":true,"placement_group_id":true,"placement_partition_number":true,"primary_network_interface":true,"primary_network_interface_id":true,"private_dns":true,"private_dns_name_options":true,"private_ip":true,"public_dns":true,"public_ip":true,"root_block_device":[{"device_name":true,"encrypted":true,"iops":true,"kms_key_id":true,"tags_all":true,"throughput":true,"volume_id":true}],"secondary_private_ips":true,"security_groups":[false],"spot_instance_request_id":true,"subnet_id":true,"tags":{},"tags_all":{},"tenancy":true,"user_data_base64":true,"vpc_security_group_ids":true},"before_sensitive":false,"after_sensitive":{"capacity_reservation_specification":[],"cpu_options":[],"credit_specification":[],"ebs_block_device":[],"enclave_options":[],"ephemeral_block_device":[],"instance_market_options":[],"ipv6_addresses":[],"launch_template":[],"maintenance_options":[],"metadata_options":[],"network_interface":[],"primary_network_interface":[],"private_dns_name_options":[],"root_block_device":[{"tags_all":{}}],"secondary_private_ips":[],"security_groups":[false],"tags":{},"tags_all":{},"vpc_security_group_ids":[]},"after_identity":{"account_id":null,"id":null,"region":null}}},{"address":"aws_security_group.default","mode":"managed","type":"aws_security_group","name":"default","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"Allow http traffic","egress":[{"cidr_blocks":["0.0.0.0/0"],"description":"","from_port":0,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"-1","security_groups":[],"self":false,"to_port":0}],"ingress":[{"cidr_blocks":["73.235.100.197/32"],"description":"","from_port":-1,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"icmp","security_groups":[],"self":false,"to_port":-1},{"cidr_blocks":["73.235.100.197/32"],"description":"","from_port":22,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":22},{"cidr_blocks":["73.235.100.197/32"],"description":"","from_port":5000,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":5000},{"cidr_blocks":["73.235.100.197/32"],"description":"","from_port":80,"ipv6_cidr_blocks":[],"prefix_list_ids":[],"protocol":"tcp","security_groups":[],"self":false,"to_port":80}],"name":"terraform-sg","region":"us-east-1","revoke_rules_on_delete":false,"tags":{"Name":"terraform-sg"},"tags_all":{"Name":"terraform-sg"},"timeouts":null,"vpc_id":"vpc-00000000"},"after_unknown":{"arn":true,"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"id":true,"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"name_prefix":true,"owner_id":true,"tags":{},"tags_all":{}},"before_sensitive":false,"after_sensitive":{"egress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"ingress":[{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]},{"cidr_blocks":[false],"ipv6_cidr_blocks":[],"prefix_list_ids":[],"security_groups":[]}],"tags":{},"tags_all":{}},"after_identity":{"account_id":null,"id":null,"region":null}}}],"configuration":{"provider_config":{"archive":{"name":"archive","full_name":"registry.terraform.io/hashicorp/archive","version_constraint":"\u003e= 2.0.0"},"aws":{"name":"aws","full_name":"registry.terraform.io/hashicorp/aws","version_constraint":"~\u003e 6.27.0","expressions":{"region":{"constant_value":"us-east-1"}}}},"root_module":{"resources":[{"address":"aws_iam_instance_profile.url-shortener-profile","mode":"managed","type":"aws_iam_instance_profile","name":"url-shortener-profile","provider_config_key":"aws","expressions":{"name":{"references":["var.name"]},"role":{"references":["aws_iam_role.url-shortener.name","aws_iam_role.url-shortener"]}},"schema_version":0},{"address":"aws_iam_policy.url-shortener-bucket-readonly","mode":"managed","type":"aws_iam_policy","name":"url-shortener-bucket-readonly","provider_config_key":"aws","expressions":{"name":{"references":["var.name"]},"policy":{"references":["var.bucket","var.bucket"]}},"schema_version":0},{"address":"aws_iam_role.url-shortener","mode":"managed","type":"aws_iam_role","name":"url-shortener","provider_config_key":"aws","expressions":{"assume_role_policy":{"constant_value":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n"},"description":{"references":["var.name"]},"name":{"references":["var.name"]}},"schema_version":0},{"address":"aws_iam_role_policy_attachment.url-shortener-bucket-readonly","mode":"managed","type":"aws_iam_role_policy_attachment","name":"url-shortener-bucket-readonly","provider_config_key":"aws","expressions":{"policy_arn":{"references":["aws_iam_policy.url-shortener-bucket-readonly.arn","aws_iam_policy.url-shortener-bucket-readonly"]},"role":{"references":["aws_iam_role.url-shortener.name","aws_iam_role.url-shortener"]}},"schema_version":0},{"address":"aws_instance.flask-web","mode":"managed","type":"aws_instance","name":"flask-web","provider_config_key":"aws","expressions":{"ami":{"references":["var.image_id"]},"iam_instance_profile":{"references":["aws_iam_instance_profile.url-shortener-profile.name","aws_iam_instance_profile.url-shortener-profile"]},"instance_type":{"references":["var.instance_type"]},"key_name":{"references":["var.ec2_keypair"]},"root_block_device":[{"volume_size":{"constant_value":"16"},"volume_type":{"constant_value":"gp3"}}],"security_groups":{"references":["aws_security_group.default.name","aws_security_group.default"]},"tags":{"references":["var.name"]},"user_data":{"references":["var.bucket","var.bucket","var.bucket","var.bucket"]}},"schema_version":2},{"address":"aws_security_group.default","mode":"managed","type":"aws_security_group","name":"default","provider_config_key":"aws","expressions":{"description":{"constant_value":"Allow http traffic"},"egress":{"constant_value":[{"cidr_blocks":["0.0.0.0/0"],"description":null,"from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"-1","security_groups":null,"self":null,"to_port":0}]},"ingress":{"references":["local.home","local.home","local.home","local.home"]},"name":{"references":["var.name"]},"tags":{"references":["var.name"]},"vpc_id":{"references":["var.vpc_id"]}},"schema_version":1}],"variables":{"access_key":{"description":"This is the AWS access key"},"aws_account":{},"azs":{"description":"The AWS VPC availability zones for the resource provisioning"},"bucket":{"description":"Central infra bucket"},"ec2_keypair":{"default":"infra-key","description":"This is the OPS EC2 SSH key name"},"image_id":{"description":"AMI ID"},"instance_type":{"description":"Instance type"},"name":{"description":"Name of ec2 instance"},"region":{"description":"The AWS region for the resource provisioning"},"secret_key":{"description":"This is the AWS secret key"},"volume_size":{},"vpc_cidr_block":{},"vpc_id":{"description":"VPC ID"}}}},"relevant_attributes":[{"resource":"aws_iam_instance_profile.url-shortener-profile","attribute":["name"]},{"resource":"aws_iam_role.url-shortener","attribute":["name"]},{"resource":"aws_iam_policy.url-shortener-bucket-readonly","attribute":["arn"]},{"resource":"aws_security_group.default","attribute":["name"]}],"timestamp":"2026-01-25T13:15:31Z","applyable":true,"complete":true,"errored":false}
