{"format_version":"1.2","terraform_version":"1.13.5","variables":{"app_name":{"value":"aws-rekognition"},"aws_region":{"value":"us-east-1"},"state_machine_definition_path":{"value":"../state_machine/Rekognition.json"}},"planned_values":{"outputs":{"s3_artifacts_bucket_name":{"sensitive":false},"state_machine_arn":{"sensitive":false}},"root_module":{"resources":[{"address":"aws_iam_role.sfn","mode":"managed","type":"aws_iam_role","name":"sfn","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"states.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"path":"/","permissions_boundary":null,"tags":null,"tags_all":{"Managed":"terraform","Project":"aws-rekognition"}},"sensitive_values":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}},{"address":"aws_iam_role_policy.sfn_inline","mode":"managed","type":"aws_iam_role_policy","name":"sfn_inline","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"name":"aws-rekognition-sfn-policy"},"sensitive_values":{}},{"address":"aws_s3_bucket.artifacts","mode":"managed","type":"aws_s3_bucket","name":"artifacts","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"force_destroy":true,"tags":null,"tags_all":{"Managed":"terraform","Project":"aws-rekognition"},"timeouts":null},"sensitive_values":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags_all":{},"versioning":[],"website":[]}},{"address":"aws_s3_bucket_public_access_block.artifacts","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"artifacts","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"block_public_acls":true,"block_public_policy":true,"ignore_public_acls":true,"restrict_public_buckets":true},"sensitive_values":{}},{"address":"aws_sfn_state_machine.rekognition","mode":"managed","type":"aws_sfn_state_machine","name":"rekognition","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"definition":"{\n    \"StartAt\": \"Map\",\n    \"States\": {\n        \"Map\": {\n            \"Type\": \"Map\",\n            \"ItemProcessor\": {\n                \"ProcessorConfig\": {\n                    \"Mode\": \"INLINE\"\n                },\n                \"StartAt\": \"CheckEventSource\",\n                \"States\": {\n                    \"CheckEventSource\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"And\": [\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"IsPresent\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"IsString\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"StringEquals\": \"aws:sqs\"\n                                    }\n                                ],\n                                \"Next\": \"CheckBody\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckEventSource\"\n                    },\n                    \"CheckBody\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"And\": [\n                                    {\n                                        \"Variable\": \"$.body\",\n                                        \"IsPresent\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.body\",\n                                        \"IsString\": true\n                                    }\n                                ],\n                                \"Next\": \"PassBody\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckBody\"\n                    },\n                    \"PassBody\": {\n                        \"Type\": \"Pass\",\n                        \"Parameters\": {\n                            \"body.$\": \"States.StringToJson($.body)\"\n                        },\n                        \"Next\": \"CheckBodyRecords\"\n                    },\n                    \"CheckBodyRecords\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"Variable\": \"$.Records\",\n                                \"IsPresent\": true,\n                                \"Next\": \"MapBodyRecords\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckBodyRecords\",\n                        \"InputPath\": \"$.body\"\n                    },\n                    \"MapBodyRecords\": {\n                        \"Type\": \"Map\",\n                        \"ItemProcessor\": {\n                            \"ProcessorConfig\": {\n                                \"Mode\": \"INLINE\"\n                            },\n                            \"StartAt\": \"CheckBodyRecordEventSource\",\n                            \"States\": {\n                                \"CheckBodyRecordEventSource\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"And\": [\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"IsPresent\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"IsString\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"StringEquals\": \"aws:s3\"\n                                                }\n                                            ],\n                                            \"Next\": \"CheckBodyRecordEventName\"\n                                        }\n                                    ],\n                                    \"Default\": \"SuccessCheckBodyRecordEventSource\"\n                                },\n                                \"CheckBodyRecordEventName\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"And\": [\n                                                {\n                                                    \"Variable\": \"$.eventName\",\n                                                    \"IsPresent\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventName\",\n                                                    \"IsString\": true\n                                                },\n                                                {\n                                                    \"Or\": [\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:CompleteMultipartUpload\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Copy\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Post\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Put\"\n                                                        }\n                                                    ]\n                                                }\n                                            ],\n                                            \"Next\": \"CheckBodyRecordS3\"\n                                        }\n                                    ],\n                                    \"Default\": \"SuccessCheckBodyRecordEventName\"\n                                },\n                                \"CheckBodyRecordS3\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"Variable\": \"$.s3\",\n                                            \"IsPresent\": true,\n                                            \"Next\": \"PassBodyRecordS3\"\n                                        }\n                                    ],\n                                    \"Default\": \"Success\"\n                                },\n                                \"PassBodyRecordS3\": {\n                                    \"Type\": \"Pass\",\n                                    \"InputPath\": \"$.s3\",\n                                    \"Next\": \"ParallelRekognitionStateMachines\"\n                                },\n                                \"ParallelRekognitionStateMachines\": {\n                                    \"Type\": \"Parallel\",\n                                    \"End\": true,\n                                    \"Branches\": [\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectFaces\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectFaces\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_faces}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectFaces\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectFaces\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_faces}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectLabels\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_labels}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectLabels\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_labels}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectModerationLabels\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectModerationLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_moderation_labels}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectDetectModerationLabels\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectDetectModerationLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_moderation_labels}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectProtectiveEquipment\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectProtectiveEquipment\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_protective_equipment}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectProtectiveEquipment\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectProtectiveEquipment\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_protective_equipment}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectText\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectText\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_text}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectText\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectText\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_text}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        }\n                                    ],\n                                    \"Parameters\": {\n                                        \"S3\": {\n                                            \"Bucket\": {\n                                                \"Name.$\": \"$.bucket.name\"\n                                            },\n                                            \"Object\": {\n                                                \"Key.$\": \"$.object.key\"\n                                            }\n                                        }\n                                    }\n                                },\n                                \"Success\": {\n                                    \"Type\": \"Succeed\"\n                                },\n                                \"SuccessCheckBodyRecordEventName\": {\n                                    \"Type\": \"Succeed\"\n                                },\n                                \"SuccessCheckBodyRecordEventSource\": {\n                                    \"Type\": \"Succeed\"\n                                }\n                            }\n                        },\n                        \"End\": true,\n                        \"ItemsPath\": \"$.Records\"\n                    },\n                    \"SuccessCheckBodyRecords\": {\n                        \"Type\": \"Succeed\"\n                    },\n                    \"SuccessCheckBody\": {\n                        \"Type\": \"Succeed\"\n                    },\n                    \"SuccessCheckEventSource\": {\n                        \"Type\": \"Succeed\"\n                    }\n                }\n            },\n            \"End\": true,\n            \"ItemsPath\": \"$\"\n        }\n    }\n}\n","publish":false,"tags":null,"tags_all":{"Managed":"terraform","Project":"aws-rekognition"},"timeouts":null,"type":"STANDARD"},"sensitive_values":{"encryption_configuration":[],"logging_configuration":[],"tags_all":{},"tracing_configuration":[]}},{"address":"data.aws_iam_policy_document.sfn_policy","mode":"data","type":"aws_iam_policy_document","name":"sfn_policy","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["rekognition:DetectFaces","rekognition:DetectLabels","rekognition:DetectModerationLabels","rekognition:DetectProtectiveEquipment","rekognition:DetectText"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["*"],"sid":"RekognitionReadWrite"},{"actions":["s3:GetObject","s3:ListBucket","s3:PutObject"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":[null,null],"sid":"S3Artifacts"},{"actions":["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["*"],"sid":"CloudWatchLogs"}],"version":null},"sensitive_values":{"statement":[{"actions":[false,false,false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false]},{"actions":[false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false,false]},{"actions":[false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false]}]}},{"address":"random_id.suffix","mode":"managed","type":"random_id","name":"suffix","provider_name":"registry.terraform.io/hashicorp/random","schema_version":0,"values":{"byte_length":4,"keepers":null,"prefix":null},"sensitive_values":{}}]}},"resource_changes":[{"address":"data.aws_iam_policy_document.sfn_policy","mode":"data","type":"aws_iam_policy_document","name":"sfn_policy","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["read"],"before":null,"after":{"override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["rekognition:DetectFaces","rekognition:DetectLabels","rekognition:DetectModerationLabels","rekognition:DetectProtectiveEquipment","rekognition:DetectText"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["*"],"sid":"RekognitionReadWrite"},{"actions":["s3:GetObject","s3:ListBucket","s3:PutObject"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":[null,null],"sid":"S3Artifacts"},{"actions":["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["*"],"sid":"CloudWatchLogs"}],"version":null},"after_unknown":{"id":true,"json":true,"minified_json":true,"statement":[{"actions":[false,false,false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false]},{"actions":[false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[true,true]},{"actions":[false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false]}]},"before_sensitive":false,"after_sensitive":{"statement":[{"actions":[false,false,false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false]},{"actions":[false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false,false]},{"actions":[false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false]}]}},"action_reason":"read_because_config_unknown"},{"address":"aws_iam_role.sfn","mode":"managed","type":"aws_iam_role","name":"sfn","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"states.amazonaws.com\"}}],\"Version\":\"2012-10-17\"}","description":null,"force_detach_policies":false,"max_session_duration":3600,"path":"/","permissions_boundary":null,"tags":null,"tags_all":{"Managed":"terraform","Project":"aws-rekognition"}},"after_unknown":{"arn":true,"create_date":true,"id":true,"inline_policy":true,"managed_policy_arns":true,"name":true,"name_prefix":true,"tags_all":{},"unique_id":true},"before_sensitive":false,"after_sensitive":{"inline_policy":[],"managed_policy_arns":[],"tags_all":{}}}},{"address":"aws_iam_role_policy.sfn_inline","mode":"managed","type":"aws_iam_role_policy","name":"sfn_inline","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"name":"aws-rekognition-sfn-policy"},"after_unknown":{"id":true,"name_prefix":true,"policy":true,"role":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_s3_bucket.artifacts","mode":"managed","type":"aws_s3_bucket","name":"artifacts","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"force_destroy":true,"tags":null,"tags_all":{"Managed":"terraform","Project":"aws-rekognition"},"timeouts":null},"after_unknown":{"acceleration_status":true,"acl":true,"arn":true,"bucket":true,"bucket_domain_name":true,"bucket_prefix":true,"bucket_regional_domain_name":true,"cors_rule":true,"grant":true,"hosted_zone_id":true,"id":true,"lifecycle_rule":true,"logging":true,"object_lock_configuration":true,"object_lock_enabled":true,"policy":true,"region":true,"replication_configuration":true,"request_payer":true,"server_side_encryption_configuration":true,"tags_all":{},"versioning":true,"website":true,"website_domain":true,"website_endpoint":true},"before_sensitive":false,"after_sensitive":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags_all":{},"versioning":[],"website":[]}}},{"address":"aws_s3_bucket_public_access_block.artifacts","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"artifacts","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"block_public_acls":true,"block_public_policy":true,"ignore_public_acls":true,"restrict_public_buckets":true},"after_unknown":{"bucket":true,"id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_sfn_state_machine.rekognition","mode":"managed","type":"aws_sfn_state_machine","name":"rekognition","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"definition":"{\n    \"StartAt\": \"Map\",\n    \"States\": {\n        \"Map\": {\n            \"Type\": \"Map\",\n            \"ItemProcessor\": {\n                \"ProcessorConfig\": {\n                    \"Mode\": \"INLINE\"\n                },\n                \"StartAt\": \"CheckEventSource\",\n                \"States\": {\n                    \"CheckEventSource\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"And\": [\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"IsPresent\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"IsString\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.eventSource\",\n                                        \"StringEquals\": \"aws:sqs\"\n                                    }\n                                ],\n                                \"Next\": \"CheckBody\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckEventSource\"\n                    },\n                    \"CheckBody\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"And\": [\n                                    {\n                                        \"Variable\": \"$.body\",\n                                        \"IsPresent\": true\n                                    },\n                                    {\n                                        \"Variable\": \"$.body\",\n                                        \"IsString\": true\n                                    }\n                                ],\n                                \"Next\": \"PassBody\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckBody\"\n                    },\n                    \"PassBody\": {\n                        \"Type\": \"Pass\",\n                        \"Parameters\": {\n                            \"body.$\": \"States.StringToJson($.body)\"\n                        },\n                        \"Next\": \"CheckBodyRecords\"\n                    },\n                    \"CheckBodyRecords\": {\n                        \"Type\": \"Choice\",\n                        \"Choices\": [\n                            {\n                                \"Variable\": \"$.Records\",\n                                \"IsPresent\": true,\n                                \"Next\": \"MapBodyRecords\"\n                            }\n                        ],\n                        \"Default\": \"SuccessCheckBodyRecords\",\n                        \"InputPath\": \"$.body\"\n                    },\n                    \"MapBodyRecords\": {\n                        \"Type\": \"Map\",\n                        \"ItemProcessor\": {\n                            \"ProcessorConfig\": {\n                                \"Mode\": \"INLINE\"\n                            },\n                            \"StartAt\": \"CheckBodyRecordEventSource\",\n                            \"States\": {\n                                \"CheckBodyRecordEventSource\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"And\": [\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"IsPresent\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"IsString\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventSource\",\n                                                    \"StringEquals\": \"aws:s3\"\n                                                }\n                                            ],\n                                            \"Next\": \"CheckBodyRecordEventName\"\n                                        }\n                                    ],\n                                    \"Default\": \"SuccessCheckBodyRecordEventSource\"\n                                },\n                                \"CheckBodyRecordEventName\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"And\": [\n                                                {\n                                                    \"Variable\": \"$.eventName\",\n                                                    \"IsPresent\": true\n                                                },\n                                                {\n                                                    \"Variable\": \"$.eventName\",\n                                                    \"IsString\": true\n                                                },\n                                                {\n                                                    \"Or\": [\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:CompleteMultipartUpload\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Copy\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Post\"\n                                                        },\n                                                        {\n                                                            \"Variable\": \"$.eventName\",\n                                                            \"StringEquals\": \"ObjectCreated:Put\"\n                                                        }\n                                                    ]\n                                                }\n                                            ],\n                                            \"Next\": \"CheckBodyRecordS3\"\n                                        }\n                                    ],\n                                    \"Default\": \"SuccessCheckBodyRecordEventName\"\n                                },\n                                \"CheckBodyRecordS3\": {\n                                    \"Type\": \"Choice\",\n                                    \"Choices\": [\n                                        {\n                                            \"Variable\": \"$.s3\",\n                                            \"IsPresent\": true,\n                                            \"Next\": \"PassBodyRecordS3\"\n                                        }\n                                    ],\n                                    \"Default\": \"Success\"\n                                },\n                                \"PassBodyRecordS3\": {\n                                    \"Type\": \"Pass\",\n                                    \"InputPath\": \"$.s3\",\n                                    \"Next\": \"ParallelRekognitionStateMachines\"\n                                },\n                                \"ParallelRekognitionStateMachines\": {\n                                    \"Type\": \"Parallel\",\n                                    \"End\": true,\n                                    \"Branches\": [\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectFaces\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectFaces\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_faces}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectFaces\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectFaces\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_faces}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectLabels\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_labels}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectLabels\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_labels}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectModerationLabels\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectModerationLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_moderation_labels}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectDetectModerationLabels\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectDetectModerationLabels\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_moderation_labels}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectProtectiveEquipment\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectProtectiveEquipment\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_protective_equipment}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectProtectiveEquipment\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectProtectiveEquipment\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_protective_equipment}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        },\n                                        {\n                                            \"StartAt\": \"StartExecutionRekognitionDetectText\",\n                                            \"States\": {\n                                                \"StartExecutionRekognitionDetectText\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Resource\": \"arn:aws:states:::states:startExecution.sync:2\",\n                                                    \"Parameters\": {\n                                                        \"StateMachineArn\": \"${rekognition_detect_text}\",\n                                                        \"Input\": {\n                                                            \"StatePayload.$\": \"$\",\n                                                            \"TaskToken.$\": \"$$.Task.Token\",\n                                                            \"AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$\": \"$$.Execution.Id\"\n                                                        }\n                                                    },\n                                                    \"Next\": \"PutObjectRekognitionDetectText\",\n                                                    \"OutputPath\": \"$.Output\"\n                                                },\n                                                \"PutObjectRekognitionDetectText\": {\n                                                    \"Type\": \"Task\",\n                                                    \"Parameters\": {\n                                                        \"Body.$\": \"$\",\n                                                        \"Bucket.$\": \"$.S3.Bucket.Name\",\n                                                        \"Key.$\": \"States.Format('${s3_object_rekognition_detect_text}{}.json', $.S3.Object.ETag)\"\n                                                    },\n                                                    \"Resource\": \"arn:aws:states:::aws-sdk:s3:putObject\",\n                                                    \"End\": true\n                                                }\n                                            }\n                                        }\n                                    ],\n                                    \"Parameters\": {\n                                        \"S3\": {\n                                            \"Bucket\": {\n                                                \"Name.$\": \"$.bucket.name\"\n                                            },\n                                            \"Object\": {\n                                                \"Key.$\": \"$.object.key\"\n                                            }\n                                        }\n                                    }\n                                },\n                                \"Success\": {\n                                    \"Type\": \"Succeed\"\n                                },\n                                \"SuccessCheckBodyRecordEventName\": {\n                                    \"Type\": \"Succeed\"\n                                },\n                                \"SuccessCheckBodyRecordEventSource\": {\n                                    \"Type\": \"Succeed\"\n                                }\n                            }\n                        },\n                        \"End\": true,\n                        \"ItemsPath\": \"$.Records\"\n                    },\n                    \"SuccessCheckBodyRecords\": {\n                        \"Type\": \"Succeed\"\n                    },\n                    \"SuccessCheckBody\": {\n                        \"Type\": \"Succeed\"\n                    },\n                    \"SuccessCheckEventSource\": {\n                        \"Type\": \"Succeed\"\n                    }\n                }\n            },\n            \"End\": true,\n            \"ItemsPath\": \"$\"\n        }\n    }\n}\n","publish":false,"tags":null,"tags_all":{"Managed":"terraform","Project":"aws-rekognition"},"timeouts":null,"type":"STANDARD"},"after_unknown":{"arn":true,"creation_date":true,"description":true,"encryption_configuration":true,"id":true,"logging_configuration":true,"name":true,"name_prefix":true,"revision_id":true,"role_arn":true,"state_machine_version_arn":true,"status":true,"tags_all":{},"tracing_configuration":true,"version_description":true},"before_sensitive":false,"after_sensitive":{"encryption_configuration":[],"logging_configuration":[],"tags_all":{},"tracing_configuration":[]}}},{"address":"random_id.suffix","mode":"managed","type":"random_id","name":"suffix","provider_name":"registry.terraform.io/hashicorp/random","change":{"actions":["create"],"before":null,"after":{"byte_length":4,"keepers":null,"prefix":null},"after_unknown":{"b64_std":true,"b64_url":true,"dec":true,"hex":true,"id":true},"before_sensitive":false,"after_sensitive":{}}}],"output_changes":{"s3_artifacts_bucket_name":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"state_machine_arn":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false}},"prior_state":{"format_version":"1.0","terraform_version":"1.13.5","values":{"root_module":{"resources":[{"address":"data.aws_iam_policy_document.sfn_assume","mode":"data","type":"aws_iam_policy_document","name":"sfn_assume","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"id":"4022981484","json":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"states.amazonaws.com\"\n      }\n    }\n  ]\n}","minified_json":"{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":\"sts:AssumeRole\",\"Principal\":{\"Service\":\"states.amazonaws.com\"}}]}","override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["sts:AssumeRole"],"condition":[],"effect":"Allow","not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":["states.amazonaws.com"],"type":"Service"}],"resources":[],"sid":""}],"version":"2012-10-17"},"sensitive_values":{"statement":[{"actions":[false],"condition":[],"not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":[false]}],"resources":[]}]}}]}}},"configuration":{"provider_config":{"aws":{"name":"aws","full_name":"registry.terraform.io/hashicorp/aws","version_constraint":"~\u003e 5.0","expressions":{"default_tags":[{"tags":{"references":["var.app_name"]}}],"region":{"references":["var.aws_region"]}}},"random":{"name":"random","full_name":"registry.terraform.io/hashicorp/random","version_constraint":"~\u003e 3.6"}},"root_module":{"outputs":{"s3_artifacts_bucket_name":{"expression":{"references":["aws_s3_bucket.artifacts.bucket","aws_s3_bucket.artifacts"]},"description":"S3 bucket for artifacts (images/results)."},"state_machine_arn":{"expression":{"references":["aws_sfn_state_machine.rekognition.arn","aws_sfn_state_machine.rekognition"]},"description":"ARN of the Step Functions state machine."}},"resources":[{"address":"aws_iam_role.sfn","mode":"managed","type":"aws_iam_role","name":"sfn","provider_config_key":"aws","expressions":{"assume_role_policy":{"references":["data.aws_iam_policy_document.sfn_assume.json","data.aws_iam_policy_document.sfn_assume"]},"name":{"references":["local.name_prefix","random_id.suffix.hex","random_id.suffix"]}},"schema_version":0},{"address":"aws_iam_role_policy.sfn_inline","mode":"managed","type":"aws_iam_role_policy","name":"sfn_inline","provider_config_key":"aws","expressions":{"name":{"references":["local.name_prefix"]},"policy":{"references":["data.aws_iam_policy_document.sfn_policy.json","data.aws_iam_policy_document.sfn_policy"]},"role":{"references":["aws_iam_role.sfn.id","aws_iam_role.sfn"]}},"schema_version":0},{"address":"aws_s3_bucket.artifacts","mode":"managed","type":"aws_s3_bucket","name":"artifacts","provider_config_key":"aws","expressions":{"bucket":{"references":["local.name_prefix","random_id.suffix.hex","random_id.suffix"]},"force_destroy":{"constant_value":true}},"schema_version":0},{"address":"aws_s3_bucket_public_access_block.artifacts","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"artifacts","provider_config_key":"aws","expressions":{"block_public_acls":{"constant_value":true},"block_public_policy":{"constant_value":true},"bucket":{"references":["aws_s3_bucket.artifacts.id","aws_s3_bucket.artifacts"]},"ignore_public_acls":{"constant_value":true},"restrict_public_buckets":{"constant_value":true}},"schema_version":0},{"address":"aws_sfn_state_machine.rekognition","mode":"managed","type":"aws_sfn_state_machine","name":"rekognition","provider_config_key":"aws","expressions":{"definition":{"references":["var.state_machine_definition_path"]},"name":{"references":["local.name_prefix","random_id.suffix.hex","random_id.suffix"]},"role_arn":{"references":["aws_iam_role.sfn.arn","aws_iam_role.sfn"]}},"schema_version":0},{"address":"random_id.suffix","mode":"managed","type":"random_id","name":"suffix","provider_config_key":"random","expressions":{"byte_length":{"constant_value":4}},"schema_version":0},{"address":"data.aws_iam_policy_document.sfn_assume","mode":"data","type":"aws_iam_policy_document","name":"sfn_assume","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["sts:AssumeRole"]},"effect":{"constant_value":"Allow"},"principals":[{"identifiers":{"constant_value":["states.amazonaws.com"]},"type":{"constant_value":"Service"}}]}]},"schema_version":0},{"address":"data.aws_iam_policy_document.sfn_policy","mode":"data","type":"aws_iam_policy_document","name":"sfn_policy","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["rekognition:DetectLabels","rekognition:DetectFaces","rekognition:DetectText","rekognition:DetectModerationLabels","rekognition:DetectProtectiveEquipment"]},"effect":{"constant_value":"Allow"},"resources":{"constant_value":["*"]},"sid":{"constant_value":"RekognitionReadWrite"}},{"actions":{"constant_value":["s3:GetObject","s3:PutObject","s3:ListBucket"]},"effect":{"constant_value":"Allow"},"resources":{"references":["aws_s3_bucket.artifacts.arn","aws_s3_bucket.artifacts","aws_s3_bucket.artifacts.arn","aws_s3_bucket.artifacts"]},"sid":{"constant_value":"S3Artifacts"}},{"actions":{"constant_value":["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"]},"effect":{"constant_value":"Allow"},"resources":{"constant_value":["*"]},"sid":{"constant_value":"CloudWatchLogs"}}]},"schema_version":0}],"variables":{"app_name":{"default":"aws-rekognition","description":"Application name used for resource naming/tagging."},"aws_region":{"default":"us-east-1","description":"AWS region to deploy into."},"state_machine_definition_path":{"default":"../state_machine/Rekognition.json","description":"Path to the Step Functions state machine definition JSON."}}}},"relevant_attributes":[{"resource":"data.aws_iam_policy_document.sfn_assume","attribute":["json"]},{"resource":"random_id.suffix","attribute":["hex"]},{"resource":"data.aws_iam_policy_document.sfn_policy","attribute":["json"]},{"resource":"aws_iam_role.sfn","attribute":["arn"]},{"resource":"aws_iam_role.sfn","attribute":["id"]},{"resource":"aws_s3_bucket.artifacts","attribute":["arn"]},{"resource":"aws_s3_bucket.artifacts","attribute":["id"]},{"resource":"aws_sfn_state_machine.rekognition","attribute":["arn"]},{"resource":"aws_s3_bucket.artifacts","attribute":["bucket"]}],"timestamp":"2026-01-25T20:01:54Z","applyable":true,"complete":true,"errored":false}
