
Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # aws_ecr_repository.natanaelvuch-ci-api will be created
  + resource "aws_ecr_repository" "natanaelvuch-ci-api" {
      + arn                  = (known after apply)
      + id                   = (known after apply)
      + image_tag_mutability = "MUTABLE"
      + name                 = "natanaelvich-ci"
      + registry_id          = (known after apply)
      + repository_url       = (known after apply)
      + tags                 = {
          + "IAC" = "True"
        }
      + tags_all             = {
          + "IAC" = "True"
        }

      + image_scanning_configuration {
          + scan_on_push = true
        }
    }

  # aws_iam_openid_connect_provider.oidc-git will be created
  + resource "aws_iam_openid_connect_provider" "oidc-git" {
      + arn             = (known after apply)
      + client_id_list  = [
          + "sts.amazonaws.com",
        ]
      + id              = (known after apply)
      + tags            = {
          + "IAC" = "True"
        }
      + tags_all        = {
          + "IAC" = "True"
        }
      + thumbprint_list = [
          + "1b511abead59c6ce207077c0bf0e0043b1382612",
        ]
      + url             = "https://token.actions.githubusercontent.com"
    }

  # aws_iam_role.app-runner-role will be created
  + resource "aws_iam_role" "app-runner-role" {
      + arn                   = (known after apply)
      + assume_role_policy    = jsonencode(
            {
              + Statement = [
                  + {
                      + Action    = "sts:AssumeRole"
                      + Effect    = "Allow"
                      + Principal = {
                          + Service = "build.apprunner.amazonaws.com"
                        }
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + create_date           = (known after apply)
      + force_detach_policies = false
      + id                    = (known after apply)
      + managed_policy_arns   = [
          + "arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly",
        ]
      + max_session_duration  = 3600
      + name                  = "app-runner-role"
      + name_prefix           = (known after apply)
      + path                  = "/"
      + tags                  = {
          + "IAC" = "True"
        }
      + tags_all              = {
          + "IAC" = "True"
        }
      + unique_id             = (known after apply)

      + inline_policy (known after apply)
    }

  # aws_iam_role.ecr-role will be created
  + resource "aws_iam_role" "ecr-role" {
      + arn                   = (known after apply)
      + assume_role_policy    = jsonencode(
            {
              + Statement = [
                  + {
                      + Action    = "sts:AssumeRoleWithWebIdentity"
                      + Condition = {
                          + StringEquals = {
                              + "token.actions.githubusercontent.com:aud" = "sts.amazonaws.com"
                              + "token.actions.githubusercontent.com:sub" = "repo:Natanaelvich/devops-ci-cd_nlw-rocketseat-24:ref:refs/heads/main"
                            }
                        }
                      + Effect    = "Allow"
                      + Principal = {
                          + Federated = "arn:aws:iam::867118092958:oidc-provider/token.actions.githubusercontent.com"
                        }
                    },
                ]
              + Version   = "2012-10-17"
            }
        )
      + create_date           = (known after apply)
      + force_detach_policies = false
      + id                    = (known after apply)
      + managed_policy_arns   = (known after apply)
      + max_session_duration  = 3600
      + name                  = "ecr-role"
      + name_prefix           = (known after apply)
      + path                  = "/"
      + tags                  = {
          + "IAC" = "True"
        }
      + tags_all              = {
          + "IAC" = "True"
        }
      + unique_id             = (known after apply)

      + inline_policy {
          + name   = "ecr-app-permissions"
          + policy = jsonencode(
                {
                  + Statement = [
                      + {
                          + Action   = "apprunner:*"
                          + Effect   = "Allow"
                          + Resource = "*"
                          + Sid      = "Statement1"
                        },
                      + {
                          + Action   = [
                              + "iam:PassRole",
                              + "iam:CreateServiceLinkedRole",
                            ]
                          + Effect   = "Allow"
                          + Resource = "*"
                          + Sid      = "Statement2"
                        },
                      + {
                          + Action   = [
                              + "ecr:GetDownloadUrlForLayer",
                              + "ecr:BatchGetImage",
                              + "ecr:BatchCheckLayerAvailability",
                              + "ecr:PutImage",
                              + "ecr:InitiateLayerUpload",
                              + "ecr:UploadLayerPart",
                              + "ecr:CompleteLayerUpload",
                              + "ecr:GetAuthorizationToken",
                            ]
                          + Effect   = "Allow"
                          + Resource = "*"
                          + Sid      = "Statement3"
                        },
                    ]
                }
            )
        }
    }

Plan: 4 to add, 0 to change, 0 to destroy.
