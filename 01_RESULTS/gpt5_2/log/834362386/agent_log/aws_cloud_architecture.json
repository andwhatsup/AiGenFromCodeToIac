{
  "aws_architecture_description": "## Proposed high-level AWS architecture (lean, secure, scalable)\n\n### 1) Networking foundation\n- Create a dedicated **VPC** spanning **2–3 Availability Zones** for high availability.\n- In each AZ, create:\n  - **Public subnets** for internet-facing load balancers.\n  - **Private subnets** for EKS worker nodes (and any internal services).\n- Attach an **Internet Gateway (IGW)** to the VPC.\n- Add **NAT Gateway(s)** in public subnets so private EKS nodes can pull images and reach AWS APIs without being publicly reachable.\n- Use **VPC endpoints** (Interface/Gateway) where it reduces egress and improves security (notably ECR, S3, CloudWatch Logs, STS, EC2, ELB as needed).\n\n### 2) Compute / Kubernetes runtime (EKS)\n- Provision an **Amazon EKS cluster** with:\n  - **Managed node group(s)** (EC2) in private subnets.\n  - Cluster endpoint access set to **private** (preferred) or **public+restricted CIDRs**.\n- Deploy the application into a dedicated Kubernetes namespace (e.g., `vat-calc`).\n- Run the existing **Kubernetes Deployment** with **replicas=6**.\n- Add **Horizontal Pod Autoscaler (HPA)** (optional but recommended) to scale pods based on CPU/requests.\n\n### 3) Ingress / external exposure (ALB)\n- Use the **AWS Load Balancer Controller** in EKS to provision and manage an **Application Load Balancer (ALB)**.\n  - Best practice is to expose via **Kubernetes Ingress** (ALB Ingress) rather than a `Service type=LoadBalancer`.\n  - If you keep `Service type=LoadBalancer`, ensure it’s compatible with the controller expectations; in most EKS setups, ALB is driven by Ingress.\n- Terminate TLS at the ALB using **AWS Certificate Manager (ACM)**.\n- Use **Route 53** to map a friendly DNS name (e.g., `vat.example.com`) to the ALB.\n- Optionally add **AWS WAF** on the ALB for basic L7 protections.\n\n### 4) Container image supply chain\n- Today the image is pushed to **DockerHub** (`yash5090/vat-calc:latest`). For AWS-native security and reliability, prefer:\n  - **Amazon ECR** as the container registry.\n  - CI/CD (GitHub Actions or Jenkins) pushes versioned tags (e.g., git SHA) to ECR.\n  - EKS pulls from ECR using node IAM permissions.\n- Keep the existing scanning steps (Trivy/Docker Scout). If you move to ECR, you can also enable **ECR enhanced scanning**.\n\n### 5) IAM / security controls\n- Use **IAM Roles for Service Accounts (IRSA)** so Kubernetes controllers (AWS Load Balancer Controller, ExternalDNS, etc.) get least-privilege AWS access.\n- Use **Security Groups**:\n  - ALB SG: allow inbound 443 from the internet; outbound to node SG on target ports.\n  - Node SG: allow inbound only from ALB SG to the app port; restrict other inbound.\n- Use **Secrets Manager** (or SSM Parameter Store) for any future secrets (even if the current static site doesn’t need them).\n\n### 6) Observability and operations\n- Send EKS control plane logs to **CloudWatch Logs**.\n- Use **Container Insights** (CloudWatch) for node/pod metrics.\n- Enable **ALB access logs** to **S3**.\n- Use **CloudTrail** for account audit logging.\n- Use **AWS Config** (optional) for compliance drift detection.\n\n### 7) CI/CD deployment to EKS (recommended pattern)\n- Keep GitHub Actions and/or Jenkins for build/test/scan.\n- Add a deploy stage that updates Kubernetes manifests (or Helm/Kustomize) and applies to EKS:\n  - Authenticate to EKS (OIDC/GitHub OIDC or Jenkins IAM role).\n  - Update image tag in the Deployment.\n  - Apply manifests and wait for rollout.\n\n---\n\n## Notes specific to this app\n- Because this is a **static site**, the simplest/cheapest AWS-native option would be **S3 + CloudFront** (no EKS). However, since your repo already includes Kubernetes manifests and an EKS direction, the architecture above keeps EKS while tightening best practices.\n",
  "aws_resources": [
    "Amazon VPC",
    "VPC public subnets (2–3 AZs)",
    "VPC private subnets (2–3 AZs)",
    "Internet Gateway (IGW)",
    "NAT Gateway (1 per AZ recommended, or 1 for cost-saving)",
    "Route tables (public/private)",
    "Elastic IPs (for NAT Gateways)",
    "VPC Endpoints (as needed: S3 Gateway endpoint; Interface endpoints such as ECR API/DKR, CloudWatch Logs, STS, EC2)",
    "Security Groups (ALB SG, EKS node SG, cluster SG as applicable)",
    "Network ACLs (optional; default NACLs acceptable for lean setup)",
    "Amazon EKS Cluster",
    "EKS Managed Node Group(s) (EC2 worker nodes)",
    "IAM role for EKS cluster",
    "IAM role(s) for EKS node group(s)",
    "IAM OIDC provider for the EKS cluster (for IRSA)",
    "IAM roles for Kubernetes service accounts (IRSA) (e.g., AWS Load Balancer Controller, ExternalDNS if used)",
    "Amazon ECR repository (recommended replacement for DockerHub)",
    "AWS Load Balancer Controller (EKS add-on/Helm deployment)",
    "Application Load Balancer (ALB) (provisioned by controller)",
    "ALB Target Group(s) (provisioned by controller)",
    "ACM Certificate (for HTTPS)",
    "Amazon Route 53 Hosted Zone + DNS record (A/AAAA alias to ALB)",
    "AWS WAFv2 Web ACL (optional, associated to ALB)",
    "Amazon S3 bucket for ALB access logs",
    "Amazon CloudWatch Logs log groups (EKS control plane logs, application logs if shipped)",
    "Amazon CloudWatch Container Insights (metrics)",
    "AWS CloudTrail trail (management events)",
    "AWS KMS key(s) (optional but recommended: encrypt EKS secrets envelope, S3 logs, CloudWatch Logs if required)",
    "AWS Secrets Manager (optional; for future secrets)",
    "AWS Systems Manager Parameter Store (optional alternative to Secrets Manager)"
  ]
}