{
  "plantuml_diagram": "@startuml\n!define AWSPuml https://raw.githubusercontent.com/awslabs/aws-icons-for-plantuml/v20.0/dist\n!include AWSPuml/AWSCommon.puml\n\ntitle Nextcloud Backup CronJob (Containerized)\n\nskinparam shadowing false\nskinparam componentStyle rectangle\n\nnode \"Kubernetes Cluster\" as k8s {\n  node \"Namespace\" as ns {\n    node \"CronJob\" as cron {\n      artifact \"Backup Container Image\\n(alpine:latest + rclone + mysql-client)\\nPublished to ghcr.io\" as img\n      node \"Pod\" as pod {\n        component \"backup-job\\n(entrypoint.sh)\" as job\n        component \"mysqldump\\n(mysql-client)\" as dump\n        component \"rclone\\n(FTP remote)\" as rclone\n      }\n    }\n  }\n}\n\nnode \"Nextcloud App Server\" as nc {\n  component \"Nextcloud\\n(PHP app)\" as nextcloud\n  database \"Nextcloud Data\\n(files + config/config.php)\" as ncfs\n}\n\ndatabase \"MySQL/MariaDB\" as db {\n  component \"Databases: nextcloud, mysql\" as schemas\n}\n\nnode \"FTP Backup Target\" as ftp {\n  component \"FTP Server\" as ftpSrv\n  artifact \"Backup Archives\\n(SQL dumps + files)\" as backups\n}\n\nimg ..> pod : image pull\njob --> nextcloud : toggle maintenance flag\\n(edit config.php)\njob --> ncfs : read Nextcloud files\\n(create archive)\ndump --> db : dump schemas\njob --> dump : invoke\njob --> rclone : invoke\nrclone --> ftpSrv : upload via FTP\nftpSrv --> backups : store\n\n@enduml",
  "svg_diagram": "<?plantuml 1.2026.2beta1?><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" contentStyleType=\"text/css\" data-diagram-type=\"DESCRIPTION\" height=\"1060px\" preserveAspectRatio=\"none\" style=\"width:959px;height:1060px;background:#FFFFFF;\" version=\"1.1\" viewBox=\"0 0 959 1060\" width=\"959px\" zoomAndPan=\"magnify\"><title>Nextcloud Backup CronJob (Containerized)</title><defs/><g><g class=\"title\" data-source-line=\"4\"><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"336.0137\" x=\"304.4932\" y=\"22.9951\">Nextcloud Backup CronJob (Containerized)</text></g><!--cluster k8s--><g class=\"cluster\" data-qualified-name=\"k8s\" data-source-line=\"9\" id=\"ent0002\"><polygon fill=\"#FFFFFF\" points=\"80,53.2969,90,43.2969,559,43.2969,559,703.1669,549,713.1669,80,713.1669,80,53.2969\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"549\" x2=\"559\" y1=\"53.2969\" y2=\"43.2969\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"80\" x2=\"549\" y1=\"53.2969\" y2=\"53.2969\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"549\" x2=\"549\" y1=\"53.2969\" y2=\"713.1669\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"152.5576\" x=\"239.2212\" y=\"69.292\">Kubernetes Cluster</text></g><!--cluster ns--><g class=\"cluster\" data-qualified-name=\"k8s.ns\" data-source-line=\"10\" id=\"ent0003\"><polygon fill=\"#FFFFFF\" points=\"104,101.2969,114,91.2969,535,91.2969,535,679.1669,525,689.1669,104,689.1669,104,101.2969\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"525\" x2=\"535\" y1=\"101.2969\" y2=\"91.2969\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"104\" x2=\"525\" y1=\"101.2969\" y2=\"101.2969\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"525\" x2=\"525\" y1=\"101.2969\" y2=\"689.1669\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"90.8428\" x=\"270.0786\" y=\"117.292\">Namespace</text></g><!--cluster cron--><g class=\"cluster\" data-qualified-name=\"k8s.ns.cron\" data-source-line=\"11\" id=\"ent0004\"><polygon fill=\"#FFFFFF\" points=\"128,149.2969,138,139.2969,511,139.2969,511,655.1669,501,665.1669,128,665.1669,128,149.2969\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"501\" x2=\"511\" y1=\"149.2969\" y2=\"139.2969\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"128\" x2=\"501\" y1=\"149.2969\" y2=\"149.2969\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"501\" x2=\"501\" y1=\"149.2969\" y2=\"665.1669\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"61.6123\" x=\"284.6938\" y=\"165.292\">CronJob</text></g><!--cluster pod--><g class=\"cluster\" data-qualified-name=\"k8s.ns.cron.pod\" data-source-line=\"13\" id=\"ent0006\"><polygon fill=\"#FFFFFF\" points=\"160,346.4769,170,336.4769,479,336.4769,479,623.1669,469,633.1669,160,633.1669,160,346.4769\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"469\" x2=\"479\" y1=\"346.4769\" y2=\"336.4769\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"160\" x2=\"469\" y1=\"346.4769\" y2=\"346.4769\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"469\" x2=\"469\" y1=\"346.4769\" y2=\"633.1669\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"29.9004\" x=\"300.5498\" y=\"362.472\">Pod</text></g><!--cluster nc--><g class=\"cluster\" data-qualified-name=\"nc\" data-source-line=\"22\" id=\"ent0010\"><polygon fill=\"#FFFFFF\" points=\"583,522.0769,593,512.0769,942,512.0769,942,619.6669,932,629.6669,583,629.6669,583,522.0769\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"932\" x2=\"942\" y1=\"522.0769\" y2=\"512.0769\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"583\" x2=\"932\" y1=\"522.0769\" y2=\"522.0769\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"932\" x2=\"932\" y1=\"522.0769\" y2=\"629.6669\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"172.2725\" x=\"672.3638\" y=\"538.072\">Nextcloud App Server</text></g><!--cluster db--><g class=\"cluster\" data-qualified-name=\"db\" data-source-line=\"27\" id=\"ent0013\"><path d=\"M6,778.1669 C6,768.1669 128,768.1669 128,768.1669 C128,768.1669 250,768.1669 250,778.1669 L250,892.7669 C250,902.7669 128,902.7669 128,902.7669 C128,902.7669 6,902.7669 6,892.7669 L6,778.1669\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><path d=\"M6,778.1669 C6,788.1669 128,788.1669 128,788.1669 C128,788.1669 250,788.1669 250,778.1669\" fill=\"none\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"125.8975\" x=\"65.0513\" y=\"803.162\">MySQL/MariaDB</text></g><!--cluster ftp--><g class=\"cluster\" data-qualified-name=\"ftp\" data-source-line=\"31\" id=\"ent0015\"><polygon fill=\"#FFFFFF\" points=\"286,804.3169,296,794.3169,510,794.3169,510,1033.3569,500,1043.3569,286,1043.3569,286,804.3169\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"500\" x2=\"510\" y1=\"804.3169\" y2=\"794.3169\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"286\" x2=\"500\" y1=\"804.3169\" y2=\"804.3169\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"500\" x2=\"500\" y1=\"804.3169\" y2=\"1043.3569\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"148.9482\" x=\"319.5259\" y=\"820.312\">FTP Backup Target</text></g><!--entity img--><g class=\"entity\" data-qualified-name=\"k8s.ns.cron.img\" data-source-line=\"12\" id=\"ent0005\"><rect fill=\"#FFFFFF\" height=\"88.1875\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"202.9082\" x=\"292.55\" y=\"179.2969\"/><polygon fill=\"#FFFFFF\" points=\"478.4582,184.2969,478.4582,198.2969,490.4582,198.2969,490.4582,190.2969,484.4582,184.2969,478.4582,184.2969\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"484.4582\" x2=\"484.4582\" y1=\"184.2969\" y2=\"190.2969\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"490.4582\" x2=\"484.4582\" y1=\"190.2969\" y2=\"190.2969\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"51.748\" x=\"302.55\" y=\"205.292\">Backup</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"354.298\" y=\"205.292\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"68.4141\" x=\"358.7482\" y=\"205.292\">Container</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"427.1623\" y=\"205.292\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"43.8457\" x=\"431.6125\" y=\"205.292\">Image</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"92.2646\" x=\"302.7688\" y=\"221.5889\">(alpine:latest</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"395.0334\" y=\"221.5889\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"11.7305\" x=\"399.4836\" y=\"221.5889\">+</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"411.2141\" y=\"221.5889\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"43.3945\" x=\"415.6643\" y=\"221.5889\">rclone</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"459.0588\" y=\"221.5889\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"11.7305\" x=\"463.509\" y=\"221.5889\">+</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"90.959\" x=\"343.5246\" y=\"237.8857\">mysql-client)</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"67.6484\" x=\"319.6433\" y=\"254.1826\">Published</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"387.2917\" y=\"254.1826\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"14.0547\" x=\"391.7419\" y=\"254.1826\">to</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"405.7966\" y=\"254.1826\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"48.1182\" x=\"410.2468\" y=\"254.1826\">ghcr.io</text></g><!--entity job--><g class=\"entity\" data-qualified-name=\"k8s.ns.cron.pod.job\" data-source-line=\"14\" id=\"ent0007\"><rect fill=\"#FFFFFF\" height=\"52.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"124.2617\" x=\"311.87\" y=\"384.4769\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"77.4238\" x=\"335.2889\" y=\"407.472\">backup-job</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"104.2617\" x=\"321.87\" y=\"423.7689\">(entrypoint.sh)</text></g><!--entity dump--><g class=\"entity\" data-qualified-name=\"k8s.ns.cron.pod.dump\" data-source-line=\"15\" id=\"ent0008\"><rect fill=\"#FFFFFF\" height=\"52.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"116.4209\" x=\"183.79\" y=\"556.5769\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"82.2773\" x=\"200.8618\" y=\"579.572\">mysqldump</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"96.4209\" x=\"193.79\" y=\"595.8689\">(mysql-client)</text></g><!--entity rclone--><g class=\"entity\" data-qualified-name=\"k8s.ns.cron.pod.rclone\" data-source-line=\"16\" id=\"ent0009\"><rect fill=\"#FFFFFF\" height=\"52.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"111.0957\" x=\"335.45\" y=\"556.5769\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"43.3945\" x=\"369.3006\" y=\"579.572\">rclone</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"30.5088\" x=\"345.45\" y=\"595.8689\">(FTP</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"375.9588\" y=\"595.8689\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"56.1367\" x=\"380.409\" y=\"595.8689\">remote)</text></g><!--entity nextcloud--><g class=\"entity\" data-qualified-name=\"nc.nextcloud\" data-source-line=\"23\" id=\"ent0011\"><rect fill=\"#FFFFFF\" height=\"52.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"90.7725\" x=\"598.61\" y=\"556.5769\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"70.7725\" x=\"608.61\" y=\"579.572\">Nextcloud</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"32.874\" x=\"609.4269\" y=\"595.8689\">(PHP</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"642.3009\" y=\"595.8689\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"31.8145\" x=\"646.7511\" y=\"595.8689\">app)</text></g><!--entity ncfs--><g class=\"entity\" data-qualified-name=\"nc.ncfs\" data-source-line=\"24\" id=\"ent0012\"><path d=\"M724.17,562.0769 C724.17,552.0769 825.0025,552.0769 825.0025,552.0769 C825.0025,552.0769 925.835,552.0769 925.835,562.0769 L925.835,603.6706 C925.835,613.6706 825.0025,613.6706 825.0025,613.6706 C825.0025,613.6706 724.17,613.6706 724.17,603.6706 L724.17,562.0769\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><path d=\"M724.17,562.0769 C724.17,572.0769 825.0025,572.0769 825.0025,572.0769 C825.0025,572.0769 925.835,572.0769 925.835,562.0769\" fill=\"none\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"70.7725\" x=\"770.6773\" y=\"589.072\">Nextcloud</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"841.4498\" y=\"589.072\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"33.4277\" x=\"845.9\" y=\"589.072\">Data</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"34.0771\" x=\"734.17\" y=\"605.3689\">(files</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"768.2471\" y=\"605.3689\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"11.7305\" x=\"772.6973\" y=\"605.3689\">+</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"784.4278\" y=\"605.3689\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"126.957\" x=\"788.878\" y=\"605.3689\">config/config.php)</text></g><!--entity schemas--><g class=\"entity\" data-qualified-name=\"db.schemas\" data-source-line=\"28\" id=\"ent0014\"><rect fill=\"#FFFFFF\" height=\"52.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"176.8848\" x=\"29.56\" y=\"826.1669\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"78.8115\" x=\"39.56\" y=\"849.162\">Databases:</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"118.3715\" y=\"849.162\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"73.623\" x=\"122.8217\" y=\"849.162\">nextcloud,</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"41.9932\" x=\"97.0058\" y=\"865.4589\">mysql</text></g><!--entity ftpSrv--><g class=\"entity\" data-qualified-name=\"ftp.ftpSrv\" data-source-line=\"32\" id=\"ent0016\"><rect fill=\"#FFFFFF\" height=\"36.2969\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"95.4072\" x=\"343.3\" y=\"834.3169\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"25.0469\" x=\"353.3\" y=\"857.312\">FTP</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"378.3469\" y=\"857.312\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"45.9102\" x=\"382.7971\" y=\"857.312\">Server</text></g><!--entity backups--><g class=\"entity\" data-qualified-name=\"ftp.backups\" data-source-line=\"33\" id=\"ent0017\"><rect fill=\"#FFFFFF\" height=\"55.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"169.9043\" x=\"306.05\" y=\"971.7669\"/><polygon fill=\"#FFFFFF\" points=\"458.9543,976.7669,458.9543,990.7669,470.9543,990.7669,470.9543,982.7669,464.9543,976.7669,458.9543,976.7669\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"464.9543\" x2=\"464.9543\" y1=\"976.7669\" y2=\"982.7669\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"470.9543\" x2=\"464.9543\" y1=\"982.7669\" y2=\"982.7669\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"51.748\" x=\"327.9104\" y=\"997.762\">Backup</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"379.6584\" y=\"997.762\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"59.9854\" x=\"384.1086\" y=\"997.762\">Archives</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"33.168\" x=\"316.05\" y=\"1014.0589\">(SQL</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"349.218\" y=\"1014.0589\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"47.5781\" x=\"353.6682\" y=\"1014.0589\">dumps</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"401.2463\" y=\"1014.0589\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"11.7305\" x=\"405.6965\" y=\"1014.0589\">+</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"417.427\" y=\"1014.0589\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"34.0771\" x=\"421.8771\" y=\"1014.0589\">files)</text></g><!--link img to pod--><g class=\"link\" data-entity-1=\"ent0005\" data-entity-2=\"ent0006\" data-link-type=\"dependency\" data-source-line=\"36\" id=\"lnk18\"><path d=\"M432.75,267.9369 C444.47,283.4869 456.06,301.8069 463,320.4769 C464.6825,325.0006 466.0748,329.7383 467.2226,334.5717 C467.3661,335.1759 466.1946,329.9266 466.3305,330.5335\" fill=\"none\" id=\"img-to-pod\" style=\"stroke:#000000;stroke-width:2;stroke-dasharray:7,7;\"/><polygon fill=\"#000000\" points=\"467.6417,336.3885,469.5782,326.7319,466.549,331.5093,461.7716,328.4802,467.6417,336.3885\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"37.377\" x=\"461\" y=\"309.6155\">image</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"498.377\" y=\"309.6155\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"21.8906\" x=\"502.1914\" y=\"309.6155\">pull</text></g><!--link job to nextcloud--><g class=\"link\" data-entity-1=\"ent0007\" data-entity-2=\"ent0011\" data-link-type=\"dependency\" data-source-line=\"37\" id=\"lnk19\"><path d=\"M414.71,437.4269 C465.69,469.5369 547.4035,521.0186 598.3235,553.0986\" fill=\"none\" id=\"job-to-nextcloud\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"603.4,556.2969,597.9174,548.1151,599.1696,553.6317,593.653,554.8838,603.4,556.2969\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"37.998\" x=\"502\" y=\"479.2155\">toggle</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"539.998\" y=\"479.2155\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"78.6152\" x=\"543.8125\" y=\"479.2155\">maintenance</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"622.4277\" y=\"479.2155\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"22.5293\" x=\"626.2422\" y=\"479.2155\">flag</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"27.7207\" x=\"525.5898\" y=\"493.1843\">(edit</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"553.3105\" y=\"493.1843\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"68.0566\" x=\"557.125\" y=\"493.1843\">config.php)</text></g><!--link job to ncfs--><g class=\"link\" data-entity-1=\"ent0007\" data-entity-2=\"ent0012\" data-link-type=\"dependency\" data-source-line=\"38\" id=\"lnk20\"><path d=\"M436.41,436.1169 C437.62,436.4469 438.81,436.7669 440,437.0769 C534.29,461.3269 566.17,432.0169 657,467.0769 C708.25,486.8569 754.6174,521.1177 786.7474,547.9877\" fill=\"none\" id=\"job-to-ncfs\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"791.35,551.8369,787.0121,542.9948,787.5145,548.6293,781.88,549.1316,791.35,551.8369\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"27.2871\" x=\"712\" y=\"479.2155\">read</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"739.2871\" y=\"479.2155\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"60.6621\" x=\"743.1016\" y=\"479.2155\">Nextcloud</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"803.7637\" y=\"479.2155\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"24.5273\" x=\"807.5781\" y=\"479.2155\">files</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"43.0371\" x=\"724.1318\" y=\"493.1843\">(create</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"767.1689\" y=\"493.1843\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"48.9902\" x=\"770.9834\" y=\"493.1843\">archive)</text></g><!--link dump to db--><g class=\"link\" data-entity-1=\"ent0008\" data-entity-2=\"ent0013\" data-link-type=\"dependency\" data-source-line=\"39\" id=\"lnk21\"><path d=\"M242,609.5269 C242,642.4919 242,701.6169 242,753.1644 C242,756.3861 242,759.5782 242,762.7325 C242,764.3096 242,759.8773 242,761.4345\" fill=\"none\" id=\"dump-to-db\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"242,767.4345,246,758.4345,242,762.4345,238,758.4345,242,767.4345\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"34.5293\" x=\"243\" y=\"741.3055\">dump</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"277.5293\" y=\"741.3055\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"53.1328\" x=\"281.3438\" y=\"741.3055\">schemas</text></g><!--link job to dump--><g class=\"link\" data-entity-1=\"ent0007\" data-entity-2=\"ent0008\" data-link-type=\"dependency\" data-source-line=\"40\" id=\"lnk22\"><path d=\"M354.08,437.3769 C346.81,446.7169 338.53,457.3769 331,467.0769 C307.18,497.7469 283.4859,528.3247 265.4559,551.5847\" fill=\"none\" id=\"job-to-dump\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"261.78,556.3269,270.4552,551.6642,264.8432,552.3751,264.1324,546.7631,261.78,556.3269\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"39.7148\" x=\"332\" y=\"486.2155\">invoke</text></g><!--link job to rclone--><g class=\"link\" data-entity-1=\"ent0007\" data-entity-2=\"ent0009\" data-link-type=\"dependency\" data-source-line=\"41\" id=\"lnk23\"><path d=\"M376.55,437.2469 C379.75,469.3069 384.6221,518.1167 387.8421,550.2667\" fill=\"none\" id=\"job-to-rclone\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"388.44,556.2369,391.5232,546.8831,387.9417,551.2618,383.563,547.6803,388.44,556.2369\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"39.7148\" x=\"383\" y=\"486.2155\">invoke</text></g><!--link rclone to ftpSrv--><g class=\"link\" data-entity-1=\"ent0009\" data-entity-2=\"ent0016\" data-link-type=\"dependency\" data-source-line=\"42\" id=\"lnk24\"><path d=\"M391,609.5269 C391,663.5569 391,781.8469 391,827.8869\" fill=\"none\" id=\"rclone-to-ftpSrv\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"391,833.8869,395,824.8869,391,828.8869,387,824.8869,391,833.8869\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"40.8691\" x=\"392\" y=\"741.3055\">upload</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"432.8691\" y=\"741.3055\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"17.7891\" x=\"436.6836\" y=\"741.3055\">via</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"454.4727\" y=\"741.3055\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"21.4688\" x=\"458.2871\" y=\"741.3055\">FTP</text></g><!--link ftpSrv to backups--><g class=\"link\" data-entity-1=\"ent0016\" data-entity-2=\"ent0017\" data-link-type=\"dependency\" data-source-line=\"43\" id=\"lnk25\"><path d=\"M391,870.9669 C391,895.9169 391,935.9369 391,965.3469\" fill=\"none\" id=\"ftpSrv-to-backups\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"391,971.3469,395,962.3469,391,966.3469,387,962.3469,391,971.3469\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"30.6152\" x=\"392\" y=\"938.9055\">store</text></g><?plantuml-src RLHDRzim3BtxLx0vDUXi5piDEHHeKmpxQf4X1NhfXPPfMuiiQPASBXlwtqVBTfmMlSGH7n_v-4JxhAHAQeBhn-scQnKq8LY_odE7prajGzCLdISdZ0waGoPCc-EpLrZu_fbA1dnQ6PTQXJfmWNp_yJAxp4lfGt8cjL1TUIoUytDjsjRepF8nIO8CYk2U_WIXJ5V23OfTPs7jZFvc2ZXVSrjaTKx-fNAP97udjKM7BVW6I_CiTGqLAayd24kqHhFORJXmSKSYeAuL9OasB6NnlIl8QGhaOQqw7yWj03tiFddubm0CIVVOahSeA69wW2Pmb1SXmVz7401Ta1MA08jfa4a_V6snfYTzZihoUQMG-mUu0CU3i_iNq1xyRvKA9Ldvyablka99tr09mK3T29T94nlAjXwx3M8sfennQygZ3fXDW4KHfQI_JC7jEU8EraY-Ijyi8v61zsXHJzcrbbclj4LI3xp76iPXokU73LlVca03OG16oaio_RuaBzEzp5jmRIrioUt7cz4Y3dRIvPZAZJPVDe3M3btq171-YG4BzAygttACEPLKVFiNN59Niiw7HsQRgOgeVAzhhd1tsFxyaT-XatXxCnXGl1LrEsRxrIpZmt2jaU55GotwUU3Ued5F7j3L569Q5UpRodtYYH-SiNNxv9rrktQYaNloF2BhZPVKZnd77KORbY6Au4M2BBkAYxFYjUBz1DifbV12G9fUpLCm74pDhn2qlCpy7K0j22g5TRzHfGnmuk1CPnUPwGZBapSyQc6Qu7WW7Y4gNYQzraXZOrTH-T6mgM0CibAzDpiwHiSNw1WVppqq6CLGPvLX5Nk9m5ucOxnF6VtW71-Ce_y0?></g></svg>",
  "architecture_description": "## High-level architecture\n\nThis repository builds a lightweight **backup container** (Alpine Linux) that packages:\n- **mysqldump** (from `mysql-client`) to export the Nextcloud databases\n- **rclone** to transfer backup artifacts to an **FTP server**\n- A shell-based orchestrator (`entrypoint.sh`) that coordinates the backup steps\n\nThe intended runtime is a **Kubernetes CronJob** (implied by the README) that periodically starts a Pod running the container.\n\n## Components and responsibilities\n\n1. **Container Image (ghcr.io)**\n   - Built from the provided `Dockerfile` and published via GitHub Actions (`.github/workflows/docker-publish.yml`).\n   - Runtime contains `entrypoint.sh`, `mysqldump`, and `rclone`.\n\n2. **Kubernetes CronJob / Pod**\n   - CronJob schedules executions; each run creates a Pod.\n   - The Pod runs `entrypoint.sh` which:\n     - Puts Nextcloud into maintenance mode by editing `config/config.php`.\n     - Reads/archives the Nextcloud filesystem data.\n     - Calls `mysqldump` to export the `nextcloud` and `mysql` databases from the external DB.\n     - Calls `rclone` to upload the resulting artifacts to the FTP target.\n\n3. **Nextcloud App Server + Filesystem**\n   - External Nextcloud instance (PHP application).\n   - The backup job needs access to the Nextcloud directory structure and `config/config.php` to toggle maintenance mode and to read files for backup.\n\n4. **MySQL/MariaDB Database**\n   - External database service hosting at least the `nextcloud` and `mysql` schemas.\n   - Accessed over the network by `mysqldump` using environment variables like `DB_HOST`.\n\n5. **FTP Backup Target**\n   - External FTP server used as the remote backup destination.\n   - `rclone` authenticates using `FTP_HOST/FTP_USER/FTP_PASS` and uploads backup archives (SQL dumps + file archives)."
}