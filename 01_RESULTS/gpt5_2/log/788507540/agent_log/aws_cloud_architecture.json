{
  "aws_architecture_description": "## Proposed high-level AWS architecture (lean, secure, scalable)\n\n### 1) Container platform: Amazon EKS (Kubernetes) with Istio\n- Deploy **svc1** and **svc2** as Kubernetes Deployments on **Amazon EKS** (mirrors your current manifests).\n- Keep **Istio** for ingress + traffic management:\n  - Run an **Istio IngressGateway** Service of type **LoadBalancer**.\n  - Use **Istio VirtualServices** to route `/svc1` → svc1 Service and `/svc2` → svc2 Service.\n  - (Optional cleanup) If you’re fully on Istio, you can remove/ignore the legacy Kubernetes Ingress objects to avoid confusion.\n\n### 2) Networking: VPC with public + private subnets\n- Create a dedicated **VPC** spanning **2–3 Availability Zones**.\n- Place **EKS worker nodes in private subnets**; place internet-facing load balancers in **public subnets**.\n- Provide outbound internet access from private subnets via **NAT Gateways**.\n- Configure the EKS cluster endpoint as **public+private** (common best practice) and restrict public access via CIDRs as needed. ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/best-practices/subnets.html?utm_source=openai))\n\n### 3) Ingress: AWS Load Balancer Controller + NLB/ALB\n- Use **AWS Load Balancer Controller** in the cluster to provision the external load balancer for the Istio IngressGateway Service.\n  - Typical pattern: **Network Load Balancer (NLB)** in front of Istio IngressGateway (L4), with TLS termination either at the NLB (ACM) or at Istio (mTLS/mesh policies).\n- Use **Route 53** to map a friendly DNS name (e.g., `api.example.com`) to the load balancer.\n\n### 4) Images + CI/CD: ECR + pipeline\n- Build the two container images from your existing multi-stage Dockerfile and push to **Amazon ECR** (separate repos or a single repo with two tags).\n- Deploy to EKS via:\n  - **GitHub Actions / CodeBuild** to build & push images\n  - **Argo CD** or **CodePipeline** (optional) to apply Kubernetes manifests/Helm charts\n\n### 5) Service-to-service calls\n- svc2 → svc1 remains an internal call via Kubernetes Service DNS (ClusterIP), same as today.\n- If you want stronger security controls, enforce:\n  - **Istio mTLS** between services\n  - **Kubernetes NetworkPolicies** (or Cilium policies if you choose that route)\n\n### 6) Observability: OpenTelemetry → AWS-managed options (recommended)\nYou currently export traces to in-cluster Grafana Tempo. On AWS you have two clean options:\n\n**Option A (most “AWS-native”):**\n- Run an **OpenTelemetry Collector** as a DaemonSet/Deployment in EKS.\n- Export traces to **AWS X-Ray** and metrics to **Amazon CloudWatch** (or Prometheus-compatible stack).\n\n**Option B (closest to current): Amazon Managed Service for Grafana + Tempo**\n- Use **Amazon Managed Grafana** with a **Tempo data source** (Grafana-managed/hosted Tempo) and send OTLP to a collector that forwards to Tempo.\n- This keeps the “Tempo” model but reduces your operational burden.\n\nIn both options:\n- Use **CloudWatch Container Insights** and **Fluent Bit** (or OpenSearch) for logs.\n\n### 7) IAM and workload permissions\n- Use **IAM Roles for Service Accounts (IRSA)** so in-cluster components (AWS Load Balancer Controller, ExternalDNS, OTel collector if needed, etc.) get least-privilege AWS access without node-wide credentials. ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html?utm_source=openai))\n\n### 8) Security baseline\n- **ACM** for TLS certificates.\n- **AWS WAF** (if using ALB) for basic L7 protections; for NLB you’d typically rely on upstream controls or move TLS/L7 to ALB.\n- **Secrets**: use **AWS Secrets Manager** (synced into K8s via External Secrets Operator) or SSM Parameter Store.\n- **KMS** for encryption of secrets (EKS envelope encryption) and for Secrets Manager.\n\n---\n\n## AWS resources to provision\n\n### Networking\n- Amazon **VPC**\n- **Public subnets** (2–3, across AZs)\n- **Private subnets** (2–3, across AZs)\n- **Internet Gateway**\n- **NAT Gateway(s)** (1 per AZ recommended for HA)\n- **Route tables** (public/private) + routes\n- **Security Groups** (EKS cluster, node groups, load balancer)\n- (Optional) **VPC Endpoints** (ECR API/DKR, S3, CloudWatch Logs, STS) to reduce NAT egress\n\n### Kubernetes / Compute\n- **Amazon EKS cluster**\n- **EKS managed node group(s)** (or Fargate profiles if you choose serverless pods)\n- **EKS OIDC provider** (for IRSA) ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html?utm_source=openai))\n\n### Ingress / Edge / DNS\n- **AWS Load Balancer Controller** (installed in-cluster; requires IAM)\n- **Network Load Balancer (NLB)** or **Application Load Balancer (ALB)** (provisioned by controller)\n- **AWS Certificate Manager (ACM)** certificate(s)\n- **Amazon Route 53** hosted zone + DNS records (A/AAAA alias to LB)\n- (Optional) **AWS WAF** web ACL (primarily with ALB)\n\n### Container registry & build/deploy\n- **Amazon ECR repositories** (svc1, svc2)\n- (Optional) **ECR lifecycle policies**\n- (Optional) **ECR image scanning** configuration\n- CI/CD (choose one):\n  - **AWS CodeBuild** project(s)\n  - **AWS CodePipeline** pipeline\n  - **S3 artifact bucket** (for CodePipeline)\n  - **IAM roles** for build/deploy\n\n### Observability\n- **Amazon CloudWatch Logs** log groups (cluster/app)\n- (Optional) **CloudWatch Container Insights**\n- (Option A) **AWS X-Ray** (trace storage/analysis)\n- (Option B) **Amazon Managed Grafana** workspace (and any required IAM access)\n\n### IAM / Security / Secrets\n- **IAM roles for service accounts (IRSA roles)** for:\n  - AWS Load Balancer Controller\n  - ExternalDNS (if used)\n  - OpenTelemetry Collector (if exporting to AWS services)\n- **IAM policies** (least privilege) attached to the above roles ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/best-practices/identity-and-access-management.html?utm_source=openai))\n- **AWS Secrets Manager** secrets (or SSM Parameter Store parameters)\n- **AWS KMS key(s)** (Secrets Manager + optional EKS secret envelope encryption)\n\n### Optional (only if needed)\n- **Amazon S3** bucket(s) (if the app needs object storage later)\n- **Amazon RDS/Aurora** (if a database is introduced later)\n- **Amazon OpenSearch Service** (if you want managed log search/analytics)\n\nIf you tell me whether you want to keep “Tempo-style” tracing (Managed Grafana/Tempo) vs move to X-Ray, and whether you prefer NLB (L4) or ALB (L7), I can tighten this into a single recommended variant and map it directly to Kubernetes manifests/Helm charts.",
  "aws_resources": [
    "Amazon VPC",
    "VPC public subnets (multi-AZ)",
    "VPC private subnets (multi-AZ)",
    "Internet Gateway (IGW)",
    "NAT Gateway(s)",
    "Public route table(s) + routes",
    "Private route table(s) + routes",
    "Security Groups (EKS control plane, node groups, load balancer)",
    "(Optional) VPC Endpoints: ECR (api,dkr), S3 (gateway), CloudWatch Logs, STS",
    "Amazon EKS cluster",
    "EKS managed node group(s) (EC2)",
    "(Optional) EKS Fargate profile(s)",
    "EKS OIDC identity provider (for IRSA)",
    "IAM Roles for Service Accounts (IRSA) roles",
    "IAM policies for IRSA roles (least privilege)",
    "Amazon ECR repository (svc1)",
    "Amazon ECR repository (svc2)",
    "(Optional) ECR lifecycle policy",
    "(Optional) ECR enhanced image scanning configuration",
    "AWS Load Balancer Controller (in-cluster add-on)",
    "Network Load Balancer (NLB) or Application Load Balancer (ALB) (provisioned by controller)",
    "AWS Certificate Manager (ACM) certificate(s)",
    "Amazon Route 53 hosted zone",
    "Route 53 DNS records (alias to LB)",
    "(Optional) AWS WAF web ACL (primarily for ALB)",
    "Amazon CloudWatch log groups",
    "(Optional) CloudWatch Container Insights",
    "(Option A) AWS X-Ray",
    "(Option B) Amazon Managed Grafana workspace",
    "AWS Secrets Manager secrets (or SSM Parameter Store parameters)",
    "AWS KMS key(s)",
    "(Optional) AWS CodeBuild project(s)",
    "(Optional) AWS CodePipeline pipeline",
    "(Optional) S3 artifact bucket for CI/CD",
    "(Optional) IAM roles for CI/CD"
  ]
}