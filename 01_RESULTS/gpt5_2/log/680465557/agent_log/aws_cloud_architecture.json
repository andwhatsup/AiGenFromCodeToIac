{
  "aws_architecture_description": "## Proposed high-level AWS architecture (Lambda container image + scheduled automation)\n\n### 1) Networking & security baseline\n- Deploy into a dedicated **VPC** with **two Availability Zones** for resilience.\n- Create **private subnets** for the Lambda function (recommended when you want controlled egress and consistent network policy).\n- Provide outbound internet access for `github.com` via a **NAT Gateway** in **public subnets** (one per AZ if you want HA; one total if you want leaner cost).\n- Use **VPC endpoints** where it reduces NAT traffic and improves security:\n  - **ECR (api + dkr)** and **S3 gateway endpoint** so Lambda can pull images / access S3 without traversing the public internet.\n  - **CloudWatch Logs** endpoint (optional; reduces NAT usage).\n- Lock down traffic with:\n  - A **Lambda security group** allowing only outbound (no inbound needed).\n  - NACLs left default unless you have a specific compliance requirement.\n\n### 2) Container image build & deployment\n- Store the Lambda container image in **Amazon ECR**.\n- Use a CI/CD pipeline (recommended) to build and push the image:\n  - **GitHub Actions** (or AWS CodeBuild/CodePipeline) builds the Docker image from the provided `Dockerfile` and pushes to ECR.\n  - Deployment updates the Lambda function to the new image digest/tag.\n\n### 3) Compute: AWS Lambda (container image runtime)\n- Create a **Lambda function (Python 3.11 container image)** with:\n  - Configured **memory/timeout** appropriate for cloning/pushing repos and calling AWS APIs.\n  - Increased **ephemeral storage** if repo operations exceed default `/tmp` capacity.\n  - Environment variables for repo/org settings and references to secrets.\n- Attach an **execution role** with least-privilege permissions:\n  - Read-only access to **AWS Organizations** SCP APIs used (list/describe).\n  - Read-only access to **IAM** list APIs used.\n  - Write permissions to **CloudWatch Logs**.\n  - (If needed) permissions to read/write to S3 (only if the function actually reads CloudTrail logs or writes artifacts).\n\n### 4) Scheduling / orchestration\n- Create an **Amazon EventBridge rule** (cron or rate) to invoke the Lambda on a schedule.\n- Add an **EventBridge target** pointing to the Lambda and a **Lambda permission** allowing EventBridge to invoke it.\n- (Optional) Add a **dead-letter / failure path**:\n  - Route failures to an **SQS DLQ** or **SNS topic** for alerting.\n\n### 5) Secrets & external integration (GitHub)\n- Store the GitHub token in **AWS Secrets Manager** (preferred) or **SSM Parameter Store (SecureString)**.\n- Grant the Lambda role permission to read that secret.\n- Ensure outbound HTTPS to GitHub works via NAT; optionally restrict egress using AWS Network Firewall or a proxy if required by policy.\n\n### 6) Audit logging (CloudTrail → S3)\n- Enable/maintain **AWS CloudTrail** to deliver logs to a dedicated **S3 bucket**.\n- Secure the bucket with:\n  - **S3 bucket policy** allowing CloudTrail delivery.\n  - **SSE-KMS** encryption (KMS key with CloudTrail permissions).\n  - **Block Public Access** and (optionally) **Object Lock** for immutability.\n- (Optional) Add lifecycle policies to manage retention/cost.\n\n### 7) Observability\n- Use **CloudWatch Logs** for Lambda logs.\n- Add **CloudWatch metrics/alarms** for:\n  - Lambda errors, throttles, duration, and iterator age (if ever event-driven streams are added).\n- (Optional) Enable **AWS X-Ray** for tracing if debugging external calls (GitHub) is important.\n\n---\n\n## Notes / lean choices\n- If you do **not** need VPC-level egress control, you can run Lambda **without a VPC** and it will have outbound internet by default; that removes NAT cost/ops. However, many orgs prefer VPC + NAT for governance.\n- CloudTrail/S3 are shown in your architecture diagram; if they are already account-standard resources, you may not need to create them in this stack—only reference them.\n",
  "aws_resources": [
    "Amazon VPC",
    "VPC Subnets (2x Public, 2x Private across 2 AZs)",
    "Internet Gateway (IGW)",
    "NAT Gateway (1 or 2)",
    "Elastic IPs for NAT Gateway",
    "Route Tables (public/private) + Routes",
    "Security Group for Lambda",
    "(Optional) VPC Endpoint: Amazon S3 (Gateway Endpoint)",
    "(Optional) VPC Endpoint: Amazon ECR (Interface - ecr.api)",
    "(Optional) VPC Endpoint: Amazon ECR (Interface - ecr.dkr)",
    "(Optional) VPC Endpoint: Amazon CloudWatch Logs (Interface)",
    "Amazon ECR Repository",
    "AWS Lambda Function (container image)",
    "Lambda Function Version(s) + Alias (e.g., prod)",
    "IAM Role for Lambda execution",
    "IAM Policies (least-privilege for Organizations/IAM read + logs + secrets access)",
    "AWS Secrets Manager Secret (GitHub token)",
    "(Alternative) SSM Parameter Store SecureString (GitHub token)",
    "Amazon EventBridge Rule (schedule)",
    "EventBridge Target (Lambda)",
    "Lambda Permission allowing EventBridge invocation",
    "Amazon CloudWatch Log Group for Lambda",
    "CloudWatch Alarms (Errors/Throttles/Duration)",
    "(Optional) AWS X-Ray configuration for Lambda",
    "AWS CloudTrail Trail",
    "Amazon S3 Bucket for CloudTrail logs",
    "S3 Bucket Policy for CloudTrail delivery",
    "AWS KMS Key for S3 encryption (SSE-KMS) + Key Policy",
    "S3 Public Access Block configuration",
    "(Optional) S3 Lifecycle Policy for log retention",
    "(Optional) SNS Topic for alerts",
    "(Optional) SQS Queue (DLQ) + Redrive policy"
  ]
}