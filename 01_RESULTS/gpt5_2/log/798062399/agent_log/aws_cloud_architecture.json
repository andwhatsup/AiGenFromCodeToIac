{
  "aws_architecture_description": "## Proposed high-level AWS architecture (lean, secure, scalable)\n\n### 1) Networking foundation\n- Create a dedicated **VPC** spanning **2–3 Availability Zones**.\n- Use **public subnets** for internet-facing load balancers and **private subnets** for EKS worker nodes (and any internal services).\n- Add **NAT Gateways** (one per AZ if you want higher availability; one total if you want lower cost) so private subnets can pull images/patches without being publicly reachable.\n- Use **VPC endpoints** (Gateway/Interface) where it reduces egress and improves security (notably S3, ECR API/DKR, CloudWatch Logs).\n\n### 2) Container platform (EKS)\n- Run the Notes WebApp on **Amazon EKS**.\n- Use **managed node groups** (EC2) in private subnets. (This is simplest and cost-effective for a small static app; Fargate is optional but not required.)\n- Deploy the existing Kubernetes objects:\n  - **Namespace** `notes-webapp`\n  - **Deployment** with replicas=2\n  - **Service** exposure\n\n### 3) Ingress / Load balancing (ALB)\n- Prefer **AWS Load Balancer Controller** and expose the app via a Kubernetes **Ingress** that provisions an **Application Load Balancer (ALB)**.\n  - Your current `Service type: LoadBalancer` can work, but on AWS the best-practice pattern for HTTP/HTTPS routing is typically **Ingress → ALB** (more control over TLS, rules, WAF, redirects, etc.).\n- Terminate TLS at the ALB using **ACM** certificates.\n- Optionally attach **AWS WAF** to the ALB for basic L7 protections.\n\n### 4) Container image registry and supply chain\n- Use **Amazon ECR** as the primary registry (instead of Docker Hub/GHCR) to keep images in AWS, simplify IAM auth, and reduce external dependencies.\n- CI (GitHub Actions and/or Jenkins) pushes images to ECR.\n- EKS pulls images from ECR using:\n  - **IRSA** (IAM Roles for Service Accounts) for the controller components, and\n  - Node instance role permissions for ECR pull (standard for managed node groups).\n- Keep **cosign signing** in CI; store signatures/attestations alongside images (ECR supports OCI artifacts).\n\n### 5) DNS and HTTPS\n- Use **Route 53** hosted zone for your domain.\n- Create an **A/AAAA alias** record pointing to the ALB.\n- Use **ACM** for public certificate issuance/renewal.\n\n### 6) Observability and security\n- Send cluster and application logs to **CloudWatch Logs** (via Container Insights / Fluent Bit add-on).\n- Use **CloudWatch metrics/alarms** for ALB 4xx/5xx, target health, and node/pod capacity.\n- Use **CloudTrail** for API auditing.\n- Use **AWS Config** (optional but recommended) for drift/compliance visibility.\n- Use **Secrets Manager** (or SSM Parameter Store) for any future secrets (even if the current static app doesn’t need them).\n\n### 7) CI/CD integration options (minimal AWS footprint)\n- Keep GitHub Actions/Jenkins as-is, but authenticate to AWS using:\n  - **GitHub OIDC → IAM role** (recommended) for GitHub Actions.\n  - For Jenkins: either OIDC (if supported) or an IAM role on the Jenkins runner (if Jenkins runs on AWS), otherwise scoped IAM user access keys (least preferred).\n- Terraform (already referenced) provisions the AWS infrastructure; kubectl applies manifests to EKS.\n\n---\n\n## Request flow\n1. User → Internet → **ALB (HTTPS 443)**\n2. ALB → **Target Group** → **Kubernetes Ingress/Service** → **Nginx pods** (serving static HTML/CSS/JS)\n\n## Build/deploy flow\n1. GitHub Actions/Jenkins builds container image → scans (Trivy/OWASP DC/Docker Scout/ZAP) → optional SonarQube gate\n2. CI signs image (cosign) → pushes to **ECR**\n3. CI triggers rollout (kubectl) → EKS pulls image from ECR → Deployment updates pods\n",
  "aws_resources": [
    "Amazon VPC",
    "VPC Subnets (Public, Private across 2–3 AZs)",
    "Internet Gateway (IGW)",
    "NAT Gateway(s)",
    "Route Tables (public/private)",
    "Security Groups (ALB SG, EKS node SG, controller SGs as needed)",
    "Network ACLs (optional; default or hardened)",
    "VPC Endpoints: S3 (Gateway)",
    "VPC Endpoints: ECR API (Interface)",
    "VPC Endpoints: ECR DKR (Interface)",
    "VPC Endpoints: CloudWatch Logs (Interface)",
    "Amazon EKS Cluster",
    "EKS Managed Node Group(s) (EC2)",
    "EKS Add-ons: CoreDNS",
    "EKS Add-ons: kube-proxy",
    "EKS Add-ons: VPC CNI",
    "EKS Add-on: Amazon CloudWatch Observability / Container Insights (or Fluent Bit)",
    "IAM OIDC Provider for EKS (for IRSA)",
    "IAM Roles: EKS Cluster Service Role",
    "IAM Roles: Node Instance Role (ECR pull, CloudWatch logs/metrics as needed)",
    "IAM Roles for Service Accounts (IRSA) for AWS Load Balancer Controller",
    "AWS Load Balancer Controller (Kubernetes controller deployment)",
    "Application Load Balancer (provisioned by controller)",
    "ALB Target Group(s)",
    "ALB Listener(s) (HTTP 80 optional redirect, HTTPS 443)",
    "AWS Certificate Manager (ACM) Public Certificate",
    "Amazon Route 53 Hosted Zone (public)",
    "Route 53 Record (ALIAS to ALB)",
    "Amazon ECR Repository",
    "ECR Lifecycle Policy",
    "ECR Repository Policy (scoped)",
    "AWS WAFv2 Web ACL (optional)",
    "CloudWatch Log Groups (EKS control plane, application logs)",
    "CloudWatch Metrics/Alarms (ALB 4xx/5xx, target health, node capacity)",
    "AWS CloudTrail",
    "AWS KMS Key(s) (for EKS secrets encryption, ECR encryption, log encryption as needed)",
    "AWS Secrets Manager (optional, for future secrets)",
    "IAM Role for GitHub Actions via OIDC (push to ECR, deploy to EKS)",
    "IAM Policy attachments for CI role (ECR push, EKS describe/update via kubectl)"
  ]
}