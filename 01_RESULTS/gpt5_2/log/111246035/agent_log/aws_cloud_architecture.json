{
  "aws_architecture_description": "## Proposed high-level AWS architecture (lean, secure, and operationally simple)\n\n### 1) Compute: run the daemon as a container on a single host (EC2)\n- Deploy the **Go SSH Key Authorizer Daemon** as a **Docker container** on an **EC2 instance**.\n- Use an **Auto Scaling Group (ASG)** with **desired capacity = 1** (or 2 if you want redundancy) to keep the host alive and allow easy replacement.\n- Use **Launch Template** + **user data** (cloud-init) to:\n  - Install/enable Docker (or containerd).\n  - Pull the container image from **Quay.io**.\n  - Run the container with:\n    - `SKA_KEY_URI` (external HTTPS endpoint)\n    - `SKA_AKF_LOC` (path to authorized_keys)\n    - A bind mount to the host path where `authorized_keys` is written.\n\nWhy EC2 (vs ECS/Fargate): this workload **must write to a host filesystem path** used by SSH (`authorized_keys`). That’s naturally aligned with a host-based deployment where the container can write to the instance’s filesystem.\n\n### 2) Storage: persist the authorized_keys path safely\nYou have two common patterns:\n\n**Option A (simplest): write to the instance root volume (EBS)**\n- The container writes to a directory on the instance (e.g., `/home/ec2-user/.ssh/authorized_keys` or similar).\n- Works well if you accept that replacing the instance requires re-generating the file (the daemon will do that on boot).\n\n**Option B (more durable): mount an EFS filesystem and write authorized_keys there**\n- Mount **Amazon EFS** on the instance at a stable mount point.\n- Bind-mount that EFS path into the container.\n- This keeps `authorized_keys` durable across instance replacement.\n\nGiven the daemon can always re-fetch keys from `SKA_KEY_URI`, Option A is usually enough; Option B is for environments where you want the file to survive instance replacement or you run >1 instance.\n\n### 3) Networking: private-by-default with controlled egress\n- Create a **VPC** with:\n  - **Public subnets** (for NAT Gateway and optionally a bastion/SSM-free access patterns)\n  - **Private subnets** (where the EC2 instance runs)\n- The daemon needs **outbound HTTPS** to `SKA_KEY_URI` and outbound access to **Quay.io** to pull images.\n- Use a **NAT Gateway** in a public subnet so the instance can reach the internet while staying in private subnets.\n- Security Groups:\n  - Instance SG: allow **egress 443** to the internet (via NAT). No inbound required for the daemon itself.\n\n### 4) Access & operations: no SSH, use SSM\n- Do not open inbound SSH.\n- Attach an **IAM instance role** with **AmazonSSMManagedInstanceCore** so operators can use **AWS Systems Manager (SSM)** Session Manager for access.\n\n### 5) Secrets/config management\n- Store configuration like `SKA_KEY_URI` and `SKA_AKF_LOC` in **SSM Parameter Store**.\n- If the daemon needs any credentials/tokens (not shown in your analysis), store them in **AWS Secrets Manager**.\n- User data reads parameters at boot and injects them into the container runtime.\n\n### 6) Observability\n- Send container logs to **CloudWatch Logs** (via CloudWatch Agent or Docker logging driver).\n- Enable **CloudWatch metrics/alarms** for:\n  - Instance health\n  - Disk usage (important if writing to local filesystem)\n  - Process/container running (basic heartbeat via logs/metrics)\n\n### 7) CI/CD integration (minimal AWS footprint)\n- Your pipeline already builds/pushes to **Quay.io** via GitHub Actions.\n- AWS does not need to host the registry.\n- Optional: use an **EventBridge scheduled rule + SSM Run Command** (or a simple cron on the instance) to periodically pull the latest tag and restart the container, or pin to immutable tags and update via ASG instance refresh.\n\n---\n\n## AWS resources to provision\n\n### Networking (foundation)\n- **Amazon VPC**\n- **Subnets**: 2x Public, 2x Private (across 2 AZs)\n- **Internet Gateway (IGW)**\n- **NAT Gateway** (in a public subnet)\n- **Elastic IP** (for NAT Gateway)\n- **Route Tables** (public + private) and route table associations\n- **Security Groups**\n  - EC2 instance security group (egress HTTPS)\n\n### Compute\n- **EC2 Launch Template** (AMI, instance type, user data, IAM instance profile, security groups)\n- **EC2 Auto Scaling Group** (desired=1, min=1, max=1 or 2)\n\n### Storage (choose one)\n- **Amazon EBS** root volume (default) *or*\n- **Amazon EFS**\n  - EFS File System\n  - EFS Mount Targets (one per AZ/subnet used)\n  - EFS Security Group (allow NFS from EC2 SG)\n\n### IAM & access\n- **IAM Role** for EC2 (instance role)\n- **IAM Instance Profile**\n- **IAM Policies/attachments**\n  - AmazonSSMManagedInstanceCore\n  - Read access to SSM Parameter Store (and Secrets Manager if used)\n  - CloudWatch Logs permissions (if using agent)\n\n### Systems management\n- **AWS Systems Manager (SSM)** managed instance enablement (via role; no separate resource required, but operationally part of the design)\n- **SSM Parameter Store Parameters**\n  - `/ska/SKA_KEY_URI`\n  - `/ska/SKA_AKF_LOC`\n  - (optional) image tag/name, refresh interval\n\n### Observability\n- **Amazon CloudWatch Log Group** (e.g., `/ska/daemon`)\n- **CloudWatch Alarms** (instance status check failed, disk usage, etc.)\n- (Optional) **CloudWatch Agent** configuration in SSM Parameter Store\n\n### Optional automation (if you want AWS-driven updates)\n- **Amazon EventBridge Rule** (schedule)\n- **SSM Run Command Document** (or use AWS-RunShellScript) to pull/restart container\n- **IAM Role/Policy** for EventBridge to invoke SSM\n",
  "aws_resources": [
    "Amazon VPC",
    "VPC Subnets (Public x2, Private x2 across AZs)",
    "Internet Gateway (IGW)",
    "NAT Gateway",
    "Elastic IP (for NAT Gateway)",
    "Route Tables (Public/Private) + Route Associations",
    "Security Groups (EC2 SG; optional EFS SG)",
    "EC2 Launch Template",
    "EC2 Auto Scaling Group (desired capacity 1)",
    "Amazon EBS Volume (root)",
    "Amazon EFS File System (optional)",
    "EFS Mount Targets (optional)",
    "IAM Role for EC2 (Instance Role)",
    "IAM Instance Profile",
    "IAM Policy Attachments (AmazonSSMManagedInstanceCore, CloudWatch Logs, SSM Parameter read, optional Secrets Manager read)",
    "AWS Systems Manager Parameter Store Parameters (SKA_KEY_URI, SKA_AKF_LOC, optional image settings)",
    "Amazon CloudWatch Log Group",
    "Amazon CloudWatch Alarms",
    "Amazon EventBridge Rule (optional)",
    "SSM Run Command / Document (optional)"
  ]
}