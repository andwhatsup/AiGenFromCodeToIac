{
  "aws_architecture_description": "## Proposed high-level AWS architecture (lean, secure, scalable)\n\n### 1) Compute / runtime\n- **Containerize the FastAPI service** (Uvicorn behind FastAPI) and run it on **Amazon ECS on Fargate**.\n  - This avoids managing EC2 instances and fits a stateless API well.\n  - Run **at least 2 tasks** across **2 private subnets** (different AZs) for high availability.\n  - Configure health checks and autoscaling based on CPU/Memory and/or ALB request count.\n\n### 2) Ingress / routing\n- Put an **Application Load Balancer (ALB)** in **public subnets**.\n  - Terminate TLS at the ALB using **AWS Certificate Manager (ACM)**.\n  - Forward traffic to the ECS service (target group) in private subnets.\n  - Optionally add **AWS WAF** on the ALB for basic L7 protections (SQLi/XSS rules, rate limiting).\n\n### 3) Networking\n- Create a dedicated **VPC** with:\n  - **2 public subnets** (ALB, NAT)\n  - **2 private subnets** (ECS tasks)\n- ECS tasks in private subnets reach the internet (and/or external Vault) via **NAT Gateways**.\n  - If Vault is reachable via private connectivity (preferred), use **AWS PrivateLink / VPC peering / VPN / Direct Connect** depending on where Vault is hosted.\n\n### 4) Secrets and configuration (Vault address + token)\nBecause the app currently expects `VAULT_ADDR` and `VAULT_TOKEN` environment variables:\n- Store `VAULT_TOKEN` in **AWS Secrets Manager**.\n- Store `VAULT_ADDR` in **SSM Parameter Store** (or Secrets Manager as well).\n- Inject both into the ECS task definition as environment variables at runtime.\n\n**Important security note:** a long-lived Vault token in Secrets Manager works, but is not ideal. A better production pattern is:\n- Use **Vault AWS auth method** (or another short-lived auth mechanism) so the task exchanges its AWS identity for a short-lived Vault token, rather than storing a static token. (This requires Vault-side configuration.)\n\n### 5) IAM and least privilege\n- ECS **Task Execution Role**: permissions to pull the container image from ECR, write logs to CloudWatch.\n- ECS **Task Role**: permissions to read the specific secret/parameters (Vault token/address) and nothing else.\n\n### 6) Observability\n- Send application logs to **CloudWatch Logs**.\n- Enable **ALB access logs** to an S3 bucket (optional but useful).\n- Use **CloudWatch metrics/alarms** for:\n  - ALB 5XX, target 5XX, latency\n  - ECS service CPU/memory, task count\n- Optionally add **AWS X-Ray** (requires app instrumentation) for tracing.\n\n### 7) Container image and deployment\n- Build and push the image to **Amazon ECR**.\n- Deploy via CI/CD (optional): CodePipeline/CodeBuild or GitHub Actions.\n\n### 8) Vault connectivity assumptions\nVault is “external/unknown” per your analysis. The AWS design supports three common cases:\n1) **Vault is public HTTPS**: ECS tasks egress via NAT to Vault.\n2) **Vault is in another VPC/account**: connect via VPC peering / Transit Gateway.\n3) **Vault is on-prem**: connect via Site-to-Site VPN or Direct Connect.\n\nIn all cases, restrict egress from ECS tasks to only the Vault endpoint/ports where feasible.\n\n---\n\n## Minimal deployment topology\nClient → (Route 53 DNS) → ALB (public subnets, TLS) → ECS Fargate service (private subnets) → outbound HTTPS to Vault\n\n---\n\n## Notes on data stores\nNo database, cache, or queue is implied by the codebase snapshot. Add them only if future requirements appear (persistence, async jobs, etc.).\n",
  "aws_resources": [
    "VPC",
    "Internet Gateway (IGW)",
    "Public Subnets (2, different AZs)",
    "Private Subnets (2, different AZs)",
    "Route Tables (public/private)",
    "NAT Gateway (1 or 2)",
    "Elastic IPs (for NAT Gateway)",
    "Security Group - ALB",
    "Security Group - ECS Tasks",
    "Network ACLs (optional; default acceptable)",
    "VPC Endpoints (optional but recommended: Secrets Manager, SSM, ECR api, ECR dkr, CloudWatch Logs)",
    "Application Load Balancer (ALB)",
    "ALB Target Group",
    "ALB Listener (HTTPS :443)",
    "AWS Certificate Manager (ACM) Certificate",
    "Amazon Route 53 Hosted Zone + DNS Record (optional if you manage DNS in Route 53)",
    "AWS WAF Web ACL (optional)",
    "Amazon ECS Cluster",
    "ECS Service (Fargate)",
    "ECS Task Definition",
    "ECS Task Execution IAM Role",
    "ECS Task IAM Role (app role)",
    "Amazon ECR Repository",
    "AWS Secrets Manager Secret (VAULT_TOKEN)",
    "AWS Systems Manager Parameter Store Parameter (VAULT_ADDR)",
    "CloudWatch Log Group(s)",
    "CloudWatch Alarms (ALB + ECS)",
    "S3 Bucket for ALB access logs (optional)",
    "IAM policies/attachments for least-privilege access to Secrets Manager/SSM/ECR/Logs"
  ]
}