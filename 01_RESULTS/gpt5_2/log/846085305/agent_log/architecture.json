{
  "plantuml_diagram": "@startuml\n!define AWSPuml https://raw.githubusercontent.com/awslabs/aws-icons-for-plantuml/v20.0/dist\n!include AWSPuml/AWSCommon.puml\n\nskinparam shadowing false\nskinparam componentStyle rectangle\nskinparam wrapWidth 220\nskinparam maxMessageSize 120\n\ntitle Deployment Architecture (Tuya -> InfluxDB -> Grafana) with AWS Lambda (Container Image)\n\nactor \"Operator\" as op\n\ncloud \"AWS Cloud\" as aws {\n  node \"Amazon ECR\\n(Container Image Registry)\" as ecr\n\n  node \"AWS Lambda\\nContainer-based Function\\nPython 3.11 runtime image\" as lambda {\n    artifact \"Lambda Container Image\\n(main.handler)\" as img\n    component \"main.py\\n- tinytuya (Tuya Cloud)\\n- influxdb-client\\n- requests/cryptography\" as code\n  }\n}\n\ncloud \"Tuya Cloud\" as tuya {\n  component \"Tuya Cloud API\" as tuya_api\n}\n\nnode \"VM / Docker Host\\n(Internet-reachable)\" as vm {\n  node \"InfluxDB 2.x\\n(time-series DB)\" as influx {\n    database \"Bucket(s)\" as bucket\n    storage \"Persistent Volume\\n(influxdb-data)\" as influx_vol\n  }\n\n  node \"Grafana\\n(dashboards & visualization)\" as grafana {\n    artifact \"dashboard.json\\n(provisioned/imported)\" as dash\n    storage \"Persistent Volume\\n(grafana-data)\" as grafana_vol\n  }\n}\n\nop --> grafana : View dashboards (HTTP/HTTPS)\n\necr --> lambda : Pull image on deploy/update\n\nlambda --> tuya_api : Poll device data\\nHTTPS (API key/secret)\nlambda --> influx : Write metrics\\nHTTPS (token auth)\n\ngrafana --> influx : Query time-series\\nHTTP/HTTPS\n\nnote right of lambda\nEnv vars:\n- TUYA_APIKEY/SECRET/REGION\n- INFLUXDB_URL/TOKEN/ORG/BUCKET\nNetworking:\n- Lambda needs outbound internet\n- InfluxDB endpoint reachable from Lambda\nend note\n\nnote bottom of vm\nLocal/VM deployment via docker-compose:\n- influxdb service + volume\n- grafana service + volume\nend note\n\n@enduml",
  "svg_diagram": "<?plantuml 1.2026.2beta3?><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" contentStyleType=\"text/css\" data-diagram-type=\"DESCRIPTION\" height=\"793px\" preserveAspectRatio=\"none\" style=\"width:1654px;height:793px;background:#FFFFFF;\" version=\"1.1\" viewBox=\"0 0 1654 793\" width=\"1654px\" zoomAndPan=\"magnify\"><title>Deployment Architecture (Tuya -&gt; InfluxDB -&gt; Grafana) with AWS Lambda (Container Image)</title><defs/><g><g class=\"title\" data-source-line=\"9\"><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"735.4238\" x=\"452.4254\" y=\"22.9951\">Deployment Architecture (Tuya -&gt; InfluxDB -&gt; Grafana) with AWS Lambda (Container Image)</text></g><!--cluster aws--><g class=\"cluster\" data-qualified-name=\"aws\" data-source-line=\"13\" id=\"ent0003\"><path d=\"M825.8164,64.3391 C839.7679,43.5853 853.249,43.4795 865.9565,65.5063 C878.2985,50.9114 890.8244,48.3371 902.4112,66.3506 C915.9068,47.7899 932.0431,47.7745 946.0964,65.6824 C958.0556,52.6672 967.819,52.6962 977.589,68.1078 C989.6039,43.738 1004.1105,44.4813 1022.363,61.3324 C1034.9503,47.0574 1048.6639,43.4886 1059.0116,63.7117 C1070.9486,50.9211 1082.441,50.0525 1092.5045,65.9026 C1103.2247,43.2969 1118.5045,46.4931 1132.5314,62.4724 C1145.5157,47.0945 1166.0716,47.5225 1174.3093,68.0026 C1183.5227,49.4292 1198.3077,47.0994 1211.7261,63.5044 C1223.0209,48.4875 1234.5338,50.3731 1244.8554,64.6066 C1256.0225,46.3462 1269.1911,43.5068 1282.2762,62.6899 C1294.7098,45.1505 1313.5463,48.8651 1322.9927,66.1795 C1335.228,46.1237 1355.8011,47.2803 1365.16,69.0775 C1367.0757,66.2928 1369.2217,66.6653 1370.7084,69.501 C1388.1552,83.8823 1387.1468,98.1611 1368.6799,110.7773 C1385.613,119.7132 1386.652,129.7973 1374.45,143.8209 C1389.0002,155.6554 1390.614,167.436 1373.0819,177.9859 C1389.7235,188.3095 1393.0851,206.4965 1372.231,215.9804 C1390.8834,224.5047 1391.7064,237.9345 1379.0914,252.3559 C1395.5199,263.1389 1395.5767,276.8618 1377.2634,285.7427 C1393.9803,294.6286 1395.7781,310.4108 1378.8351,320.8055 C1397.6295,334.2646 1397.7684,347.8573 1376.2513,358.5575 C1392.9425,370.4456 1391.4288,382.4686 1374.2746,392.3787 C1395.2362,405.7043 1388.9157,422.0062 1371.2383,432.4004 C1389.198,444.7528 1387.668,458.0686 1368.2512,467.2141 C1380.8131,484.5357 1378.2058,496.1315 1358.16,504.6675 C1361.6524,504.6884 1363.0567,507.1373 1361.057,510.0915 C1351.4387,527.3265 1335.0207,528.1998 1323.8204,511.8454 C1310.5339,526.3233 1296.9421,522.9597 1287.7717,506.9746 C1278.3729,527.7814 1261.6748,531.4997 1247.3272,511.932 C1236.5337,529.5882 1220.0402,525.0085 1211.9158,509.1149 C1204.466,528.6797 1188.7548,532.0518 1174.5582,516.2393 C1161.836,536.882 1145.9065,533.3563 1135.3716,514.0914 C1123.1747,536.1443 1110.0642,534.8185 1095.1206,516.8542 C1083.5334,538.7302 1065.0499,536.0119 1053.8232,516.4945 C1042.6108,529.8667 1031.3405,531.3738 1021.7029,514.8051 C1006.711,533.4819 989.7057,530.752 980.7208,508.753 C971.1317,528.5843 955.2987,527.1947 944.213,510.2382 C934.0859,526.8105 917.8852,531.3292 905.328,512.9411 C891.7038,531.7149 874.8791,531.3179 863.8888,510.2046 C841.9091,530.715 826.6975,526.1876 818.16,497.6675 C822.1645,495.9862 824.0657,497.5698 823.8383,501.7601 C803.037,491.9271 807.2126,474.3043 823.4061,464.0472 C809.1635,454.6983 808.8368,441.9222 823.2547,432.436 C804.262,423.5369 800.1919,405.4972 819.8002,393.1995 C807.5383,380.6128 807.0979,369.7197 823.6996,360.5839 C804.5743,350.1648 801.9553,332.5212 820.7473,319.385 C807.9099,308.5418 807.7449,296.0331 822.7558,286.9123 C807.0318,280.0745 804.8399,263.4909 819.344,253.5608 C799.3866,243.5923 801.7701,225.159 818.0355,213.9926 C802.6055,200.7288 800.9608,189.4226 819.5166,177.5396 C803.9529,168.0928 803.964,153.9439 820.1938,145.1621 C803.6412,131.7539 801.9199,118.0755 821.7716,106.1391 C804.8901,91.146 803.1051,74.0764 825.16,62.0775 C826.3631,62.5835 826.632,63.2472 825.8164,64.3391\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"85.9141\" x=\"1048.703\" y=\"80.0726\">AWS Cloud</text></g><!--cluster lambda--><g class=\"cluster\" data-qualified-name=\"aws.lambda\" data-source-line=\"16\" id=\"ent0005\"><polygon fill=\"#FFFFFF\" points=\"842.16,301.4775,852.16,291.4775,1341.16,291.4775,1341.16,470.6675,1331.16,480.6675,842.16,480.6675,842.16,301.4775\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"1331.16\" x2=\"1341.16\" y1=\"301.4775\" y2=\"291.4775\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"842.16\" x2=\"1331.16\" y1=\"301.4775\" y2=\"301.4775\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"1331.16\" x2=\"1331.16\" y1=\"301.4775\" y2=\"480.6675\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"103.6807\" x=\"1035.8197\" y=\"317.4726\">AWS Lambda</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"204.0391\" x=\"985.6405\" y=\"333.7695\">Container-based Function</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"215.5576\" x=\"979.8812\" y=\"350.0664\">Python 3.11 runtime image</text></g><!--cluster tuya--><g class=\"cluster\" data-qualified-name=\"tuya\" data-source-line=\"22\" id=\"ent0008\"><path d=\"M1263.896,641.4619 C1266.9363,635.6999 1271.5831,636.6791 1274.782,641.2955 C1277.9585,633.8091 1282.8179,633.2402 1287.8035,639.5934 C1290.2561,634.0857 1295.9288,633.3522 1299.4562,638.4078 C1302.2392,632.9503 1305.6371,632.6941 1309.7223,637.0447 C1313.0475,631.3864 1317.8907,630.8025 1321.9058,636.2904 C1325.3319,630.2003 1329.6087,629.7495 1333.9791,635.3119 C1338.5255,630.5182 1343.4985,631.3019 1345.5135,637.8796 C1349.5333,633.59 1354.0786,632.8793 1357.0351,639.0508 C1361.0145,632.4588 1367.0029,633.1601 1370.6137,639.4396 C1373.8603,634.8237 1378.8219,634.9079 1380.8509,640.6437 C1384.6206,635.5288 1389.9079,634.9354 1392.9909,641.3658 C1397.3831,636.0972 1401.7662,636.5653 1405.2601,642.3619 C1410.7843,644.3108 1413.2117,649.4317 1407.9069,653.871 C1413.4547,656.6126 1413.7816,660.8757 1409.4173,664.9666 C1416.0539,668.0849 1417.7306,672.7882 1411.2947,677.8164 C1417.2159,682.2812 1414.9922,687.2085 1409.3227,689.7595 C1413.4343,694.5066 1412.6813,698.444 1406.704,700.7977 C1413.2381,705.1945 1412.5094,710.3855 1406.0706,714.1678 C1402.5726,720.0218 1396.329,719.5634 1393.1516,713.8109 C1390.5476,719.9874 1386.2387,720.0325 1381.8642,715.7153 C1378.8341,721.7898 1373.4136,720.7379 1370.3999,715.6984 C1366.7219,721.3354 1362.6195,722.3605 1357.8308,716.9636 C1354.8445,722.6328 1349.1653,722.3753 1346.2671,716.8725 C1342.5232,723.3919 1338.2965,723.935 1333.7622,717.6439 C1329.8881,722.7273 1326.3586,721.747 1322.9973,717.0779 C1319.449,722.7355 1314.2478,723.3691 1310.5424,717.2439 C1305.3011,723.0729 1301.2261,721.773 1297.8034,715.3526 C1294.1167,720.4036 1290.7544,719.9825 1287.0209,715.4051 C1283.2365,719.8722 1278.5908,720.1117 1275.7126,714.3984 C1271.7028,719.3723 1266.0428,718.7312 1263.7776,712.5344 C1258.0005,709.6651 1255.9497,705.9159 1260.9582,700.5163 C1255.1407,698.4649 1255.3341,693.8732 1259.2509,690.2093 C1252.771,687.8045 1251.1428,682.3374 1255.4703,676.8697 C1251.4803,671.9456 1252.9738,668.0401 1258.7076,666.0164 C1254.6043,662.4482 1255.2589,656.9937 1260.4449,654.8737 C1255.2495,649.0287 1255.5324,643.8179 1263.896,641.4619\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"87.6436\" x=\"1289.3382\" y=\"658.8026\">Tuya Cloud</text></g><!--cluster vm--><g class=\"cluster\" data-qualified-name=\"vm\" data-source-line=\"26\" id=\"ent0010\"><polygon fill=\"#FFFFFF\" points=\"230.16,252.2775,240.16,242.2775,758.16,242.2775,758.16,766.2575,748.16,776.2575,230.16,776.2575,230.16,252.2775\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"748.16\" x2=\"758.16\" y1=\"252.2775\" y2=\"242.2775\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"230.16\" x2=\"748.16\" y1=\"252.2775\" y2=\"252.2775\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"748.16\" x2=\"748.16\" y1=\"252.2775\" y2=\"776.2575\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"136.1104\" x=\"422.1048\" y=\"268.2726\">VM / Docker Host</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"160.9043\" x=\"409.7079\" y=\"284.5695\">(Internet-reachable)</text></g><!--cluster influx--><g class=\"cluster\" data-qualified-name=\"vm.influx\" data-source-line=\"27\" id=\"ent0011\"><polygon fill=\"#FFFFFF\" points=\"340.16,605.6675,350.16,595.6675,676.16,595.6675,676.16,726.2575,666.16,736.2575,340.16,736.2575,340.16,605.6675\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"666.16\" x2=\"676.16\" y1=\"605.6675\" y2=\"595.6675\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"340.16\" x2=\"666.16\" y1=\"605.6675\" y2=\"605.6675\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"666.16\" x2=\"666.16\" y1=\"605.6675\" y2=\"736.2575\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"96.3184\" x=\"456.0008\" y=\"621.6626\">InfluxDB 2.x</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"128.707\" x=\"439.8065\" y=\"637.9595\">(time-series DB)</text></g><!--cluster grafana--><g class=\"cluster\" data-qualified-name=\"vm.grafana\" data-source-line=\"32\" id=\"ent0014\"><polygon fill=\"#FFFFFF\" points=\"278.16,332.2775,288.16,322.2775,718.16,322.2775,718.16,455.8675,708.16,465.8675,278.16,465.8675,278.16,332.2775\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"708.16\" x2=\"718.16\" y1=\"332.2775\" y2=\"322.2775\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"278.16\" x2=\"708.16\" y1=\"332.2775\" y2=\"332.2775\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"708.16\" x2=\"708.16\" y1=\"332.2775\" y2=\"465.8675\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"62.7949\" x=\"462.7625\" y=\"348.2726\">Grafana</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"226.8096\" x=\"380.7552\" y=\"364.5695\">(dashboards &amp; visualization)</text></g><!--entity ecr--><g class=\"entity\" data-qualified-name=\"aws.ecr\" data-source-line=\"14\" id=\"ent0004\"><polygon fill=\"#FFFFFF\" points=\"1127.14,99.0775,1137.14,89.0775,1357.1654,89.0775,1357.1654,141.6713,1347.1654,151.6713,1127.14,151.6713,1127.14,99.0775\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"1347.1654\" x2=\"1357.1654\" y1=\"99.0775\" y2=\"89.0775\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"1127.14\" x2=\"1347.1654\" y1=\"99.0775\" y2=\"99.0775\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"1347.1654\" x2=\"1347.1654\" y1=\"99.0775\" y2=\"151.6713\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"56.5811\" x=\"1192.4628\" y=\"122.0726\">Amazon</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"1249.0438\" y=\"122.0726\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"28.3486\" x=\"1253.494\" y=\"122.0726\">ECR</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"73.876\" x=\"1142.14\" y=\"138.3695\">(Container</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"1216.016\" y=\"138.3695\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"43.8457\" x=\"1220.4662\" y=\"138.3695\">Image</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"1264.3119\" y=\"138.3695\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"63.4033\" x=\"1268.7621\" y=\"138.3695\">Registry)</text></g><!--entity img--><g class=\"entity\" data-qualified-name=\"aws.lambda.img\" data-source-line=\"17\" id=\"ent0006\"><rect fill=\"#FFFFFF\" height=\"55.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"207.5293\" x=\"866.39\" y=\"386.2775\"/><polygon fill=\"#FFFFFF\" points=\"1056.9193,391.2775,1056.9193,405.2775,1068.9193,405.2775,1068.9193,397.2775,1062.9193,391.2775,1056.9193,391.2775\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"1062.9193\" x2=\"1062.9193\" y1=\"391.2775\" y2=\"397.2775\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"1068.9193\" x2=\"1062.9193\" y1=\"397.2775\" y2=\"397.2775\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"56.3691\" x=\"876.39\" y=\"412.2726\">Lambda</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"932.7591\" y=\"412.2726\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"68.4141\" x=\"937.2093\" y=\"412.2726\">Container</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"1005.6234\" y=\"412.2726\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"43.8457\" x=\"1010.0736\" y=\"412.2726\">Image</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"103.8242\" x=\"913.2425\" y=\"428.5695\">(main.handler)</text></g><!--entity code--><g class=\"entity\" data-qualified-name=\"aws.lambda.code\" data-source-line=\"18\" id=\"ent0007\"><rect fill=\"#FFFFFF\" height=\"85.1875\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"188.9844\" x=\"1108.67\" y=\"371.4775\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"56.6016\" x=\"1174.8614\" y=\"394.4726\">main.py</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"5.0518\" x=\"1122.4776\" y=\"410.7695\">-</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"1127.5294\" y=\"410.7695\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"57.7637\" x=\"1131.9796\" y=\"410.7695\">tinytuya</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"1189.7432\" y=\"410.7695\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"39.751\" x=\"1194.1934\" y=\"410.7695\">(Tuya</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"1233.9444\" y=\"410.7695\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"45.4521\" x=\"1238.3946\" y=\"410.7695\">Cloud)</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"5.0518\" x=\"1148.4029\" y=\"427.0664\">-</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"1153.4547\" y=\"427.0664\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"100.0166\" x=\"1157.9049\" y=\"427.0664\">influxdb-client</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"5.0518\" x=\"1118.67\" y=\"443.3633\">-</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"1123.7218\" y=\"443.3633\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"159.4824\" x=\"1128.172\" y=\"443.3633\">requests/cryptography</text></g><!--entity tuya_api--><g class=\"entity\" data-qualified-name=\"tuya.tuya_api\" data-source-line=\"23\" id=\"ent0009\"><rect fill=\"#FFFFFF\" height=\"36.2969\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"125.3281\" x=\"1270.49\" y=\"667.8075\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"34.2891\" x=\"1280.49\" y=\"690.8026\">Tuya</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"1314.7791\" y=\"690.8026\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"39.9902\" x=\"1319.2293\" y=\"690.8026\">Cloud</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"1359.2195\" y=\"690.8026\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"22.1484\" x=\"1363.6697\" y=\"690.8026\">API</text></g><!--entity bucket--><g class=\"entity\" data-qualified-name=\"vm.influx.bucket\" data-source-line=\"28\" id=\"ent0012\"><path d=\"M363.86,673.3075 C363.86,663.3075 407.1613,663.3075 407.1613,663.3075 C407.1613,663.3075 450.4625,663.3075 450.4625,673.3075 L450.4625,698.6044 C450.4625,708.6044 407.1613,708.6044 407.1613,708.6044 C407.1613,708.6044 363.86,708.6044 363.86,698.6044 L363.86,673.3075\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><path d=\"M363.86,673.3075 C363.86,683.3075 407.1613,683.3075 407.1613,683.3075 C407.1613,683.3075 450.4625,683.3075 450.4625,673.3075\" fill=\"none\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"66.6025\" x=\"373.86\" y=\"700.3026\">Bucket(s)</text></g><!--entity influx_vol--><g class=\"entity\" data-qualified-name=\"vm.influx.influx_vol\" data-source-line=\"29\" id=\"ent0013\"><rect fill=\"#FFFFFF\" height=\"52.5938\" rx=\"35\" ry=\"35\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"147.3604\" x=\"485.48\" y=\"659.6675\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"69.7539\" x=\"495.48\" y=\"682.6626\">Persistent</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"565.2339\" y=\"682.6626\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"53.1563\" x=\"569.6841\" y=\"682.6626\">Volume</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"104.0225\" x=\"507.1489\" y=\"698.9595\">(influxdb-data)</text></g><!--entity dash--><g class=\"entity\" data-qualified-name=\"vm.grafana.dash\" data-source-line=\"33\" id=\"ent0015\"><rect fill=\"#FFFFFF\" height=\"55.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"190.8701\" x=\"301.72\" y=\"386.2775\"/><polygon fill=\"#FFFFFF\" points=\"475.5901,391.2775,475.5901,405.2775,487.5901,405.2775,487.5901,397.2775,481.5901,391.2775,475.5901,391.2775\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"481.5901\" x2=\"481.5901\" y1=\"391.2775\" y2=\"397.2775\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"487.5901\" x2=\"481.5901\" y1=\"397.2775\" y2=\"397.2775\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"107.3789\" x=\"338.4656\" y=\"412.2726\">dashboard.json</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"160.8701\" x=\"311.72\" y=\"428.5695\">(provisioned/imported)</text></g><!--entity grafana_vol--><g class=\"entity\" data-qualified-name=\"vm.grafana.grafana_vol\" data-source-line=\"34\" id=\"ent0016\"><rect fill=\"#FFFFFF\" height=\"52.5938\" rx=\"35\" ry=\"35\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"147.3604\" x=\"527.48\" y=\"387.7775\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"69.7539\" x=\"537.48\" y=\"410.7726\">Persistent</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"607.2339\" y=\"410.7726\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"53.1563\" x=\"611.6841\" y=\"410.7726\">Volume</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"101.6914\" x=\"550.3145\" y=\"427.0695\">(grafana-data)</text></g><!--entity op--><g class=\"entity\" data-qualified-name=\"op\" data-source-line=\"11\" id=\"ent0002\"><ellipse cx=\"690.1525\" cy=\"90.7275\" fill=\"#FFFFFF\" rx=\"8\" ry=\"8\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><path d=\"M690.1525,98.7275 L690.1525,125.7275 M677.1525,106.7275 L703.1525,106.7275 M690.1525,125.7275 L677.1525,140.7275 M690.1525,125.7275 L703.1525,140.7275\" fill=\"none\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"62.665\" x=\"658.82\" y=\"155.9726\">Operator</text></g><g class=\"entity\" data-qualified-name=\"GMN22\" data-source-line=\"48\" id=\"ent0023\"><path d=\"M1389.05,340.9675 L1389.05,487.1628 L1647.2746,487.1628 L1647.2746,350.9675 L1637.2746,340.9675 L1389.05,340.9675\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><path d=\"M1637.2746,340.9675 L1637.2746,350.9675 L1647.2746,350.9675 L1637.2746,340.9675\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"24.1465\" x=\"1483.4443\" y=\"358.0344\">Env</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"1507.5908\" y=\"358.0344\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"32.1572\" x=\"1511.7231\" y=\"358.0344\">vars:</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.6909\" x=\"1410.9318\" y=\"373.1672\">-</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"1415.6228\" y=\"373.1672\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"196.6377\" x=\"1419.7551\" y=\"373.1672\">TUYA_APIKEY/SECRET/REGION</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.6909\" x=\"1511.3168\" y=\"388.3\">-</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"237.2246\" x=\"1395.05\" y=\"403.4329\">INFLUXDB_URL/TOKEN/ORG/BUCKET</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"78.7617\" x=\"1474.2814\" y=\"418.5657\">Networking:</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.6909\" x=\"1428.2038\" y=\"433.6985\">-</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"1432.8947\" y=\"433.6985\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"52.3428\" x=\"1437.0271\" y=\"433.6985\">Lambda</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"1489.3698\" y=\"433.6985\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"39.2603\" x=\"1493.5021\" y=\"433.6985\">needs</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"1532.7624\" y=\"433.6985\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"62.2261\" x=\"1536.8947\" y=\"433.6985\">outbound</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"51.6255\" x=\"1487.8496\" y=\"448.8313\">internet</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.6909\" x=\"1416.4733\" y=\"463.9641\">-</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"1421.1643\" y=\"463.9641\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"55.123\" x=\"1425.2966\" y=\"463.9641\">InfluxDB</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"1480.4196\" y=\"463.9641\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"57.6431\" x=\"1484.552\" y=\"463.9641\">endpoint</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"1542.195\" y=\"463.9641\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"64.5239\" x=\"1546.3273\" y=\"463.9641\">reachable</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"30.5386\" x=\"1470.1555\" y=\"479.0969\">from</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"1500.694\" y=\"479.0969\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"52.3428\" x=\"1504.8264\" y=\"479.0969\">Lambda</text></g><g class=\"entity\" data-qualified-name=\"GMN25\" data-source-line=\"57\" id=\"ent0026\"><path d=\"M6,650.6975 L6,721.2288 L206.3149,721.2288 L206.3149,660.6975 L196.3149,650.6975 L6,650.6975\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><path d=\"M196.3149,650.6975 L196.3149,660.6975 L206.3149,660.6975 L196.3149,650.6975\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"58.4111\" x=\"19.8044\" y=\"667.7644\">Local/VM</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"78.2156\" y=\"667.7644\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"77.7588\" x=\"82.3479\" y=\"667.7644\">deployment</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"160.1067\" y=\"667.7644\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"19.2715\" x=\"164.239\" y=\"667.7644\">via</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"112.0361\" x=\"45.6394\" y=\"682.8972\">docker-compose:</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.6909\" x=\"12\" y=\"698.03\">-</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"16.6909\" y=\"698.03\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"52.4761\" x=\"20.8232\" y=\"698.03\">influxdb</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"73.2993\" y=\"698.03\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"46.5664\" x=\"77.4316\" y=\"698.03\">service</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"123.998\" y=\"698.03\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"10.8926\" x=\"128.1304\" y=\"698.03\">+</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"139.0229\" y=\"698.03\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"48.1597\" x=\"143.1553\" y=\"698.03\">volume</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.6909\" x=\"13.0823\" y=\"713.1629\">-</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"17.7732\" y=\"713.1629\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"50.3115\" x=\"21.9055\" y=\"713.1629\">grafana</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"72.217\" y=\"713.1629\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"46.5664\" x=\"76.3494\" y=\"713.1629\">service</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"122.9158\" y=\"713.1629\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"10.8926\" x=\"127.0481\" y=\"713.1629\">+</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"137.9407\" y=\"713.1629\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"48.1597\" x=\"142.073\" y=\"713.1629\">volume</text></g><!--link op to grafana--><g class=\"link\" data-entity-1=\"ent0002\" data-entity-2=\"ent0014\" data-link-type=\"dependency\" data-source-line=\"38\" id=\"lnk17\"><path d=\"M692.77,159.5075 C695.44,198.4225 699.695,260.455 703.3275,313.4225 C703.441,315.0778 703.5539,316.7241 703.6662,318.3607 C703.7223,319.179 703.7782,319.9948 703.834,320.808 C703.8619,321.2146 703.4792,315.6347 703.507,316.04\" fill=\"none\" id=\"op-to-grafana\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"703.9175,322.0259,707.2924,312.7733,703.5754,317.0376,699.3111,313.3207,703.9175,322.0259\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"28.7402\" x=\"697.16\" y=\"201.4162\">View</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"725.9002\" y=\"201.4162\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"69.9434\" x=\"729.7147\" y=\"201.4162\">dashboards</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"82.8633\" x=\"706.9774\" y=\"215.3849\">(HTTP/HTTPS)</text></g><!--link ecr to lambda--><g class=\"link\" data-entity-1=\"ent0004\" data-entity-2=\"ent0005\" data-link-type=\"dependency\" data-source-line=\"40\" id=\"lnk18\"><path d=\"M1268.62,151.7275 C1284.33,171.5675 1303.11,198.8075 1313.16,226.2775 C1320.2225,245.5725 1325.02,266.6832 1328.2395,287.5472 C1328.4408,288.8512 1327.7733,284.2166 1327.9624,285.5181\" fill=\"none\" id=\"ecr-to-lambda\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"1328.8249,291.4558,1331.4896,281.9743,1328.1061,286.5078,1323.5727,283.1243,1328.8249,291.4558\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"21.5098\" x=\"1312.7879\" y=\"201.4162\">Pull</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"1334.2977\" y=\"201.4162\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"37.377\" x=\"1338.1121\" y=\"201.4162\">image</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"1375.4891\" y=\"201.4162\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"14.9473\" x=\"1379.3036\" y=\"201.4162\">on</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"86.7188\" x=\"1310.16\" y=\"215.3849\">deploy/update</text></g><!--link lambda to tuya_api--><g class=\"link\" data-entity-1=\"ent0005\" data-entity-2=\"ent0009\" data-link-type=\"dependency\" data-source-line=\"42\" id=\"lnk19\"><path d=\"M1333.16,480.9066 C1333.16,493.2332 1333.16,506.6135 1333.16,520.4288 C1333.16,575.69 1333.16,631.9125 1333.16,661.5075\" fill=\"none\" id=\"lambda-to-tuya_api\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"1333.16,667.5075,1337.16,658.5075,1333.16,662.5075,1329.16,658.5075,1333.16,667.5075\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"21.2461\" x=\"1334.16\" y=\"540.8062\">Poll</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"1355.4061\" y=\"540.8062\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"39.416\" x=\"1359.2205\" y=\"540.8062\">device</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"1398.6366\" y=\"540.8062\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"27.0293\" x=\"1402.451\" y=\"540.8062\">data</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"38.5371\" x=\"1348.8114\" y=\"554.7749\">HTTPS</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"1387.3485\" y=\"554.7749\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"23.666\" x=\"1391.1629\" y=\"554.7749\">(API</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"67.4121\" x=\"1348.1141\" y=\"568.7437\">key/secret)</text></g><!--link lambda to influx--><g class=\"link\" data-entity-1=\"ent0005\" data-entity-2=\"ent0011\" data-link-type=\"dependency\" data-source-line=\"43\" id=\"lnk20\"><path d=\"M1333.7733,481.1353 C1333.7359,481.3153 1333.6981,481.4953 1333.6598,481.6751 C1333.5833,482.0348 1333.505,482.3942 1333.4248,482.7532 C1332.7838,485.6252 1332.0267,488.4732 1331.138,491.2703 C1327.5831,502.4588 1321.9225,512.8325 1313.16,520.6675 C1304.35,528.5375 1218.78,526.5675 1207.16,528.6675 C1085.395,550.6725 951.79,589.31 848.06,622.6613 C796.195,639.3369 751.7987,654.691 720.0856,665.9836 C704.2291,671.6299 691.5433,676.2609 682.6801,679.5341 C680.4643,680.3524 684.1104,678.9925 682.3826,679.6357\" fill=\"none\" id=\"lambda-to-influx\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"676.7596,681.729,686.5896,682.3377,681.4454,679.9846,683.7986,674.8404,676.7596,681.729\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"32.2207\" x=\"1226.0868\" y=\"547.8062\">Write</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"1258.3075\" y=\"547.8062\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"44.8945\" x=\"1262.1219\" y=\"547.8062\">metrics</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"38.5371\" x=\"1208.16\" y=\"561.7749\">HTTPS</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"1246.6971\" y=\"561.7749\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"38.666\" x=\"1250.5116\" y=\"561.7749\">(token</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"1289.1776\" y=\"561.7749\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"31.9512\" x=\"1292.992\" y=\"561.7749\">auth)</text></g><!--link grafana to influx--><g class=\"link\" data-entity-1=\"ent0014\" data-entity-2=\"ent0011\" data-link-type=\"dependency\" data-source-line=\"45\" id=\"lnk21\"><path d=\"M702.0809,466.9728 C702.0156,467.392 701.9501,467.813 701.8843,468.2357 C701.3581,471.6173 700.8147,475.1089 700.2567,478.6947 C699.1407,485.8665 697.966,493.4153 696.7521,501.2155 C694.3245,516.816 691.7403,533.4219 689.1563,550.0275 C686.5722,566.6332 683.9882,583.2385 681.5608,598.8376 C680.3472,606.6372 679.1726,614.1853 678.0568,621.3561 C677.4989,624.9415 676.9557,628.4326 676.4296,631.8136 C676.3639,632.2362 677.2209,626.7285 677.1556,627.1477\" fill=\"none\" id=\"grafana-to-influx\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"676.2331,633.0763,681.5693,624.7983,677.0019,628.1358,673.6644,623.5683,676.2331,633.0763\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"36.4688\" x=\"692.16\" y=\"547.8062\">Query</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"728.6288\" y=\"547.8062\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"66.9785\" x=\"732.4432\" y=\"547.8062\">time-series</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"73.5\" x=\"709.0409\" y=\"561.7749\">HTTP/HTTPS</text></g><!--link lambda to GMN22--><g class=\"link\" data-entity-1=\"ent0005\" data-entity-2=\"ent0023\" data-link-type=\"association\" data-source-line=\"48\" id=\"lnk24\"><path d=\"M1341.3607,414.0675 C1341.432,414.0675 1341.5032,414.0675 1341.5745,414.0675 C1341.8594,414.0675 1342.1444,414.0675 1342.4293,414.0675 C1342.9993,414.0675 1343.5692,414.0675 1344.1391,414.0675 C1345.2789,414.0675 1346.4187,414.0675 1347.5584,414.0675 C1352.1175,414.0675 1356.6763,414.0675 1361.235,414.0675 C1370.3525,414.0675 1379.47,414.0675 1388.59,414.0675\" fill=\"none\" id=\"lambda-GMN22\" style=\"stroke:#000000;stroke-width:2;stroke-dasharray:7,7;\"/></g><!--link vm to GMN25--><g class=\"link\" data-entity-1=\"ent0010\" data-entity-2=\"ent0026\" data-link-type=\"association\" data-source-line=\"57\" id=\"lnk27\"><path d=\"M229.9457,431.8565 C228.3128,435.1957 226.468,438.9682 224.4405,443.1142 C216.3303,459.6985 205.2969,482.2594 193.2113,506.9713 C169.04,556.395 140.66,614.4225 123.04,650.4475\" fill=\"none\" id=\"vm-GMN25\" style=\"stroke:#000000;stroke-width:2;stroke-dasharray:7,7;\"/></g><?plantuml-src XLHDR-Cs4BthLypwK3WeP2NfpOS2_jgiaMpYsaxI1Gm4b3YMs4YaIb9ob6B_UuUKhAYxXrviIJFlpPl76NxYU1GIOVQysrH53fcrfPb6aMQdIIfiLiMLGPqeQL7QIQAAY9rCpcBZ_aD10HCUbGxBd4bB155zVJcvZBWmDlWaP99Nl2UFw7-XYaB9IKclGM1UXIoPPWMOZ75r4ZA58yiD3Y9KibIIYkziaoDeJ2oJQJvCEMbMFWjkCxY-lXnyBzZRLpI6fRWJxmXN50oiiCIon39NJK6iCDD99YonLXfXlAyQ1k7li9R7l7fRpjtpZMP79ja5dCWFrmlSiIBc3COBieMHUnhM1LMv20AMMALXz52YPlGq0cP0bK6GvAhYC7BWXNlq0N8G_Wa0f2AFHhE2lIi9gyNs87zaXYscvAXkBZmG4nryu7f11zd3mfWPvF2vaeaLIXxafh4PiVyskRe2NKah2WJXg3rXtZRan00mRSMH6e5Hr-SFOaXUGQ-JZ4cUesubYIBruFwuOEIJokOWGx12DjPPsnhiBRXm0U5zvd6Ov890xfF6loiqraI9RaghKZhShF4r4kgNYdmFllU6Vj3v35_3TJ6GyP42iyswJtjXfN14hObFNo62fKfUgSalof2GyPf6NakqeKQMP2pEiUsqBWQ7ri_9zUIDCCxMaFP5e87bl7F6ftJUScQPEneOpIigPiUcJOhzcqynD3Vko4SRr8OEtJNnfFAgSCRtVZcY8VzBhNBlJI-j6ri2SMQoM37D3Vm2jJ0LoyKxStFHCgHjva_7t-CcVnatG-DIAu8J3daao61jaRSKBlN_rNU51kAxBxrwqgzA26dhpgAcy2Jm18CUnb_s-qtaVdQqSRGBFhyRuIbigZnlHnjeuBdVzAWggIO6GPVb0ESXS11548wrID2Vq45wTXZJmC0hDf6XAcWlXl3kMAVmhEdwW0Aj5edfaLQzeWHMsOmqddlv3-wF2dK3WubfiMrZRYw9LOiqiw2ENNV1IjPGCsscGGZxns-p5n9uk_eMxUZMMEsZxUfc_N1FiVNzvxl7FvVpbyVjNRH_k5tTHm_RcsZ-kBXTxODxj2UbwPfC7K-tv1AHl5MLZLKbESbifz-HdMSS9IyL1Q3V23XgLNGC0ON1gUwqnyfQ2fBukWZkLCBoYBQCVzoyjM30_Sg5VbqDEZdd2GSonH_8hr3x-Q7OsSUVGkVI_m80?></g></svg>",
  "architecture_description": "## High-level architecture\n\nThis system is a serverless data pipeline that periodically pulls IoT/device telemetry from the **Tuya Cloud API** and stores it in **InfluxDB 2.x** for time-series retention and querying, with **Grafana** providing dashboards/visualization.\n\n### Components\n\n1. **AWS Lambda (container image) – Python 3.11**\n   - Deployed as a container-based Lambda function (Dockerfile uses `public.ecr.aws/lambda/python:3.11`, handler `main.handler`).\n   - Core libraries:\n     - `tinytuya` to authenticate and call Tuya Cloud.\n     - `influxdb-client` to write points to InfluxDB.\n     - `requests`/`cryptography` for HTTPS/TLS and supporting auth.\n   - Configuration via environment variables:\n     - Tuya: `TUYA_APIKEY`, `TUYA_APISECRET`, `TUYA_APISREGION`\n     - InfluxDB: `INFLUXDB_URL`, `INFLUXDB_TOKEN`, `INFLUXDB_ORG`, `INFLUXDB_BUCKET`\n\n2. **Amazon ECR (container image registry)**\n   - Stores the Lambda container image.\n   - Lambda pulls the image during deployment/updates.\n\n3. **Tuya Cloud API (external SaaS)**\n   - Source of device/telemetry data.\n   - Accessed by Lambda over outbound HTTPS.\n\n4. **InfluxDB 2.x (VM / Docker host)**\n   - Runs as a container (per `docker-compose.yaml`).\n   - Stores time-series data in **buckets**.\n   - Uses a persistent volume (`influxdb-data`) for durability.\n   - Must be reachable from Lambda (public endpoint or via networking such as VPN/VPC connectivity).\n\n5. **Grafana (VM / Docker host)**\n   - Runs as a container (per `docker-compose.yaml`).\n   - Uses a persistent volume (`grafana-data`) for state (users, datasources, etc.).\n   - Dashboard definition provided (`grafana/dashboard.json`) for import/provisioning.\n\n### Key data flows\n\n- **Lambda → Tuya Cloud API**: polls/pulls device data over HTTPS using Tuya credentials.\n- **Lambda → InfluxDB**: writes metrics over HTTP/HTTPS using InfluxDB token authentication.\n- **Grafana → InfluxDB**: queries time-series data to render dashboards.\n- **Operator → Grafana**: accesses Grafana UI over HTTP/HTTPS to view dashboards.\n\n### Deployment considerations (implied by repo)\n\n- InfluxDB and Grafana are intended to be deployed together on a VM via Docker Compose with persistent volumes.\n- Lambda requires outbound internet access and network reachability to the InfluxDB endpoint (as noted in the README inference)."
}