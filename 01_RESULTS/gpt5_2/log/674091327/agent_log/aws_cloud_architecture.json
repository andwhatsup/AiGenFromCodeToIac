{
  "aws_architecture_description": "### Target AWS architecture (lean, secure, scalable)\n\n#### 1) Container build & delivery\n- **Source → CI/CD → Image registry**\n  - Build the Flask container from the existing `dockerfile` (Python 3.9 base) in a CI pipeline.\n  - Push versioned images to **Amazon ECR**.\n\n#### 2) Runtime: Amazon EKS for the Flask API\n- **Amazon EKS cluster** in a dedicated **VPC** spanning **2–3 Availability Zones**.\n- **Managed Node Group** (EC2) for running pods.\n- Deploy the Flask app as a **Kubernetes Deployment** with an **HPA** (CPU/Memory-based) and a **ClusterIP Service**.\n- Expose the Flask API publicly via:\n  - **AWS Load Balancer Controller** creating an **Application Load Balancer (ALB)** from a Kubernetes **Ingress** (recommended for HTTP/HTTPS), or\n  - an NLB if you need pure L4 behavior.\n  - (AWS notes that the AWS Load Balancer Controller can create ALBs for Ingress.) ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/best-practices/scale-workloads.html?utm_source=openai))\n- TLS termination at the ALB using **ACM** certificates.\n\n#### 3) Message broker: move ActiveMQ to managed Amazon MQ (recommended)\n- Replace the in-cluster ActiveMQ pod (`rmohr/activemq:latest`) with **Amazon MQ for ActiveMQ**.\n  - This keeps your app code largely unchanged because Amazon MQ supports **STOMP** and other standard protocols. ([aws.amazon.com](https://aws.amazon.com/amazon-mq/faqs/?utm_source=openai))\n- Deploy Amazon MQ as **Active/Standby** (Multi-AZ) for higher availability.\n- Enable **TLS** for STOMP and store broker credentials in **AWS Secrets Manager**.\n- Place the broker in **private subnets**; allow inbound only from the EKS worker node security group (or pod ENIs if using security groups for pods).\n- Use the currently recommended ActiveMQ engine version on Amazon MQ (ActiveMQ 5.18 is the default/recommended). ([aws.amazon.com](https://aws.amazon.com/amazon-mq/faqs/?utm_source=openai))\n\n> Alternative (only if you must keep “self-managed ActiveMQ”): run ActiveMQ on EKS with persistent storage (EBS via CSI driver) and expose it internally via an NLB. This is more operationally heavy than Amazon MQ.\n\n#### 4) Networking & security\n- **Public subnets**: ALB.\n- **Private subnets**: EKS nodes/pods and Amazon MQ.\n- **NAT Gateways** for private subnet egress (pulling images, OS updates, etc.).\n- **Security Groups**:\n  - ALB SG: allow 443 from the internet.\n  - EKS node SG: allow inbound from ALB SG to Flask service port.\n  - Amazon MQ SG: allow inbound STOMP/TLS port only from EKS node SG.\n- **IAM Roles for Service Accounts (IRSA)** for the Flask workload to access AWS APIs (e.g., Secrets Manager, CloudWatch). Best practice is one IAM role per application/service account. ([aws.github.io](https://aws.github.io/aws-eks-best-practices/security/docs/iam/?utm_source=openai))\n\n#### 5) Observability & operations\n- **CloudWatch Logs** for container logs (via Fluent Bit / Container Insights).\n- **CloudWatch metrics/alarms** for:\n  - ALB (5xx, latency)\n  - EKS node/pod health\n  - Amazon MQ broker metrics\n- **AWS KMS** for encryption of Secrets Manager secrets and (optionally) EKS secrets envelope encryption.\n\n---\n\n## AWS resources to provision\n\n### Networking\n- Amazon VPC\n- Public subnets (2–3 AZs)\n- Private subnets (2–3 AZs)\n- Internet Gateway\n- NAT Gateway(s)\n- Route tables (public/private) + routes\n- VPC Endpoints (recommended):\n  - Interface endpoints: ECR (api + dkr), CloudWatch Logs, Secrets Manager, STS\n  - Gateway endpoint: S3 (if needed by tooling)\n\n### Compute / Kubernetes\n- Amazon EKS Cluster\n- EKS Managed Node Group(s) (EC2) + Launch Template (optional)\n- EKS Add-ons / controllers:\n  - AWS Load Balancer Controller\n  - EBS CSI Driver (if you use PVs)\n  - CoreDNS, kube-proxy, VPC CNI (standard)\n\n### Load balancing / edge\n- Application Load Balancer (created/managed by AWS Load Balancer Controller)\n- Target Groups (for Flask service)\n- ALB Listeners (443) + rules\n- AWS Certificate Manager (ACM) certificate\n- Amazon Route 53 hosted zone + DNS record (if you own a domain)\n\n### Container registry & build\n- Amazon ECR repository\n- ECR lifecycle policy\n- (Optional) ECR enhanced scanning configuration\n\n### Messaging\n- Amazon MQ for ActiveMQ broker (Active/Standby recommended)\n- Amazon MQ configuration (broker config, users)\n\n### Security / IAM / secrets\n- IAM roles:\n  - EKS cluster role\n  - EKS node instance role\n  - IRSA role for Flask service account (least privilege) ([aws.github.io](https://aws.github.io/aws-eks-best-practices/security/docs/iam/?utm_source=openai))\n- IAM OIDC provider for the EKS cluster (for IRSA)\n- AWS Secrets Manager secret(s) (Amazon MQ credentials, connection endpoints if desired)\n- AWS KMS key(s) (for Secrets Manager and optional EKS secret encryption)\n- Security Groups (ALB, EKS nodes, Amazon MQ)\n\n### Monitoring / logging\n- Amazon CloudWatch Log Groups\n- CloudWatch Alarms (ALB, EKS, Amazon MQ)\n- (Optional) AWS X-Ray (if you add tracing)\n\n### CI/CD (optional but typical)\n- AWS CodeBuild (container build)\n- AWS CodePipeline (or GitHub Actions/OIDC to AWS)\n- IAM roles/policies for CI to push to ECR and deploy to EKS\n\nIf you tell me (a) expected traffic, (b) whether ActiveMQ must remain self-managed, and (c) whether the Flask API must be public, I can right-size the node group, pick ALB vs NLB definitively, and list the exact ports/security group rules for STOMP/TLS and HTTP.",
  "aws_resources": [
    "Amazon VPC",
    "Public Subnets (2–3 AZs)",
    "Private Subnets (2–3 AZs)",
    "Internet Gateway",
    "NAT Gateway(s)",
    "Public Route Table + Routes",
    "Private Route Table + Routes",
    "VPC Interface Endpoints (ECR api, ECR dkr, CloudWatch Logs, Secrets Manager, STS)",
    "VPC Gateway Endpoint (S3, optional)",
    "Amazon EKS Cluster",
    "EKS Managed Node Group(s) (EC2)",
    "(Optional) EC2 Launch Template for node group",
    "EKS Add-ons: VPC CNI, CoreDNS, kube-proxy",
    "AWS Load Balancer Controller (EKS)",
    "EBS CSI Driver (EKS, if PVs used)",
    "Application Load Balancer (via AWS Load Balancer Controller)",
    "ALB Target Group(s)",
    "ALB Listener(s) (443) + Rules",
    "AWS Certificate Manager (ACM) Certificate",
    "Amazon Route 53 Hosted Zone + DNS Record (optional)",
    "Amazon ECR Repository",
    "ECR Lifecycle Policy",
    "(Optional) ECR Image Scanning configuration",
    "Amazon MQ for ActiveMQ Broker (Active/Standby recommended)",
    "Amazon MQ Broker Configuration + Users",
    "IAM Role: EKS Cluster Role",
    "IAM Role: EKS Node Instance Role",
    "IAM OIDC Provider for EKS (IRSA)",
    "IAM Role: IRSA role for Flask Kubernetes ServiceAccount",
    "AWS Secrets Manager Secrets (Amazon MQ credentials, etc.)",
    "AWS KMS Key(s) (Secrets encryption; optional EKS secrets envelope encryption)",
    "Security Group: ALB",
    "Security Group: EKS Nodes",
    "Security Group: Amazon MQ Broker",
    "Amazon CloudWatch Log Groups",
    "Amazon CloudWatch Alarms",
    "(Optional) AWS X-Ray",
    "(Optional) AWS CodeBuild",
    "(Optional) AWS CodePipeline",
    "(Optional) IAM Roles/Policies for CI/CD deployments"
  ]
}