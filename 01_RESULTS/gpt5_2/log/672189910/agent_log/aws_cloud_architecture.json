{
  "aws_architecture_description": "## Proposed high-level AWS architecture (Streamlit + LangChain + OpenAI + FAISS)\n\n### 1) Networking & edge\n- **VPC across 2 Availability Zones** with **public subnets** (for load balancer) and **private subnets** (for compute and storage).\n- **Internet-facing Application Load Balancer (ALB)** terminates TLS (HTTPS) and forwards traffic to the Streamlit service.\n- **Route 53** hosts the DNS record (e.g., `app.example.com`) pointing to the ALB.\n- **ACM certificate** attached to the ALB for HTTPS.\n\n### 2) Containerized application runtime\n- Package the Python app (Streamlit + LangChain + dependencies) as a **Docker image**.\n- Store the image in **Amazon ECR**.\n- Run the container on **Amazon ECS with Fargate** (leanest managed option; no EC2 management). \n  - **ECS Service** maintains desired count (start with 1; scale out later).\n  - **ECS Task Definition** defines CPU/memory, container port (Streamlit default 8501), environment variables, and secrets.\n  - **Auto Scaling** can scale tasks based on CPU/memory or ALB request count.\n\n### 3) FAISS persistence strategy (recommended)\nFAISS is a local index by default; for production you want durability across task restarts.\n- **Primary option (simple + durable): Amazon EFS**\n  - Mount an **EFS file system** into the ECS task (via EFS access point) and store the FAISS index there.\n  - This keeps the index persistent even if the task is replaced.\n- **Optional backup/export:** periodically copy the FAISS index to **S3** (manual job or scheduled task) for versioning/backup.\n\n### 4) Secrets, configuration, and outbound access\n- Store the **OpenAI API key** in **AWS Secrets Manager**.\n- ECS task retrieves the secret at runtime via an **IAM task role**.\n- Tasks in private subnets need outbound internet to call **OpenAI over HTTPS**:\n  - Use a **NAT Gateway** in each AZ (or one NAT to start, if cost-sensitive) and route private subnets’ 0.0.0.0/0 to NAT.\n\n### 5) Observability & security\n- **CloudWatch Logs** for container logs (Streamlit + app logs).\n- **CloudWatch metrics/alarms** for ECS service health, ALB 5xx, latency, and task CPU/memory.\n- **AWS WAF** on the ALB (optional but recommended if internet-exposed) to reduce common web attacks.\n- **Security groups**:\n  - ALB SG: inbound 443 from the internet; outbound to ECS tasks.\n  - ECS SG: inbound only from ALB SG on 8501; outbound to internet via NAT.\n  - EFS SG: inbound NFS (2049) only from ECS SG.\n\n### 6) Deployment workflow (fits your existing Terraform runner)\n- Keep using Terraform from the provided containerized runner to provision:\n  - VPC, subnets, routing, ALB, ECS, ECR, EFS, IAM, logging.\n- Build/push image:\n  - `docker build` → push to ECR.\n  - Update ECS service (new task definition revision) to roll out.\n\n### Notes / tradeoffs\n- **Fargate + EFS** is the most straightforward way to keep FAISS persistent without introducing a managed vector DB.\n- If you later need multi-user scale and higher throughput, you can:\n  - Increase ECS task count and keep a shared EFS index (works, but consider concurrency/locking patterns), or\n  - Move to a managed vector store (not required for this codebase today).\n",
  "aws_resources": [
    "Amazon VPC",
    "VPC CIDR block",
    "Public subnets (2 AZs)",
    "Private subnets (2 AZs)",
    "Internet Gateway (IGW)",
    "NAT Gateway (1–2, cost vs HA tradeoff)",
    "Elastic IP(s) for NAT Gateway",
    "Route tables (public/private)",
    "Route table associations",
    "VPC endpoints (optional: ECR API, ECR DKR, CloudWatch Logs, S3)",
    "Security Groups (ALB SG, ECS SG, EFS SG)",
    "Network ACLs (optional; default NACLs acceptable initially)",
    "Amazon Route 53 Hosted Zone (or record in existing zone)",
    "Route 53 Record (A/AAAA alias to ALB)",
    "AWS Certificate Manager (ACM) public certificate",
    "Application Load Balancer (ALB)",
    "ALB Target Group",
    "ALB HTTPS Listener (443)",
    "ALB Listener Rule(s)",
    "AWS WAF Web ACL (optional)",
    "Amazon ECR Repository",
    "ECR lifecycle policy (optional)",
    "Amazon ECS Cluster",
    "ECS Task Definition (Fargate)",
    "ECS Service",
    "ECS Service Auto Scaling (target tracking)",
    "IAM Role: ECS Task Execution Role",
    "IAM Role: ECS Task Role (app permissions)",
    "IAM policies for Secrets Manager + EFS + CloudWatch logs access",
    "AWS Secrets Manager Secret (OpenAI API key)",
    "Amazon EFS File System",
    "EFS Mount Targets (per AZ)",
    "EFS Access Point (recommended)",
    "EFS File System Policy (optional)",
    "CloudWatch Log Group(s) for ECS/Streamlit logs",
    "CloudWatch Alarms (ALB 5xx, latency, ECS CPU/memory, task count)",
    "AWS CloudTrail (account-level; recommended)",
    "AWS Config (optional; governance)",
    "S3 bucket for FAISS backups/artifacts (optional)",
    "S3 bucket for ALB access logs (optional)",
    "ALB access logging configuration (optional)"
  ]
}