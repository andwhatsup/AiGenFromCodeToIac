{
  "aws_architecture_description": "## Proposed high-level AWS architecture (FreeIPA cluster deployed via Terraform)\n\n### 1) Delivery / provisioning flow (GitHub Actions → AWS)\n- **GitHub Actions** runs `terraform init/plan/apply`.\n- Use **OIDC federation from GitHub to AWS** so the workflow assumes an AWS IAM role (no long‑lived AWS keys in GitHub).\n- Terraform uses a **remote backend**:\n  - **S3** for state storage (versioned + encrypted).\n  - **DynamoDB** for state locking.\n\n### 2) Network foundation (VPC + private subnets)\n- Deploy FreeIPA into a dedicated **VPC** (or consume an existing “shared VPC” via remote state).\n- Use **private subnets across at least 2–3 Availability Zones** for the 3 FreeIPA EC2 instances.\n- Provide controlled egress from private subnets via **NAT Gateway** (or NAT instance if cost-constrained) so instances can reach OS/package repos, CrowdStrike/Nessus endpoints, etc., without being publicly reachable.\n- Add **VPC endpoints** to keep common AWS control-plane traffic private (recommended for SSM, S3, CloudWatch Logs, etc.).\n\n### 3) Compute layer (FreeIPA cluster on EC2)\n- Provision **three EC2 instances** (`ipa0`, `ipa1`, `ipa2`) in private subnets.\n- Attach a **server security group** to the FreeIPA instances.\n- Use **EBS gp3 volumes** for OS + FreeIPA data; enable encryption with KMS.\n- Prefer **SSM Session Manager** for administrative access (no inbound SSH from the internet). If SSH is required, restrict to a bastion or VPN CIDR.\n\n### 4) Security groups and traffic model\n- **Client security group**: attached to workloads that need to authenticate against FreeIPA.\n- **Server security group**: allows only required FreeIPA ports from the client SG and intra-cluster replication traffic between FreeIPA nodes.\n- Keep outbound rules least-privilege where practical (or allow egress but rely on NACLs/egress filtering if your org requires it).\n\n### 5) DNS and service discovery (Route 53)\n- Use **Route 53 hosted zone(s)** (public or private depending on your environment) to publish:\n  - **A records** for each FreeIPA node.\n  - **SRV/TXT records** for Kerberos/LDAP service discovery.\n  - **PTR records** via a Route 53 reverse zone if you manage reverse DNS in Route 53.\n- Use **Route 53 health checks** (as your module indicates) to support monitoring and (optionally) failover-style DNS patterns.\n\n### 6) Configuration inputs and secrets\n- Store non-secret configuration values (e.g., agent/customer IDs) in **SSM Parameter Store**.\n- Store secrets (FreeIPA admin bootstrap secrets, enrollment tokens, etc.) in **Secrets Manager** (or SSM SecureString with KMS) and grant access only to the provisioning role / instance role.\n\n### 7) Instance permissions and operations\n- Attach an **EC2 instance profile** to FreeIPA nodes for:\n  - SSM (Session Manager + inventory/patching if used).\n  - CloudWatch Logs/metrics publishing.\n  - Reading required parameters/secrets.\n- Centralize logs/metrics in **CloudWatch**; add alarms for instance health, disk usage, and FreeIPA service health.\n\n### 8) Deployment strategy / environments\n- Use separate Terraform workspaces or separate state keys per environment (dev/test/prod).\n- Keep the FreeIPA module consuming foundational outputs (VPC/subnets/hosted zone IDs) via **terraform_remote_state** (as your docs suggest), so networking and DNS can be managed by a platform stack.\n\n---\n\n## AWS resources to provision\n\n### A) Terraform backend (state)\n- **S3 Bucket** (Terraform state)\n- **S3 Bucket Versioning**\n- **S3 Bucket Server-Side Encryption (SSE-KMS recommended)**\n- **S3 Bucket Public Access Block**\n- **S3 Bucket Policy** (restrict to Terraform role)\n- **DynamoDB Table** (Terraform state locking)\n- **KMS Key** (for S3 state encryption; optional if using SSE-S3)\n- **KMS Alias**\n\n### B) IAM (CI + provisioning)\n- **IAM OIDC Provider** (GitHub Actions)\n- **IAM Role** (assumable by GitHub Actions via OIDC)\n- **IAM Policy** (Terraform permissions for this stack)\n- **IAM Role Policy Attachment**\n\n### C) Networking (if not provided by a separate “foundation” stack)\n- **VPC**\n- **Subnets** (private subnets in 2–3 AZs)\n- **Route Table(s)** (private)\n- **NAT Gateway** (and **Elastic IP**) for private subnet egress\n- **Internet Gateway** (required for NAT)\n- **Public Subnet(s)** (to host NAT Gateway)\n- **Network ACLs** (optional; if you manage beyond SGs)\n- **VPC Endpoints** (recommended):\n  - **Gateway Endpoint: S3**\n  - **Interface Endpoints: SSM, EC2Messages, SSMMessages, CloudWatch Logs** (and others as needed)\n\n### D) Security controls\n- **Security Group: FreeIPA Server SG**\n- **Security Group: FreeIPA Client SG**\n- **Security Group Rules** (ingress/egress for FreeIPA ports, replication, DNS/Kerberos/LDAP as required)\n\n### E) Compute (FreeIPA)\n- **EC2 Instances (3)**: `ipa0`, `ipa1`, `ipa2`\n- **EBS Volumes** (root + any data volumes as defined)\n- **EC2 Key Pair** (only if SSH is required)\n- **IAM Role (EC2 instance role)**\n- **IAM Instance Profile**\n- **IAM Policies/Attachments** (SSM, CloudWatch, Parameter/Secrets read)\n\n### F) DNS / health\n- **Route 53 Hosted Zone** (public or private; if managed here)\n- **Route 53 Record Sets**:\n  - **A records**\n  - **SRV records**\n  - **TXT records**\n  - **PTR records** (requires reverse hosted zone)\n- **Route 53 Health Checks**\n\n### G) Configuration / secrets\n- **SSM Parameter Store Parameters** (CrowdStrike/Nessus values and other inputs)\n- **Secrets Manager Secrets** (recommended for sensitive bootstrap values; if applicable)\n- **KMS Key** (for SSM SecureString / Secrets Manager encryption, if using customer-managed keys)\n\n### H) Observability (recommended baseline)\n- **CloudWatch Log Groups** (system/app logs)\n- **CloudWatch Alarms** (instance status checks, disk, CPU, service/health check signals)\n- **CloudWatch Dashboard** (optional)\n\n### I) Optional hardening (only if required by your org)\n- **AWS Backup** (backup plan + vault) for EBS snapshots\n- **AWS Config** (recording + rules)\n- **GuardDuty**\n\n",
  "aws_resources": [
    "S3 Bucket (Terraform state)",
    "S3 Bucket Versioning",
    "S3 Bucket Server-Side Encryption (SSE-KMS recommended)",
    "S3 Bucket Public Access Block",
    "S3 Bucket Policy (restrict to Terraform role)",
    "DynamoDB Table (Terraform state locking)",
    "KMS Key (state encryption)",
    "KMS Alias",
    "IAM OIDC Provider (GitHub Actions)",
    "IAM Role (GitHub Actions assume role)",
    "IAM Policy (Terraform permissions)",
    "IAM Role Policy Attachment",
    "VPC",
    "Subnets (private across 2–3 AZs)",
    "Route Tables (private)",
    "Internet Gateway",
    "Public Subnets (for NAT)",
    "NAT Gateway",
    "Elastic IP (for NAT)",
    "Network ACLs (optional)",
    "VPC Gateway Endpoint (S3)",
    "VPC Interface Endpoints (SSM, EC2Messages, SSMMessages, CloudWatch Logs)",
    "Security Group (FreeIPA Server)",
    "Security Group (FreeIPA Client)",
    "Security Group Rules (ingress/egress)",
    "EC2 Instances x3 (ipa0, ipa1, ipa2)",
    "EBS Volumes (gp3, encrypted)",
    "EC2 Key Pair (optional)",
    "IAM Role (EC2 instance role)",
    "IAM Instance Profile",
    "IAM Policy Attachments (SSM/CloudWatch/SSM Parameter access)",
    "Route 53 Hosted Zone (public or private; if managed here)",
    "Route 53 Record Sets (A, SRV, TXT, PTR)",
    "Route 53 Health Checks",
    "SSM Parameter Store Parameters",
    "Secrets Manager Secrets (recommended for sensitive values)",
    "KMS Key (for secrets/parameters; optional)",
    "CloudWatch Log Groups",
    "CloudWatch Alarms",
    "CloudWatch Dashboard (optional)",
    "AWS Backup (optional)",
    "AWS Config (optional)",
    "GuardDuty (optional)"
  ]
}