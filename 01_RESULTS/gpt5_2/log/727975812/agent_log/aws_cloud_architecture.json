{
  "aws_architecture_description": "## Proposed high-level AWS architecture\n\n### 1) Core runtime (serverless)\n- **Amazon EventBridge Scheduler (or EventBridge Rule)** runs on a cron/rate schedule and **invokes a single AWS Lambda function asynchronously** to execute the Venmo automation workflow. EventBridge Scheduler uses an **execution role** that grants only `lambda:InvokeFunction` on the specific Lambda ARN (and optionally the alias ARN if you use aliases). ([docs.aws.amazon.com](https://docs.aws.amazon.com/lambda/latest/dg/with-eventbridge-scheduler.html?utm_source=openai))\n- **AWS Lambda (Python 3.x)** contains `handler.py` plus dependencies from `requirements.txt` (notably `venmo-api`). The function makes outbound HTTPS calls to the **external Venmo API**.\n\n### 2) Secrets and configuration\n- Store the Venmo auth token securely:\n  - Preferred: **AWS Secrets Manager** secret (e.g., `venmo/auth_token`) and load it at runtime.\n  - If you keep it as an environment variable, rely on Lambda’s encryption at rest (optionally with a customer-managed KMS key). ([docs.aws.amazon.com](https://docs.aws.amazon.com/lambda/latest/dg/configuration-envvars-encryption.html?utm_source=openai))\n\n### 3) Networking\n- Because the Lambda only calls a public external API over HTTPS, **no VPC attachment is required** (keeps it simpler and avoids NAT costs/complexity). If your org requires VPC egress control, attach Lambda to private subnets and add a NAT Gateway, but that’s optional for this workload.\n\n### 4) Observability and alerting\n- **CloudWatch Logs**: Lambda writes logs to a dedicated log group with a defined retention period.\n- **CloudWatch Alarms**: Create alarms on Lambda **Errors** (and optionally Throttles/Duration) and on Scheduler failures (if you want to detect missed invocations).\n- **SNS Topic + Email subscription**: CloudWatch Alarms publish to SNS, which emails operators.\n\n### 5) Deployment strategy\n- Package Lambda using your existing `package_lambda.sh` (zip artifact) and deploy via IaC (CloudFormation/SAM/Terraform/CDK).\n- Use **Lambda versions + alias** (e.g., `prod`) so the Scheduler target points to a stable alias ARN; update the alias during deployments for safe rollouts.\n- Apply least-privilege IAM and enable basic security hygiene (log retention, secret access scoping, optional KMS CMK).\n\n---\n\n## AWS resources to provision\n\n### Foundational / account-level\n- **IAM**\n  - IAM Role: `VenmoAutomationLambdaExecutionRole`\n  - IAM Policy (inline or managed): CloudWatch Logs permissions + (optional) Secrets Manager read\n  - IAM Role: `EventBridgeSchedulerInvokeRole` (execution role for the schedule)\n  - IAM Policy: allow `lambda:InvokeFunction` on the Lambda function (and alias)\n\n### Compute\n- **AWS Lambda**\n  - Lambda Function: `VenmoAutomationFunction`\n  - (Recommended) Lambda Version(s)\n  - (Recommended) Lambda Alias: `prod`\n  - Lambda Permission / resource-based policy statement allowing Scheduler to invoke (commonly created by IaC tooling)\n\n### Scheduling\n- **Amazon EventBridge Scheduler**\n  - Schedule Group (optional, but nice for organization)\n  - Schedule: `VenmoAutomationSchedule` (cron/rate)\n  - Target configuration pointing to Lambda (prefer alias ARN)\n\n### Secrets / encryption\n- **AWS Secrets Manager** (recommended)\n  - Secret: `venmo/auth_token`\n- **AWS KMS** (optional)\n  - Customer managed KMS key for Secrets Manager and/or Lambda env var encryption\n  - KMS key policy + alias\n\n### Observability\n- **Amazon CloudWatch**\n  - Log Group: `/aws/lambda/VenmoAutomationFunction` (with retention)\n  - CloudWatch Alarm(s): Lambda Errors (and optionally Throttles/Duration)\n  - (Optional) CloudWatch Dashboard\n\n### Notifications\n- **Amazon SNS**\n  - SNS Topic: `VenmoAutomationAlerts`\n  - SNS Subscription: Email subscription(s) for operators\n\n### Networking (only if you choose VPC attachment)\n- VPC\n- Private subnets (2+ AZs)\n- Route tables\n- Security group for Lambda\n- NAT Gateway + Elastic IP (for outbound internet)\n- (Optional) VPC endpoints (e.g., Secrets Manager, CloudWatch Logs) to reduce NAT usage\n\nThis keeps the system lean (serverless + scheduler + monitoring) while meeting the inferred requirements: scheduled execution, secure token handling, logging, alarms, and email notifications.",
  "aws_resources": [
    "IAM Role: VenmoAutomationLambdaExecutionRole",
    "IAM Policy: VenmoAutomationLambdaExecutionPolicy (logs + optional secrets access)",
    "IAM Role: EventBridgeSchedulerInvokeRole",
    "IAM Policy: EventBridgeSchedulerInvokePolicy (lambda:InvokeFunction scoped to function/alias)",
    "AWS Lambda Function: VenmoAutomationFunction",
    "AWS Lambda Version(s) (recommended)",
    "AWS Lambda Alias: prod (recommended)",
    "Lambda resource-based permission for scheduler invocation (AWS::Lambda::Permission)",
    "Amazon EventBridge Scheduler: Schedule Group (optional)",
    "Amazon EventBridge Scheduler: Schedule (cron/rate)",
    "Amazon CloudWatch Log Group: /aws/lambda/VenmoAutomationFunction",
    "Amazon CloudWatch Alarms: Lambda Errors (and optional Throttles/Duration)",
    "Amazon SNS Topic: VenmoAutomationAlerts",
    "Amazon SNS Email Subscription(s)",
    "AWS Secrets Manager Secret: venmo/auth_token (recommended)",
    "AWS KMS CMK + alias (optional, for secrets/env var encryption)",
    "(Optional if VPC required) VPC",
    "(Optional if VPC required) Private Subnets (2+ AZs)",
    "(Optional if VPC required) Route Tables",
    "(Optional if VPC required) Security Group for Lambda",
    "(Optional if VPC required) NAT Gateway + Elastic IP",
    "(Optional if VPC required) VPC Endpoints (Secrets Manager, CloudWatch Logs)"
  ]
}