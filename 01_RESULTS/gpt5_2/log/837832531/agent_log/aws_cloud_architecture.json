{
  "aws_architecture_description": "## Proposed high-level AWS architecture (lean, secure, scalable)\n\n### 1) Networking foundation\n- Create a dedicated **VPC** spanning **2–3 Availability Zones**.\n- Use **public subnets** for internet-facing load balancers and **private subnets** for EKS worker nodes.\n- Add **NAT Gateway(s)** so private EKS nodes can pull container images and reach external CDNs (Google Fonts / cdnjs) without being publicly reachable.\n- Use **VPC Endpoints** where it reduces exposure/cost (notably ECR, CloudWatch Logs, S3, STS) if you adopt ECR and/or private cluster patterns.\n\n### 2) Compute / runtime: Amazon EKS hosting the Nginx static site\n- Run the application as-is on **Amazon EKS**:\n  - Kubernetes **Deployment** `btry-indi` with replicas (3–6) across AZs.\n  - Kubernetes **Service** exposed via an AWS load balancer.\n- Prefer **AWS Load Balancer Controller** + **Ingress** (recommended) to provision and manage an **Application Load Balancer (ALB)**. If you keep `Service type: LoadBalancer`, it can still create an LB, but Ingress gives better routing/TLS features and is the common EKS pattern.\n- Use **Managed Node Groups** (or Fargate profiles if you want to avoid node management; for this simple Nginx workload, either works).\n- Add **Horizontal Pod Autoscaler (HPA)** to scale replicas based on CPU/memory (even though it’s static content, it’s a standard best practice for bursty traffic).\n\n### 3) Ingress, TLS, and DNS\n- Internet traffic flow:\n  1. **Route 53** hosts your domain (e.g., `app.example.com`).\n  2. **ACM** issues a public TLS certificate.\n  3. **ALB (internet-facing)** terminates HTTPS using the ACM cert.\n  4. ALB forwards to the **Kubernetes Service** / Pods.\n- Add **AWS WAF** on the ALB for baseline protections (managed rules, rate limiting).\n\n### 4) Container image source and pull authentication\n- Recommended: standardize on **Amazon ECR** as the primary registry for EKS pulls (simplifies IAM and reduces external dependency on Docker Hub/GHCR availability/rate limits).\n- CI (GitHub Actions and/or Jenkins) builds the Nginx image and pushes to **ECR**.\n- EKS nodes pull from ECR using node IAM permissions; no imagePullSecrets needed for ECR.\n- If you must keep GHCR/Docker Hub, store credentials in **AWS Secrets Manager** and sync to Kubernetes as imagePullSecrets (or use External Secrets Operator).\n\n### 5) CI/CD on AWS (minimal changes)\n- Keep GitHub Actions if desired; integrate with AWS using **OIDC federation**:\n  - Create an **IAM role for GitHub Actions** (no long-lived AWS keys) to push to ECR and optionally deploy to EKS.\n- If Jenkins is required:\n  - Run Jenkins either **outside AWS** (simplest) or on AWS (EC2/ECS/EKS). If on AWS, store secrets in **Secrets Manager** and use an IAM role for the instance/task.\n- Deployment:\n  - CI updates Kubernetes manifests (or Helm/Kustomize) and applies to EKS.\n\n### 6) Observability, logging, and security\n- **CloudWatch Container Insights** (or ADOT) for cluster/pod metrics.\n- **Fluent Bit** (or AWS for Fluent Bit) to ship container logs to **CloudWatch Logs**.\n- **CloudTrail** for account audit logging.\n- **GuardDuty** for threat detection.\n- **AWS Config** (optional but common) for compliance drift detection.\n- Use **IAM Roles for Service Accounts (IRSA)** for any in-cluster components that need AWS API access (e.g., AWS Load Balancer Controller).\n\n### 7) Optional simplification (if Kubernetes is not required)\nBecause this is a static site, the simplest/cheapest AWS-native option is **S3 static hosting + CloudFront** (no EKS). However, since your repo already includes Kubernetes manifests and ALB annotations, the primary recommendation above keeps EKS.\n\n---\n\n## End-to-end request path\n- End user → Route 53 DNS → ALB (HTTPS, ACM cert, WAF) → EKS Ingress/Service → Nginx Pods → browser fetches external CDN assets (Google Fonts / cdnjs) via NAT egress.\n\n---\n\n## Deployment strategy (practical)\n- **Blue/green or rolling**: use Kubernetes rolling updates (default) for the Deployment.\n- **Immutable images**: tag images with git SHA; avoid `latest` in production.\n- **Security gates**: keep Trivy/Docker Scout + (optional) ECR image scanning; fail pipeline on critical CVEs.\n",
  "aws_resources": [
    "Amazon VPC",
    "VPC subnets (public subnets across 2–3 AZs)",
    "VPC subnets (private subnets across 2–3 AZs)",
    "Internet Gateway (IGW)",
    "NAT Gateway(s) (one per AZ preferred)",
    "Elastic IP(s) for NAT Gateway(s)",
    "Route tables (public and private)",
    "Security Groups (ALB SG, EKS node SG, controller SGs as needed)",
    "Network ACLs (optional; if used, per-subnet)",
    "VPC Endpoints (recommended/optional: ECR API, ECR DKR, S3 Gateway endpoint, CloudWatch Logs, STS)",
    "Amazon EKS cluster",
    "EKS managed node group(s) (EC2 worker nodes) OR EKS Fargate profile(s) (choose one)",
    "IAM role for EKS cluster",
    "IAM role(s) for EKS node group(s)",
    "OIDC provider for the EKS cluster (for IRSA)",
    "IAM roles for service accounts (IRSA) (e.g., AWS Load Balancer Controller)",
    "AWS Load Balancer Controller (deployed to EKS; requires IAM/IRSA and Helm manifest—AWS-side resources are IAM/OIDC)",
    "AWS Application Load Balancer (provisioned by controller)",
    "Target Group(s) (created/managed with ALB)",
    "ACM public certificate (for your domain)",
    "Amazon Route 53 hosted zone and DNS records (A/AAAA alias to ALB)",
    "AWS WAFv2 Web ACL associated to the ALB",
    "Amazon ECR repository (recommended primary image registry)",
    "IAM role for GitHub Actions via OIDC (permissions: ECR push, optional EKS deploy)",
    "AWS Secrets Manager (optional: store GHCR/Docker Hub creds, Jenkins secrets, etc.)",
    "Amazon CloudWatch Logs log groups (EKS/control plane and application logs)",
    "CloudWatch Container Insights / ADOT resources (metrics/telemetry)",
    "AWS CloudTrail",
    "Amazon GuardDuty"
  ]
}