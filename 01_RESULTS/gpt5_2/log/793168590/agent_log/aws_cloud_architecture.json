{
  "aws_architecture_description": "## Proposed high-level AWS architecture (lean, secure, scalable)\n\n### 1) Container build & registry\n- **Amazon ECR** hosts the Docker image built from the repo’s `Dockerfile` (Flask app exposing `/ping` and `/invocations`).\n- A **CI/CD pipeline** (or developer workstation initially) builds the image, scans it, and pushes a versioned tag to ECR.\n\n### 2) Model hosting / inference runtime\n- **Amazon SageMaker Hosting** runs the container as a **SageMaker Endpoint** (real-time inference).\n  - Create a **SageMaker Model** that references the ECR image.\n  - Create an **Endpoint Configuration** (instance type/count, autoscaling policy if used).\n  - Create the **Endpoint**.\n- **Networking**: place the endpoint in a **VPC** (VPC-enabled endpoint) with **private subnets**.\n  - If the container needs to pull from ECR and write logs without public internet, add **VPC endpoints** (PrivateLink) for ECR (api + dkr), S3 (gateway), and CloudWatch Logs.\n\n### 3) Invocation paths\n- **Direct invocation (optional, controlled)**\n  - For production, avoid exposing the SageMaker endpoint directly to the public internet.\n  - If you need an external HTTPS entrypoint, put **Amazon API Gateway (HTTP API)** in front of a **Lambda** “proxy” that calls `sagemaker-runtime:InvokeEndpoint`. This gives you auth, throttling, WAF integration, and request validation.\n  - If direct testing is needed, restrict access via IAM auth and/or network controls (e.g., only from a bastion/VPN).\n\n- **Scheduled invocation / health check**\n  - **Amazon EventBridge Scheduler (or EventBridge Rule)** triggers the existing **AWS Lambda** on a cron.\n  - Lambda calls the SageMaker endpoint using `boto3` `sagemaker-runtime.invoke_endpoint`.\n\n### 4) Security & IAM\n- **IAM execution role for SageMaker**\n  - Minimum permissions to pull the image from ECR, read any required artifacts (often S3), and write logs/metrics.\n- **IAM role for Lambda**\n  - Minimum permissions: `sagemaker:InvokeEndpoint` (and related runtime permissions), plus CloudWatch Logs.\n- **Secrets** (only if needed): store any API keys/config in **AWS Secrets Manager** or **SSM Parameter Store**, not in env vars committed to code.\n\n### 5) Observability\n- **CloudWatch Logs**\n  - Separate log groups for Lambda and SageMaker endpoint/container logs.\n- **CloudWatch Metrics & Alarms**\n  - Alarms on endpoint errors/latency, invocation errors, and Lambda errors/throttles.\n- (Optional) **AWS X-Ray** for tracing if you add API Gateway → Lambda → SageMaker.\n\n### 6) Deployment strategy\n- **Blue/green endpoint updates** using SageMaker endpoint config updates:\n  - Push new image tag to ECR.\n  - Create new EndpointConfig referencing the new image.\n  - Update the Endpoint to the new config; roll back by switching back if needed.\n\n---\n\n## Notes / assumptions\n- No database is indicated in the codebase; none is included.\n- If the container needs to download model artifacts at startup, use **S3** and grant the SageMaker role read access.\n- If you only need internal scheduled invocations, you can omit API Gateway entirely and keep everything private.\n",
  "aws_resources": [
    "Amazon ECR Repository",
    "Amazon ECR Lifecycle Policy",
    "Amazon ECR Repository Policy (optional, if cross-account)",
    "Amazon VPC",
    "VPC Public Subnets (optional; only if you need NAT/bastion)",
    "VPC Private Subnets (for SageMaker endpoint and Lambda if VPC-enabled)",
    "VPC Route Tables",
    "VPC Security Groups (SageMaker endpoint ENIs, Lambda ENIs if in VPC)",
    "VPC Interface Endpoint: com.amazonaws.<region>.ecr.api (recommended for private SageMaker)",
    "VPC Interface Endpoint: com.amazonaws.<region>.ecr.dkr (recommended for private SageMaker)",
    "VPC Gateway Endpoint: com.amazonaws.<region>.s3 (recommended if artifacts/log delivery require S3 access)",
    "VPC Interface Endpoint: com.amazonaws.<region>.logs (recommended for private logging)",
    "AWS IAM Role: SageMaker Execution Role",
    "AWS IAM Policy: SageMaker permissions (ECR pull, CloudWatch Logs, S3 read if needed)",
    "AWS IAM Role: Lambda Execution Role",
    "AWS IAM Policy: Lambda permissions (sagemaker-runtime InvokeEndpoint, CloudWatch Logs)",
    "Amazon SageMaker Model",
    "Amazon SageMaker Endpoint Configuration",
    "Amazon SageMaker Endpoint",
    "Application Auto Scaling Target/Policy for SageMaker Endpoint (optional, if you want autoscaling)",
    "AWS Lambda Function (invoker)",
    "Lambda Log Group (CloudWatch Logs)",
    "Amazon EventBridge Rule or EventBridge Scheduler Schedule",
    "EventBridge Target Permission to invoke Lambda",
    "Amazon CloudWatch Log Group(s) for SageMaker endpoint/container logs",
    "Amazon CloudWatch Alarms (Lambda errors/throttles; SageMaker 4XX/5XX, latency, invocations)",
    "Amazon API Gateway HTTP API (optional; if you want a public HTTPS entrypoint)",
    "API Gateway Integration to Lambda (optional)",
    "AWS WAF Web ACL (optional; if API Gateway is public)",
    "AWS Secrets Manager or SSM Parameter Store (optional; if secrets/config are needed)",
    "CI/CD: AWS CodeBuild Project (optional)",
    "CI/CD: AWS CodePipeline (optional)",
    "CI/CD: IAM roles for build/deploy (optional)"
  ]
}