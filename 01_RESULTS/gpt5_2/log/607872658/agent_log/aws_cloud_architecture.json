{
  "aws_architecture_description": "## Proposed high-level AWS architecture (SSM Parameter Store → S3 backup)\n\n### 1) Core workflow (serverless, scheduled)\n- **Amazon EventBridge (Scheduler/Rule)** runs a **daily cron** and invokes the **`ssm_backup` AWS Lambda** function.\n- **AWS Lambda (Python)** executes `ssm_backup.lambda_handler` and:\n  1. Calls **SSM Parameter Store** APIs (`DescribeParameters`, `GetParameters`) to enumerate and fetch parameter values.\n  2. Serializes the result to a timestamped JSON document.\n  3. Uploads the JSON to **Amazon S3** under `backups/parameters-<timestamp>.json`.\n- **Amazon S3** stores the backup objects with **default encryption SSE-KMS** using a **customer-managed KMS key (CMK)**.\n\n### 2) Security model (least privilege + enforced encryption)\n- **IAM execution role for Lambda**\n  - Trust policy allows `lambda.amazonaws.com` to assume the role. ([docs.aws.amazon.com](https://docs.aws.amazon.com/lambda/latest/dg/lambda-intro-execution-role.html?utm_source=openai))\n  - Attach **AWSLambdaBasicExecutionRole** (or equivalent inline permissions) so the function can write logs to **CloudWatch Logs** (`logs:CreateLogGroup`, `logs:CreateLogStream`, `logs:PutLogEvents`). ([docs.aws.amazon.com](https://docs.aws.amazon.com/lambda/latest/dg/monitoring-cloudwatchlogs.html?utm_source=openai))\n  - Add a **custom inline policy** for:\n    - `ssm:DescribeParameters`, `ssm:GetParameters` (optionally scope to a path prefix if your parameters are namespaced)\n    - `s3:PutObject` to `arn:aws:s3:::<backup-bucket>/backups/*`\n    - **KMS permissions required for SSE-KMS uploads** (not just `kms:Encrypt`; typically includes `kms:GenerateDataKey` for `PutObject` with SSE-KMS). ([docs.aws.amazon.com](https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html?utm_source=openai))\n- **S3 bucket policy** (recommended) to **deny** `PutObject` unless:\n  - `s3:x-amz-server-side-encryption` is `aws:kms`, and\n  - `s3:x-amz-server-side-encryption-aws-kms-key-id` matches your CMK ARN.\n  This enforces that all backups are encrypted with the intended key. ([docs.aws.amazon.com](https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html?utm_source=openai))\n- **KMS key policy** grants:\n  - The Lambda execution role permission to use the key (GenerateDataKey/Encrypt as needed), and\n  - The S3 service principal permission to use the key for bucket encryption (standard SSE-KMS pattern).\n\n### 3) Observability & operations\n- **CloudWatch Logs log group** `/aws/lambda/ssm_backup` with a retention policy (e.g., 14–90 days).\n- **CloudWatch Alarms** (recommended):\n  - Alarm on Lambda `Errors` > 0\n  - Alarm on `Throttles` > 0\n  - Optional: alarm if the function hasn’t run successfully in > 24h (via metric math or EventBridge + alarm)\n\n### 4) Networking\n- Keep the Lambda **out of a VPC** unless you have a specific requirement. This avoids NAT/VPC endpoint complexity and is sufficient because SSM, S3, KMS, and CloudWatch Logs are public AWS service endpoints.\n  - If you must run in a VPC, add interface/gateway endpoints (S3 gateway endpoint; interface endpoints for SSM/KMS/CloudWatch Logs) and appropriate route tables/security groups.\n\n### 5) Deployment strategy\n- Package and deploy the Lambda from the provided artifact (`ssm_backup.zip`) or build pipeline.\n- Use IaC (Terraform module implied by README) to provision:\n  - S3 bucket + encryption + bucket policy\n  - KMS CMK + alias + key policy\n  - Lambda + role/policies + env vars (`S3_BUCKET`, `KMS_KEY_ARN`)\n  - EventBridge schedule + Lambda invoke permission\n\n---\n\n## AWS resources to provision\n\n### Compute\n- **AWS Lambda Function** (`ssm_backup`)\n- **Lambda Permission** allowing **EventBridge** to invoke the function (resource-based policy on the function) ([docs.aws.amazon.com](https://docs.aws.amazon.com/lambda/latest/dg/lambda-permissions.html?utm_source=openai))\n\n### Scheduling / Events\n- **Amazon EventBridge Rule** (scheduled cron expression)\n- **EventBridge Target** (the Lambda function)\n\n### Storage\n- **Amazon S3 Bucket** (backup bucket)\n- **S3 Bucket Default Encryption configuration** (SSE-KMS with CMK)\n- **S3 Bucket Policy** enforcing SSE-KMS + specific CMK ARN ([docs.aws.amazon.com](https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html?utm_source=openai))\n- (Optional but recommended) **S3 Public Access Block** (account/bucket level)\n- (Optional) **S3 Lifecycle Rule** to expire/transition old backups (e.g., Glacier)\n\n### Key Management\n- **AWS KMS Customer Managed Key (symmetric)** for S3 SSE-KMS ([docs.aws.amazon.com](https://docs.aws.amazon.com/AmazonS3/latest/userguide/specifying-kms-encryption.html?utm_source=openai))\n- **KMS Alias** (e.g., `alias/ssm-parameter-backup`)\n- **KMS Key Policy** (allow S3 + Lambda role usage)\n\n### Identity & Access Management\n- **IAM Role** (Lambda execution role)\n- **IAM Policy** (custom least-privilege for SSM + S3 + KMS)\n- **IAM Managed Policy attachment**: `AWSLambdaBasicExecutionRole` (or equivalent inline permissions) ([docs.aws.amazon.com](https://docs.aws.amazon.com/lambda/latest/dg/monitoring-cloudwatchlogs.html?utm_source=openai))\n\n### Monitoring / Logging\n- **Amazon CloudWatch Logs Log Group** `/aws/lambda/ssm_backup` (with retention) ([docs.aws.amazon.com](https://docs.aws.amazon.com/lambda/latest/dg/monitoring-cloudwatchlogs.html?utm_source=openai))\n- (Recommended) **CloudWatch Alarms** for Lambda Errors/Throttles/Duration\n- (Optional) **SNS Topic** (or other notification target) for alarm notifications\n\n### (Optional) Configuration / Governance\n- **AWS Systems Manager Parameter Store** (already exists as the source of truth; no new resource unless you want to create a dedicated path/prefix)\n- **AWS CloudTrail** (account-level; recommended if not already enabled) to audit access to SSM/S3/KMS\n\n### (Optional) VPC (only if required)\n- VPC, private subnets, route tables\n- VPC endpoints (S3 gateway; interface endpoints for SSM, KMS, CloudWatch Logs)\n- Security groups for Lambda ENIs\n- NAT Gateway/IGW (only if you choose not to use endpoints)",
  "aws_resources": [
    "AWS Lambda Function (ssm_backup)",
    "Lambda resource-based permission for EventBridge invocation (AWS::Lambda::Permission)",
    "Amazon EventBridge Scheduled Rule (cron)",
    "EventBridge Target (Lambda)",
    "Amazon S3 Bucket (backup bucket)",
    "S3 Bucket Default Encryption (SSE-KMS with CMK)",
    "S3 Bucket Policy enforcing SSE-KMS + specific KMS key",
    "S3 Public Access Block (recommended)",
    "S3 Lifecycle Configuration (optional)",
    "AWS KMS Customer Managed Key (symmetric)",
    "KMS Alias",
    "KMS Key Policy",
    "IAM Role (Lambda execution role)",
    "IAM Policy (SSM read + S3 put + KMS use)",
    "IAM managed policy attachment: AWSLambdaBasicExecutionRole",
    "CloudWatch Logs Log Group (/aws/lambda/ssm_backup) + retention",
    "CloudWatch Alarms (Lambda Errors/Throttles/Duration) (recommended)",
    "SNS Topic for alarm notifications (optional)",
    "AWS CloudTrail (account-level, optional if not already enabled)",
    "(Optional if Lambda must run in VPC) VPC",
    "(Optional) Subnets (private)",
    "(Optional) Route Tables",
    "(Optional) Security Groups",
    "(Optional) VPC Endpoints: S3 Gateway Endpoint",
    "(Optional) VPC Interface Endpoints: SSM, KMS, CloudWatch Logs",
    "(Optional) NAT Gateway / Internet Gateway (only if endpoints not used)"
  ]
}