{
  "plantuml_diagram": "@startuml\n!define AWSPuml https://raw.githubusercontent.com/awslabs/aws-icons-for-plantuml/v20.0/dist\n!include AWSPuml/AWSCommon.puml\n\ntitle Nebari Plugin: Metrics Server (Terraform Stage) - High-Level Deployment\n\nskinparam shadowing false\nskinparam componentStyle rectangle\n\nactor \"Platform Engineer\" as user\n\nnode \"Developer Workstation / CI\" as ci {\n  artifact \"Python package\\nnebari-plugin-metrics-server\\n(PyPI distribution)\" as pkg\n}\n\nnode \"Nebari Deployment Orchestrator\" as nebari {\n  component \"Nebari Core\\n(Python)\" as nebari_core\n  component \"Plugin System\\n(hookimpl/hookspecs)\" as plugin_sys\n  component \"Terraform Stage Runner\\n(NebariTerraformStage)\" as stage_runner\n}\n\nnode \"IaC Tooling\" as iac {\n  component \"Terraform\" as tf\n  component \"Helm Provider\" as helm\n}\n\nnode \"Kubernetes Cluster\" as k8s {\n  node \"Control Plane\" as cp {\n    component \"Kubernetes API Server\" as apiserver\n  }\n  node \"kube-system namespace\" as ns {\n    component \"Helm Release: metrics-server\" as helmrel\n    component \"Metrics Server\\n(Deployment + Service)\" as metrics\n  }\n}\n\nuser --> pkg : installs/uses\npkg --> plugin_sys : registers stage via hookimpl\nplugin_sys --> stage_runner : invokes stage\nstage_runner --> tf : generates/applies plan\ntf --> helm : manages Helm release\nhelm --> apiserver : deploys resources\napiserver --> helmrel : creates/updates\nhelmrel --> metrics : runs\nmetrics --> apiserver : scrapes node/pod metrics\n\nnote right of metrics\nProvides resource metrics for HPA/VPA\nand kubectl top.\nend note\n\n@enduml",
  "svg_diagram": "<?plantuml 1.2026.2beta1?><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" contentStyleType=\"text/css\" data-diagram-type=\"DESCRIPTION\" height=\"1132px\" preserveAspectRatio=\"none\" style=\"width:1071px;height:1132px;background:#FFFFFF;\" version=\"1.1\" viewBox=\"0 0 1071 1132\" width=\"1071px\" zoomAndPan=\"magnify\"><title>Nebari Plugin: Metrics Server (Terraform Stage) - High-Level Deployment</title><defs/><g><g class=\"title\" data-source-line=\"4\"><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"580.6719\" x=\"238.2052\" y=\"22.9951\">Nebari Plugin: Metrics Server (Terraform Stage) - High-Level Deployment</text></g><!--cluster ci--><g class=\"cluster\" data-qualified-name=\"ci\" data-source-line=\"11\" id=\"ent0003\"><polygon fill=\"#FFFFFF\" points=\"114,190.8469,124,180.8469,402,180.8469,402,298.7369,392,308.7369,114,308.7369,114,190.8469\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"392\" x2=\"402\" y1=\"190.8469\" y2=\"180.8469\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"114\" x2=\"392\" y1=\"190.8469\" y2=\"190.8469\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"392\" x2=\"392\" y1=\"190.8469\" y2=\"308.7369\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"212.6182\" x=\"147.6909\" y=\"206.842\">Developer Workstation / CI</text></g><!--cluster nebari--><g class=\"cluster\" data-qualified-name=\"nebari\" data-source-line=\"15\" id=\"ent0005\"><polygon fill=\"#FFFFFF\" points=\"16,379.7369,26,369.7369,361,369.7369,361,595.9169,351,605.9169,16,605.9169,16,379.7369\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"351\" x2=\"361\" y1=\"379.7369\" y2=\"369.7369\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"16\" x2=\"351\" y1=\"379.7369\" y2=\"379.7369\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"351\" x2=\"351\" y1=\"379.7369\" y2=\"605.9169\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"258.7129\" x=\"55.1436\" y=\"395.732\">Nebari Deployment Orchestrator</text></g><!--cluster iac--><g class=\"cluster\" data-qualified-name=\"iac\" data-source-line=\"21\" id=\"ent0009\"><polygon fill=\"#FFFFFF\" points=\"189,719.0669,199,709.0669,396,709.0669,396,920.3569,386,930.3569,189,930.3569,189,719.0669\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"386\" x2=\"396\" y1=\"719.0669\" y2=\"709.0669\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"189\" x2=\"386\" y1=\"719.0669\" y2=\"719.0669\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"386\" x2=\"386\" y1=\"719.0669\" y2=\"930.3569\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"88.1768\" x=\"244.4116\" y=\"735.062\">IaC Tooling</text></g><!--cluster k8s--><g class=\"cluster\" data-qualified-name=\"k8s\" data-source-line=\"26\" id=\"ent0012\"><polygon fill=\"#FFFFFF\" points=\"420,662.9169,430,652.9169,833,652.9169,833,1105.8069,823,1115.8069,420,1115.8069,420,662.9169\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"823\" x2=\"833\" y1=\"662.9169\" y2=\"652.9169\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"420\" x2=\"823\" y1=\"662.9169\" y2=\"662.9169\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"823\" x2=\"823\" y1=\"662.9169\" y2=\"1115.8069\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"152.5576\" x=\"546.2212\" y=\"678.912\">Kubernetes Cluster</text></g><!--cluster cp--><g class=\"cluster\" data-qualified-name=\"k8s.cp\" data-source-line=\"27\" id=\"ent0013\"><polygon fill=\"#FFFFFF\" points=\"449,1009.5069,459,999.5069,659,999.5069,659,1081.8069,649,1091.8069,449,1091.8069,449,1009.5069\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"649\" x2=\"659\" y1=\"1009.5069\" y2=\"999.5069\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"449\" x2=\"649\" y1=\"1009.5069\" y2=\"1009.5069\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"649\" x2=\"649\" y1=\"1009.5069\" y2=\"1091.8069\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"106.7158\" x=\"496.6421\" y=\"1025.502\">Control Plane</text></g><!--cluster ns--><g class=\"cluster\" data-qualified-name=\"k8s.ns\" data-source-line=\"30\" id=\"ent0015\"><polygon fill=\"#FFFFFF\" points=\"444,710.9169,454,700.9169,715,700.9169,715,928.5069,705,938.5069,444,938.5069,444,710.9169\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"705\" x2=\"715\" y1=\"710.9169\" y2=\"700.9169\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"444\" x2=\"705\" y1=\"710.9169\" y2=\"710.9169\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"705\" x2=\"705\" y1=\"710.9169\" y2=\"938.5069\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"195.1387\" x=\"477.9307\" y=\"726.912\">kube-system namespace</text></g><!--entity pkg--><g class=\"entity\" data-qualified-name=\"ci.pkg\" data-source-line=\"12\" id=\"ent0004\"><rect fill=\"#FFFFFF\" height=\"71.8906\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"229.7461\" x=\"143.13\" y=\"220.8469\"/><polygon fill=\"#FFFFFF\" points=\"355.8761,225.8469,355.8761,239.8469,367.8761,239.8469,367.8761,231.8469,361.8761,225.8469,355.8761,225.8469\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"361.8761\" x2=\"361.8761\" y1=\"225.8469\" y2=\"231.8469\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"367.8761\" x2=\"361.8761\" y1=\"231.8469\" y2=\"231.8469\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"48.5283\" x=\"196.839\" y=\"246.842\">Python</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"245.3673\" y=\"246.842\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"59.3496\" x=\"249.8175\" y=\"246.842\">package</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"199.7461\" x=\"153.13\" y=\"263.1389\">nebari-plugin-metrics-server</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"34.7607\" x=\"190.7755\" y=\"279.4357\">(PyPI</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"225.5363\" y=\"279.4357\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"85.2441\" x=\"229.9864\" y=\"279.4357\">distribution)</text></g><!--entity nebari_core--><g class=\"entity\" data-qualified-name=\"nebari.nebari_core\" data-source-line=\"16\" id=\"ent0006\"><rect fill=\"#FFFFFF\" height=\"52.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"103.3574\" x=\"32.32\" y=\"409.7369\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"46.1973\" x=\"42.32\" y=\"432.732\">Nebari</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"88.5173\" y=\"432.732\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"32.71\" x=\"92.9675\" y=\"432.732\">Core</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"59.4521\" x=\"54.2726\" y=\"449.0289\">(Python)</text></g><!--entity plugin_sys--><g class=\"entity\" data-qualified-name=\"nebari.plugin_sys\" data-source-line=\"17\" id=\"ent0007\"><rect fill=\"#FFFFFF\" height=\"52.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"173.9521\" x=\"171.02\" y=\"409.7369\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"42.8545\" x=\"208.2407\" y=\"432.732\">Plugin</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"251.0952\" y=\"432.732\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"52.2061\" x=\"255.5454\" y=\"432.732\">System</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"153.9521\" x=\"181.02\" y=\"449.0289\">(hookimpl/hookspecs)</text></g><!--entity stage_runner--><g class=\"entity\" data-qualified-name=\"nebari.stage_runner\" data-source-line=\"18\" id=\"ent0008\"><rect fill=\"#FFFFFF\" height=\"52.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"190.2148\" x=\"154.89\" y=\"537.3269\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"70.1436\" x=\"164.89\" y=\"560.322\">Terraform</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"235.0336\" y=\"560.322\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"40.4551\" x=\"239.4838\" y=\"560.322\">Stage</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"279.9388\" y=\"560.322\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"50.7158\" x=\"284.389\" y=\"560.322\">Runner</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"167.7197\" x=\"166.1376\" y=\"576.6189\">(NebariTerraformStage)</text></g><!--entity tf--><g class=\"entity\" data-qualified-name=\"iac.tf\" data-source-line=\"22\" id=\"ent0010\"><rect fill=\"#FFFFFF\" height=\"36.2969\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"90.1436\" x=\"204.93\" y=\"749.0669\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"70.1436\" x=\"214.93\" y=\"772.062\">Terraform</text></g><!--entity helm--><g class=\"entity\" data-qualified-name=\"iac.helm\" data-source-line=\"23\" id=\"ent0011\"><rect fill=\"#FFFFFF\" height=\"36.2969\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"119.3125\" x=\"232.34\" y=\"878.0669\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"36.668\" x=\"242.34\" y=\"901.062\">Helm</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"279.008\" y=\"901.062\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"58.1943\" x=\"283.4582\" y=\"901.062\">Provider</text></g><!--entity apiserver--><g class=\"entity\" data-qualified-name=\"k8s.cp.apiserver\" data-source-line=\"28\" id=\"ent0014\"><rect fill=\"#FFFFFF\" height=\"36.2969\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"177.1514\" x=\"465.42\" y=\"1039.5069\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"80.1924\" x=\"475.42\" y=\"1062.502\">Kubernetes</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"555.6124\" y=\"1062.502\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"22.1484\" x=\"560.0626\" y=\"1062.502\">API</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"582.211\" y=\"1062.502\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"45.9102\" x=\"586.6612\" y=\"1062.502\">Server</text></g><!--entity helmrel--><g class=\"entity\" data-qualified-name=\"k8s.ns.helmrel\" data-source-line=\"31\" id=\"ent0016\"><rect fill=\"#FFFFFF\" height=\"52.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"121.7461\" x=\"517.13\" y=\"740.9169\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"36.668\" x=\"527.4205\" y=\"763.912\">Helm</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"564.0885\" y=\"763.912\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"60.0469\" x=\"568.5387\" y=\"763.912\">Release:</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"101.7461\" x=\"527.13\" y=\"780.2089\">metrics-server</text></g><!--entity metrics--><g class=\"entity\" data-qualified-name=\"k8s.ns.metrics\" data-source-line=\"32\" id=\"ent0017\"><rect fill=\"#FFFFFF\" height=\"52.5938\" style=\"stroke:#7D8998;stroke-width:1.25;\" width=\"188.9297\" x=\"459.54\" y=\"869.9169\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"50.8184\" x=\"503.4155\" y=\"892.912\">Metrics</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"554.2338\" y=\"892.912\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"45.9102\" x=\"558.684\" y=\"892.912\">Server</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"91.0957\" x=\"469.54\" y=\"909.2089\">(Deployment</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"560.6357\" y=\"909.2089\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"11.7305\" x=\"565.0859\" y=\"909.2089\">+</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"576.8164\" y=\"909.2089\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"57.2031\" x=\"581.2666\" y=\"909.2089\">Service)</text></g><!--entity user--><g class=\"entity\" data-qualified-name=\"user\" data-source-line=\"9\" id=\"ent0002\"><ellipse cx=\"258.0044\" cy=\"51.2969\" fill=\"#FFFFFF\" rx=\"8\" ry=\"8\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><path d=\"M258.0044,59.2969 L258.0044,86.2969 M245.0044,67.2969 L271.0044,67.2969 M258.0044,86.2969 L245.0044,101.2969 M258.0044,86.2969 L271.0044,101.2969\" fill=\"none\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"59.2881\" x=\"194.96\" y=\"116.542\">Platform</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"4.4502\" x=\"254.2481\" y=\"116.542\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" lengthAdjust=\"spacing\" textLength=\"62.3506\" x=\"258.6983\" y=\"116.542\">Engineer</text></g><g class=\"entity\" data-qualified-name=\"GMN27\" data-source-line=\"47\" id=\"ent0028\"><path d=\"M851.91,868.5169 L851.91,923.9153 L1064.0824,923.9153 L1064.0824,878.5169 L1054.0824,868.5169 L851.91,868.5169\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><path d=\"M1054.0824,868.5169 L1054.0824,878.5169 L1064.0824,878.5169 L1054.0824,868.5169\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"55.4658\" x=\"857.91\" y=\"885.5838\">Provides</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"913.3758\" y=\"885.5838\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"56.7988\" x=\"917.5081\" y=\"885.5838\">resource</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"974.307\" y=\"885.5838\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"48.6357\" x=\"978.4393\" y=\"885.5838\">metrics</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"1027.075\" y=\"885.5838\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"17.875\" x=\"1031.2074\" y=\"885.5838\">for</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"56.5132\" x=\"925.2396\" y=\"900.7166\">HPA/VPA</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"24.4575\" x=\"900.4806\" y=\"915.8494\">and</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"924.9381\" y=\"915.8494\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"47.874\" x=\"929.0704\" y=\"915.8494\">kubectl</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"4.1323\" x=\"976.9444\" y=\"915.8494\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"13\" lengthAdjust=\"spacing\" textLength=\"25.4351\" x=\"981.0767\" y=\"915.8494\">top.</text></g><!--link user to pkg--><g class=\"link\" data-entity-1=\"ent0002\" data-entity-2=\"ent0004\" data-link-type=\"dependency\" data-source-line=\"36\" id=\"lnk18\"><path d=\"M258,120.0969 C258,149.9769 258,185.2369 258,214.3869\" fill=\"none\" id=\"user-to-pkg\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"258,220.3869,262,211.3869,258,215.3869,254,211.3869,258,220.3869\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"73.7051\" x=\"259\" y=\"161.9855\">installs/uses</text></g><!--link pkg to plugin_sys--><g class=\"link\" data-entity-1=\"ent0004\" data-entity-2=\"ent0007\" data-link-type=\"dependency\" data-source-line=\"37\" id=\"lnk19\"><path d=\"M258,293.2269 C258,327.5769 258,372.8369 258,403.4069\" fill=\"none\" id=\"pkg-to-plugin_sys\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"258,409.4069,262,400.4069,258,404.4069,254,400.4069,258,409.4069\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"52.793\" x=\"259\" y=\"336.8755\">registers</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"311.793\" y=\"336.8755\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"33.3105\" x=\"315.6074\" y=\"336.8755\">stage</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"348.918\" y=\"336.8755\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"17.7891\" x=\"352.7324\" y=\"336.8755\">via</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"55.2129\" x=\"287.1543\" y=\"350.8443\">hookimpl</text></g><!--link plugin_sys to stage_runner--><g class=\"link\" data-entity-1=\"ent0007\" data-entity-2=\"ent0008\" data-link-type=\"dependency\" data-source-line=\"38\" id=\"lnk20\"><path d=\"M256.36,462.7469 C254.98,484.4169 253.4015,509.289 252.0215,530.949\" fill=\"none\" id=\"plugin_sys-to-stage_runner\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"251.64,536.9369,256.2042,528.2094,251.9579,531.947,248.2203,527.7008,251.64,536.9369\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"45.9668\" x=\"256\" y=\"504.4655\">invokes</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"301.9668\" y=\"504.4655\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"33.3105\" x=\"305.7813\" y=\"504.4655\">stage</text></g><!--link stage_runner to tf--><g class=\"link\" data-entity-1=\"ent0008\" data-entity-2=\"ent0010\" data-link-type=\"dependency\" data-source-line=\"39\" id=\"lnk21\"><path d=\"M250,590.1569 C250,631.6869 250,706.8269 250,742.5769\" fill=\"none\" id=\"stage_runner-to-tf\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"250,748.5769,254,739.5769,250,743.5769,246,739.5769,250,748.5769\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"107.5488\" x=\"251\" y=\"634.0555\">generates/applies</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"358.5488\" y=\"634.0555\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"25.9102\" x=\"362.3633\" y=\"634.0555\">plan</text></g><!--link tf to helm--><g class=\"link\" data-entity-1=\"ent0010\" data-entity-2=\"ent0011\" data-link-type=\"dependency\" data-source-line=\"40\" id=\"lnk22\"><path d=\"M255.75,785.6069 C263.75,809.7969 276.2667,847.6401 284.2967,871.9301\" fill=\"none\" id=\"tf-to-helm\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"286.18,877.6269,287.1529,867.8262,284.6106,872.8796,279.5572,870.3372,286.18,877.6269\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"55.2539\" x=\"274\" y=\"835.6555\">manages</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"329.2539\" y=\"835.6555\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"31.4297\" x=\"333.0684\" y=\"835.6555\">Helm</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"364.498\" y=\"835.6555\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"44.0215\" x=\"368.3125\" y=\"835.6555\">release</text></g><!--link helm to apiserver--><g class=\"link\" data-entity-1=\"ent0011\" data-entity-2=\"ent0014\" data-link-type=\"dependency\" data-source-line=\"41\" id=\"lnk23\"><path d=\"M320.79,914.7369 C371.17,945.3969 469.6246,1005.3075 520.0346,1035.9875\" fill=\"none\" id=\"helm-to-apiserver\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"525.16,1039.1069,519.5515,1031.0109,520.8888,1036.5074,515.3923,1037.8448,525.16,1039.1069\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"46.6465\" x=\"431\" y=\"973.6455\">deploys</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"477.6465\" y=\"973.6455\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"58.6816\" x=\"481.4609\" y=\"973.6455\">resources</text></g><!--link apiserver to helmrel--><g class=\"link\" data-entity-1=\"ent0014\" data-entity-2=\"ent0016\" data-link-type=\"dependency\" data-source-line=\"42\" id=\"lnk24\"><path d=\"M603.05,1039.1269 C627.86,1027.4769 655.68,1009.4669 670,983.5069 C694.7,938.7269 685.13,915.9469 666,868.5169 C654.13,839.0769 634.1825,816.4817 614.0925,798.0617\" fill=\"none\" id=\"apiserver-to-helmrel\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"609.67,794.0069,613.6005,803.0375,613.3554,797.3859,619.0069,797.1408,609.67,794.0069\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"97.1836\" x=\"685\" y=\"900.8555\">creates/updates</text></g><!--link helmrel to metrics--><g class=\"link\" data-entity-1=\"ent0016\" data-entity-2=\"ent0017\" data-link-type=\"dependency\" data-source-line=\"43\" id=\"lnk25\"><path d=\"M573.14,793.9169 C568.98,815.9469 564.1238,841.6312 559.9638,863.6512\" fill=\"none\" id=\"helmrel-to-metrics\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"558.85,869.5469,564.4512,861.4458,559.7782,864.6338,556.5902,859.9608,558.85,869.5469\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"26.3965\" x=\"568\" y=\"835.6555\">runs</text></g><!--link metrics to apiserver--><g class=\"link\" data-entity-1=\"ent0017\" data-entity-2=\"ent0014\" data-link-type=\"dependency\" data-source-line=\"44\" id=\"lnk26\"><path d=\"M554,922.8269 C554,955.5769 554,1005.3869 554,1033.4569\" fill=\"none\" id=\"metrics-to-apiserver\" style=\"stroke:#000000;stroke-width:2;\"/><polygon fill=\"#000000\" points=\"554,1039.4569,558,1030.4569,554,1034.4569,550,1030.4569,554,1039.4569\" style=\"stroke:#000000;stroke-width:2;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"46.3887\" x=\"555\" y=\"966.6455\">scrapes</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"3.8145\" x=\"601.3887\" y=\"966.6455\">&#160;</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"56.5664\" x=\"605.2031\" y=\"966.6455\">node/pod</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"12\" lengthAdjust=\"spacing\" textLength=\"44.8945\" x=\"585.9375\" y=\"980.6143\">metrics</text></g><!--link metrics to GMN27--><g class=\"link\" data-entity-1=\"ent0017\" data-entity-2=\"ent0028\" data-link-type=\"association\" data-source-line=\"47\" id=\"lnk29\"><path d=\"M597.74,869.5169 C624.14,854.9969 659.04,838.4969 692.5,831.0169 C742.38,819.8569 757.45,820.6369 807.5,831.0169 C842.35,838.2369 879.05,853.9569 907.48,868.1469\" fill=\"none\" id=\"metrics-GMN27\" style=\"stroke:#000000;stroke-width:2;stroke-dasharray:7,7;\"/></g><?plantuml-src PLHDRzim3BthLx0zjHWS5piDEGm8qW4jzcKqnNefK2WoOmkH9K6KKmH3__iesN4-Th8bFZxoyT6-gd6ZBSBYPLNrdO4sHa_piWpoVTResFRhdZ0ePoFQE5EkA-Kx6Rccz2mq1wZOk51u8sraWdBt-MvsLzQQehZILfc-diXBVYvTrpaxytmK8kfe47xXMWODbUaRRUVm4sFGYc25OOS1Rfun1CabEbX5sU0j5F2WcxRuWJiqS8_Uk7t7pGb1Mssz3B83QcNjthLjO2CDuKc45NXd6RwAUwuTK4Lf6uD2I1LTWElAo9YhVRFS3cAu1acGXY24TIpc-ZuLTfvxUt5XIr56xIoKi7pCKANXhm2G8UeDSpBZFhOCy59jkVzNQxDUdbZIMtI3t8Aot5TxK-shHqZp2thT9-hRJEktZVWuj32Ex2WUVWVL8kT85f7nGvNSogHvIbowWBbKwkps1F-cE7AUClW2gpr5x3YfTMwhEs_Az48U5OqDPjmRxUay_y8_UEfv0adeqCiK7jpDL9HUtq867aK_oYKyEsVOrepIKbtAcyWo86xEemzeEgY2s-bwjBNbcsE1x_qQWyM814lJizm1jFr2kSu0MlAd49pXTPKM1yDz3f-LEg5Qi9t3BcUqz7gmcbC-9jOjumlA8mOhEoJUbe7Tql_iMSWJ6fI4SpZVe4bNG7EPT_vfiGKd2_GftserMZ2IvYPvG6d_eIY-fZM4EMZB5Xb39T-JI7SvDcq0Gm8sEermT1DsMi9XTSG9CYMU-ftPTswBOw8u2oPqt32cGJvAdcyflJSQq_v9ApYM84a_WpffEPSWpoiCyn8vba2J4uoiyo28GUJwe5ZKCNeWP096ge2vRE_hz1I7I4ADGqlgUqlYSBmiHYf8psqbwqllwcdOl8UH_qdyTulWDjFrkBB7xgP2lEhmK2tAFzL2I5j3MYCL3KJdPmBv8X7-0m00?></g></svg>",
  "architecture_description": "## High-level architecture\n\nThis codebase is a **Python Nebari plugin** that contributes a **Nebari Terraform stage**. When enabled in a Nebari deployment, the stage uses **Terraform (with the Helm provider)** to install/upgrade the **Kubernetes Metrics Server** add-on in the target Kubernetes cluster.\n\n### Main components\n- **Python plugin package (nebari-plugin-metrics-server)**\n  - Technology: Python (packaged via `pyproject.toml`, built with hatchling)\n  - Role: Registers itself into Nebari via the plugin system (`hookimpl/hookspecs`) and exposes a `NebariTerraformStage` implementation.\n  - Distribution: Published to PyPI (CI workflow builds/publishes).\n\n- **Nebari Deployment Orchestrator**\n  - Technology: Nebari core (Python)\n  - Role: Loads installed plugins, discovers the stage, and executes it as part of the overall Nebari provisioning workflow.\n\n- **IaC Tooling (Terraform + Helm provider)**\n  - Role: Applies infrastructure changes defined by the stage; specifically manages a **Helm release** for `metrics-server`.\n\n- **Kubernetes Cluster (target platform)**\n  - **Kubernetes API Server**: Receives resource creation/update requests from Terraform/Helm.\n  - **Namespace (commonly `kube-system`)**: Hosts the Helm release and the deployed Metrics Server workload.\n  - **Metrics Server**: Collects node/pod resource usage and exposes it via the Kubernetes metrics APIs, enabling `kubectl top` and autoscaling features (e.g., HPA/VPA).\n\n### Key relationships / flow\n1. A platform engineer installs/uses the plugin package (directly or via Nebari environment management).\n2. Nebari loads the plugin and invokes its **Terraform stage**.\n3. The stage runs **Terraform**, which uses the **Helm provider** to install/upgrade the `metrics-server` Helm release.\n4. The Helm provider talks to the **Kubernetes API server**, which creates/updates the release resources in the cluster.\n5. The **Metrics Server** runs in the cluster and provides resource metrics back through Kubernetes APIs for consumers like autoscalers and `kubectl top`."
}