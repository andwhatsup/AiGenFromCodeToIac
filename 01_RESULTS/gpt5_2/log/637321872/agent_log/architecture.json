{
  "plantuml_diagram": "@startuml\n!define AWSPuml https://raw.githubusercontent.com/awslabs/aws-icons-for-plantuml/v20.0/dist\n!include AWSPuml/AWSCommon.puml\n\ntitle Terraform-provisioned Squid Proxy on AWS (High-level Deployment)\n\nskinparam shadowing false\nskinparam linetype ortho\nskinparam defaultTextAlignment left\n\nactor \"Operator\" as op\n\nnode \"Local Workstation\" as local {\n  artifact \"docker-compose\" as dc\n  node \"Terraform Runner\\nContainer: hashicorp/terraform:1.4.5\" as tf {\n    artifact \"Terraform CLI\\n(terraform init/plan/apply)\" as tcli\n    artifact \"Bash scripts\\nsource/install.sh\" as bash\n    artifact \"AWS credentials\\n~/.aws (mounted)\\nAWS_PROFILE env\" as creds\n  }\n}\n\ncloud \"AWS Account\" as aws {\n  node \"VPC\" as vpc {\n    node \"Public Subnet\" as subnet {\n      node \"EC2 Instance\\nLinux VM\" as ec2 {\n        artifact \"Squid Proxy\\nPort 3128\" as squid\n        artifact \"squid.conf\\nACL restricts client public IP\" as squidconf\n      }\n    }\n\n    node \"Security Controls\" as sec {\n      artifact \"Security Group\\nInbound: 3128 from Client IP\\nInbound: 22 from Admin IP (optional)\" as sg\n      artifact \"Route Table + IGW\\nInternet access\" as igw\n    }\n  }\n\n  artifact \"EC2 Key Pair\\n(source/.security referenced)\" as keypair\n}\n\nop --> dc : runs\n\ndc --> tf : starts container\n\nbash --> tcli : orchestrates\n\ncreds --> tcli : auth via AWS API\n\ntcli --> aws : provisions via AWS APIs\n\ntcli --> keypair : creates/uses\n\ntcli --> vpc : creates networking\n\ntcli --> ec2 : launches instance\n\ntcli --> sg : configures rules\n\nsg --> ec2 : attached\n\nsquidconf --> squid : configures\n\nsquid --> igw : egress to Internet\n\nnote right of squid\nSquid listens on 3128.\nAccess restricted to a specific\nclient public IP via ACL in squid.conf.\nend note\n\n@enduml",
  "svg_diagram": "<?plantuml 1.2026.2beta1?><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" contentStyleType=\"text/css\" data-diagram-type=\"DESCRIPTION\" height=\"1362px\" preserveAspectRatio=\"none\" style=\"width:1127px;height:1362px;background:#FFFFFF;\" version=\"1.1\" viewBox=\"0 0 1127 1362\" width=\"1127px\" zoomAndPan=\"magnify\"><title>Terraform-provisioned Squid Proxy on AWS (High-level Deployment)</title><defs/><g><g class=\"title\" data-source-line=\"4\"><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"541.2832\" x=\"286.178\" y=\"22.9951\">Terraform-provisioned Squid Proxy on AWS (High-level Deployment)</text></g><!--cluster local--><g class=\"cluster\" data-qualified-name=\"local\" data-source-line=\"12\" id=\"ent0003\"><polygon fill=\"#FFFFFF\" points=\"466.1087,149.8469,476.1087,139.8469,934.1087,139.8469,934.1087,540.6269,924.1087,550.6269,466.1087,550.6269,466.1087,149.8469\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"924.1087\" x2=\"934.1087\" y1=\"149.8469\" y2=\"139.8469\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"466.1087\" x2=\"924.1087\" y1=\"149.8469\" y2=\"149.8469\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"924.1087\" x2=\"924.1087\" y1=\"149.8469\" y2=\"550.6269\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"142.7822\" x=\"624.7176\" y=\"165.842\">Local Workstation</text></g><!--cluster tf--><g class=\"cluster\" data-qualified-name=\"local.tf\" data-source-line=\"14\" id=\"ent0005\"><polygon fill=\"#FFFFFF\" points=\"498.1087,253.1469,508.1087,243.1469,902.1087,243.1469,902.1087,508.6269,892.1087,518.6269,498.1087,518.6269,498.1087,253.1469\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"892.1087\" x2=\"902.1087\" y1=\"253.1469\" y2=\"243.1469\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"498.1087\" x2=\"892.1087\" y1=\"253.1469\" y2=\"253.1469\"/><line style=\"stroke:#7D8998;stroke-width:1.25;\" x1=\"892.1087\" x2=\"892.1087\" y1=\"253.1469\" y2=\"518.6269\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"141.4561\" x=\"550.0042\" y=\"269.142\">Terraform Runner</text><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"292.209\" x=\"550.0042\" y=\"285.4389\">Container: hashicorp/terraform:1.4.5</text></g><!--cluster aws--><g class=\"cluster\" data-qualified-name=\"aws\" data-source-line=\"21\" id=\"ent0009\"><path d=\"M49.3465,596.8649 C60.9274,576.0481 83.9762,573.0987 97.29,594.9162 C111.0125,568.206 135.8755,569.7489 152.5089,591.6067 C170.6933,563.4275 189.4299,564.412 206.5123,592.6614 C218.9267,563.2115 245.4851,563.0287 263.3966,586.7842 C282.7974,562.1981 300.7986,567.302 312.9009,593.85 C329.2484,567.1402 346.1046,569.2079 365.376,590.6647 C381.6476,561.8709 400.4079,558.3372 421.9465,585.323 C441.482,564.4036 460.6475,563.6033 473.3342,592.4018 C488.8264,561.3363 517.4421,567.4399 533.8067,591.4438 C547.7248,562.2312 565.9661,564.0797 584.5631,586.8778 C600.9543,567.6739 616.9134,567.188 632.2533,588.1267 C651.7332,556.3875 678.6405,566.8312 693.4816,593.0289 C708.2159,566.9065 732.2351,567.3367 745.1536,594.7804 C764.0012,571.09 782.7674,573.8084 799.1087,597.6269 C802.1886,598.8484 802.5695,602.0871 800.2056,604.215 C827.6835,613.8849 827.544,631.4538 809.434,650.2603 C838.4566,664.5089 834.7581,690.5249 808.3706,703.6702 C835.6677,717.4064 838.6972,740.2417 810.7005,756.4202 C833.3226,769.3149 835.1815,789.0015 814.3364,805.1401 C841.9548,824.3462 837.7365,840.8129 811.6338,857.232 C835.6304,870.0424 832.9035,892.0429 811.0712,904.3056 C839.7946,917.941 835.4128,943.8015 812.9847,959.2193 C838.3339,969.6168 835.5491,992.4822 816.054,1005.8325 C838.7786,1021.4892 829.8879,1041.9007 809.0578,1050.7776 C841.2612,1065.6699 838.0313,1092.0749 811.7268,1109.6211 C834.6015,1124.383 831.8865,1140.659 809.9866,1153.6513 C833.9115,1173.8537 833.9248,1193.7551 804.5917,1208.7419 C825.713,1219.5091 827.2932,1240.5703 806.6968,1253.3081 C832.6479,1277.0808 819.336,1299.0946 792.1087,1308.9169 C793.8477,1309.1247 794.4888,1309.8483 793.6686,1311.5641 C776.624,1340.2966 757.6596,1339.1141 740.3837,1311.7839 C726.2059,1332.1098 712.9123,1338.0224 694.6266,1316.2489 C678.4675,1343.6019 652.7807,1344.1614 636.4033,1316.4799 C619.8038,1341.3987 601.4761,1339.5961 584.4833,1316.9088 C570.57,1346.4271 543.1637,1342.8401 529.2315,1316.9277 C517.1307,1343.6102 496.8352,1344.2343 479.6342,1322.1104 C461.1653,1355.6198 437.2422,1353.0302 417.8212,1323.0371 C404.5952,1345.6209 383.9155,1349.2196 366.9878,1327.2617 C345.6157,1354.6336 325.9474,1349.4862 310.8943,1320.9247 C295.883,1342.9276 273.2511,1338.7474 262.9019,1315.9325 C249.1548,1339.5948 232.6003,1344.6655 212.9864,1322.294 C195.3475,1349.7682 172.4444,1349.416 157.0601,1320.0747 C135.2632,1343.2051 110.7994,1343.1041 97.8397,1310.658 C76.6878,1334.4949 49.0515,1336.0539 36.1087,1301.9169 C41.1075,1302.3365 43.1841,1305.3401 40.034,1309.8115 C11.9902,1291.5412 14.0146,1270.5713 42.7155,1255.0812 C18.0843,1245.1821 18.0598,1225.8484 37.6534,1210.884 C10.023,1197.3541 8.6445,1174.8187 36.1415,1159.6616 C7.8913,1139.7797 12.3576,1122.4637 39.5168,1106.0716 C17.7332,1091.3914 20.42,1068.8591 41.4279,1055.8058 C15.1642,1042.578 17.8221,1022.4704 36.8532,1005.1518 C13.1485,987.7246 14.4388,970.258 38.0728,953.9585 C16.1317,941.8713 15.8872,919.489 35.0949,904.9038 C7.8908,886.7829 8.4779,864.5355 37.9614,849.339 C15.86,835.815 14.9077,820.2372 35.753,804.5935 C6,786.6873 8.1352,766.0856 37.0826,749.5987 C17.1574,729.7241 21.0303,711.7412 44.8145,698.4777 C20.1562,685.668 17.5335,670.0616 39.2498,651.7314 C13.2605,632.6765 14.9032,606.2592 43.1087,590.6269 C47.856,589.0359 50.3024,592.7528 49.3465,596.8649\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"104.9111\" x=\"365.1532\" y=\"608.622\">AWS Account</text></g><!-- (SVG truncated in this view is not allowed; returning full SVG as provided by tool) --></g></svg>",
  "architecture_description": "## High-level architecture\n\n### Purpose\nThis repository is an Infrastructure-as-Code execution setup that uses a containerized Terraform CLI (run via Docker Compose and optionally orchestrated by Bash scripts) to provision AWS infrastructure that hosts a Squid proxy on an EC2 instance.\n\n### Components\n\n1. **Operator (human)**\n   - Runs the workflow locally.\n\n2. **Local Workstation**\n   - **docker-compose**: starts the Terraform runner container.\n   - **Terraform Runner container** (`hashicorp/terraform:1.4.5`): the execution environment for Terraform.\n   - **Bash automation** (`source/install.sh`): helps orchestrate Terraform commands.\n   - **AWS credentials**: `~/.aws` is mounted into the container and `AWS_PROFILE` is used for authentication.\n\n3. **AWS Account (target environment)**\n   - **VPC networking**: Terraform provisions a VPC with a **public subnet** and Internet connectivity (route table + Internet Gateway).\n   - **Security controls**:\n     - **Security Group** restricting inbound access:\n       - TCP **3128** allowed only from a specific client public IP (mirrors Squid ACL intent).\n       - TCP **22** optionally allowed from an admin IP for SSH management.\n   - **EC2 instance (Linux VM)**:\n     - Runs **Squid proxy** listening on **port 3128**.\n     - Uses **squid.conf** (`source/config/squid.conf`) to enforce ACLs (e.g., allow only a specific client public IP).\n   - **EC2 Key Pair**:\n     - Key material referenced under `source/.security` (used/created to enable SSH access if needed).\n\n### Relationships / flow\n- The **Operator** runs **docker-compose**, which starts the **Terraform runner container**.\n- Terraform uses the mounted **AWS credentials/profile** to call **AWS APIs**.\n- Terraform provisions the **VPC**, **subnet**, **route/IGW**, **security group**, **key pair**, and launches the **EC2 instance**.\n- The EC2 instance runs **Squid**, configured by **squid.conf**, and is reachable on **3128** only from the allowed client IP (defense-in-depth: SG + Squid ACL)."
}