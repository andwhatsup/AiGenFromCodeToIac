{
  "aws_architecture_description": "## Proposed high-level AWS architecture (lean, secure, scalable)\n\n### 1) Networking / isolation\n- **One VPC** spanning **2+ Availability Zones** for high availability.\n- **Public subnets (2+)**: host only internet-facing components.\n  - **Application Load Balancer (ALB)** with listeners.\n- **Private subnets (2+)**: host application and database.\n  - **ECS tasks** (API containers) run here with no public IPs.\n  - **RDS PostgreSQL** runs here (not publicly accessible).\n- **NAT Gateways (1 per AZ recommended)** so ECS tasks can reach AWS APIs and pull images/patches without being publicly reachable.\n- **VPC endpoints** (Interface/Gateway) to reduce NAT dependency and keep traffic private where possible:\n  - Interface endpoints: **ECR (api + dkr)**, **CloudWatch Logs**, **Secrets Manager**.\n  - Gateway endpoint: **S3** (used by ECR under the hood and generally useful).\n\n### 2) Ingress / routing\n- **Route 53** hosts the public DNS name (e.g., `api.example.com`) pointing to the ALB.\n- **ACM certificate** for TLS.\n- **ALB** terminates HTTPS (443) and forwards to an **ECS target group**.\n  - Health checks configured to a lightweight endpoint (e.g., `/health`).\n\n### 3) Compute (API runtime)\n- **Amazon ECS on Fargate** (recommended for simplicity) running the Go REST API container.\n  - **ECS Cluster** + **ECS Service** with desired count >= 2 across AZs.\n  - **Task Definition** references the image in **ECR**.\n  - **Autoscaling** based on CPU/Memory and/or ALB request count.\n- **Logging**: container stdout/stderr to **CloudWatch Logs**.\n\n### 4) Data layer (PostgreSQL)\n- **Amazon RDS for PostgreSQL** in private subnets.\n  - **Multi-AZ** for production (single-AZ acceptable for dev).\n  - Storage autoscaling enabled where appropriate.\n  - Automated backups + retention.\n- **Security group rules**:\n  - RDS SG allows inbound **5432** only from the ECS task SG.\n\n### 5) Secrets and configuration\n- **AWS Secrets Manager** stores DB credentials (and optionally the full DSN components).\n- ECS task uses **task role** permissions to read the specific secret.\n- Inject secret into the container as environment variables (or fetch at runtime) to construct `PG_DSN`.\n\n### 6) Container registry + CI/CD\n- **Amazon ECR repository** stores the built Docker image.\n- **GitHub Actions** continues to:\n  - Build and push image to ECR.\n  - Update ECS service (new task definition revision) to roll out the new image.\n- Use **OIDC federation** from GitHub to AWS (recommended) to avoid long-lived AWS keys.\n\n### 7) Observability, security, and operations\n- **CloudWatch Alarms** for:\n  - ALB 5XX, target unhealthy count.\n  - ECS service CPU/memory high, task count anomalies.\n  - RDS CPU/storage/connection count.\n- **AWS CloudTrail** enabled for audit.\n- **AWS WAF** on the ALB (optional but recommended for internet-facing APIs) with managed rule groups.\n- **KMS** keys for encryption at rest (Secrets Manager, RDS, CloudWatch Logs if desired).\n\n---\n\n## Request flow summary\n1. Client resolves `api.example.com` in Route 53 → ALB.\n2. Client connects via HTTPS → ALB (ACM cert).\n3. ALB forwards to ECS Fargate tasks in private subnets.\n4. API reads DB credentials from Secrets Manager (via task role) and connects to RDS PostgreSQL.\n\n---\n\n## Minimal deployment strategy\n- Start with: VPC (2 AZ), ALB, ECS Fargate service (2 tasks), RDS Postgres (single-AZ for dev / Multi-AZ for prod), Secrets Manager, ECR, CloudWatch logs/alarms.\n- Add WAF + VPC endpoints + Multi-AZ RDS as you move toward production hardening.",
  "aws_resources": [
    "Amazon VPC",
    "VPC subnets (public, private across 2+ AZs)",
    "Route tables (public/private)",
    "Internet Gateway (IGW)",
    "NAT Gateway(s) + Elastic IP(s)",
    "Security Groups (ALB SG, ECS task SG, RDS SG)",
    "Network ACLs (optional; default NACLs acceptable initially)",
    "VPC Endpoints: Interface (Secrets Manager, ECR api, ECR dkr, CloudWatch Logs)",
    "VPC Endpoint: Gateway (S3)",
    "Elastic Load Balancing: Application Load Balancer (ALB)",
    "ALB Target Group",
    "ALB Listener (HTTPS :443)",
    "AWS Certificate Manager (ACM) certificate",
    "Amazon Route 53 hosted zone + DNS record (A/AAAA alias to ALB)",
    "Amazon ECS Cluster",
    "Amazon ECS Service",
    "AWS Fargate capacity (via ECS service launch type)",
    "ECS Task Definition",
    "Amazon ECR repository",
    "Amazon RDS for PostgreSQL DB instance (or Aurora PostgreSQL if you choose)",
    "RDS Subnet Group",
    "RDS Parameter Group (optional)",
    "RDS Option Group (optional)",
    "AWS Secrets Manager secret (DB credentials / DSN parts)",
    "AWS KMS key(s) (for Secrets Manager and RDS encryption)",
    "IAM Roles: ECS Task Execution Role",
    "IAM Roles: ECS Task Role (SecretsManager read)",
    "IAM policy attachments for ECR pull, CloudWatch Logs, Secrets Manager access",
    "IAM Role for GitHub Actions via OIDC (recommended) + IAM policy for ECR push and ECS deploy",
    "Amazon CloudWatch Log Group(s)",
    "Amazon CloudWatch Alarms (ALB/ECS/RDS)",
    "AWS CloudTrail trail",
    "AWS WAFv2 Web ACL (optional) + association to ALB"
  ]
}