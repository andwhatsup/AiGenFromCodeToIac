{
  "aws_architecture_description": "## Proposed high-level AWS architecture (lean, secure, scalable)\n\n### 1) Networking foundation\n- Create a dedicated **VPC** spanning **2 Availability Zones** for high availability.\n- In each AZ:\n  - **Public subnets**: only for internet-facing load balancers and NAT.\n  - **Private subnets**: for EKS worker nodes (and any internal services).\n- Add **Internet Gateway** for public subnets and **NAT Gateways** (one per AZ, or one to reduce cost) so private workloads can pull images, reach SonarQube, and access AWS APIs without being publicly reachable.\n\n### 2) Kubernetes runtime on AWS (EKS)\n- Use **Amazon EKS** to run the existing Kubernetes manifests (Deployment + Service).\n- Run workloads on **EKS Managed Node Groups** (EC2-based) in private subnets.\n- Deploy the React SPA container as a Kubernetes **Deployment** with:\n  - Multiple replicas across AZs.\n  - Readiness/liveness probes.\n  - Resource requests/limits.\n  - Optional **Horizontal Pod Autoscaler** (HPA) based on CPU/Memory.\n\n### 3) Ingress / load balancing / TLS\n- Replace (or augment) the raw `Service type: LoadBalancer` pattern with the **AWS Load Balancer Controller** so Kubernetes can provision an **Application Load Balancer (ALB)** via an **Ingress** resource.\n  - This gives better L7 routing, health checks, and tighter integration with TLS.\n- Terminate TLS at the ALB using **AWS Certificate Manager (ACM)**.\n- Use **Route 53** to host the public DNS record (e.g., `app.example.com`) pointing to the ALB.\n- Optionally add **AWS WAF** on the ALB for baseline web protections.\n\n### 4) Container image registry\n- Use **Amazon ECR** as the OCI registry (instead of Docker Hub) to keep artifacts in AWS and simplify IAM-based pulls.\n- EKS nodes pull images from ECR using node IAM permissions.\n\n### 5) CI/CD execution (self-hosted GitHub Actions runner on AWS)\n- Keep the current model (self-hosted runner) but harden it:\n  - Run the runner on a dedicated **EC2 instance** in a private subnet.\n  - Use **SSM Session Manager** for admin access (no inbound SSH).\n  - Attach an **IAM role** allowing push to ECR and (optionally) deploy to EKS.\n- The GitHub Actions workflow:\n  1. Builds the Docker image on the runner.\n  2. Pushes the image to **ECR**.\n  3. Updates the EKS deployment (e.g., `kubectl set image` or GitOps).\n  4. Runs SonarQube scan and enforces quality gate.\n\n### 6) SonarQube hosting (AWS-managed where possible)\nTwo common options; pick based on how “lean” you want to be:\n\n**Option A (leaner ops): SonarQube on ECS Fargate**\n- Run SonarQube as a container on **ECS Fargate** behind an internal ALB.\n- Store SonarQube database in **Amazon RDS for PostgreSQL**.\n- Store plugins/attachments (if needed) on **EFS** mounted to the task.\n\n**Option B (simplest to mirror current README): SonarQube on EC2**\n- Run SonarQube on a dedicated **EC2 instance** in private subnets.\n- Use **RDS for PostgreSQL** for the database.\n- Use **EBS** for local persistence (or EFS if you want shared storage).\n\nEither way, restrict access so only the runner (and optionally VPN/admin) can reach SonarQube.\n\n### 7) Observability, security, and operations\n- **CloudWatch Container Insights** (or Prometheus/Grafana) for EKS metrics.\n- **CloudWatch Logs** for application logs (via Fluent Bit/CloudWatch agent).\n- **AWS CloudTrail** for account audit.\n- **AWS Config** (optional) for compliance drift.\n- **Secrets**:\n  - Store sensitive values (Sonar token, registry creds if any) in **AWS Secrets Manager**.\n  - Sync to Kubernetes using **External Secrets Operator** (optional) or inject at deploy time.\n- **Encryption**:\n  - Use **KMS** keys for EKS secrets encryption, ECR, RDS, EBS/EFS.\n\n### 8) End-to-end request flow\n1. User hits `https://app.example.com`.\n2. Route 53 resolves to the public ALB.\n3. ALB terminates TLS (ACM cert) and forwards to EKS Ingress target group.\n4. Traffic reaches Kubernetes Service/Pods serving the React static assets.\n\n### 9) Build/deploy flow\n1. Developer pushes to GitHub.\n2. GitHub Actions dispatches job to the self-hosted runner on EC2.\n3. Runner builds image and pushes to ECR.\n4. Runner triggers deployment update on EKS.\n5. Runner runs SonarQube scan against SonarQube endpoint in the VPC.\n\n---\n\n## Notes specific to a React SPA\nIf the container is only serving static files, the most cost/performance-lean alternative is **S3 + CloudFront** (no Kubernetes needed). However, since your repo already includes Kubernetes manifests and a containerized runtime, the above keeps your current operational model while improving AWS integration (ECR + EKS + ALB Ingress).\n",
  "aws_resources": [
    "VPC",
    "Public subnets (2 AZs)",
    "Private subnets (2 AZs)",
    "Internet Gateway",
    "NAT Gateway(s)",
    "Route tables (public/private)",
    "Security Groups (ALB, EKS nodes, runner, SonarQube, RDS)",
    "Network ACLs (optional)",
    "VPC Endpoints (recommended: ECR api, ECR dkr, S3 gateway, CloudWatch Logs, SSM/EC2Messages/SSMMessages)",
    "Amazon EKS Cluster",
    "EKS Managed Node Group(s) (EC2)",
    "EKS IAM Roles (cluster role, node role)",
    "OIDC provider for EKS (IRSA)",
    "AWS Load Balancer Controller (installed in EKS)",
    "Kubernetes Ingress (ALB-backed)",
    "Application Load Balancer (provisioned by controller)",
    "ACM Certificate",
    "Route 53 Hosted Zone + Record (A/AAAA alias to ALB)",
    "AWS WAF Web ACL (optional)",
    "Amazon ECR Repository",
    "IAM policy/role for CI to push to ECR",
    "EC2 Instance for self-hosted GitHub Actions runner",
    "IAM Instance Profile for runner EC2",
    "AWS Systems Manager (SSM) managed instance configuration",
    "CloudWatch Logs log groups (EKS/ALB/EC2)",
    "CloudWatch metrics/alarms (ALB 5xx, target health, node CPU, etc.)",
    "CloudTrail",
    "KMS Key(s) (EKS secrets encryption, RDS, EBS/EFS, Secrets Manager)",
    "Secrets Manager (Sonar token, GitHub runner registration token handling, etc.)",
    "SonarQube hosting (choose one): ECS Cluster + Fargate Service + internal ALB OR EC2 Instance",
    "Amazon RDS for PostgreSQL (SonarQube DB)",
    "RDS Subnet Group",
    "RDS Parameter Group (optional)",
    "EBS volumes (if SonarQube on EC2) or EFS File System + Mount Targets (if SonarQube on ECS/EKS)",
    "S3 bucket for ALB access logs (optional)"
  ]
}