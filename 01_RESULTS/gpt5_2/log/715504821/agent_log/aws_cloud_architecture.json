{
  "aws_architecture_description": "## Proposed high-level AWS architecture (lean, secure, scalable)\n\n### 1) Container runtime: ECS on Fargate (recommended)\n- Package the FastAPI app as the existing Docker image (Uvicorn on **port 8080**).\n- Run it as an **Amazon ECS Service** on **AWS Fargate** (no EC2 management).\n- Use **ECS Service Auto Scaling** (target tracking on CPU/Memory and/or ALB request count) to scale tasks horizontally.\n\n### 2) Networking: VPC with public + private subnets across 2 AZs\n- Create a dedicated **VPC** spanning **at least 2 Availability Zones**.\n- **Public subnets**: host the internet-facing entry point (ALB) and NAT Gateways.\n- **Private subnets**: host the Fargate tasks (no public IPs).\n- Provide outbound internet for tasks (for dependency calls, etc.) via **NAT Gateway** (ideally one per AZ for resilience; you can start with one for cost). AWS explicitly supports/encourages private-subnet + NAT patterns for ECS/Fargate. ([docs.aws.amazon.com](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/networking-outbound.html?utm_source=openai))\n\n### 3) Ingress: Application Load Balancer (HTTPS) → ECS service\n- Deploy an **internet-facing Application Load Balancer (ALB)** in the public subnets.\n- Terminate **TLS** at the ALB using **ACM** certificates.\n- ALB forwards traffic to an **ECS target group** on **HTTP:8080**.\n- Configure ALB health checks to a FastAPI health endpoint (e.g., `/health`) and ensure the container listens on `0.0.0.0:8080`.\n\n### 4) Container image registry: Amazon ECR\n- Store built images in **Amazon ECR**.\n- Add an **ECR lifecycle policy** to expire old images and control storage growth. ([docs.aws.amazon.com](https://docs.aws.amazon.com/AmazonECR/latest/userguide/lp_creation.html?utm_source=openai))\n\n### 5) Secrets & configuration\n- Store runtime secrets (if/when added) in **AWS Secrets Manager** (or SSM Parameter Store for non-secrets).\n- Inject into the ECS task as environment variables / secrets.\n\n### 6) Observability & security controls\n- Send application logs to **CloudWatch Logs** via the ECS task log driver.\n- Enable **CloudWatch Alarms** (ALB 5XX, target health, ECS CPU/Memory, etc.).\n- Use **AWS X-Ray** optionally later if you add tracing.\n- Use least-privilege **IAM roles**:\n  - **ECS task execution role** (pull from ECR, write logs).\n  - **ECS task role** (only if the app needs AWS APIs).\n\n### 7) CI/CD with GitHub Actions (secure auth)\n- Keep GitHub Actions building and pushing the container image to ECR, then running Terraform.\n- Prefer **GitHub OIDC → AWS STS AssumeRoleWithWebIdentity** instead of long-lived access keys. The official AWS credentials action recommends OIDC. ([github.com](https://github.com/aws-actions/configure-aws-credentials?utm_source=openai))\n\n### Notes / optional future extensions\n- If you later add a database: place it in private subnets (RDS/Aurora) with security-group-only access from ECS.\n- If you later add static assets: S3 + CloudFront.\n\n---\n\n## Request flow\n1. Client → **ALB (HTTPS :443)**\n2. ALB → **ECS/Fargate tasks (HTTP :8080)** in private subnets\n3. Tasks → outbound via **NAT** (or via VPC endpoints if you add them)\n\n---\n\n## Deployment strategy\n- Terraform provisions: VPC, ALB, ECS cluster/service, ECR, IAM, logging.\n- GitHub Actions:\n  1) lint/test\n  2) build Docker image\n  3) push to ECR\n  4) terraform apply\n  5) update ECS service (new task definition revision referencing the new image tag/digest)\n",
  "aws_resources": [
    "Amazon VPC (1)",
    "VPC CIDR block (e.g., 10.0.0.0/16)",
    "Subnets: Public (2, across 2 AZs)",
    "Subnets: Private (2, across 2 AZs)",
    "Internet Gateway (1)",
    "Route Tables (public + private) and routes",
    "Elastic IPs (1-2, for NAT Gateway)",
    "NAT Gateway (1 for cost-optimized dev; 2 for HA prod)",
    "Security Groups: ALB SG, ECS Tasks SG",
    "(Optional) Network ACLs (custom only if required)",
    "(Optional) VPC Flow Logs",
    "Application Load Balancer (ALB)",
    "ALB Listener: HTTPS :443",
    "ALB Listener Rule(s) / default action",
    "ALB Target Group (HTTP :8080, target type = ip)",
    "ACM Certificate (for your domain)",
    "Route 53 Hosted Zone + DNS record (A/AAAA alias to ALB)",
    "Amazon ECS Cluster",
    "ECS Task Definition (Fargate, container port 8080, health check, log config)",
    "ECS Service (desired count, deployment config)",
    "ECS Service Auto Scaling (target tracking policies)",
    "Amazon ECR Repository",
    "ECR Lifecycle Policy",
    "IAM Role: ECS Task Execution Role",
    "IAM Role: ECS Task Role (only if app calls AWS APIs)",
    "IAM Policy attachments for the above roles (least privilege)",
    "CloudWatch Log Group(s) for application logs",
    "CloudWatch Metrics/Alarms (ALB 5XX, target health, ECS CPU/Memory, etc.)",
    "AWS Secrets Manager secret(s) (optional, if/when secrets exist)",
    "SSM Parameter Store parameters (optional, for non-secret config)",
    "IAM OIDC Provider for GitHub (in AWS account)",
    "IAM Role for GitHub Actions (trust policy for OIDC, permissions for ECR + Terraform-managed resources)"
  ]
}