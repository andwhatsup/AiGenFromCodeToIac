{
  "aws_architecture_description": "### Target outcome\nDeploy a single Amazon Linux 2 EC2 instance running **Nginx + PHP-FPM**, provisioned by **Terraform** (executed from a Docker Compose “terraform runner” container). Access to the instance is restricted via **Security Group allowlisting** (runner’s public IP), matching the repo’s intent.\n\n---\n\n## High-level AWS architecture\n\n### 1) Networking foundation (VPC)\n- **VPC**: Use an existing VPC (as your README implies) or create a dedicated one.\n- **Public subnet (at least 1 AZ)**: The EC2 web server is internet-facing, so it should live in a public subnet.\n- **Internet Gateway + route table**: Public subnet routes `0.0.0.0/0` to the IGW.\n- **(Optional but recommended) 2nd public subnet in another AZ**: Not required for a single instance, but useful if you later add an ALB/ASG.\n\n### 2) Compute (EC2 web server)\n- **EC2 instance (Amazon Linux 2)**:\n  - Launched into the public subnet.\n  - Associated with a **Security Group** that only allows:\n    - **HTTP (80)** from your allowlisted IP/CIDR (or from the internet if you explicitly want it public).\n    - **HTTPS (443)** if you terminate TLS on-instance.\n    - **SSH (22)** only from the allowlisted runner IP/CIDR (needed for Terraform remote-exec/provisioning).\n  - Provisioning:\n    - Terraform uses the mounted **SSH private key** to connect and run `nginx-php-inst.sh`.\n    - The script installs/configures **Nginx** and **PHP-FPM**.\n\n### 3) Identity & access (IAM)\n- **Terraform execution identity** (outside AWS):\n  - Your runner container uses mounted `~/.aws` credentials and `AWS_PROFILE`.\n  - Best practice is to use a **dedicated IAM role/user** with least-privilege permissions for the Terraform state and the resources it manages.\n- **EC2 instance role (IAM Instance Profile)**:\n  - Keep minimal by default.\n  - Add permissions only if the instance must access AWS services (e.g., S3 for assets/log shipping, SSM for management).\n\n### 4) Key management / access\n- **EC2 Key Pair**:\n  - Terraform should reference an EC2 key pair (public key) that corresponds to your private key used by the runner.\n  - Store the private key securely outside AWS (do not commit it); consider rotating to SSM Session Manager later to remove inbound SSH.\n\n### 5) Observability & operations\n- **CloudWatch Logs (recommended)**:\n  - Install/configure the CloudWatch Agent (or use a lightweight approach) to ship Nginx/PHP logs to CloudWatch Logs.\n- **CloudWatch metrics/alarms**:\n  - Basic alarms for instance health (CPU, status checks) to detect failures.\n\n### 6) (Optional) DNS + TLS\n- If you want a friendly domain and HTTPS:\n  - **Route 53** hosted zone + record pointing to the instance public IP (or later to an ALB).\n  - **ACM certificate** if you later terminate TLS at an ALB/CloudFront. (ACM is not used directly on an EC2 instance unless you export/import certs yourself; many teams use Let’s Encrypt on-instance for single-node setups.)\n\n---\n\n## AWS resources to be created\n\n### Core networking\n- Amazon VPC\n- Public Subnet (1+)\n- Internet Gateway (IGW)\n- Route Table (public) + Route (0.0.0.0/0 -> IGW)\n- Route Table Association(s)\n\n### Security\n- Security Group (web/ssh allowlist)\n- (Optional) Network ACLs (if you need explicit subnet-level controls; otherwise default NACLs are fine)\n\n### Compute\n- EC2 Instance (Amazon Linux 2)\n- EC2 Key Pair (public key registered in AWS)\n- Elastic IP (optional; only if you need a stable public IP)\n\n### IAM\n- IAM policy/role/user for Terraform execution (least privilege)\n- IAM Role for EC2 + IAM Instance Profile (optional but recommended for CloudWatch/SSM)\n\n### Monitoring / logging\n- CloudWatch Log Group(s) (e.g., nginx access/error, php-fpm logs) (recommended)\n- CloudWatch Alarms (EC2 status check failed, CPU high, disk if using agent)\n\n### Optional: DNS / TLS\n- Route 53 Hosted Zone + Record Set(s) (optional)\n- AWS Certificate Manager (ACM) certificate (optional; mainly if you add an ALB/CloudFront)\n\n### Optional: Remote management without SSH\n- AWS Systems Manager (SSM) enablement (requires instance role permissions)\n- SSM Parameter Store (optional, for configuration/secrets)\n\n---\n\nIf you tell me whether the VPC is truly “existing” (and its subnet IDs), and whether the site must be publicly accessible (0.0.0.0/0) vs only from the runner IP, I can tighten the resource list to exactly what Terraform should manage vs what it should reference as data sources.",
  "aws_resources": [
    "Amazon VPC",
    "Public Subnet (1+ Availability Zones)",
    "Internet Gateway (IGW)",
    "Public Route Table",
    "Route (0.0.0.0/0 -> IGW)",
    "Route Table Association(s)",
    "Security Group (allowlisted inbound for SSH/HTTP/HTTPS)",
    "EC2 Instance (Amazon Linux 2)",
    "EC2 Key Pair",
    "Elastic IP (optional)",
    "IAM User/Role for Terraform execution (least privilege)",
    "IAM Policy for Terraform execution",
    "IAM Role for EC2 (optional)",
    "IAM Instance Profile (optional)",
    "Amazon CloudWatch Log Group(s) (recommended)",
    "Amazon CloudWatch Alarms (recommended)",
    "Amazon Route 53 Hosted Zone (optional)",
    "Route 53 Record Set(s) (optional)",
    "AWS Certificate Manager (ACM) Certificate (optional)",
    "AWS Systems Manager (SSM) enablement (optional)",
    "SSM Parameter Store parameters (optional)"
  ]
}