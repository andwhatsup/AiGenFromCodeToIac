{
  "aws_architecture_description": "### Target deployment model (lean + AWS-native)\nDeploy the Flask container to **Amazon EKS** (managed Kubernetes) and expose it through an **AWS Load Balancer Controller–managed load balancer** created from your Kubernetes `Service`/`Ingress` manifests. This matches your repo’s current `kubectl apply` workflow and existing AWS LB annotations.\n\n---\n\n## 1) Runtime architecture (request path)\n1. **End users** resolve your app’s DNS name in **Route 53**.\n2. Traffic terminates with TLS on an **AWS Application Load Balancer (ALB)** (recommended for HTTP/HTTPS). The ALB is provisioned and managed by **AWS Load Balancer Controller** running in the EKS cluster. (If you keep a `Service type=LoadBalancer` with NLB annotations, you can also run with NLB; ALB is typically better for L7 HTTP features.) ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/best-practices/load-balancing.html?utm_source=openai))\n3. The ALB forwards to a Kubernetes target group (via controller-managed resources) and then to the **Kubernetes Service**, which routes to the **Flask pods** (2+ replicas).\n4. Pods run on **EKS managed node groups** (EC2) in **private subnets**; only the load balancer is internet-facing in public subnets.\n\n### Scaling & availability\n- Use **Kubernetes HPA** (CPU/memory) to scale pods beyond the current `replicas=2`.\n- Use **Cluster Autoscaler** (or Karpenter) to scale worker nodes.\n- Multi-AZ: place subnets and node groups across **at least 2–3 AZs**.\n\n---\n\n## 2) Networking & security baseline\n### VPC layout\n- **One VPC** with:\n  - **Public subnets** (ALB, NAT Gateways)\n  - **Private subnets** (EKS nodes/pods)\n- **NAT Gateways** allow private nodes to pull images and reach external services without being publicly reachable.\n\n### Traffic controls\n- **Security groups**:\n  - ALB SG: allow inbound 443 from the internet; egress to EKS node/pod targets.\n  - Node SG: allow inbound only from ALB SG on the app port; restrict other inbound.\n- **AWS WAF** (optional but recommended for internet-facing apps) attached to ALB.\n\n---\n\n## 3) Container image supply chain\n### Registry\n- Prefer **Amazon ECR** as the primary registry (keeps runtime pulls inside AWS IAM + VPC endpoints if desired). You can still publish to GHCR/DockerHub, but ECR simplifies permissions and operations.\n\n### Image pull auth\n- If using ECR: nodes/pods pull using node IAM role (or IRSA if needed).\n- If using GHCR/DockerHub: store credentials in **AWS Secrets Manager** and sync to Kubernetes as an imagePullSecret (or use External Secrets).\n\n---\n\n## 4) CI/CD on AWS (minimal changes)\nYou currently have both GitHub Actions and Jenkins. A lean AWS approach:\n- Keep **GitHub Actions** for build/test/scan and push to **ECR**.\n- Use **Argo CD** (GitOps) or keep **Jenkins** to run `kubectl apply`.\n\nIf you keep Jenkins:\n- Run Jenkins on **ECS/Fargate** or **EKS** (or EC2) and store state in **EFS**.\n- Store secrets (kubeconfig, tokens, registry creds) in **Secrets Manager**.\n\n---\n\n## 5) Observability & operations\n- **CloudWatch Container Insights** for EKS metrics/logs.\n- **Fluent Bit** (or AWS for Fluent Bit) as a DaemonSet to ship pod logs to CloudWatch Logs.\n- **AWS X-Ray** (optional) for tracing if you instrument Flask.\n- **CloudTrail** + **AWS Config** for audit/compliance.\n\n---\n\n## 6) EKS-specific controllers/add-ons (needed for your manifests)\n- **AWS Load Balancer Controller** to reconcile Kubernetes `Service`/`Ingress` into AWS load balancers and support the `service.beta.kubernetes.io/aws-load-balancer-*` annotation model you’re using. ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/best-practices/load-balancing.html?utm_source=openai))\n- **IRSA (IAM Roles for Service Accounts)** so the controller can call AWS APIs without node-wide permissions. ([kubernetes-sigs.github.io](https://kubernetes-sigs.github.io/aws-load-balancer-controller/latest/guide/service/annotations/?utm_source=openai))\n- **Amazon VPC CNI** (standard) for pod networking; required for certain target modes (e.g., NLB IP targets). ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/userguide/network-load-balancing.html?utm_source=openai))\n\n---\n\n# AWS resources to provision\n## Networking\n- Amazon VPC\n- Public subnets (2–3 AZs)\n- Private subnets (2–3 AZs)\n- Internet Gateway\n- NAT Gateways (1 per AZ recommended) + Elastic IPs\n- Route tables (public/private) + routes\n- VPC Endpoints (optional but recommended):\n  - Gateway endpoint: S3\n  - Interface endpoints: ECR (api + dkr), CloudWatch Logs, STS, Secrets Manager\n\n## Compute / Kubernetes\n- Amazon EKS Cluster\n- EKS Managed Node Group(s) (EC2) OR EKS Fargate profiles (if suitable)\n- EKS Add-ons:\n  - VPC CNI add-on\n  - CoreDNS\n  - kube-proxy\n- (Optional) Cluster Autoscaler or Karpenter\n- (Optional) Kubernetes Metrics Server (for HPA)\n\n## Load balancing / ingress\n- AWS Load Balancer Controller (deployed via Helm, but requires AWS resources below)\n- Application Load Balancer (provisioned dynamically by controller)\n- Target Groups (provisioned dynamically)\n- Listener(s) : 443 (and 80 redirect if desired)\n- AWS Certificate Manager (ACM) certificate for your domain\n- Amazon Route 53 hosted zone + DNS records (A/AAAA alias to ALB)\n- (Optional) AWS WAFv2 Web ACL + association to ALB\n\n## Container registry\n- Amazon ECR repository (private)\n- (Optional) ECR lifecycle policy\n- (Optional) ECR enhanced scanning configuration (as desired)\n\n## IAM / security\n- IAM roles:\n  - EKS cluster role\n  - EKS node group role\n  - IRSA roles for:\n    - aws-load-balancer-controller service account\n    - external-dns (if used)\n    - fluent-bit/log shipping (if used)\n- IAM OIDC provider for the EKS cluster (for IRSA)\n- Security Groups:\n  - ALB security group\n  - Worker node security group\n- AWS KMS key(s) (optional but recommended):\n  - EKS secrets encryption\n  - Secrets Manager encryption (if custom key)\n\n## Secrets & configuration\n- AWS Secrets Manager secrets (registry creds if not using ECR; app secrets)\n- AWS Systems Manager Parameter Store (optional for non-secret config)\n\n## Logging/monitoring/audit\n- Amazon CloudWatch Log Groups (EKS control plane logs, application logs)\n- CloudWatch Container Insights (enablement)\n- AWS CloudTrail\n- AWS Config (optional)\n- Amazon SNS topic (optional) for alarms\n- CloudWatch Alarms (ALB 5xx, latency, target health, node CPU, etc.)\n\n## CI/CD (choose one path)\n- If keeping GitHub Actions only (minimal AWS):\n  - IAM role for GitHub OIDC federation (to push to ECR and optionally deploy)\n- If running Jenkins on AWS:\n  - ECS cluster + Fargate service (or EKS namespace) for Jenkins controller/agents\n  - EFS file system (for Jenkins home) + mount targets\n  - ALB (internal) for Jenkins UI (optional)\n  - Secrets Manager for Jenkins credentials\n\n---\n\n## Notes on your existing Kubernetes Service annotations\nYour repo references `service.beta.kubernetes.io/aws-load-balancer-*` annotations. These are supported by the **AWS Load Balancer Controller** and are the right direction versus the legacy in-tree service controller. ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/best-practices/load-balancing.html?utm_source=openai))\n\nIf you want ALB specifically for HTTP/HTTPS, consider moving from `Service type=LoadBalancer` to an **Ingress** resource (still managed by AWS Load Balancer Controller). If you prefer to keep `Service type=LoadBalancer`, you’ll typically end up with an **NLB** (still valid), controlled by annotations such as `aws-load-balancer-type` and target type settings. ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/userguide/auto-configure-nlb.html?utm_source=openai))",
  "aws_resources": [
    "Amazon VPC",
    "Public Subnets (multi-AZ)",
    "Private Subnets (multi-AZ)",
    "Internet Gateway",
    "NAT Gateways",
    "Elastic IPs (for NAT)",
    "Route Tables (public/private)",
    "VPC Endpoints (S3 Gateway; ECR/Logs/STS/Secrets Manager Interface - optional)",
    "Security Groups (ALB SG, Node SG)",
    "Amazon EKS Cluster",
    "EKS Managed Node Group(s) (EC2) or EKS Fargate Profiles",
    "EKS Add-ons (VPC CNI, CoreDNS, kube-proxy)",
    "Kubernetes Metrics Server (optional)",
    "Horizontal Pod Autoscaler (K8s object)",
    "Cluster Autoscaler or Karpenter (optional)",
    "AWS Load Balancer Controller (on EKS)",
    "Application Load Balancer (provisioned by controller)",
    "Target Groups (provisioned by controller)",
    "ALB Listeners (443, optional 80->443 redirect)",
    "AWS Certificate Manager (ACM) Certificate",
    "Amazon Route 53 Hosted Zone and DNS Records",
    "AWS WAFv2 Web ACL (optional)",
    "Amazon ECR Repository",
    "ECR Lifecycle Policy (optional)",
    "IAM OIDC Provider for EKS (IRSA)",
    "IAM Roles (EKS cluster role, node role, IRSA roles for controllers)",
    "AWS KMS Key (optional; EKS secrets encryption)",
    "AWS Secrets Manager (app secrets, registry creds if needed)",
    "AWS Systems Manager Parameter Store (optional)",
    "Amazon CloudWatch Log Groups",
    "CloudWatch Container Insights",
    "CloudWatch Alarms",
    "Amazon SNS Topic (optional for alarm notifications)",
    "AWS CloudTrail",
    "AWS Config (optional)",
    "GitHub OIDC IAM Role for CI to push to ECR (if using GitHub Actions)",
    "(Optional) Jenkins on AWS: Amazon ECS/Fargate or EKS resources",
    "(Optional) Amazon EFS (for Jenkins persistent storage)"
  ]
}