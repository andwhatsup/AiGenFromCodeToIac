{
  "aws_architecture_description": "## Proposed high-level AWS architecture (lean, secure, scalable)\n\n### 1) Event-driven serverless pipeline (core runtime)\n- **Amazon EventBridge Scheduler / EventBridge Rule (cron)** triggers the system on a fixed cadence (e.g., every N minutes).\n- The rule invokes **Lambda: `check_announcement` (Go)**.\n  - `check_announcement` reads configuration (e.g., announcement sources / routing rules) from **SSM Parameter Store**.\n  - It reads/writes the current “announcement state” in **Amazon DynamoDB** (single table).\n  - When it writes changes, **DynamoDB Streams** emits change records.\n- **Lambda: `send_notification` (Go)** is invoked via **DynamoDB Streams** (Lambda event source mapping).\n  - It transforms stream records into a normalized “notification event”.\n  - It publishes the event to an **Amazon SNS Topic** (fan-out / decoupling).\n- **Lambda: `send_telegram_notification` (Go)** is invoked via an **SNS subscription**.\n  - It fetches the **Telegram bot token** and per-channel/per-announcement routing config from **SSM Parameter Store**.\n  - It calls the **Telegram Bot API** over HTTPS to deliver messages to Telegram channels/chats.\n\n### 2) Networking / egress\n- By default, keep Lambdas **out of a VPC** (simplest + avoids NAT cost/complexity) since they only need to reach AWS public endpoints (DynamoDB, SNS, SSM) and Telegram over the public internet.\n- If you later require VPC attachment (e.g., private endpoints, compliance), add:\n  - Private subnets + **NAT Gateway** for Telegram egress, and/or\n  - VPC endpoints (Interface/Gateway) for DynamoDB/SSM/SNS to reduce public egress.\n\n### 3) Security and secrets\n- Use **IAM least privilege** with a dedicated execution role per Lambda:\n  - `check_announcement`: DynamoDB read/write, SSM GetParameter(s), CloudWatch Logs.\n  - `send_notification`: DynamoDB Streams read, SNS Publish, CloudWatch Logs.\n  - `send_telegram_notification`: SSM GetParameter(s), CloudWatch Logs.\n- Store the Telegram token as **SSM Parameter Store SecureString** encrypted with a **customer-managed KMS key** (recommended) and restrict decrypt access to only the Telegram Lambda role.\n\n### 4) Reliability, throttling, and failure handling\n- Configure **Lambda reserved concurrency** (especially for `send_telegram_notification`) to avoid Telegram rate-limit bursts.\n- Use **Lambda DLQ / on-failure destination** (SNS or SQS) for `send_telegram_notification` to capture failed deliveries for replay/inspection.\n- Use **CloudWatch Alarms** on Lambda errors/throttles and DynamoDB stream iterator age.\n\n### 5) Observability\n- **CloudWatch Log Groups** per Lambda with retention set (e.g., 14–30 days).\n- **CloudWatch Metrics + Alarms** for:\n  - Lambda Errors, Duration, Throttles\n  - DynamoDB ConsumedCapacity (if provisioned) / throttles\n  - DynamoDB Streams IteratorAge (for `send_notification`)\n- Optional: **AWS X-Ray** tracing enabled on Lambdas for end-to-end latency debugging.\n\n### 6) CI/CD and IaC\n- Continue using **Terraform** (already present) to provision all infrastructure.\n- Build/package Go Lambdas in CI (GitLab CI) and deploy via Terraform (zip artifacts or S3-backed artifacts).\n\n---\n\n## End-to-end flow (deployment view)\n1. EventBridge cron → invokes `check_announcement`.\n2. `check_announcement` → reads config from SSM → reads/writes state in DynamoDB.\n3. DynamoDB Streams → triggers `send_notification`.\n4. `send_notification` → publishes to SNS topic.\n5. SNS → invokes `send_telegram_notification`.\n6. `send_telegram_notification` → reads token/config from SSM → calls Telegram Bot API.\n7. All Lambdas → CloudWatch Logs/metrics (and optional X-Ray).\n",
  "aws_resources": [
    "AWS Lambda (3 functions: check_announcement, send_notification, send_telegram_notification)",
    "AWS IAM Roles (one execution role per Lambda)",
    "AWS IAM Policies (least-privilege policies for DynamoDB, DynamoDB Streams, SNS, SSM, CloudWatch Logs, KMS decrypt)",
    "AWS Lambda Permissions (resource-based permissions for EventBridge->Lambda and SNS->Lambda)",
    "Amazon EventBridge Rule (scheduled cron trigger)",
    "Amazon EventBridge Target (rule target: check_announcement Lambda)",
    "Amazon DynamoDB Table (announcement state)",
    "Amazon DynamoDB Streams (enabled on the table)",
    "AWS Lambda Event Source Mapping (DynamoDB Streams -> send_notification)",
    "Amazon SNS Topic (notifications fan-out)",
    "Amazon SNS Subscription (topic -> send_telegram_notification Lambda)",
    "AWS Systems Manager Parameter Store Parameters (Telegram token, chat/channel IDs, routing config)",
    "AWS Key Management Service (KMS) Key (CMK for encrypting SecureString parameters)",
    "Amazon CloudWatch Log Groups (one per Lambda, with retention policy)",
    "Amazon CloudWatch Alarms (Lambda errors/throttles, DynamoDB stream iterator age, optional DynamoDB throttles)",
    "AWS X-Ray (optional: tracing configuration for Lambdas)",
    "Lambda Dead-Letter Queue or Destinations (recommended for send_telegram_notification failures: SQS queue or SNS topic)"
  ]
}