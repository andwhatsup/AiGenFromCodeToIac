{
  "aws_architecture_description": "### Target architecture (lean, production-ready)\n\n#### 1) Networking / isolation\n- Deploy into a dedicated **VPC** spanning **2+ Availability Zones**.\n- Create **public subnets** (for internet-facing ingress) and **private subnets** (for application and database).\n- Place the **Application Load Balancer (ALB)** in public subnets.\n- Run **ECS tasks (Strapi containers)** in private subnets with **no public IPs**.\n- Place **RDS MySQL** in private subnets (DB subnet group across AZs).\n- Provide outbound internet access for ECS tasks (to pull images from Docker Hub and fetch npm/native deps at build time if needed) via **NAT Gateway(s)** in public subnets.\n\n#### 2) Ingress / TLS\n- Use an **ALB** to terminate **HTTPS (443)** with an **ACM certificate**.\n- ALB forwards to an **ECS target group** on **HTTP 1337**.\n- Optionally add **AWS WAF** on the ALB for basic L7 protections (rate limiting, common rule sets) if the admin UI is internet-exposed.\n\n#### 3) Compute (Strapi)\n- Run Strapi as a container on **Amazon ECS (Fargate)**:\n  - **ECS Cluster** + **ECS Service** (desired count 1+; scale out as needed).\n  - **Task Definition** exposes container port **1337**.\n  - Configure **health checks** via ALB target group (e.g., `/` or a dedicated health endpoint if you add one).\n  - Use **ECS Service Auto Scaling** based on CPU/memory (and optionally ALB request count).\n\n#### 4) Data layer (MySQL)\n- Use **Amazon RDS for MySQL** in private subnets.\n  - Prefer **Multi-AZ** for production availability.\n  - Enable automated backups and set retention.\n  - Restrict inbound DB access to only the ECS task security group on **3306**.\n\n#### 5) Secrets & configuration\n- Store sensitive Strapi settings in **AWS Secrets Manager** (or SSM Parameter Store for non-secrets):\n  - `APP_KEYS`, `API_TOKEN_SALT`, `ADMIN_JWT_SECRET`, `JWT_SECRET`, DB username/password, etc.\n- Inject secrets into the ECS task definition as environment variables.\n- Use **KMS** to encrypt secrets (default AWS-managed key is acceptable; CMK if you need tighter control).\n\n#### 6) Persistent file/media storage (recommended for Strapi)\n- Strapi commonly needs shared storage for uploads across tasks. Use **S3** for media uploads.\n  - Configure Strapi upload provider for S3.\n  - Use an **IAM task role** granting least-privilege access to the specific S3 bucket/prefix.\n\n#### 7) Observability\n- Send container logs to **CloudWatch Logs** (one log group per service/environment).\n- Use **CloudWatch Alarms** for:\n  - ALB 5XX / target 5XX\n  - ECS service running task count < desired\n  - RDS CPU, free storage, connections\n- Enable **ALB access logs** to S3 (optional but useful for audit/debug).\n\n#### 8) CI/CD and infrastructure state\n- Keep the existing pipeline that builds/pushes the image to **Docker Hub**.\n- Terraform remote state:\n  - Use an **S3 bucket** for state and a **DynamoDB table** for state locking.\n- (Optional improvement) Migrate images to **ECR** to avoid external registry dependency and simplify IAM auth, but it’s not required given your current workflow.\n\n---\n\n### Traffic flow\n1. End users/editors access `https://<domain>` → **ALB (443)**.\n2. ALB forwards to **ECS Fargate tasks** on **HTTP 1337** in private subnets.\n3. Strapi reads/writes content in **RDS MySQL (3306)**.\n4. Strapi stores uploaded media in **S3**.\n5. Logs/metrics go to **CloudWatch**; alarms notify via **SNS**.\n\n---\n\n### Security posture (key points)\n- Only ALB is public; ECS and RDS are private.\n- Security groups enforce:\n  - ALB → ECS on 1337\n  - ECS → RDS on 3306\n- Secrets never stored in images; pulled at runtime from Secrets Manager.\n- Encrypt data at rest (RDS, S3, Secrets Manager) and in transit (HTTPS).\n",
  "aws_resources": [
    "Amazon VPC",
    "VPC subnets (public, private across 2+ AZs)",
    "Internet Gateway (IGW)",
    "NAT Gateway(s)",
    "Route tables (public/private) and routes",
    "VPC endpoints (optional but recommended: S3 Gateway Endpoint; Secrets Manager/SSM/CloudWatch Logs Interface Endpoints)",
    "Security Groups (ALB SG, ECS tasks SG, RDS SG)",
    "AWS Certificate Manager (ACM) certificate",
    "Application Load Balancer (ALB)",
    "ALB Target Group",
    "ALB Listeners (HTTPS 443, optional HTTP 80 redirect)",
    "Amazon Route 53 hosted zone + DNS records (if using AWS DNS)",
    "Amazon ECS Cluster",
    "ECS Task Definition (Fargate)",
    "ECS Service",
    "ECS Service Auto Scaling (target tracking policies)",
    "IAM Role: ECS Task Execution Role",
    "IAM Role: ECS Task Role (app permissions, e.g., S3 + secrets read)",
    "IAM Policies (least privilege for logs, secrets, S3)",
    "Amazon RDS for MySQL DB instance (or Aurora MySQL-compatible, if chosen)",
    "RDS DB Subnet Group",
    "RDS Parameter Group (as needed)",
    "RDS Option Group (as needed)",
    "AWS Secrets Manager secrets (Strapi APP_KEYS/JWT secrets/salts, DB creds)",
    "AWS KMS key (optional CMK; otherwise AWS-managed keys)",
    "Amazon S3 bucket for Strapi uploads/media",
    "S3 bucket policy / public access block configuration",
    "Amazon CloudWatch Logs Log Group(s)",
    "Amazon CloudWatch Alarms",
    "Amazon SNS Topic (alarm notifications)",
    "AWS WAF Web ACL (optional, attached to ALB)",
    "S3 bucket for Terraform remote state",
    "DynamoDB table for Terraform state locking"
  ]
}