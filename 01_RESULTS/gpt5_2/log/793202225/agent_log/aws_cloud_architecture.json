{
  "aws_architecture_description": "### Proposed high-level AWS architecture (Axum Rust API on ECS Fargate with CodeDeploy blue/green)\n\n#### 1) Networking / edge\n- **VPC across 2+ Availability Zones** for high availability.\n- **Public subnets** host an **internet-facing Application Load Balancer (ALB)**.\n- **Private subnets** host the **ECS Fargate tasks** (no public IPs).\n- **NAT Gateways (one per AZ)** allow private tasks to pull images from ECR and send logs/metrics to AWS APIs without being publicly reachable.\n- **VPC endpoints** (Interface/Gateway) can be added to reduce NAT cost and tighten egress (commonly: ECR API/DKR, CloudWatch Logs, S3).\n\n#### 2) Traffic flow (runtime)\n- Client → **ALB HTTPS listener (443)**.\n- ALB forwards to **two target groups** (Blue and Green) that point to the ECS service tasks on **container port 3000**.\n- **Health checks** are configured on the target groups (e.g., `GET /health` or `/` depending on the app) to ensure only healthy tasks receive traffic.\n\n#### 3) Compute (ECS on Fargate)\n- **ECS Cluster** (Fargate capacity).\n- **ECS Task Definition** for the Axum container:\n  - Container listens on **0.0.0.0:3000**.\n  - Uses **awslogs** log driver to send stdout/stderr (including `tracing` output) to CloudWatch Logs.\n  - Task execution role grants pull from ECR + write logs.\n- **ECS Service** runs desired count across AZs in private subnets.\n  - Service is configured for **CodeDeploy blue/green** (ECS deployment controller = CodeDeploy).\n\n#### 4) Container registry\n- **Amazon ECR repository** stores the built Docker image.\n- Image scanning and lifecycle policies can be enabled to keep the repo lean and improve security posture.\n\n#### 5) Deployments (blue/green)\n- **AWS CodeDeploy Application (ECS)** + **Deployment Group**:\n  - Integrates with the ALB listener and the **Blue/Green target groups**.\n  - On deployment, CodeDeploy creates/updates a new task set (green), validates health checks, then shifts traffic (e.g., `CodeDeployDefault.ECSAllAtOnce` as your repo indicates).\n  - Optional: add pre/post-traffic hooks (Lambda) later if you need smoke tests.\n\n#### 6) Observability and operations\n- **CloudWatch Logs log group** (e.g., `/ecs/axum-service`) with retention policy.\n- **CloudWatch metrics/alarms** for ALB (5xx, target response time), ECS (CPU/memory), and deployment failures.\n- **AWS CloudTrail** for audit logging of API activity.\n\n#### 7) Security baseline\n- **ACM certificate** for TLS on the ALB.\n- **Security groups**:\n  - ALB SG: inbound 443 from the internet; outbound to ECS tasks on 3000.\n  - ECS task SG: inbound 3000 only from ALB SG; outbound restricted as needed.\n- **IAM roles**:\n  - ECS task execution role (ECR pull + CloudWatch Logs write).\n  - ECS task role (app permissions; keep minimal—none if the app doesn’t call AWS APIs).\n  - CodeDeploy service role.\n\n---\n\n### Notes / assumptions\n- No database, cache, or queue is implied by the provided artifacts; the architecture stays lean and focuses on ECS + ALB + CodeDeploy.\n- If the service must be publicly reachable only via a custom domain, add Route 53 records pointing to the ALB.\n",
  "aws_resources": [
    "Amazon VPC",
    "Public subnets (2+ AZs)",
    "Private subnets (2+ AZs)",
    "Internet Gateway (IGW)",
    "NAT Gateways (1 per AZ)",
    "Public route tables + routes",
    "Private route tables + routes",
    "VPC Security Groups (ALB SG, ECS Task SG)",
    "AWS WAF (optional, if you want L7 protection on ALB)",
    "Application Load Balancer (internet-facing)",
    "ALB HTTPS Listener (443)",
    "ALB Target Group (Blue)",
    "ALB Target Group (Green)",
    "ACM Certificate (for TLS on ALB)",
    "Amazon ECS Cluster",
    "ECS Task Definition (Fargate)",
    "ECS Service (Fargate, CodeDeploy deployment controller)",
    "ECS Capacity Provider (Fargate/Fargate Spot if used)",
    "Amazon ECR Repository",
    "ECR Lifecycle Policy",
    "ECR Image Scanning configuration",
    "Amazon CloudWatch Logs Log Group (/ecs/axum-service)",
    "CloudWatch Alarms (ALB 5xx/latency, ECS CPU/memory, deployment alarms)",
    "AWS CodeDeploy Application (ECS)",
    "AWS CodeDeploy Deployment Group (blue/green, traffic shifting)",
    "IAM Role: ECS Task Execution Role",
    "IAM Role: ECS Task Role (least privilege; optional if app needs AWS access)",
    "IAM Role: CodeDeploy Service Role",
    "AWS CloudTrail (account-level trail)",
    "Amazon Route 53 Hosted Zone + Record (optional, for custom domain)",
    "VPC Endpoints: ECR API, ECR DKR, CloudWatch Logs (optional)",
    "VPC Endpoint: S3 Gateway (optional, commonly used with ECR layers via S3)"
  ]
}