{
  "aws_architecture_description": "## Proposed high-level AWS architecture (lean, production-ready)\n\n### 1) Networking foundation\n- Deploy into a dedicated **VPC** spanning **2 Availability Zones** for high availability.\n- Create **public subnets** (one per AZ) for internet-facing load balancers and **private subnets** (one per AZ) for ECS tasks.\n- Add an **Internet Gateway** for inbound/outbound internet access from public subnets.\n- Add **NAT Gateways** (one per AZ, or one to reduce cost) so ECS tasks in private subnets can reach the internet (e.g., to pull images from ECR, call external APIs).\n- Use **VPC endpoints** (Interface endpoints) for **ECR (api + dkr)** and **CloudWatch Logs** (and optionally S3 gateway endpoint) to reduce NAT traffic and keep traffic on AWS’s network.\n\n### 2) Container runtime (ECS on Fargate)\n- Use **Amazon ECS with Fargate** (recommended here since the app is a simple stateless Express API and you already have a container build).\n- Create an **ECS Cluster** (`my-ecs-cluster`).\n- Create an **ECS Task Definition**:\n  - Container image from **ECR**.\n  - Container port **3000**.\n  - Configure health check endpoint (e.g., `/health`) if available.\n  - Send logs to **CloudWatch Logs**.\n  - Set CPU/memory and desired count.\n- Create an **ECS Service** (`my-service`) running in **private subnets**, with **Service Auto Scaling** based on CPU/Memory (and optionally ALB request count).\n\n### 3) Ingress, TLS, and routing\n- Put an **Application Load Balancer (ALB)** in the **public subnets**.\n- ALB forwards traffic to an **ECS target group** on port **3000**.\n- Terminate TLS at the ALB using **AWS Certificate Manager (ACM)**.\n- Use **Route 53** to point your domain (e.g., `api.example.com`) to the ALB.\n\n### 4) Container registry\n- Create an **Amazon ECR repository** (matches your GitHub Actions workflow that pushes to `$ECR_REPOSITORY`).\n- Enable **ECR image scanning** and apply a **lifecycle policy** to expire old images.\n\n### 5) CI/CD (keep GitHub Actions, harden credentials)\n- Keep the existing **GitHub Actions** pipeline:\n  1) build Docker image\n  2) push to ECR\n  3) `aws ecs update-service --force-new-deployment`\n- Replace long-lived access keys with **GitHub OIDC → AWS IAM Role** (recommended):\n  - GitHub assumes an IAM role with least-privilege permissions to push to ECR and update the ECS service.\n\n### 6) Security controls\n- **Security Groups**:\n  - ALB SG: allow inbound 443 (and optionally 80 for redirect) from the internet; outbound to ECS tasks.\n  - ECS Tasks SG: allow inbound **3000 only from ALB SG**; outbound as needed.\n- **IAM**:\n  - ECS **task execution role** to pull from ECR and write logs.\n  - ECS **task role** for app AWS API access (only if needed).\n- **Secrets**:\n  - Store runtime secrets in **AWS Secrets Manager** (or SSM Parameter Store) and inject into the task definition.\n\n### 7) Observability\n- **CloudWatch Logs** for application logs.\n- **CloudWatch metrics/alarms** for:\n  - ALB 5XX, target health, latency\n  - ECS service CPU/memory, task count\n- **AWS X-Ray** (optional) for tracing if you add instrumentation.\n\n### 8) Deployment strategy\n- Use **rolling deployments** (ECS default) with:\n  - minimum healthy percent / maximum percent tuned for safe rollouts.\n- Optionally enable **ECS deployment circuit breaker** (rollback on failed deployments).\n\n---\n\n## AWS resources to provision\n\n### Networking\n- Amazon VPC\n- Subnets (Public x2, Private x2)\n- Route Tables (public + private) and route associations\n- Internet Gateway\n- NAT Gateway(s) + Elastic IP(s)\n- VPC Endpoints:\n  - Interface: com.amazonaws.<region>.ecr.api\n  - Interface: com.amazonaws.<region>.ecr.dkr\n  - Interface: com.amazonaws.<region>.logs\n  - (Optional) Gateway: com.amazonaws.<region>.s3\n- (Optional) AWS WAF Web ACL (attached to ALB)\n\n### Load balancing / DNS / TLS\n- Elastic Load Balancing: Application Load Balancer\n- ALB Target Group\n- ALB Listeners (443, and optional 80→443 redirect)\n- AWS Certificate Manager (ACM) certificate\n- Amazon Route 53 hosted zone + DNS record (A/AAAA alias to ALB)\n\n### Compute (containers)\n- Amazon ECS Cluster (my-ecs-cluster)\n- ECS Task Definition (Fargate)\n- ECS Service (my-service)\n- ECS Service Auto Scaling target + scaling policies\n\n### Container registry\n- Amazon ECR Repository ($ECR_REPOSITORY)\n- ECR Lifecycle Policy\n- (Optional) ECR enhanced scanning configuration (where applicable)\n\n### IAM / Security\n- IAM Role: ECS Task Execution Role\n- IAM Role: ECS Task Role (only if app needs AWS API access)\n- IAM Policy attachments for ECR pull + CloudWatch Logs\n- IAM Role for GitHub Actions via OIDC (recommended)\n- IAM OIDC Identity Provider for GitHub (if not already configured)\n- Security Groups (ALB SG, ECS Tasks SG)\n\n### Secrets / configuration\n- AWS Secrets Manager secrets (as needed)\n- (Optional) SSM Parameter Store parameters (non-secret config)\n\n### Observability\n- CloudWatch Log Group(s) for ECS task logs\n- CloudWatch Alarms (ALB + ECS)\n- (Optional) AWS X-Ray resources (sampling rules/groups) if enabled\n\n### Optional (only if you need persistent storage later)\n- Amazon S3 bucket(s) for uploads/static assets\n- Amazon RDS (PostgreSQL/MySQL) + subnet group + security group (if a database is introduced)\n\nIf you tell me whether you want a public API (internet-facing) vs internal-only, and whether you have a domain name already, I can tighten the resource list and security group rules accordingly.",
  "aws_resources": [
    "Amazon VPC",
    "Public Subnets (2 AZs)",
    "Private Subnets (2 AZs)",
    "Route Tables (public/private) + route associations",
    "Internet Gateway",
    "NAT Gateway(s) + Elastic IP(s)",
    "VPC Interface Endpoints: ECR (api, dkr), CloudWatch Logs",
    "(Optional) VPC Gateway Endpoint: S3",
    "Application Load Balancer (ALB)",
    "ALB Target Group",
    "ALB Listeners (443, optional 80 redirect)",
    "AWS Certificate Manager (ACM) certificate",
    "Amazon Route 53 hosted zone + DNS records (ALIAS to ALB)",
    "Amazon ECS Cluster (my-ecs-cluster)",
    "ECS Task Definition (Fargate)",
    "ECS Service (my-service)",
    "ECS Service Auto Scaling target + scaling policies",
    "Amazon ECR Repository ($ECR_REPOSITORY)",
    "ECR Lifecycle Policy",
    "IAM Role: ECS Task Execution Role",
    "IAM Role: ECS Task Role (optional)",
    "IAM OIDC Provider for GitHub (recommended)",
    "IAM Role for GitHub Actions (assume-role via OIDC)",
    "Security Groups (ALB SG, ECS Tasks SG)",
    "AWS Secrets Manager (optional, for runtime secrets)",
    "CloudWatch Log Group(s)",
    "CloudWatch Alarms",
    "(Optional) AWS WAF Web ACL",
    "(Optional) AWS X-Ray"
  ]
}