{"format_version":"1.2","terraform_version":"1.13.5","variables":{"aws_region":{"value":"eu-west-1"},"cloudfront_price_class":{"value":"PriceClass_100"},"create_route53_records":{"value":false},"domain_name":{"value":""},"enable_cicd":{"value":false},"enable_cloudfront_logs":{"value":false},"enable_codepipeline":{"value":false},"enable_waf":{"value":true},"environment":{"value":"dev"},"github_branch":{"value":"main"},"github_owner":{"value":""},"github_repo":{"value":""},"github_token_secret_arn":{"value":""},"hosted_zone_id":{"value":""},"project_name":{"value":"amazon-clone"},"react_app_env":{"value":{}}},"planned_values":{"outputs":{"cloudfront_distribution_id":{"sensitive":false},"cloudfront_domain_name":{"sensitive":false},"s3_bucket_name":{"sensitive":false,"type":"string","value":"amazon-clone-dev-spa-000000000000"},"site_url":{"sensitive":false}},"root_module":{"resources":[{"address":"aws_cloudfront_cache_policy.caching_optimized","mode":"managed","type":"aws_cloudfront_cache_policy","name":"caching_optimized","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"comment":"Fallback for AWS managed policy Managed-CachingOptimized","default_ttl":86400,"max_ttl":31536000,"min_ttl":0,"name":"amazon-clone-dev-caching-optimized","parameters_in_cache_key_and_forwarded_to_origin":[{"cookies_config":[{"cookie_behavior":"none","cookies":[]}],"enable_accept_encoding_brotli":true,"enable_accept_encoding_gzip":true,"headers_config":[{"header_behavior":"none","headers":[]}],"query_strings_config":[{"query_string_behavior":"none","query_strings":[]}]}]},"sensitive_values":{"parameters_in_cache_key_and_forwarded_to_origin":[{"cookies_config":[{"cookies":[]}],"headers_config":[{"headers":[]}],"query_strings_config":[{"query_strings":[]}]}]}},{"address":"aws_cloudfront_distribution.spa","mode":"managed","type":"aws_cloudfront_distribution","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":1,"values":{"aliases":null,"comment":"amazon-clone-dev SPA","custom_error_response":[{"error_caching_min_ttl":0,"error_code":403,"response_code":200,"response_page_path":"/index.html"},{"error_caching_min_ttl":0,"error_code":404,"response_code":200,"response_page_path":"/index.html"}],"default_cache_behavior":[{"allowed_methods":["GET","HEAD","OPTIONS"],"cached_methods":["GET","HEAD","OPTIONS"],"compress":true,"field_level_encryption_id":null,"forwarded_values":[],"function_association":[],"lambda_function_association":[],"min_ttl":0,"realtime_log_config_arn":null,"smooth_streaming":null,"target_origin_id":"s3-spa-origin","viewer_protocol_policy":"redirect-to-https"}],"default_root_object":"index.html","enabled":true,"http_version":"http2","is_ipv6_enabled":true,"logging_config":[],"ordered_cache_behavior":[],"origin":[{"connection_attempts":3,"connection_timeout":10,"custom_header":[],"custom_origin_config":[],"origin_id":"s3-spa-origin","origin_path":"","origin_shield":[],"s3_origin_config":[],"vpc_origin_config":[]}],"origin_group":[],"price_class":"PriceClass_100","restrictions":[{"geo_restriction":[{"restriction_type":"none"}]}],"retain_on_delete":false,"staging":false,"tags":null,"tags_all":{"Environment":"dev","ManagedBy":"terraform","Project":"amazon-clone"},"viewer_certificate":[{"acm_certificate_arn":null,"cloudfront_default_certificate":true,"iam_certificate_id":null,"minimum_protocol_version":"TLSv1.2_2021","ssl_support_method":null}],"wait_for_deployment":true},"sensitive_values":{"custom_error_response":[{},{}],"default_cache_behavior":[{"allowed_methods":[false,false,false],"cached_methods":[false,false,false],"forwarded_values":[],"function_association":[],"grpc_config":[],"lambda_function_association":[],"trusted_key_groups":[],"trusted_signers":[]}],"logging_config":[],"ordered_cache_behavior":[],"origin":[{"custom_header":[],"custom_origin_config":[],"origin_shield":[],"s3_origin_config":[],"vpc_origin_config":[]}],"origin_group":[],"restrictions":[{"geo_restriction":[{"locations":[]}]}],"tags_all":{},"trusted_key_groups":[],"trusted_signers":[],"viewer_certificate":[{}]}},{"address":"aws_cloudfront_origin_access_control.spa","mode":"managed","type":"aws_cloudfront_origin_access_control","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"OAC for private S3 origin","name":"amazon-clone-dev-oac","origin_access_control_origin_type":"s3","signing_behavior":"always","signing_protocol":"sigv4"},"sensitive_values":{}},{"address":"aws_cloudfront_origin_request_policy.cors_s3origin","mode":"managed","type":"aws_cloudfront_origin_request_policy","name":"cors_s3origin","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"comment":"Fallback for AWS managed policy Managed-CORS-S3Origin","cookies_config":[{"cookie_behavior":"none","cookies":[]}],"headers_config":[{"header_behavior":"whitelist","headers":[{"items":["Access-Control-Request-Headers","Access-Control-Request-Method","Origin"]}]}],"name":"amazon-clone-dev-cors-s3origin","query_strings_config":[{"query_string_behavior":"none","query_strings":[]}]},"sensitive_values":{"cookies_config":[{"cookies":[]}],"headers_config":[{"headers":[{"items":[false,false,false]}]}],"query_strings_config":[{"query_strings":[]}]}},{"address":"aws_cloudfront_response_headers_policy.security_headers","mode":"managed","type":"aws_cloudfront_response_headers_policy","name":"security_headers","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"comment":null,"cors_config":[],"custom_headers_config":[],"name":"amazon-clone-dev-security-headers","remove_headers_config":[],"security_headers_config":[{"content_security_policy":[],"content_type_options":[{"override":true}],"frame_options":[{"frame_option":"DENY","override":true}],"referrer_policy":[{"override":true,"referrer_policy":"strict-origin-when-cross-origin"}],"strict_transport_security":[{"access_control_max_age_sec":63072000,"include_subdomains":true,"override":true,"preload":true}],"xss_protection":[{"mode_block":true,"override":true,"protection":true,"report_uri":null}]}],"server_timing_headers_config":[]},"sensitive_values":{"cors_config":[],"custom_headers_config":[],"remove_headers_config":[],"security_headers_config":[{"content_security_policy":[],"content_type_options":[{}],"frame_options":[{}],"referrer_policy":[{}],"strict_transport_security":[{}],"xss_protection":[{}]}],"server_timing_headers_config":[]}},{"address":"aws_s3_bucket.spa","mode":"managed","type":"aws_s3_bucket","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"bucket":"amazon-clone-dev-spa-000000000000","force_destroy":false,"tags":null,"tags_all":{"Environment":"dev","ManagedBy":"terraform","Project":"amazon-clone"},"timeouts":null},"sensitive_values":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags_all":{},"versioning":[],"website":[]}},{"address":"aws_s3_bucket_ownership_controls.spa","mode":"managed","type":"aws_s3_bucket_ownership_controls","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"rule":[{"object_ownership":"BucketOwnerEnforced"}]},"sensitive_values":{"rule":[{}]}},{"address":"aws_s3_bucket_policy.spa","mode":"managed","type":"aws_s3_bucket_policy","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"sensitive_values":{}},{"address":"aws_s3_bucket_public_access_block.spa","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"block_public_acls":true,"block_public_policy":true,"ignore_public_acls":true,"restrict_public_buckets":true},"sensitive_values":{}},{"address":"aws_s3_bucket_server_side_encryption_configuration.spa","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"expected_bucket_owner":null,"rule":[{"apply_server_side_encryption_by_default":[{"kms_master_key_id":"","sse_algorithm":"AES256"}],"bucket_key_enabled":null}]},"sensitive_values":{"rule":[{"apply_server_side_encryption_by_default":[{}]}]}},{"address":"aws_s3_bucket_versioning.spa","mode":"managed","type":"aws_s3_bucket_versioning","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"expected_bucket_owner":null,"mfa":null,"versioning_configuration":[{"status":"Enabled"}]},"sensitive_values":{"versioning_configuration":[{}]}},{"address":"aws_wafv2_web_acl.this[0]","mode":"managed","type":"aws_wafv2_web_acl","name":"this","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"association_config":[],"captcha_config":[],"challenge_config":[],"custom_response_body":[],"data_protection_config":[],"default_action":[{"allow":[{"custom_request_handling":[]}],"block":[]}],"description":null,"name":"amazon-clone-dev-waf","rule":[{"action":[],"captcha_config":[],"challenge_config":[],"name":"AWSManagedRulesCommonRuleSet","override_action":[{"count":[],"none":[{}]}],"priority":1,"rule_label":[],"statement":[{"and_statement":[],"asn_match_statement":[],"byte_match_statement":[],"geo_match_statement":[],"ip_set_reference_statement":[],"label_match_statement":[],"managed_rule_group_statement":[{"managed_rule_group_configs":[],"name":"AWSManagedRulesCommonRuleSet","rule_action_override":[],"scope_down_statement":[],"vendor_name":"AWS","version":""}],"not_statement":[],"or_statement":[],"rate_based_statement":[],"regex_match_statement":[],"regex_pattern_set_reference_statement":[],"rule_group_reference_statement":[],"size_constraint_statement":[],"sqli_match_statement":[],"xss_match_statement":[]}],"visibility_config":[{"cloudwatch_metrics_enabled":true,"metric_name":"AWSManagedRulesCommonRuleSet","sampled_requests_enabled":true}]}],"rule_json":null,"scope":"CLOUDFRONT","tags":null,"tags_all":{"Environment":"dev","ManagedBy":"terraform","Project":"amazon-clone"},"token_domains":null,"visibility_config":[{"cloudwatch_metrics_enabled":true,"metric_name":"amazon-clone-dev-waf","sampled_requests_enabled":true}]},"sensitive_values":{"association_config":[],"captcha_config":[],"challenge_config":[],"custom_response_body":[],"data_protection_config":[],"default_action":[{"allow":[{"custom_request_handling":[]}],"block":[]}],"rule":[{"action":[],"captcha_config":[],"challenge_config":[],"override_action":[{"count":[],"none":[{}]}],"rule_label":[],"statement":[{"and_statement":[],"asn_match_statement":[],"byte_match_statement":[],"geo_match_statement":[],"ip_set_reference_statement":[],"label_match_statement":[],"managed_rule_group_statement":[{"managed_rule_group_configs":[],"rule_action_override":[],"scope_down_statement":[]}],"not_statement":[],"or_statement":[],"rate_based_statement":[],"regex_match_statement":[],"regex_pattern_set_reference_statement":[],"rule_group_reference_statement":[],"size_constraint_statement":[],"sqli_match_statement":[],"xss_match_statement":[]}],"visibility_config":[{}]}],"tags_all":{},"visibility_config":[{}]}},{"address":"data.aws_iam_policy_document.spa_bucket","mode":"data","type":"aws_iam_policy_document","name":"spa_bucket","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["s3:GetObject"],"condition":[{"test":"StringEquals","values":[null],"variable":"AWS:SourceArn"}],"effect":null,"not_actions":null,"not_principals":[],"not_resources":null,"principals":[{"identifiers":["cloudfront.amazonaws.com"],"type":"Service"}],"resources":[null],"sid":"AllowCloudFrontServicePrincipalReadOnly"}],"version":null},"sensitive_values":{"statement":[{"actions":[false],"condition":[{"values":[false]}],"not_principals":[],"principals":[{"identifiers":[false]}],"resources":[false]}]}}]}},"resource_changes":[{"address":"data.aws_iam_policy_document.spa_bucket","mode":"data","type":"aws_iam_policy_document","name":"spa_bucket","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["read"],"before":null,"after":{"override_json":null,"override_policy_documents":null,"policy_id":null,"source_json":null,"source_policy_documents":null,"statement":[{"actions":["s3:GetObject"],"condition":[{"test":"StringEquals","values":[null],"variable":"AWS:SourceArn"}],"effect":null,"not_actions":null,"not_principals":[],"not_resources":null,"principals":[{"identifiers":["cloudfront.amazonaws.com"],"type":"Service"}],"resources":[null],"sid":"AllowCloudFrontServicePrincipalReadOnly"}],"version":null},"after_unknown":{"id":true,"json":true,"minified_json":true,"statement":[{"actions":[false],"condition":[{"values":[true]}],"not_principals":[],"principals":[{"identifiers":[false]}],"resources":[true]}]},"before_sensitive":false,"after_sensitive":{"statement":[{"actions":[false],"condition":[{"values":[false]}],"not_principals":[],"principals":[{"identifiers":[false]}],"resources":[false]}]}},"action_reason":"read_because_config_unknown"},{"address":"aws_cloudfront_cache_policy.caching_optimized","mode":"managed","type":"aws_cloudfront_cache_policy","name":"caching_optimized","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"comment":"Fallback for AWS managed policy Managed-CachingOptimized","default_ttl":86400,"max_ttl":31536000,"min_ttl":0,"name":"amazon-clone-dev-caching-optimized","parameters_in_cache_key_and_forwarded_to_origin":[{"cookies_config":[{"cookie_behavior":"none","cookies":[]}],"enable_accept_encoding_brotli":true,"enable_accept_encoding_gzip":true,"headers_config":[{"header_behavior":"none","headers":[]}],"query_strings_config":[{"query_string_behavior":"none","query_strings":[]}]}]},"after_unknown":{"arn":true,"etag":true,"id":true,"parameters_in_cache_key_and_forwarded_to_origin":[{"cookies_config":[{"cookies":[]}],"headers_config":[{"headers":[]}],"query_strings_config":[{"query_strings":[]}]}]},"before_sensitive":false,"after_sensitive":{"parameters_in_cache_key_and_forwarded_to_origin":[{"cookies_config":[{"cookies":[]}],"headers_config":[{"headers":[]}],"query_strings_config":[{"query_strings":[]}]}]}}},{"address":"aws_cloudfront_distribution.spa","mode":"managed","type":"aws_cloudfront_distribution","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"aliases":null,"comment":"amazon-clone-dev SPA","custom_error_response":[{"error_caching_min_ttl":0,"error_code":403,"response_code":200,"response_page_path":"/index.html"},{"error_caching_min_ttl":0,"error_code":404,"response_code":200,"response_page_path":"/index.html"}],"default_cache_behavior":[{"allowed_methods":["GET","HEAD","OPTIONS"],"cached_methods":["GET","HEAD","OPTIONS"],"compress":true,"field_level_encryption_id":null,"forwarded_values":[],"function_association":[],"lambda_function_association":[],"min_ttl":0,"realtime_log_config_arn":null,"smooth_streaming":null,"target_origin_id":"s3-spa-origin","viewer_protocol_policy":"redirect-to-https"}],"default_root_object":"index.html","enabled":true,"http_version":"http2","is_ipv6_enabled":true,"logging_config":[],"ordered_cache_behavior":[],"origin":[{"connection_attempts":3,"connection_timeout":10,"custom_header":[],"custom_origin_config":[],"origin_id":"s3-spa-origin","origin_path":"","origin_shield":[],"s3_origin_config":[],"vpc_origin_config":[]}],"origin_group":[],"price_class":"PriceClass_100","restrictions":[{"geo_restriction":[{"restriction_type":"none"}]}],"retain_on_delete":false,"staging":false,"tags":null,"tags_all":{"Environment":"dev","ManagedBy":"terraform","Project":"amazon-clone"},"viewer_certificate":[{"acm_certificate_arn":null,"cloudfront_default_certificate":true,"iam_certificate_id":null,"minimum_protocol_version":"TLSv1.2_2021","ssl_support_method":null}],"wait_for_deployment":true},"after_unknown":{"arn":true,"caller_reference":true,"continuous_deployment_policy_id":true,"custom_error_response":[{},{}],"default_cache_behavior":[{"allowed_methods":[false,false,false],"cache_policy_id":true,"cached_methods":[false,false,false],"default_ttl":true,"forwarded_values":[],"function_association":[],"grpc_config":true,"lambda_function_association":[],"max_ttl":true,"origin_request_policy_id":true,"response_headers_policy_id":true,"trusted_key_groups":true,"trusted_signers":true}],"domain_name":true,"etag":true,"hosted_zone_id":true,"id":true,"in_progress_validation_batches":true,"last_modified_time":true,"logging_config":[],"ordered_cache_behavior":[],"origin":[{"custom_header":[],"custom_origin_config":[],"domain_name":true,"origin_access_control_id":true,"origin_shield":[],"s3_origin_config":[],"vpc_origin_config":[]}],"origin_group":[],"restrictions":[{"geo_restriction":[{"locations":true}]}],"status":true,"tags_all":{},"trusted_key_groups":true,"trusted_signers":true,"viewer_certificate":[{}],"web_acl_id":true},"before_sensitive":false,"after_sensitive":{"custom_error_response":[{},{}],"default_cache_behavior":[{"allowed_methods":[false,false,false],"cached_methods":[false,false,false],"forwarded_values":[],"function_association":[],"grpc_config":[],"lambda_function_association":[],"trusted_key_groups":[],"trusted_signers":[]}],"logging_config":[],"ordered_cache_behavior":[],"origin":[{"custom_header":[],"custom_origin_config":[],"origin_shield":[],"s3_origin_config":[],"vpc_origin_config":[]}],"origin_group":[],"restrictions":[{"geo_restriction":[{"locations":[]}]}],"tags_all":{},"trusted_key_groups":[],"trusted_signers":[],"viewer_certificate":[{}]}}},{"address":"aws_cloudfront_origin_access_control.spa","mode":"managed","type":"aws_cloudfront_origin_access_control","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"description":"OAC for private S3 origin","name":"amazon-clone-dev-oac","origin_access_control_origin_type":"s3","signing_behavior":"always","signing_protocol":"sigv4"},"after_unknown":{"arn":true,"etag":true,"id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_cloudfront_origin_request_policy.cors_s3origin","mode":"managed","type":"aws_cloudfront_origin_request_policy","name":"cors_s3origin","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"comment":"Fallback for AWS managed policy Managed-CORS-S3Origin","cookies_config":[{"cookie_behavior":"none","cookies":[]}],"headers_config":[{"header_behavior":"whitelist","headers":[{"items":["Access-Control-Request-Headers","Access-Control-Request-Method","Origin"]}]}],"name":"amazon-clone-dev-cors-s3origin","query_strings_config":[{"query_string_behavior":"none","query_strings":[]}]},"after_unknown":{"arn":true,"cookies_config":[{"cookies":[]}],"etag":true,"headers_config":[{"headers":[{"items":[false,false,false]}]}],"id":true,"query_strings_config":[{"query_strings":[]}]},"before_sensitive":false,"after_sensitive":{"cookies_config":[{"cookies":[]}],"headers_config":[{"headers":[{"items":[false,false,false]}]}],"query_strings_config":[{"query_strings":[]}]}}},{"address":"aws_cloudfront_response_headers_policy.security_headers","mode":"managed","type":"aws_cloudfront_response_headers_policy","name":"security_headers","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"comment":null,"cors_config":[],"custom_headers_config":[],"name":"amazon-clone-dev-security-headers","remove_headers_config":[],"security_headers_config":[{"content_security_policy":[],"content_type_options":[{"override":true}],"frame_options":[{"frame_option":"DENY","override":true}],"referrer_policy":[{"override":true,"referrer_policy":"strict-origin-when-cross-origin"}],"strict_transport_security":[{"access_control_max_age_sec":63072000,"include_subdomains":true,"override":true,"preload":true}],"xss_protection":[{"mode_block":true,"override":true,"protection":true,"report_uri":null}]}],"server_timing_headers_config":[]},"after_unknown":{"arn":true,"cors_config":[],"custom_headers_config":[],"etag":true,"id":true,"remove_headers_config":[],"security_headers_config":[{"content_security_policy":[],"content_type_options":[{}],"frame_options":[{}],"referrer_policy":[{}],"strict_transport_security":[{}],"xss_protection":[{}]}],"server_timing_headers_config":[]},"before_sensitive":false,"after_sensitive":{"cors_config":[],"custom_headers_config":[],"remove_headers_config":[],"security_headers_config":[{"content_security_policy":[],"content_type_options":[{}],"frame_options":[{}],"referrer_policy":[{}],"strict_transport_security":[{}],"xss_protection":[{}]}],"server_timing_headers_config":[]}}},{"address":"aws_s3_bucket.spa","mode":"managed","type":"aws_s3_bucket","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"bucket":"amazon-clone-dev-spa-000000000000","force_destroy":false,"tags":null,"tags_all":{"Environment":"dev","ManagedBy":"terraform","Project":"amazon-clone"},"timeouts":null},"after_unknown":{"acceleration_status":true,"acl":true,"arn":true,"bucket_domain_name":true,"bucket_prefix":true,"bucket_regional_domain_name":true,"cors_rule":true,"grant":true,"hosted_zone_id":true,"id":true,"lifecycle_rule":true,"logging":true,"object_lock_configuration":true,"object_lock_enabled":true,"policy":true,"region":true,"replication_configuration":true,"request_payer":true,"server_side_encryption_configuration":true,"tags_all":{},"versioning":true,"website":true,"website_domain":true,"website_endpoint":true},"before_sensitive":false,"after_sensitive":{"cors_rule":[],"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"replication_configuration":[],"server_side_encryption_configuration":[],"tags_all":{},"versioning":[],"website":[]}}},{"address":"aws_s3_bucket_ownership_controls.spa","mode":"managed","type":"aws_s3_bucket_ownership_controls","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"rule":[{"object_ownership":"BucketOwnerEnforced"}]},"after_unknown":{"bucket":true,"id":true,"rule":[{}]},"before_sensitive":false,"after_sensitive":{"rule":[{}]}}},{"address":"aws_s3_bucket_policy.spa","mode":"managed","type":"aws_s3_bucket_policy","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{},"after_unknown":{"bucket":true,"id":true,"policy":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_s3_bucket_public_access_block.spa","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"block_public_acls":true,"block_public_policy":true,"ignore_public_acls":true,"restrict_public_buckets":true},"after_unknown":{"bucket":true,"id":true},"before_sensitive":false,"after_sensitive":{}}},{"address":"aws_s3_bucket_server_side_encryption_configuration.spa","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"expected_bucket_owner":null,"rule":[{"apply_server_side_encryption_by_default":[{"kms_master_key_id":"","sse_algorithm":"AES256"}],"bucket_key_enabled":null}]},"after_unknown":{"bucket":true,"id":true,"rule":[{"apply_server_side_encryption_by_default":[{}]}]},"before_sensitive":false,"after_sensitive":{"rule":[{"apply_server_side_encryption_by_default":[{}]}]}}},{"address":"aws_s3_bucket_versioning.spa","mode":"managed","type":"aws_s3_bucket_versioning","name":"spa","provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"expected_bucket_owner":null,"mfa":null,"versioning_configuration":[{"status":"Enabled"}]},"after_unknown":{"bucket":true,"id":true,"versioning_configuration":[{"mfa_delete":true}]},"before_sensitive":false,"after_sensitive":{"versioning_configuration":[{}]}}},{"address":"aws_wafv2_web_acl.this[0]","mode":"managed","type":"aws_wafv2_web_acl","name":"this","index":0,"provider_name":"registry.terraform.io/hashicorp/aws","change":{"actions":["create"],"before":null,"after":{"association_config":[],"captcha_config":[],"challenge_config":[],"custom_response_body":[],"data_protection_config":[],"default_action":[{"allow":[{"custom_request_handling":[]}],"block":[]}],"description":null,"name":"amazon-clone-dev-waf","rule":[{"action":[],"captcha_config":[],"challenge_config":[],"name":"AWSManagedRulesCommonRuleSet","override_action":[{"count":[],"none":[{}]}],"priority":1,"rule_label":[],"statement":[{"and_statement":[],"asn_match_statement":[],"byte_match_statement":[],"geo_match_statement":[],"ip_set_reference_statement":[],"label_match_statement":[],"managed_rule_group_statement":[{"managed_rule_group_configs":[],"name":"AWSManagedRulesCommonRuleSet","rule_action_override":[],"scope_down_statement":[],"vendor_name":"AWS","version":""}],"not_statement":[],"or_statement":[],"rate_based_statement":[],"regex_match_statement":[],"regex_pattern_set_reference_statement":[],"rule_group_reference_statement":[],"size_constraint_statement":[],"sqli_match_statement":[],"xss_match_statement":[]}],"visibility_config":[{"cloudwatch_metrics_enabled":true,"metric_name":"AWSManagedRulesCommonRuleSet","sampled_requests_enabled":true}]}],"rule_json":null,"scope":"CLOUDFRONT","tags":null,"tags_all":{"Environment":"dev","ManagedBy":"terraform","Project":"amazon-clone"},"token_domains":null,"visibility_config":[{"cloudwatch_metrics_enabled":true,"metric_name":"amazon-clone-dev-waf","sampled_requests_enabled":true}]},"after_unknown":{"application_integration_url":true,"arn":true,"association_config":[],"capacity":true,"captcha_config":[],"challenge_config":[],"custom_response_body":[],"data_protection_config":[],"default_action":[{"allow":[{"custom_request_handling":[]}],"block":[]}],"id":true,"lock_token":true,"name_prefix":true,"rule":[{"action":[],"captcha_config":[],"challenge_config":[],"override_action":[{"count":[],"none":[{}]}],"rule_label":[],"statement":[{"and_statement":[],"asn_match_statement":[],"byte_match_statement":[],"geo_match_statement":[],"ip_set_reference_statement":[],"label_match_statement":[],"managed_rule_group_statement":[{"managed_rule_group_configs":[],"rule_action_override":[],"scope_down_statement":[]}],"not_statement":[],"or_statement":[],"rate_based_statement":[],"regex_match_statement":[],"regex_pattern_set_reference_statement":[],"rule_group_reference_statement":[],"size_constraint_statement":[],"sqli_match_statement":[],"xss_match_statement":[]}],"visibility_config":[{}]}],"tags_all":{},"visibility_config":[{}]},"before_sensitive":false,"after_sensitive":{"association_config":[],"captcha_config":[],"challenge_config":[],"custom_response_body":[],"data_protection_config":[],"default_action":[{"allow":[{"custom_request_handling":[]}],"block":[]}],"rule":[{"action":[],"captcha_config":[],"challenge_config":[],"override_action":[{"count":[],"none":[{}]}],"rule_label":[],"statement":[{"and_statement":[],"asn_match_statement":[],"byte_match_statement":[],"geo_match_statement":[],"ip_set_reference_statement":[],"label_match_statement":[],"managed_rule_group_statement":[{"managed_rule_group_configs":[],"rule_action_override":[],"scope_down_statement":[]}],"not_statement":[],"or_statement":[],"rate_based_statement":[],"regex_match_statement":[],"regex_pattern_set_reference_statement":[],"rule_group_reference_statement":[],"size_constraint_statement":[],"sqli_match_statement":[],"xss_match_statement":[]}],"visibility_config":[{}]}],"tags_all":{},"visibility_config":[{}]}}}],"output_changes":{"cloudfront_distribution_id":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"cloudfront_domain_name":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false},"s3_bucket_name":{"actions":["create"],"before":null,"after":"amazon-clone-dev-spa-000000000000","after_unknown":false,"before_sensitive":false,"after_sensitive":false},"site_url":{"actions":["create"],"before":null,"after_unknown":true,"before_sensitive":false,"after_sensitive":false}},"prior_state":{"format_version":"1.0","terraform_version":"1.13.5","values":{"outputs":{"s3_bucket_name":{"sensitive":false,"value":"amazon-clone-dev-spa-000000000000","type":"string"}},"root_module":{"resources":[{"address":"data.aws_caller_identity.current","mode":"data","type":"aws_caller_identity","name":"current","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"account_id":"000000000000","arn":"arn:aws:iam::000000000000:root","id":"000000000000","user_id":"AKIAIOSFODNN7EXAMPLE"},"sensitive_values":{}},{"address":"data.aws_partition.current","mode":"data","type":"aws_partition","name":"current","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"dns_suffix":"amazonaws.com","id":"aws","partition":"aws","reverse_dns_prefix":"com.amazonaws"},"sensitive_values":{}},{"address":"data.aws_region.current","mode":"data","type":"aws_region","name":"current","provider_name":"registry.terraform.io/hashicorp/aws","schema_version":0,"values":{"description":"Europe (Ireland)","endpoint":"ec2.eu-west-1.amazonaws.com","id":"eu-west-1","name":"eu-west-1"},"sensitive_values":{}}]}}},"configuration":{"provider_config":{"aws":{"name":"aws","full_name":"registry.terraform.io/hashicorp/aws","version_constraint":"~\u003e 5.0","expressions":{"default_tags":[{"tags":{"references":["var.project_name","var.environment"]}}],"region":{"references":["var.aws_region"]}}},"aws.use1":{"name":"aws","full_name":"registry.terraform.io/hashicorp/aws","alias":"use1","version_constraint":"~\u003e 5.0","expressions":{"default_tags":[{"tags":{"references":["var.project_name","var.environment"]}}],"region":{"constant_value":"us-east-1"}}}},"root_module":{"outputs":{"cloudfront_distribution_id":{"expression":{"references":["aws_cloudfront_distribution.spa.id","aws_cloudfront_distribution.spa"]},"description":"CloudFront distribution ID."},"cloudfront_domain_name":{"expression":{"references":["aws_cloudfront_distribution.spa.domain_name","aws_cloudfront_distribution.spa"]},"description":"CloudFront domain name (use this if you did not configure a custom domain)."},"s3_bucket_name":{"expression":{"references":["aws_s3_bucket.spa.bucket","aws_s3_bucket.spa"]},"description":"S3 bucket that stores the SPA assets (private)."},"site_url":{"expression":{"references":["local.use_custom_domain","var.domain_name","aws_cloudfront_distribution.spa.domain_name","aws_cloudfront_distribution.spa"]},"description":"Primary URL for the site."}},"resources":[{"address":"aws_acm_certificate.this","mode":"managed","type":"aws_acm_certificate","name":"this","provider_config_key":"aws.use1","expressions":{"domain_name":{"references":["var.domain_name"]},"validation_method":{"constant_value":"DNS"}},"schema_version":0,"count_expression":{"references":["local.use_custom_domain"]}},{"address":"aws_acm_certificate_validation.this","mode":"managed","type":"aws_acm_certificate_validation","name":"this","provider_config_key":"aws.use1","expressions":{"certificate_arn":{"references":["aws_acm_certificate.this[0].arn","aws_acm_certificate.this[0]","aws_acm_certificate.this"]},"validation_record_fqdns":{"references":["aws_route53_record.cert_validation"]}},"schema_version":0,"count_expression":{"references":["local.use_custom_domain","var.create_route53_records"]}},{"address":"aws_cloudfront_cache_policy.caching_optimized","mode":"managed","type":"aws_cloudfront_cache_policy","name":"caching_optimized","provider_config_key":"aws","expressions":{"comment":{"constant_value":"Fallback for AWS managed policy Managed-CachingOptimized"},"default_ttl":{"constant_value":86400},"max_ttl":{"constant_value":31536000},"min_ttl":{"constant_value":0},"name":{"references":["local.name_prefix"]},"parameters_in_cache_key_and_forwarded_to_origin":[{"cookies_config":[{"cookie_behavior":{"constant_value":"none"}}],"enable_accept_encoding_brotli":{"constant_value":true},"enable_accept_encoding_gzip":{"constant_value":true},"headers_config":[{"header_behavior":{"constant_value":"none"}}],"query_strings_config":[{"query_string_behavior":{"constant_value":"none"}}]}]},"schema_version":0},{"address":"aws_cloudfront_distribution.spa","mode":"managed","type":"aws_cloudfront_distribution","name":"spa","provider_config_key":"aws","expressions":{"aliases":{"references":["local.use_custom_domain","var.domain_name"]},"comment":{"references":["local.name_prefix"]},"custom_error_response":[{"error_caching_min_ttl":{"constant_value":0},"error_code":{"constant_value":403},"response_code":{"constant_value":200},"response_page_path":{"constant_value":"/index.html"}},{"error_caching_min_ttl":{"constant_value":0},"error_code":{"constant_value":404},"response_code":{"constant_value":200},"response_page_path":{"constant_value":"/index.html"}}],"default_cache_behavior":[{"allowed_methods":{"constant_value":["GET","HEAD","OPTIONS"]},"cache_policy_id":{"references":["aws_cloudfront_cache_policy.caching_optimized.id","aws_cloudfront_cache_policy.caching_optimized"]},"cached_methods":{"constant_value":["GET","HEAD","OPTIONS"]},"compress":{"constant_value":true},"origin_request_policy_id":{"references":["aws_cloudfront_origin_request_policy.cors_s3origin.id","aws_cloudfront_origin_request_policy.cors_s3origin"]},"response_headers_policy_id":{"references":["aws_cloudfront_response_headers_policy.security_headers.id","aws_cloudfront_response_headers_policy.security_headers"]},"target_origin_id":{"constant_value":"s3-spa-origin"},"viewer_protocol_policy":{"constant_value":"redirect-to-https"}}],"default_root_object":{"constant_value":"index.html"},"enabled":{"constant_value":true},"is_ipv6_enabled":{"constant_value":true},"origin":[{"domain_name":{"references":["aws_s3_bucket.spa.bucket_regional_domain_name","aws_s3_bucket.spa"]},"origin_access_control_id":{"references":["aws_cloudfront_origin_access_control.spa.id","aws_cloudfront_origin_access_control.spa"]},"origin_id":{"constant_value":"s3-spa-origin"}}],"price_class":{"references":["var.cloudfront_price_class"]},"restrictions":[{"geo_restriction":[{"restriction_type":{"constant_value":"none"}}]}],"viewer_certificate":[{"acm_certificate_arn":{"references":["local.use_custom_domain","aws_acm_certificate.this[0].arn","aws_acm_certificate.this[0]","aws_acm_certificate.this"]},"cloudfront_default_certificate":{"references":["local.use_custom_domain"]},"minimum_protocol_version":{"references":["local.use_custom_domain"]},"ssl_support_method":{"references":["local.use_custom_domain"]}}],"web_acl_id":{"references":["var.enable_waf","aws_wafv2_web_acl.this[0].arn","aws_wafv2_web_acl.this[0]","aws_wafv2_web_acl.this"]}},"schema_version":1,"depends_on":["aws_s3_bucket_public_access_block.spa"]},{"address":"aws_cloudfront_origin_access_control.spa","mode":"managed","type":"aws_cloudfront_origin_access_control","name":"spa","provider_config_key":"aws","expressions":{"description":{"constant_value":"OAC for private S3 origin"},"name":{"references":["local.name_prefix"]},"origin_access_control_origin_type":{"constant_value":"s3"},"signing_behavior":{"constant_value":"always"},"signing_protocol":{"constant_value":"sigv4"}},"schema_version":0},{"address":"aws_cloudfront_origin_request_policy.cors_s3origin","mode":"managed","type":"aws_cloudfront_origin_request_policy","name":"cors_s3origin","provider_config_key":"aws","expressions":{"comment":{"constant_value":"Fallback for AWS managed policy Managed-CORS-S3Origin"},"cookies_config":[{"cookie_behavior":{"constant_value":"none"}}],"headers_config":[{"header_behavior":{"constant_value":"whitelist"},"headers":[{"items":{"constant_value":["Origin","Access-Control-Request-Method","Access-Control-Request-Headers"]}}]}],"name":{"references":["local.name_prefix"]},"query_strings_config":[{"query_string_behavior":{"constant_value":"none"}}]},"schema_version":0},{"address":"aws_cloudfront_response_headers_policy.security_headers","mode":"managed","type":"aws_cloudfront_response_headers_policy","name":"security_headers","provider_config_key":"aws","expressions":{"name":{"references":["local.name_prefix"]},"security_headers_config":[{"content_type_options":[{"override":{"constant_value":true}}],"frame_options":[{"frame_option":{"constant_value":"DENY"},"override":{"constant_value":true}}],"referrer_policy":[{"override":{"constant_value":true},"referrer_policy":{"constant_value":"strict-origin-when-cross-origin"}}],"strict_transport_security":[{"access_control_max_age_sec":{"constant_value":63072000},"include_subdomains":{"constant_value":true},"override":{"constant_value":true},"preload":{"constant_value":true}}],"xss_protection":[{"mode_block":{"constant_value":true},"override":{"constant_value":true},"protection":{"constant_value":true}}]}]},"schema_version":0},{"address":"aws_codebuild_project.spa","mode":"managed","type":"aws_codebuild_project","name":"spa","provider_config_key":"aws","expressions":{"artifacts":[{"type":{"constant_value":"CODEPIPELINE"}}],"description":{"constant_value":"Build CRA app and deploy to S3 + invalidate CloudFront"},"environment":[{"compute_type":{"constant_value":"BUILD_GENERAL1_SMALL"},"environment_variable":[{"name":{"constant_value":"S3_BUCKET"},"value":{"references":["aws_s3_bucket.spa.bucket","aws_s3_bucket.spa"]}},{"name":{"constant_value":"CLOUDFRONT_DISTRIBUTION_ID"},"value":{"references":["aws_cloudfront_distribution.spa.id","aws_cloudfront_distribution.spa"]}}],"image":{"constant_value":"aws/codebuild/standard:7.0"},"image_pull_credentials_type":{"constant_value":"CODEBUILD"},"type":{"constant_value":"LINUX_CONTAINER"}}],"name":{"references":["local.name_prefix"]},"service_role":{"references":["aws_iam_role.codebuild[0].arn","aws_iam_role.codebuild[0]","aws_iam_role.codebuild"]},"source":[{"buildspec":{"constant_value":"version: 0.2\nphases:\n  install:\n    runtime-versions:\n      nodejs: 18\n    commands:\n      - npm ci\n  build:\n    commands:\n      - npm run build\n  post_build:\n    commands:\n      - aws s3 sync build s3://$S3_BUCKET/ --delete\n      - aws cloudfront create-invalidation --distribution-id $CLOUDFRONT_DISTRIBUTION_ID --paths \"/index.html\" \"/asset-manifest.json\" \"/\"\nartifacts:\n  files:\n    - '**/*'\n  base-directory: build\n"},"type":{"constant_value":"CODEPIPELINE"}}]},"schema_version":0,"count_expression":{"references":["var.enable_cicd"]}},{"address":"aws_codepipeline.spa","mode":"managed","type":"aws_codepipeline","name":"spa","provider_config_key":"aws","expressions":{"artifact_store":[{"location":{"references":["aws_s3_bucket.codepipeline_artifacts[0].bucket","aws_s3_bucket.codepipeline_artifacts[0]","aws_s3_bucket.codepipeline_artifacts"]},"type":{"constant_value":"S3"}}],"name":{"references":["local.name_prefix"]},"role_arn":{"references":["aws_iam_role.codepipeline[0].arn","aws_iam_role.codepipeline[0]","aws_iam_role.codepipeline"]},"stage":[{"action":[{"category":{"constant_value":"Source"},"configuration":{"references":["var.github_owner","var.github_repo","var.github_branch","var.github_token_secret_arn"]},"name":{"constant_value":"Source"},"output_artifacts":{"constant_value":["source_output"]},"owner":{"constant_value":"ThirdParty"},"provider":{"constant_value":"GitHub"},"run_order":{"constant_value":1},"version":{"constant_value":"1"}}],"name":{"constant_value":"Source"}},{"action":[{"category":{"constant_value":"Build"},"configuration":{"references":["aws_codebuild_project.spa[0].name","aws_codebuild_project.spa[0]","aws_codebuild_project.spa"]},"input_artifacts":{"constant_value":["source_output"]},"name":{"constant_value":"BuildDeploy"},"owner":{"constant_value":"AWS"},"provider":{"constant_value":"CodeBuild"},"version":{"constant_value":"1"}}],"name":{"constant_value":"BuildDeploy"}}]},"schema_version":0,"count_expression":{"references":["var.enable_cicd","var.enable_codepipeline"]}},{"address":"aws_iam_role.codebuild","mode":"managed","type":"aws_iam_role","name":"codebuild","provider_config_key":"aws","expressions":{"assume_role_policy":{},"name":{"references":["local.name_prefix"]}},"schema_version":0,"count_expression":{"references":["var.enable_cicd"]}},{"address":"aws_iam_role.codepipeline","mode":"managed","type":"aws_iam_role","name":"codepipeline","provider_config_key":"aws","expressions":{"assume_role_policy":{},"name":{"references":["local.name_prefix"]}},"schema_version":0,"count_expression":{"references":["var.enable_cicd","var.enable_codepipeline"]}},{"address":"aws_iam_role_policy.codebuild","mode":"managed","type":"aws_iam_role_policy","name":"codebuild","provider_config_key":"aws","expressions":{"name":{"references":["local.name_prefix"]},"policy":{"references":["aws_s3_bucket.spa.arn","aws_s3_bucket.spa","aws_s3_bucket.spa.arn","aws_s3_bucket.spa","aws_s3_bucket.codepipeline_artifacts[0].arn","aws_s3_bucket.codepipeline_artifacts[0]","aws_s3_bucket.codepipeline_artifacts","aws_s3_bucket.codepipeline_artifacts[0].arn","aws_s3_bucket.codepipeline_artifacts[0]","aws_s3_bucket.codepipeline_artifacts"]},"role":{"references":["aws_iam_role.codebuild[0].id","aws_iam_role.codebuild[0]","aws_iam_role.codebuild"]}},"schema_version":0,"count_expression":{"references":["var.enable_cicd"]}},{"address":"aws_iam_role_policy.codepipeline","mode":"managed","type":"aws_iam_role_policy","name":"codepipeline","provider_config_key":"aws","expressions":{"name":{"references":["local.name_prefix"]},"policy":{"references":["aws_s3_bucket.codepipeline_artifacts[0].arn","aws_s3_bucket.codepipeline_artifacts[0]","aws_s3_bucket.codepipeline_artifacts","aws_s3_bucket.codepipeline_artifacts[0].arn","aws_s3_bucket.codepipeline_artifacts[0]","aws_s3_bucket.codepipeline_artifacts","aws_codebuild_project.spa[0].arn","aws_codebuild_project.spa[0]","aws_codebuild_project.spa","var.github_token_secret_arn"]},"role":{"references":["aws_iam_role.codepipeline[0].id","aws_iam_role.codepipeline[0]","aws_iam_role.codepipeline"]}},"schema_version":0,"count_expression":{"references":["var.enable_cicd","var.enable_codepipeline"]}},{"address":"aws_route53_record.app_a","mode":"managed","type":"aws_route53_record","name":"app_a","provider_config_key":"aws","expressions":{"alias":[{"evaluate_target_health":{"constant_value":false},"name":{"references":["aws_cloudfront_distribution.spa.domain_name","aws_cloudfront_distribution.spa"]},"zone_id":{"references":["aws_cloudfront_distribution.spa.hosted_zone_id","aws_cloudfront_distribution.spa"]}}],"name":{"references":["var.domain_name"]},"type":{"constant_value":"A"},"zone_id":{"references":["var.hosted_zone_id"]}},"schema_version":2,"count_expression":{"references":["local.use_custom_domain","var.create_route53_records"]}},{"address":"aws_route53_record.app_aaaa","mode":"managed","type":"aws_route53_record","name":"app_aaaa","provider_config_key":"aws","expressions":{"alias":[{"evaluate_target_health":{"constant_value":false},"name":{"references":["aws_cloudfront_distribution.spa.domain_name","aws_cloudfront_distribution.spa"]},"zone_id":{"references":["aws_cloudfront_distribution.spa.hosted_zone_id","aws_cloudfront_distribution.spa"]}}],"name":{"references":["var.domain_name"]},"type":{"constant_value":"AAAA"},"zone_id":{"references":["var.hosted_zone_id"]}},"schema_version":2,"count_expression":{"references":["local.use_custom_domain","var.create_route53_records"]}},{"address":"aws_route53_record.cert_validation","mode":"managed","type":"aws_route53_record","name":"cert_validation","provider_config_key":"aws","expressions":{"name":{"references":["each.value.name","each.value"]},"records":{"references":["each.value.record","each.value"]},"ttl":{"constant_value":60},"type":{"references":["each.value.type","each.value"]},"zone_id":{"references":["var.hosted_zone_id"]}},"schema_version":2,"for_each_expression":{"references":["local.use_custom_domain","var.create_route53_records","aws_acm_certificate.this[0].domain_validation_options","aws_acm_certificate.this[0]","aws_acm_certificate.this"]}},{"address":"aws_s3_bucket.codepipeline_artifacts","mode":"managed","type":"aws_s3_bucket","name":"codepipeline_artifacts","provider_config_key":"aws","expressions":{"bucket":{"references":["local.name_prefix","data.aws_caller_identity.current.account_id","data.aws_caller_identity.current"]},"force_destroy":{"constant_value":false}},"schema_version":0,"count_expression":{"references":["var.enable_cicd"]}},{"address":"aws_s3_bucket.logs","mode":"managed","type":"aws_s3_bucket","name":"logs","provider_config_key":"aws","expressions":{"bucket":{"references":["local.name_prefix","data.aws_caller_identity.current.account_id","data.aws_caller_identity.current"]},"force_destroy":{"constant_value":false}},"schema_version":0,"count_expression":{"references":["var.enable_cloudfront_logs"]}},{"address":"aws_s3_bucket.spa","mode":"managed","type":"aws_s3_bucket","name":"spa","provider_config_key":"aws","expressions":{"bucket":{"references":["local.name_prefix","data.aws_caller_identity.current.account_id","data.aws_caller_identity.current"]},"force_destroy":{"constant_value":false}},"schema_version":0},{"address":"aws_s3_bucket_ownership_controls.logs","mode":"managed","type":"aws_s3_bucket_ownership_controls","name":"logs","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.logs[0].id","aws_s3_bucket.logs[0]","aws_s3_bucket.logs"]},"rule":[{"object_ownership":{"constant_value":"BucketOwnerEnforced"}}]},"schema_version":0,"count_expression":{"references":["var.enable_cloudfront_logs"]}},{"address":"aws_s3_bucket_ownership_controls.spa","mode":"managed","type":"aws_s3_bucket_ownership_controls","name":"spa","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.spa.id","aws_s3_bucket.spa"]},"rule":[{"object_ownership":{"constant_value":"BucketOwnerEnforced"}}]},"schema_version":0},{"address":"aws_s3_bucket_policy.spa","mode":"managed","type":"aws_s3_bucket_policy","name":"spa","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.spa.id","aws_s3_bucket.spa"]},"policy":{"references":["data.aws_iam_policy_document.spa_bucket.json","data.aws_iam_policy_document.spa_bucket"]}},"schema_version":0},{"address":"aws_s3_bucket_public_access_block.codepipeline_artifacts","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"codepipeline_artifacts","provider_config_key":"aws","expressions":{"block_public_acls":{"constant_value":true},"block_public_policy":{"constant_value":true},"bucket":{"references":["aws_s3_bucket.codepipeline_artifacts[0].id","aws_s3_bucket.codepipeline_artifacts[0]","aws_s3_bucket.codepipeline_artifacts"]},"ignore_public_acls":{"constant_value":true},"restrict_public_buckets":{"constant_value":true}},"schema_version":0,"count_expression":{"references":["var.enable_cicd"]}},{"address":"aws_s3_bucket_public_access_block.logs","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"logs","provider_config_key":"aws","expressions":{"block_public_acls":{"constant_value":true},"block_public_policy":{"constant_value":true},"bucket":{"references":["aws_s3_bucket.logs[0].id","aws_s3_bucket.logs[0]","aws_s3_bucket.logs"]},"ignore_public_acls":{"constant_value":true},"restrict_public_buckets":{"constant_value":true}},"schema_version":0,"count_expression":{"references":["var.enable_cloudfront_logs"]}},{"address":"aws_s3_bucket_public_access_block.spa","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"spa","provider_config_key":"aws","expressions":{"block_public_acls":{"constant_value":true},"block_public_policy":{"constant_value":true},"bucket":{"references":["aws_s3_bucket.spa.id","aws_s3_bucket.spa"]},"ignore_public_acls":{"constant_value":true},"restrict_public_buckets":{"constant_value":true}},"schema_version":0},{"address":"aws_s3_bucket_server_side_encryption_configuration.codepipeline_artifacts","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"codepipeline_artifacts","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.codepipeline_artifacts[0].id","aws_s3_bucket.codepipeline_artifacts[0]","aws_s3_bucket.codepipeline_artifacts"]},"rule":[{"apply_server_side_encryption_by_default":[{"sse_algorithm":{"constant_value":"AES256"}}]}]},"schema_version":0,"count_expression":{"references":["var.enable_cicd"]}},{"address":"aws_s3_bucket_server_side_encryption_configuration.logs","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"logs","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.logs[0].id","aws_s3_bucket.logs[0]","aws_s3_bucket.logs"]},"rule":[{"apply_server_side_encryption_by_default":[{"sse_algorithm":{"constant_value":"AES256"}}]}]},"schema_version":0,"count_expression":{"references":["var.enable_cloudfront_logs"]}},{"address":"aws_s3_bucket_server_side_encryption_configuration.spa","mode":"managed","type":"aws_s3_bucket_server_side_encryption_configuration","name":"spa","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.spa.id","aws_s3_bucket.spa"]},"rule":[{"apply_server_side_encryption_by_default":[{"sse_algorithm":{"constant_value":"AES256"}}]}]},"schema_version":0},{"address":"aws_s3_bucket_versioning.spa","mode":"managed","type":"aws_s3_bucket_versioning","name":"spa","provider_config_key":"aws","expressions":{"bucket":{"references":["aws_s3_bucket.spa.id","aws_s3_bucket.spa"]},"versioning_configuration":[{"status":{"constant_value":"Enabled"}}]},"schema_version":0},{"address":"aws_wafv2_web_acl.this","mode":"managed","type":"aws_wafv2_web_acl","name":"this","provider_config_key":"aws","expressions":{"default_action":[{"allow":[{}]}],"name":{"references":["local.name_prefix"]},"rule":[{"name":{"constant_value":"AWSManagedRulesCommonRuleSet"},"override_action":[{"none":[{}]}],"priority":{"constant_value":1},"statement":[{"managed_rule_group_statement":[{"name":{"constant_value":"AWSManagedRulesCommonRuleSet"},"vendor_name":{"constant_value":"AWS"}}]}],"visibility_config":[{"cloudwatch_metrics_enabled":{"constant_value":true},"metric_name":{"constant_value":"AWSManagedRulesCommonRuleSet"},"sampled_requests_enabled":{"constant_value":true}}]}],"scope":{"constant_value":"CLOUDFRONT"},"visibility_config":[{"cloudwatch_metrics_enabled":{"constant_value":true},"metric_name":{"references":["local.name_prefix"]},"sampled_requests_enabled":{"constant_value":true}}]},"schema_version":0,"count_expression":{"references":["var.enable_waf"]}},{"address":"data.aws_caller_identity.current","mode":"data","type":"aws_caller_identity","name":"current","provider_config_key":"aws","schema_version":0},{"address":"data.aws_iam_policy_document.spa_bucket","mode":"data","type":"aws_iam_policy_document","name":"spa_bucket","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["s3:GetObject"]},"condition":[{"test":{"constant_value":"StringEquals"},"values":{"references":["aws_cloudfront_distribution.spa.arn","aws_cloudfront_distribution.spa"]},"variable":{"constant_value":"AWS:SourceArn"}}],"principals":[{"identifiers":{"constant_value":["cloudfront.amazonaws.com"]},"type":{"constant_value":"Service"}}],"resources":{"references":["aws_s3_bucket.spa.arn","aws_s3_bucket.spa"]},"sid":{"constant_value":"AllowCloudFrontServicePrincipalReadOnly"}}]},"schema_version":0},{"address":"data.aws_partition.current","mode":"data","type":"aws_partition","name":"current","provider_config_key":"aws","schema_version":0},{"address":"data.aws_region.current","mode":"data","type":"aws_region","name":"current","provider_config_key":"aws","schema_version":0}],"variables":{"aws_region":{"default":"eu-west-1","description":"AWS region for primary resources (S3, WAF, etc.)."},"cloudfront_price_class":{"default":"PriceClass_100","description":"CloudFront price class."},"create_route53_records":{"default":false,"description":"Whether to create Route53 alias records for domain_name."},"domain_name":{"default":"","description":"Optional custom domain for the SPA (e.g., app.example.com). Leave empty to use the CloudFront domain."},"enable_cicd":{"default":false,"description":"Create CodeBuild project (and optional CodePipeline skeleton)."},"enable_cloudfront_logs":{"default":false,"description":"Enable CloudFront access logs to a dedicated S3 bucket."},"enable_codepipeline":{"default":false,"description":"Create a CodePipeline (requires a GitHub token in Secrets Manager)."},"enable_waf":{"default":true,"description":"Attach an AWS WAFv2 Web ACL (managed rules) to CloudFront."},"environment":{"default":"dev","description":"Environment name (e.g., dev, staging, prod)."},"github_branch":{"default":"main","description":"GitHub branch for CodePipeline source."},"github_owner":{"default":"","description":"GitHub owner/org for CodePipeline source (only used if enable_cicd=true and enable_codepipeline=true)."},"github_repo":{"default":"","description":"GitHub repo name for CodePipeline source (only used if enable_cicd=true and enable_codepipeline=true)."},"github_token_secret_arn":{"default":"","description":"ARN of a Secrets Manager secret containing a GitHub OAuth token (plaintext) for CodePipeline."},"hosted_zone_id":{"default":"","description":"Optional Route53 hosted zone ID for domain_name. Required if domain_name is set."},"project_name":{"default":"react-spa","description":"Project/name prefix used for resource naming."},"react_app_env":{"default":{},"description":"Map of build-time REACT_APP_* environment variables for CodeBuild (optional)."}}}},"relevant_attributes":[{"resource":"aws_s3_bucket.spa","attribute":["arn"]},{"resource":"aws_cloudfront_distribution.spa","attribute":["domain_name"]},{"resource":"aws_s3_bucket.spa","attribute":["bucket"]},{"resource":"aws_cloudfront_origin_access_control.spa","attribute":["id"]},{"resource":"aws_s3_bucket.spa","attribute":["bucket_regional_domain_name"]},{"resource":"aws_cloudfront_origin_request_policy.cors_s3origin","attribute":["id"]},{"resource":"aws_cloudfront_response_headers_policy.security_headers","attribute":["id"]},{"resource":"aws_cloudfront_distribution.spa","attribute":["arn"]},{"resource":"aws_s3_bucket.logs[0]","attribute":["bucket_domain_name"]},{"resource":"data.aws_caller_identity.current","attribute":["account_id"]},{"resource":"data.aws_iam_policy_document.spa_bucket","attribute":["json"]},{"resource":"aws_s3_bucket.spa","attribute":["id"]},{"resource":"aws_acm_certificate.this[0]","attribute":["arn"]},{"resource":"aws_cloudfront_distribution.spa","attribute":["id"]},{"resource":"aws_cloudfront_cache_policy.caching_optimized","attribute":["id"]},{"resource":"aws_wafv2_web_acl.this[0]","attribute":["arn"]}],"checks":[{"address":{"kind":"var","name":"cloudfront_price_class","to_display":"var.cloudfront_price_class"},"status":"pass","instances":[{"address":{"to_display":"var.cloudfront_price_class"},"status":"pass"}]}],"timestamp":"2026-01-27T07:52:43Z","applyable":true,"complete":true,"errored":false}
