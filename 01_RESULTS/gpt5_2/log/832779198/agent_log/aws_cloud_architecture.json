{
  "aws_architecture_description": "## Proposed high-level AWS architecture\n\nThis system has two deployable concerns that can share the same AWS account but should be deployed as two “stacks”:\n\n### A) Event-driven S3 file mover (S3 → Lambda)\n1. **Amazon S3 bucket**\n   - Single bucket with two logical prefixes: `source/` (ingress) and `destination/` (egress).\n   - **S3 Event Notification** configured for `s3:ObjectCreated:*` with an **object key prefix filter** of `source/` so only new uploads under `source/` invoke the function (and to avoid recursive invocation when the function writes to `destination/`). ([docs.aws.amazon.com](https://docs.aws.amazon.com/AmazonS3/latest/userguide/enable-event-notifications.html?utm_source=openai))\n\n2. **AWS Lambda (Python)**\n   - Runs `lambda_function.py` (boto3) to implement a “move” as **CopyObject → DeleteObject**.\n   - Configure:\n     - Environment variables for bucket name and prefixes (optional but recommended).\n     - Reserved concurrency (optional) to protect downstream and control cost.\n     - Timeout sized for expected object sizes (copy is server-side, but still allow for retries/latency).\n\n3. **IAM security**\n   - Lambda execution role with least-privilege permissions:\n     - `s3:GetObject` on `source/*`\n     - `s3:PutObject` (or `s3:CopyObject` via `s3:*Object` actions as needed) on `destination/*`\n     - `s3:DeleteObject` on `source/*`\n     - CloudWatch Logs permissions.\n   - Add an **S3-to-Lambda invoke permission** (resource-based permission on the Lambda) so S3 can invoke it. ([docs.aws.amazon.com](https://docs.aws.amazon.com/AmazonS3/latest/userguide/enable-event-notifications.html?utm_source=openai))\n\n4. **Reliability / correctness**\n   - S3 event notifications can be duplicated or arrive out of order; the Lambda should be **idempotent** (e.g., if destination key already exists, treat as success; if source key is already deleted, treat as success). ([aws.amazon.com](https://aws.amazon.com/blogs/storage/manage-event-ordering-and-duplicate-events-with-amazon-s3-event-notifications/?utm_source=openai))\n   - (Optional) Enable **S3 Versioning** to protect against accidental deletes and to aid recovery.\n\n5. **Observability**\n   - CloudWatch Logs for Lambda.\n   - CloudWatch metrics/alarms for Lambda errors/throttles and DLQ (if used).\n\n\n### B) Litecoin node container runtime on AWS (Docker Hub image → ECS on EC2)\nBecause a blockchain node needs persistent disk and stable networking, the lean AWS-native approach is:\n\n1. **Amazon ECS on EC2 (not Fargate)**\n   - Run the existing Docker Hub image as an **ECS Service** on an **EC2 Auto Scaling Group**.\n   - Use `awsvpc` networking so each task gets its own ENI and is controlled by security groups. ([docs.aws.amazon.com](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/security-network.html?utm_source=openai))\n\n2. **Persistent storage**\n   - Attach **EBS gp3** volumes to the EC2 instances and mount into the container for the Litecoin data directory.\n   - This keeps the node state across container restarts on the same instance.\n\n3. **Networking exposure**\n   - **P2P port 9333**: typically public inbound (from the internet) to participate in the network.\n   - **RPC port 9332**: restrict inbound to only trusted sources (e.g., a bastion/VPN, or a private subnet only). Do not expose RPC publicly.\n   - Use security groups to enforce this.\n\n4. **Optional load balancing**\n   - If you need stable inbound for P2P across instance replacement, use a **Network Load Balancer** for TCP 9333.\n   - For RPC, prefer private access (no LB) or a separate internal NLB with strict source restrictions.\n\n5. **Secrets**\n   - Store RPC credentials (if used) in **AWS Secrets Manager** and inject into the task.\n\n6. **CI/CD**\n   - Keep GitHub Actions building/pushing to Docker Hub as-is.\n   - (Optional AWS improvement) Mirror the image into **Amazon ECR** for better pull reliability and IAM-based access control, but it’s not required.\n\n\n## AWS resources to be created\n\n### Shared / foundational\n- Amazon VPC\n- Public subnets (2 AZs)\n- Private subnets (2 AZs) (recommended for ECS instances)\n- Internet Gateway\n- NAT Gateway (if ECS instances are private and must pull from Docker Hub)\n- Route tables (public/private) and routes\n- VPC endpoints (optional but recommended):\n  - Gateway endpoint: Amazon S3\n  - Interface endpoints: CloudWatch Logs, ECS, ECR (only if you adopt ECR), Secrets Manager\n- AWS KMS key (optional; for S3 SSE-KMS and Secrets Manager)\n\n### Stack A: S3 → Lambda mover\n- Amazon S3 bucket\n- S3 event notification configuration (ObjectCreated with prefix filter `source/`) ([docs.aws.amazon.com](https://docs.aws.amazon.com/AmazonS3/latest/userguide/enable-event-notifications.html?utm_source=openai))\n- AWS Lambda function (Python)\n- Lambda permission allowing S3 to invoke the function (resource-based policy)\n- IAM role for Lambda execution\n- IAM policy for S3 read/copy/delete scoped to bucket prefixes\n- CloudWatch Log Group for Lambda\n- CloudWatch Alarms (errors, throttles) (recommended)\n\n### Stack B: Litecoin node runtime (ECS on EC2)\n- Amazon ECS Cluster\n- ECS Task Definition (container from Docker Hub, ports 9332/9333, mount points)\n- ECS Service\n- ECS Capacity Provider (backed by an Auto Scaling Group) (recommended)\n- EC2 Auto Scaling Group for ECS container instances\n- EC2 Launch Template (ECS-optimized AMI, user data to join cluster)\n- Amazon EBS volumes (gp3) attached to ECS instances for blockchain data\n- Security Groups:\n  - SG for ECS instances/tasks (inbound 9333 from internet or NLB; inbound 9332 restricted)\n  - (If used) SG for internal admin access (bastion/VPN)\n- IAM instance profile/role for ECS instances (ECS agent, CloudWatch logs, Secrets Manager read if used)\n- (Optional) Network Load Balancer (TCP 9333) + target group + listeners\n- (Optional) AWS Secrets Manager secret for RPC credentials\n- CloudWatch Logs log group for container logs\n- CloudWatch Alarms (instance health, service desired vs running tasks)\n\n### Optional (if you choose to mirror Docker Hub → ECR)\n- Amazon ECR repository\n- IAM role/policy for pushing/pulling\n- (Optional) ECR lifecycle policy\n",
  "aws_resources": [
    "Amazon VPC",
    "Public Subnets (2 AZs)",
    "Private Subnets (2 AZs)",
    "Internet Gateway",
    "NAT Gateway",
    "Route Tables and Routes (public/private)",
    "VPC Gateway Endpoint for S3 (optional)",
    "VPC Interface Endpoints: CloudWatch Logs, ECS, Secrets Manager (optional)",
    "AWS KMS Key (optional)",
    "Amazon S3 Bucket",
    "S3 Event Notification (ObjectCreated with prefix filter source/)",
    "AWS Lambda Function (Python)",
    "Lambda Resource-based Permission for S3 Invoke",
    "IAM Role for Lambda Execution",
    "IAM Policy (least privilege S3 + CloudWatch Logs)",
    "Amazon CloudWatch Log Group (Lambda)",
    "Amazon CloudWatch Alarms (Lambda errors/throttles)",
    "Amazon ECS Cluster",
    "ECS Task Definition (Litecoin node container)",
    "ECS Service",
    "ECS Capacity Provider (recommended)",
    "EC2 Auto Scaling Group (ECS container instances)",
    "EC2 Launch Template (ECS-optimized AMI)",
    "Amazon EBS Volumes (gp3) for Litecoin data",
    "Security Groups (ECS/tasks, admin access)",
    "IAM Instance Profile/Role for ECS instances",
    "Amazon CloudWatch Log Group (ECS container logs)",
    "Amazon CloudWatch Alarms (ECS/EC2 health)",
    "Network Load Balancer (optional)",
    "NLB Target Group + Listeners (optional)",
    "AWS Secrets Manager Secret (optional)",
    "Amazon ECR Repository (optional)",
    "ECR Lifecycle Policy (optional)"
  ]
}