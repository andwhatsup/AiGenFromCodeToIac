{
  "aws_architecture_description": "### Proposed high-level AWS architecture (Node.js container on EKS)\n\n#### 1) Networking foundation\n- Deploy into a dedicated **VPC** in **us-east-1** spanning **at least 2 Availability Zones**.\n- Create **public subnets** (for internet-facing load balancers) and **private subnets** (for EKS worker nodes and Pods). This matches AWS EKS best practice: keep nodes private and expose only the load balancer publicly. ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/best-practices/subnets.html?utm_source=openai))\n- Provide outbound internet access for private subnets via **NAT Gateway(s)** (so nodes can pull images, reach AWS APIs, etc.).\n\n#### 2) Container image supply chain\n- **GitHub Actions** builds the Docker image from the repo’s Dockerfile and pushes it to **Amazon ECR** (`my-ecr-repo`).\n- Enable **ECR image scanning** and apply lifecycle policies to keep the repo lean.\n\n#### 3) Compute / orchestration (Amazon EKS)\n- Run the workload on **Amazon EKS** (`nawy-eks-cluster`) with:\n  - An **EKS managed node group** (EC2) in **private subnets**.\n  - The Kubernetes objects you already have: **Namespace `nodeaws`**, **Deployment (3 replicas)**, and **Service**.\n- For least-privilege AWS access from Pods (now or later), enable **IRSA (IAM Roles for Service Accounts)** by associating the cluster with an **IAM OIDC provider** and creating IAM roles bound to Kubernetes service accounts. ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html?utm_source=openai))\n\n#### 4) Ingress / exposure to the internet\n- Your current `Service: LoadBalancer` will provision an AWS load balancer and expose port **80** to the service, which forwards to Pods on **3000**.\n- Recommended approach on EKS:\n  - Install **AWS Load Balancer Controller** in the cluster.\n  - Keep the current Service type `LoadBalancer` if you want simple L4 exposure; on EKS this is typically a **Network Load Balancer (NLB)**. ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/best-practices/load-balancing.html?utm_source=openai))\n  - If you later need HTTPS termination, host/path routing, WAF, etc., add a Kubernetes **Ingress** and let the controller provision an **Application Load Balancer (ALB)**. ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/best-practices/load-balancing.html?utm_source=openai))\n- Add **Route 53** DNS (optional but typical) pointing a friendly hostname to the load balancer.\n\n#### 5) Observability, security, and operations\n- Use **CloudWatch Container Insights** (or at minimum CloudWatch Logs) for cluster/app logs and metrics.\n- Use **AWS KMS** for encryption of:\n  - EKS secrets envelope encryption (optional but recommended)\n  - ECR (at-rest) and CloudWatch Logs (if required by policy)\n- Use **AWS Secrets Manager** (optional) if/when you introduce secrets beyond Kubernetes manifests.\n\n#### 6) CI/CD permissions model\n- GitHub Actions should assume an AWS role (via OIDC federation) with permissions to:\n  - Push to ECR\n  - Update kubeconfig / deploy manifests to EKS\n  - (If Terraform is used) provision the underlying AWS resources\n\nThis design stays close to what your repo already does (ECR + EKS + Service type LoadBalancer), while adding the AWS “basics” (VPC layout, node groups, IAM, logging) needed for a secure and operable production deployment.\n\n---\n\n## AWS resources to create\n\n### Account / IAM\n- **IAM OIDC Identity Provider for GitHub Actions** (for CI/CD federation)\n- **IAM Role for GitHub Actions** (ECR push + EKS deploy + optional Terraform permissions)\n- **Amazon EKS Cluster IAM Role**\n- **EKS Node Group IAM Role (instance profile)**\n- **EKS OIDC Provider (for IRSA)** ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html?utm_source=openai))\n- **IAM Roles for Service Accounts** (at least for AWS Load Balancer Controller; optionally for app Pods)\n- **IAM policies** attached to the above roles (least privilege)\n\n### Networking\n- **VPC**\n- **Public subnets** (2+ AZs)\n- **Private subnets** (2+ AZs)\n- **Internet Gateway (IGW)**\n- **NAT Gateway(s)** (1 per AZ for HA, or 1 to reduce cost)\n- **Elastic IP(s)** for NAT Gateway(s)\n- **Route tables** (public + private) and **routes**\n- **Security Groups** (EKS control plane, node group, load balancer)\n- **Network ACLs** (default or custom, if required)\n\n### Container registry\n- **Amazon ECR repository** (`my-ecr-repo`)\n- **ECR lifecycle policy**\n- **ECR image scanning configuration**\n\n### Kubernetes / compute\n- **Amazon EKS cluster** (`nawy-eks-cluster`)\n- **EKS managed node group(s)** (EC2) in private subnets\n- (Optional) **EKS add-ons** (CoreDNS, kube-proxy, VPC CNI as managed add-ons)\n\n### Load balancing / ingress\n- **AWS Load Balancer Controller** (installed in-cluster; requires IAM + Kubernetes resources)\n- **Elastic Load Balancer** created by Kubernetes Service type `LoadBalancer` (typically **NLB**) ([docs.aws.amazon.com](https://docs.aws.amazon.com/eks/latest/best-practices/load-balancing.html?utm_source=openai))\n- (Optional) **ACM certificate** (if you move to HTTPS)\n- (Optional) **AWS WAF** (if using ALB and you need L7 protection)\n\n### DNS (optional but common)\n- **Route 53 hosted zone**\n- **Route 53 record** (A/AAAA alias to the LB)\n\n### Observability / security services\n- **CloudWatch Log Groups** (EKS control plane logs; application logs if shipped)\n- **CloudWatch alarms** (node health, LB 5xx, latency, etc.)\n- (Optional) **KMS key** for EKS secrets encryption and/or log encryption\n- (Optional) **AWS Secrets Manager** for application secrets\n- (Optional) **AWS CloudTrail** (often already enabled at account level)\n- (Optional) **AWS Config** (compliance / drift detection)",
  "aws_resources": [
    "VPC",
    "Public Subnets (2+ AZs)",
    "Private Subnets (2+ AZs)",
    "Internet Gateway (IGW)",
    "NAT Gateway(s)",
    "Elastic IP(s) for NAT Gateway(s)",
    "Route Tables (public/private) and Routes",
    "Security Groups (EKS control plane, nodes, load balancer)",
    "Network ACLs (default or custom)",
    "Amazon ECR Repository (my-ecr-repo)",
    "ECR Lifecycle Policy",
    "ECR Image Scanning Configuration",
    "Amazon EKS Cluster (nawy-eks-cluster)",
    "EKS Cluster IAM Role",
    "EKS Managed Node Group(s)",
    "Node Group IAM Role / Instance Profile",
    "EKS Managed Add-ons (CoreDNS, kube-proxy, VPC CNI)",
    "IAM OIDC Provider for EKS (IRSA)",
    "IAM Roles for Service Accounts (IRSA roles)",
    "IAM OIDC Provider for GitHub Actions",
    "IAM Role for GitHub Actions (CI/CD deploy role)",
    "AWS Load Balancer Controller (Kubernetes deployment + IAM)",
    "Elastic Load Balancer created by Kubernetes Service type LoadBalancer (typically NLB)",
    "Amazon CloudWatch Log Groups",
    "CloudWatch Alarms",
    "AWS KMS Key (optional, for secrets/log encryption)",
    "AWS Certificate Manager Certificate (optional, for HTTPS)",
    "Amazon Route 53 Hosted Zone (optional)",
    "Route 53 DNS Records (optional)",
    "AWS WAF (optional, if using ALB/Ingress)",
    "AWS Secrets Manager (optional)",
    "AWS CloudTrail (optional / account-level)",
    "AWS Config (optional)"
  ]
}