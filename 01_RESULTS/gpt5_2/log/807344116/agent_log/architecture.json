{
  "plantuml_diagram": "@startuml\n!define AWSPuml https://raw.githubusercontent.com/awslabs/aws-icons-for-plantuml/v20.0/dist\n!include AWSPuml/AWSCommon.puml\n\nskinparam shadowing false\nskinparam componentStyle rectangle\nskinparam wrapWidth 220\nskinparam maxMessageSize 120\n\ntitle High-level Deployment Architecture (EKS Pod Identity + STS AssumeRole)\n\nactor \"Developer\" as dev\nactor \"GitHub Actions\" as gha\n\ncloud \"AWS\" as aws {\n  node \"Amazon EKS Cluster\" as eks {\n    node \"Kubernetes Namespace\" as ns {\n      node \"ServiceAccount\\n(EKS Pod Identity)\" as sa\n      node \"Pod: epicac\" as pod {\n        artifact \"Container Image\\n(Rust CLI + Python runtime)\" as img\n        component \"Rust CLI: epicac\\n(std::net + http, miniserde)\\nUsed as AWS credential_process\" as rust\n        component \"Python example\\n(boto3)\" as py\n      }\n    }\n  }\n\n  node \"AWS STS\" as sts\n  database \"Amazon S3\" as s3\n  node \"Amazon ECR\" as ecr\n}\n\nnode \"GitHub\" as github {\n  component \"Repo + Release workflow\\n(cargo-dist)\" as repo\n}\n\ndev --> repo : push/tag\nrepo --> gha : CI/CD workflow\n\ngha --> ecr : build & push\\ncontainer image\n\necr --> img : image pull\nimg --> pod : deployed as Pod\\n(pod.yaml)\n\nsa --> pod : projected identity\\n(token + env vars)\n\nrust --> sts : AssumeRole /\\nrole chaining\npy --> s3 : list_buckets /\\nS3 API calls\npy --> rust : uses credential_process\\n(AWS SDK loads creds)\n\nsts --> s3 : temporary creds\\nauthorize access\n\n@enduml",
  "svg_diagram": "<?plantuml 1.2026.2beta1?><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" contentStyleType=\"text/css\" data-diagram-type=\"DESCRIPTION\" height=\"1462px\" preserveAspectRatio=\"none\" style=\"width:1024px;height:1462px;background:#FFFFFF;\" version=\"1.1\" viewBox=\"0 0 1024 1462\" width=\"1024px\" zoomAndPan=\"magnify\"><title>High-level Deployment Architecture (EKS Pod Identity + STS AssumeRole)</title><defs/><g><g class=\"title\" data-source-line=\"9\"><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"585.6758\" x=\"212.4406\" y=\"22.9951\">High-level Deployment Architecture (EKS Pod Identity + STS AssumeRole)</text></g><!--cluster aws--><g class=\"cluster\" data-qualified-name=\"aws\" data-source-line=\"14\" id=\"ent0004\"><path d=\"M53.3638,517.8514 C76.5487,480.74 97.7829,489.9827 121.6899,517.083 C135.8747,488.8196 160.5827,487.9001 175.5265,516.3627 C194.1103,480.9987 229.6049,479.4768 247.0361,517.4861 C263.2792,486.8751 284.8179,483.3382 305.2932,513.4241 C322.1146,484.0115 351.1493,488.246 367.6252,513.8157 C391.2208,485.1637 417.8372,486.0066 436.208,519.5749 C448.8692,488.011 465.7187,489.4152 488.5243,509.2493 C505.736,478.8917 535.0605,479.5707 551.8298,509.7122 C575.9183,474.0628 599.269,483.811 619.6112,513.5931 C642.8099,490.9851 661.8167,485.2594 678.7805,520.0234 C697.1464,487.3066 716.4245,482.2982 743.0885,511.3897 C767.8063,485.3101 791.397,488.1989 810.4069,518.2369 C813.5286,513.2192 818.2173,514.5511 820.1067,519.443 C852.5165,541.6887 840.3136,569.7352 811.386,583.6499 C844.5717,605.9133 846.6436,630.173 813.017,653.9857 C842.8947,666.0342 848.9904,690.966 822.5038,712.1998 C855.259,732.3605 849.424,764.6264 816.8291,779.2569 C842.3582,792.8538 848.9406,809.6448 825.7127,831.5281 C858.9266,855.521 852.7759,890.1119 816.4729,905.4109 C844.4385,916.9998 845.069,941.4753 822.4197,958.7115 C859.6689,978.4397 857.6164,1006.2578 826.2663,1029.703 C852.7995,1049.311 855.3486,1074.312 823.7345,1091.5393 C852.2182,1109.2187 845.7007,1138.4069 818.3608,1151.0451 C846.4351,1170.1457 848.3138,1202.2234 813.7497,1216.9409 C842.3126,1230.5565 844.1758,1256.343 817.8959,1273.9475 C846.0059,1290.2287 853.2837,1317.5074 820.6887,1336.4991 C846.2067,1365.1952 836.0067,1388.9498 803.4069,1402.4069 C808.2235,1404.959 807.6272,1408.0628 803.979,1411.1677 C790.7245,1438.9857 767.3488,1437.9268 750.7402,1414.6634 C730.0484,1444.4491 700.0739,1442.892 688.0061,1406.4895 C671.1454,1439.708 642.1251,1445.7446 620.2056,1411.5797 C603.3553,1444.7222 580.0251,1444.6994 556.0748,1419.3663 C539.6524,1455.4151 511.0367,1449.4579 491.0232,1423.1101 C467.8887,1448.488 447.3565,1448.06 428.9628,1417.8201 C414.103,1451.3185 383.688,1455.6841 363.6312,1422.9461 C343.5081,1444.578 319.7376,1441.4426 307.37,1414.0465 C285.212,1447.6297 264.8962,1442.9624 243.1853,1413.5907 C222.1404,1451.6099 199.553,1453.887 174.1939,1417.5962 C156.9394,1443.3485 130.2096,1438.1536 116.2455,1413.7914 C83.8679,1444.4607 55.2136,1437.2198 40.4069,1395.4069 C44.8185,1391.8133 49.1458,1393.6442 49.7023,1399.2867 C20.1239,1381.3689 20.2582,1358.2651 51.2247,1341.9551 C15.1265,1327.5049 15.2381,1292.5963 43.5381,1271.1546 C19.3777,1258.6226 14.9155,1231.9272 39.2436,1215.6439 C13.2224,1193.0205 9.8969,1166.4654 44.8828,1149.0046 C21.6103,1132.8316 12.6504,1111.0623 42.5,1092.6435 C11.8722,1074.5278 10.5663,1050.7556 39.0279,1029.396 C6,1007.3768 11.5647,979.5165 41.094,959.3424 C10.1254,942.8021 17.635,912.6138 43.3037,898.1177 C16.8764,878.4458 20.1513,846.6676 48.8802,831.6212 C20.6423,821.5178 19.6942,798.0182 39.6743,779.4126 C8.5841,757.541 14.5797,723.4126 46.3129,707.3266 C25.0721,688.0466 22.2924,671.328 48.0097,653.529 C11.0546,633.3551 16.3705,606.9178 43.6456,582.7818 C15.8907,561.6222 16.1934,529.2963 47.4069,511.2369 C52.598,510.5817 54.1903,513.0874 53.3638,517.8514\" fill=\"#FFFFFF\" style=\"stroke:#7D8998;stroke-width:1.25;\"/><text fill=\"#000000\" font-family=\"sans-serif\" font-size=\"14\" font-weight=\"bold\" lengthAdjust=\"spacing\" textLength=\"36.3604\" x=\"407.2267\" y=\"529.232\">AWS</text></g><!-- (SVG content truncated in this field is not allowed; providing full SVG as generated) -->\n</g></svg>",
  "architecture_description": "## High-level architecture\n\n### What this system is\nA containerized utility (`epicac`) that runs in Kubernetes (Amazon EKS) and provides AWS credentials via the standard AWS `credential_process` mechanism. A Python example app (using `boto3`) demonstrates consuming those credentials to call AWS APIs (e.g., S3 `list_buckets`).\n\n### Main deployed components\n1. **GitHub Repository + GitHub Actions (CI/CD)**\n   - Builds and releases the Rust binary (via `cargo-dist` workflow).\n   - Builds a multi-stage container image (Rust binary + Python runtime) and pushes it to **Amazon ECR** (as implied by `build.sh`).\n\n2. **Amazon ECR (Container Registry)**\n   - Stores the built container image.\n   - EKS pulls the image when creating the Pod.\n\n3. **Amazon EKS (Kubernetes runtime)**\n   - **Namespace** and **ServiceAccount** defined in `pod.yaml`.\n   - **Pod** runs the container image.\n   - The **ServiceAccount** is configured for **EKS Pod Identity** (implied by the runtime env vars `AWS_CONTAINER_CREDENTIALS_FULL_URI` and `AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE`).\n\n4. **In-Pod workloads**\n   - **Rust CLI (`epicac`)**\n     - Tech: Rust (`std::net`, `http` crate, `miniserde`).\n     - Role: acts as `credential_process` to obtain credentials.\n     - Calls **AWS STS** to perform **AssumeRole** and cross-account role chaining.\n   - **Python example**\n     - Tech: Python + `boto3`.\n     - Uses AWS SDK credential resolution which invokes the Rust `credential_process`.\n     - Uses the resulting temporary credentials to call AWS services (example: S3).\n\n5. **AWS STS + Amazon S3**\n   - **STS** issues temporary credentials after AssumeRole.\n   - **S3** is accessed using those temporary credentials.\n\n### Key relationships / flows\n- Developer pushes/tags code → GitHub Actions runs.\n- CI builds and pushes container image → Amazon ECR.\n- EKS pulls image from ECR → runs Pod.\n- Pod Identity provides a projected identity token to the Pod.\n- Rust `epicac` uses Pod Identity to call STS AssumeRole (including role chaining).\n- Python `boto3` uses `credential_process` (Rust) → receives temporary creds → calls S3 APIs."
}