{
  "aws_architecture_description": "## Target AWS architecture (lean, production-ready)\n\n### 1) Networking & entry\n- Deploy into a dedicated **VPC** spanning **2 Availability Zones** for high availability.\n- Create **public subnets** (for load balancer) and **private subnets** (for compute + database).\n- Expose the service via an **Application Load Balancer (ALB)** in public subnets.\n  - **TLS termination at ALB** using **ACM**.\n  - Route `mlflow.<your-domain>` via **Route 53** to the ALB.\n\n### 2) Compute (container runtime)\n- Run the MLflow tracking server container on **Amazon ECS on Fargate** (recommended over EC2 for simplicity).\n  - The container image is pulled from **Amazon ECR** (private) or **ECR Public** (either works; private is typical for production).\n  - The ECS **Service** runs tasks in **private subnets** with no public IPs.\n  - The ALB forwards traffic to the ECS service target group.\n\n**About nginx + basic auth in the container**\n- Keep the current container design (nginx + supervisord + mlflow) unchanged for fastest migration.\n- Prefer moving authentication to the edge over time:\n  - Option A (simple): keep **nginx basic auth** as-is.\n  - Option B (more AWS-native): use **ALB authentication (OIDC/Cognito)** and remove basic auth from nginx later.\n\n### 3) Data layer\n- **Metadata store**: Use **Amazon RDS for PostgreSQL** (Multi-AZ) as the MLflow backend store.\n  - Store DB credentials in **AWS Secrets Manager**.\n  - Restrict DB access to only the ECS task security group.\n- **Artifact store**: Use an **S3 bucket** for MLflow artifacts.\n  - Enable **SSE-KMS** encryption.\n  - Block public access.\n  - Optionally enable **bucket versioning** and lifecycle policies (e.g., transition to IA/Glacier).\n\n### 4) IAM & security\n- Use an **ECS task execution role** (pull image, write logs) and a separate **task role** (S3 access, KMS decrypt, Secrets Manager read).\n- Use **security groups**:\n  - ALB SG: inbound 443 from Internet; outbound to ECS.\n  - ECS SG: inbound only from ALB SG; outbound to RDS + S3 (via endpoints).\n  - RDS SG: inbound only from ECS SG.\n- Add **VPC endpoints** to keep traffic private and reduce NAT usage:\n  - **Gateway endpoint for S3**.\n  - **Interface endpoints** for ECR (api + dkr), CloudWatch Logs, Secrets Manager, KMS (optional but common).\n\n### 5) Observability & operations\n- Send container logs to **CloudWatch Logs**.\n- Enable **CloudWatch alarms** (ECS CPU/memory, ALB 5xx/latency, RDS CPU/storage/connections).\n- Use **AWS CloudTrail** for audit and **AWS Config** (optional) for compliance posture.\n\n### 6) CI/CD (GitHub Actions â†’ AWS)\n- Keep GitHub Actions, but switch to **OIDC federation** (recommended) so GitHub can assume an **IAM role** without long-lived AWS keys.\n- Pipeline flow:\n  1) Build Docker image\n  2) Push to ECR\n  3) Deploy by updating ECS service (new task definition revision)\n\n### 7) Scaling & resilience\n- ECS Service autoscaling based on CPU/memory and/or ALB request count.\n- RDS Multi-AZ for failover.\n- S3 is inherently multi-AZ.\n\n---\n\n## Minimal deployment variant (if you want the fewest moving parts)\n- Same as above, but skip VPC endpoints and use a **single NAT Gateway** for private subnet egress.\n- Keep nginx basic auth in-container.\n\n---\n\n## Notes specific to MLflow\n- Configure MLflow with:\n  - `--backend-store-uri` pointing to the RDS PostgreSQL endpoint\n  - `--default-artifact-root` pointing to the S3 bucket/prefix\n- Ensure the ECS task role has S3 permissions for the artifact prefix and KMS permissions if using SSE-KMS.\n",
  "aws_resources": [
    "Amazon VPC",
    "Public subnets (2 AZs)",
    "Private subnets (2 AZs)",
    "Internet Gateway",
    "NAT Gateway (1 or 2) + Elastic IP(s)",
    "Route tables (public/private)",
    "Security Groups (ALB, ECS tasks, RDS)",
    "AWS WAF (optional, recommended for internet-facing ALB)",
    "Amazon Route 53 Hosted Zone + DNS record (A/AAAA alias to ALB)",
    "AWS Certificate Manager (ACM) certificate for TLS",
    "Elastic Load Balancing - Application Load Balancer (ALB)",
    "ALB Target Group",
    "ALB Listener (443) + optional HTTP(80)->HTTPS redirect",
    "Amazon ECS Cluster",
    "Amazon ECS Task Definition",
    "Amazon ECS Service (Fargate)",
    "AWS Fargate capacity (serverless compute)",
    "Amazon ECR repository (private) or ECR Public image reference",
    "AWS IAM Role - ECS Task Execution Role",
    "AWS IAM Role - ECS Task Role (S3/Secrets/KMS access)",
    "AWS IAM Policy attachments for least-privilege access",
    "AWS Secrets Manager secret (RDS credentials, MLflow basic auth secret if needed)",
    "Amazon RDS for PostgreSQL (Multi-AZ)",
    "RDS DB Subnet Group",
    "RDS Parameter Group (optional)",
    "RDS Option Group (optional)",
    "Amazon S3 bucket for MLflow artifacts",
    "S3 bucket policy (least privilege)",
    "S3 Block Public Access settings",
    "AWS KMS key (for S3 SSE-KMS and optionally Secrets Manager)",
    "Amazon CloudWatch Logs Log Group(s)",
    "Amazon CloudWatch Alarms (ECS, ALB, RDS)",
    "AWS CloudTrail (account-level)",
    "VPC Gateway Endpoint for S3 (recommended)",
    "VPC Interface Endpoints (recommended): ECR (api, dkr), CloudWatch Logs, Secrets Manager, KMS (optional)",
    "IAM Role for GitHub Actions via OIDC (recommended)",
    "AWS Systems Manager Parameter Store (optional for non-secret config)"
  ]
}